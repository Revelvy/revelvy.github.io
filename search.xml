<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Maven ä½¿ç”¨æŒ‡å—</title>
      <link href="/2021/08/27/maven-shi-yong-zhi-nan/"/>
      <url>/2021/08/27/maven-shi-yong-zhi-nan/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¦‚å¿µï¼šä¸“å®¶ã€‚</p><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½œç”¨ï¼šç®¡ç† jar åŒ…çš„å·¥å…·ï¼ŒåŸºäºJavaå¹³å°çš„é¡¹â½¬æ„å»ºã€ä¾èµ–ç®¡ç†ã€é¡¹â½¬ä¿¡æ¯ç®¡ç†é¡¹ç›®æ„å»ºå·¥å…·ã€‚</p><blockquote><p>é¡¹ç›®æ„å»ºå·¥å…·ï¼šAntï¼ˆJavaï¼‰ã€Mavenï¼ˆJavaï¼‰ã€Gradleï¼ˆGroovyï¼‰ã€‚</p></blockquote><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä»“åº“</p><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æœ¬åœ°ä»“åº“</p><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è¿œç¨‹ä»“åº“</p><ol><li><p>ä¸­å¤®ä»“åº“ï¼šé»˜è®¤é…ç½®ä¸‹ï¼ŒMavenä¸‹è½½jaråŒ…çš„åœ°æ–¹ã€‚</p></li><li><p>ç§æœï¼šç‰¹æ®Šçš„è¿œç¨‹ä»“åº“ï¼Œä¸ºäº†èŠ‚çœå¸¦å®½å’Œæ—¶é—´ï¼Œæ¶è®¾åœ¨å±€åŸŸç½‘å†…çš„ç§æœ‰ä»“åº“æœåŠ¡å™¨ï¼Œä»£ç†æ‰€æœ‰å¤–éƒ¨çš„è¿œç¨‹ä»“åº“ã€‚</p></li></ol><blockquote><p>å…¬å¸å†…éƒ¨åº”å»ºç«‹ç§æœï¼š<br>1.èŠ‚çœå¤–ç½‘å¸¦å®½<br>2.åŠ é€Ÿ Maven æ„å»º<br>3.éƒ¨ç½²ç¬¬ä¸‰æ–¹æ§ä»¶<br>4.æé«˜ç¨³å®šæ€§<br>5.é™ä½ä¸­å¤®ä»“åº“çš„è´Ÿè·</p></blockquote><ol start="3"><li>å…¶ä»–å…¬å…±ä»“åº“ï¼šé˜¿é‡Œäº‘ã€åä¸ºäº‘</li></ol><h2 id="å®‰è£…-é…ç½®ä»“åº“"><a href="#å®‰è£…-é…ç½®ä»“åº“" class="headerlink" title="å®‰è£… é…ç½®ä»“åº“"></a>å®‰è£… é…ç½®ä»“åº“</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¸‹è½½ï¼š<a href="http://maven.apache.org/download.html">http://maven.apache.org/download.html</a></p><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç¯å¢ƒå˜é‡ï¼š</p><p>â€‹    æ–°å»ºï¼šMVN_HOME</p><p>â€‹    pathï¼š%MVN_HOME%\bin;</p><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ£€æŸ¥ï¼šcmd â€“&gt; mvn -v</p><h3 id="é…ç½®ä»“åº“"><a href="#é…ç½®ä»“åº“" class="headerlink" title="é…ç½®ä»“åº“"></a>é…ç½®ä»“åº“</h3><p> apache-maven-3.6.3\conf\settings.xml</p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"> <span class="token comment">&lt;!-- æœ¬åœ°ä»“åº“ --&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>localRepository</span><span class="token punctuation">&gt;</span></span>D:\Java\maven\apache-maven-3.6.3\repository<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>localRepository</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrors</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- é˜¿é‡Œäº‘ä¸­å¤®ä»“åº“ --&gt;</span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>nexus-aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>Nexus aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://maven.aliyun.com/nexus/content/groups/public<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- åä¸ºäº‘ä¸­å¤®ä»“åº“ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>huaweicloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://mirrors.huaweicloud.com/repository/maven/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrors</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java">æ ¼å¼ï¼šmvn <span class="token punctuation">[</span>plugin<span class="token operator">-</span>name<span class="token punctuation">]</span><span class="token operator">:</span><span class="token punctuation">[</span>goal<span class="token operator">-</span>name<span class="token punctuation">]</span><span class="token comment">// æ‰§è¡Œ plugin-name æ’ä»¶çš„ goal-name ç›®æ ‡</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th>Maven å‘½ä»¤</th><th>è¿è¡Œå‘½ä»¤æ—¶ï¼Œå…ˆå®šä½åˆ°Mavené¡¹ç›®çš„ç›®å½•</th></tr></thead><tbody><tr><td>mvn â€“version</td><td>ç‰ˆæœ¬</td></tr><tr><td>mvn clean</td><td>æ¸…ç†é¡¹ç›®çš„ä¸´æ—¶æ–‡ä»¶  ${basedir} / target</td></tr><tr><td>mvn compile</td><td>ç¼–è¯‘Javaæºä»£ç   ${basedir} / src / main / java</td></tr><tr><td>mvn package</td><td>æ‰“åŒ…  åœ¨æ¨¡å—ä¸‹çš„ target ç›®å½•ç”Ÿæˆ jar / war æ‰“åŒ…æ–‡ä»¶</td></tr><tr><td>mvn test</td><td>æµ‹è¯•  æ‰§è¡Œ ${basedir} / src / test / java / ä¸‹junitçš„æµ‹è¯•ç”¨ä¾‹</td></tr><tr><td>mvn install</td><td>å°† jar / war æ‰“åŒ…æ–‡ä»¶å¤åˆ¶åˆ°æœ¬åœ°ä»“åº“ï¼Œä¾›å…¶ä»–æ¨¡å—ä½¿ç”¨</td></tr><tr><td>mvn deploy</td><td>å°† jar / war æ‰“åŒ…æ–‡ä»¶å‘å¸ƒåˆ°è¿œç¨‹å‚è€ƒï¼Œæä¾›å…¶ä»–äººå‘˜è¿›è¡Œä¸‹è½½ä¾èµ–</td></tr><tr><td>mvn site</td><td>ç”Ÿæˆé¡¹ç›®ç›¸å…³ä¿¡æ¯çš„ç½‘ç«™</td></tr><tr><td>mvn eclipse:eclipse</td><td>è½¬ä¸ºEclipseé¡¹ç›®</td></tr><tr><td>mvn dependency:tree</td><td>æ‰“å°é¡¹ç›®ä¾èµ–æ ‘</td></tr><tr><td>mvn archetype:generate</td><td>åˆ›å»ºMavençš„æ™®é€šjavaé¡¹ç›®</td></tr><tr><td>mvn tomcat7:run</td><td>åœ¨tomcatå®¹å™¨ä¸­è¿è¡Œwebåº”ç”¨</td></tr><tr><td>mvn jetty:run</td><td>è°ƒç”¨ Jetty æ’ä»¶çš„ Run ç›®æ ‡åœ¨ Jetty Servlet å®¹å™¨ä¸­å¯åŠ¨ web åº”ç”¨</td></tr></tbody></table><h2 id="å‘½ä»¤å‚æ•°"><a href="#å‘½ä»¤å‚æ•°" class="headerlink" title="å‘½ä»¤å‚æ•°"></a>å‘½ä»¤å‚æ•°</h2><h3 id="D-ä¼ å…¥å±æ€§å‚æ•°"><a href="#D-ä¼ å…¥å±æ€§å‚æ•°" class="headerlink" title="-D ä¼ å…¥å±æ€§å‚æ•°"></a>-D ä¼ å…¥å±æ€§å‚æ•°</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">mvn <span class="token keyword">package</span> <span class="token operator">-</span><span class="token class-name">Dmaven</span><span class="token punctuation">.</span>test<span class="token punctuation">.</span>skip<span class="token operator">=</span><span class="token boolean">true</span>   æ‰“åŒ…æ—¶è·³è¿‡å•å…ƒæµ‹è¯•mvn deploy <span class="token operator">-</span><span class="token class-name">Dmaven</span><span class="token punctuation">.</span>test<span class="token punctuation">.</span>skip<span class="token operator">=</span><span class="token boolean">true</span>    éƒ¨ç½²ï¼Œå¹¶è·³è¿‡å•å…ƒæµ‹è¯•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="P-æŒ‡å®š-Profile-æ‰“åŒ…ç¯å¢ƒé…ç½®"><a href="#P-æŒ‡å®š-Profile-æ‰“åŒ…ç¯å¢ƒé…ç½®" class="headerlink" title="-P æŒ‡å®š Profile æ‰“åŒ…ç¯å¢ƒé…ç½®"></a>-P æŒ‡å®š Profile æ‰“åŒ…ç¯å¢ƒé…ç½®</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">é¡¹ç›®ç¯å¢ƒï¼šå¼€å‘ï¼Œæµ‹è¯•ï¼Œé¢„å‘ï¼Œæ­£å¼æŒ‰ä¸åŒç¯å¢ƒè¿›è¡Œæ‰“åŒ…éƒ¨ç½²    mvn <span class="token keyword">package</span> <span class="token operator">-</span><span class="token class-name">Pdev</span> <span class="token operator">-</span><span class="token class-name">Dmaven</span><span class="token punctuation">.</span>test<span class="token punctuation">.</span>skip<span class="token operator">=</span><span class="token boolean">true</span>  æ‰“åŒ…æœ¬åœ°å¼€å‘ç¯å¢ƒï¼Œå¹¶è·³è¿‡å•å…ƒæµ‹è¯•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="IDEA"><a href="#IDEA" class="headerlink" title="IDEA"></a>IDEA</h2><h3 id="IDEA-Maven"><a href="#IDEA-Maven" class="headerlink" title="IDEA  Maven"></a>IDEA  Maven</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225431.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225436.png"></p><h3 id="IDEA-Javaé¡¹ç›®"><a href="#IDEA-Javaé¡¹ç›®" class="headerlink" title="IDEA  Javaé¡¹ç›®"></a>IDEA  Javaé¡¹ç›®</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225441.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225445.png"><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225452.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225455.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225458.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225501.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225504.png"></p><h3 id="IDEA-Webé¡¹ç›®"><a href="#IDEA-Webé¡¹ç›®" class="headerlink" title="IDEA  Webé¡¹ç›®"></a>IDEA  Webé¡¹ç›®</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225508.png"></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">pom.xml  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project.build.sourceEncoding</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">Jetty  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>WebappTest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mortbay.jetty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-jetty-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.1.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">&lt;!-- çƒ­éƒ¨ç½²ï¼Œæ¯10ç§’æ‰«æä¸€æ¬¡ --&gt;</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scanIntervalSeconds</span><span class="token punctuation">&gt;</span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scanIntervalSeconds</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">&lt;!-- å¯æŒ‡å®šå½“å‰é¡¹ç›®çš„ç«™ç‚¹å --&gt;</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contextPath</span><span class="token punctuation">&gt;</span></span>/test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contextPath</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connectors</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connector</span> <span class="token attr-name">implementation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.mortbay.jetty.nio.SelectChannelConnector<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>              <span class="token comment">&lt;!-- è®¾ç½®å¯åŠ¨çš„ç«¯å£å· --&gt;</span>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span>9090<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>port</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>connector</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>connectors</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">Tomcat  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>WebappTest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.tomcat.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tomcat7-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">&lt;!-- å¯åŠ¨ç«¯å£ é»˜è®¤:8080 --&gt;</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span>8080<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>port</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">&lt;!-- é¡¹ç›®çš„ç«™ç‚¹åï¼Œå³å¯¹å¤–è®¿é—®è·¯å¾„ --&gt;</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><span class="token punctuation">&gt;</span></span>/test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">&lt;!-- å­—ç¬¦é›†ç¼–ç  é»˜è®¤ï¼šISO-8859-1 --&gt;</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uriEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>uriEncoding</span><span class="token punctuation">&gt;</span></span>          <span class="token comment">&lt;!-- æœåŠ¡å™¨åç§° --&gt;</span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span><span class="token punctuation">&gt;</span></span>tomcat7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>server</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225512.png"></p><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><h3 id="ä¾èµ–ç®¡ç†ç³»ç»Ÿ"><a href="#ä¾èµ–ç®¡ç†ç³»ç»Ÿ" class="headerlink" title="ä¾èµ–ç®¡ç†ç³»ç»Ÿ"></a>ä¾èµ–ç®¡ç†ç³»ç»Ÿ</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">ä¾èµ–å¯¼å…¥https://mvnrepository.com ç¡®å®šç‰ˆæœ¬ï¼Œæ‹·è´åœ°å€pom.xml  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- https://mvnrepository.com/artifact/dom4j/dom4j --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>dom4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dom4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.6.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>ä¾èµ–å¯»æ‰¾å½“Mavenæ ¹æ®ä¾èµ–åæ ‡å¯»æ‰¾æ„ä»¶æ—¶ï¼Œå…ˆæŸ¥çœ‹æœ¬åœ°ä»“åº“ï¼Œè‹¥æœ‰ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ï¼›è‹¥æ— ï¼Œå°±ä¼šå»è¿œç¨‹ä»“åº“æŸ¥æ‰¾ï¼Œå‘ç°éœ€è¦çš„æ„ä»¶ä¹‹åï¼Œä¸‹è½½åˆ°æœ¬åœ°ä»“åº“å†ä½¿ç”¨ã€‚è‹¥æœ¬åœ°ã€è¿œç¨‹ä»“åº“éƒ½æ— ï¼ŒæŠ¥é”™ã€‚ä¾èµ–åæ ‡    åŸºæœ¬åæ ‡ï¼šgroupIdã€artifactIdã€version    å…¶ä»–        Typeï¼šä¾èµ–ç±»å‹ é»˜è®¤jar        Scopeï¼šä¾èµ–èŒƒå›´ï¼ˆcompile,test,provided,runtime,systemï¼‰            compileï¼ˆé»˜è®¤ï¼‰: ç¼–è¯‘ä¾èµ–èŒƒå›´                ä½¿ç”¨æ­¤ä¾èµ–èŒƒå›´çš„Mavenä¾èµ–ï¼Œå¯¹ç¼–è¯‘ã€æµ‹è¯•ã€è¿è¡Œä¸‰ç§classpathéƒ½æœ‰æ•ˆã€‚            test: æµ‹è¯•ä¾èµ–èŒƒå›´                å¯¹æµ‹è¯•classpathæœ‰æ•ˆï¼Œåœ¨ç¼–è¯‘ä¸»ä»£ç æˆ–è€…è¿è¡Œé¡¹ç›®çš„ä½¿ç”¨æ—¶å°†æ— æ³•ä½¿ç”¨æ­¤ç±»ä¾èµ–ã€‚                å¦‚JUnitï¼Œå®ƒåªæœ‰åœ¨ç¼–è¯‘æµ‹è¯•ä»£ç åŠè¿è¡Œæµ‹è¯•çš„æ—¶å€™æ‰éœ€è¦ã€‚            provided: å·²æä¾›ä¾èµ–èŒƒå›´                å¯¹ç¼–è¯‘å’Œæµ‹è¯•classpathæœ‰æ•ˆï¼Œä½†åœ¨è¿è¡Œæ—¶æ— æ•ˆã€‚                å¦‚servlet-apiï¼Œç¼–è¯‘å’Œæµ‹è¯•é¡¹ç›®çš„æ—¶å€™éœ€è¦è¯¥ä¾èµ–ï¼Œä½†åœ¨è¿è¡Œé¡¹ç›®çš„æ—¶å€™ï¼Œ                ç”±äºå®¹å™¨å·²ç»æä¾›ï¼Œå°±ä¸éœ€è¦Mavené‡å¤åœ°å¼•å…¥ä¸€éã€‚            runtime: è¿è¡Œæ—¶ä¾èµ–èŒƒå›´                å¯¹æµ‹è¯•å’Œè¿è¡Œclasspathæœ‰æ•ˆï¼Œä½†åœ¨ç¼–è¯‘ä¸»ä»£ç æ—¶æ— æ•ˆã€‚                å¦‚JDBCé©±åŠ¨å®ç°ï¼Œé¡¹ç›®ä¸»ä»£ç çš„ç¼–è¯‘åªéœ€JDKæä¾›çš„JDBCæ¥å£ï¼Œ                åªæœ‰åœ¨æ‰§è¡Œæµ‹è¯•æˆ–è€…è¿è¡Œé¡¹ç›®çš„æ—¶å€™æ‰éœ€è¦å®ç°ä¸Šè¿°æ¥å£çš„å…·ä½“JDBCé©±åŠ¨ã€‚            system: ç³»ç»Ÿä¾èµ–èŒƒå›´                è¯¥ä¾èµ–ä¸ä¸‰ç§classpathçš„å…³ç³»ï¼Œå’Œprovidedä¾èµ–èŒƒå›´å®Œå…¨ä¸€è‡´ã€‚                ä½†ä½¿ç”¨systemèŒƒå›´ä¾èµ–æ—¶å¿…é¡»é€šè¿‡systemPathå…ƒç´ æ˜¾å¼åœ°æŒ‡å®šä¾èµ–æ–‡ä»¶çš„è·¯å¾„ã€‚                ç”±äºæ­¤ç±»ä¾èµ–ä¸æ˜¯é€šè¿‡Mavenä»“åº“è§£æçš„ï¼Œè€Œä¸”å¾€å¾€ä¸æœ¬æœºç³»ç»Ÿç»‘å®šï¼Œå¯èƒ½é€ æˆæ„å»ºçš„ä¸å¯ç§»æ¤ã€‚        Optionalï¼šæ ‡è®°ä¾èµ–æ˜¯å¦å¯é€‰        Exclusionsï¼š ç”¨æ¥æ’é™¤ä¼ é€’æ€§ä¾èµ–ä¾èµ–èŒƒå›´    é¦–å…ˆéœ€è¦çŸ¥é“ï¼ŒMavenåœ¨ç¼–è¯‘é¡¹ç›®ä¸»ä»£ç çš„æ—¶å€™éœ€è¦ä½¿ç”¨ä¸€å¥—classpathã€‚ æ¯”å¦‚ï¼šç¼–è¯‘é¡¹ç›®ä»£ç çš„æ—¶å€™    éœ€è¦ç”¨åˆ°spring-core, è¯¥æ–‡ä»¶ä»¥ä¾èµ–çš„æ–¹å¼è¢«å¼•å…¥åˆ°classpathä¸­ã€‚ å…¶æ¬¡ï¼Œ Mavenåœ¨æ‰§è¡Œæµ‹è¯•çš„æ—¶å€™ä¼š    ä½¿ç”¨å¦å¤–ä¸€å¥—classpathã€‚ å¦‚ï¼šjunitã€‚    æœ€ååœ¨å®é™…è¿è¡Œé¡¹ç›®æ—¶ï¼Œåˆä¼šä½¿ç”¨ä¸€å¥—classpathï¼Œ spring-coreéœ€è¦åœ¨è¯¥classpathä¸­ï¼Œè€Œjunitä¸éœ€    è¦ã€‚    é‚£ä¹ˆä¾èµ–èŒƒå›´å°±æ˜¯ç”¨æ¥æ§åˆ¶ä¾èµ–ä¸è¿™ä¸‰ç§classpath(ç¼–è¯‘classpathï¼Œæµ‹è¯•classpathï¼Œè¿è¡Œæ—¶classpath)    çš„å…³ç³»ï¼Œ Mavenæœ‰ä»¥ä¸‹å‡ ç§ä¾èµ–èŒƒå›´ï¼š    Compile ç¼–è¯‘ä¾èµ–èŒƒå›´ã€‚ å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œå°±ä¼šé»˜è®¤ä½¿ç”¨è¯¥ä¾èµ–èŒƒå›´ã€‚ ä½¿ç”¨æ­¤ä¾èµ–èŒƒå›´çš„Mavenä¾    èµ–ï¼Œ å¯¹äºç¼–è¯‘ï¼Œæµ‹è¯•ï¼Œè¿è¡Œéƒ½æœ‰æ•ˆã€‚    Testï¼š æµ‹è¯•ä¾èµ–èŒƒå›´ã€‚ åªåœ¨æµ‹è¯•çš„æ—¶å€™éœ€è¦ã€‚æ¯”å¦‚junit    Providedï¼š å·²æä¾›ä¾èµ–èŒƒå›´ã€‚ ä½¿ç”¨æ­¤ä¾èµ–èŒƒå›´çš„Mavenä¾èµ–ï¼Œå¯¹äºç¼–è¯‘å’Œæµ‹è¯•æœ‰æ•ˆï¼Œ ä½†åœ¨è¿è¡Œ    æ—¶æ— æ•ˆã€‚ å…¸å‹çš„ä¾‹å­æ˜¯servlet-API, ç¼–è¯‘å’Œæµ‹è¯•é¡¹ç›®çš„éœ€è¦ï¼Œ ä½†åœ¨è¿è¡Œé¡¹ç›®æ—¶ï¼Œ ç”±äºå®¹å™¨å·²ç»æ    ä¾›ï¼Œ å°±ä¸éœ€è¦Mavené‡å¤åœ°å¼•å…¥ä¸€éã€‚    Runtimeï¼š è¿è¡Œæ—¶ä¾èµ–èŒƒå›´ã€‚ ä½¿ç”¨æ­¤ä¾èµ–èŒƒå›´çš„Mavenä¾èµ–ï¼Œå¯¹äºæµ‹è¯•å’Œè¿è¡Œæœ‰æ•ˆï¼Œ ä½†åœ¨ç¼–è¯‘ä»£    ç æ—¶æ— æ•ˆã€‚ å…¸å‹çš„ä¾‹å­æ˜¯ï¼šjdbcé©±åŠ¨ç¨‹åºï¼Œ é¡¹ç›®ä¸»ä»£ç çš„ç¼–è¯‘åªéœ€è¦jdkæä¾›çš„jdbcæ¥å£ï¼Œåªæœ‰åœ¨    æ‰§è¡Œæµ‹è¯•æˆ–è€…è¿è¡Œé¡¹ç›®çš„æ—¶å€™æ‰éœ€è¦å®ç°ä¸Šè¿°æ¥å£çš„å…·ä½“jdbcé©±åŠ¨ã€‚    Systemï¼š ç³»ç»Ÿä¾èµ–èŒƒå›´ã€‚ ä¸€èˆ¬ä¸ä½¿ç”¨ã€‚ä¼ é€’ä¾èµ–    ä¼ é€’ä¾èµ–æœºåˆ¶ï¼Œ è®©æˆ‘ä»¬åœ¨ä½¿ç”¨æŸä¸ªjarçš„æ—¶å€™å°±ä¸ç”¨å»è€ƒè™‘å®ƒä¾èµ–äº†ä»€ä¹ˆã€‚ä¹Ÿä¸ç”¨æ‹…å¿ƒå¼•å…¥å¤šä½™çš„ä¾èµ–ã€‚Mavenä¼šè§£æå„ä¸ªç›´æ¥ä¾èµ–çš„POMï¼Œå°†é‚£äº›å¿…è¦çš„é—´æ¥ä¾èµ–ï¼Œä»¥ä¼ é€’æ€§ä¾èµ–çš„å½¢å¼å¼•å…¥åˆ°å½“å‰é¡¹ç›®ä¸­ã€‚    æ³¨æ„ï¼š ä¼ é€’ä¾èµ–æœ‰å¯èƒ½äº§ç”Ÿå†²çªï¼ï¼    å†²çªåœºæ™¯ï¼š    A--&gt;B---&gt;C (2.0)    A--&gt;E---&gt;C (1.0)    å¦‚æœAä¸‹åŒæ—¶å­˜åœ¨ä¸¤ä¸ªä¸åŒversionçš„Cï¼Œå†²çªï¼ï¼ï¼ˆé€‰å–åŒæ—¶é€‚åˆAã€Bçš„ç‰ˆæœ¬ï¼‰    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>           <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>C<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>C<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¤šæ¨¡å—é¡¹ç›®æ„å»º"><a href="#å¤šæ¨¡å—é¡¹ç›®æ„å»º" class="headerlink" title="å¤šæ¨¡å—é¡¹ç›®æ„å»º"></a>å¤šæ¨¡å—é¡¹ç›®æ„å»º</h3><pre class="line-numbers language-none"><code class="language-none">dao service controller å±‚åˆ†ç¦»å°†ä¸€ä¸ªé¡¹ç›®åˆ†è§£ä¸ºå¤šä¸ªæ¨¡å—ã€‚åœ¨Mavenä¸­éœ€å®šä¹‰ä¸€ä¸ªparent POMä½œä¸ºä¸€ç»„moduleçš„èšåˆPOMã€‚åœ¨è¯¥POMä¸­å¯ä»¥ä½¿ç”¨æ ‡ç­¾æ¥å®šä¹‰ä¸€ç»„å­æ¨¡å—ã€‚parent POMä¸ä¼šæœ‰ä»€ä¹ˆå®é™…æ„å»ºäº§å‡ºã€‚è€Œparent POMä¸­çš„buildé…ç½®ä»¥åŠä¾èµ–é…ç½®éƒ½ä¼šè‡ªåŠ¨ç»§æ‰¿ç»™å­moduleã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="é¡¹ç›®ç»“æ„ä¸€è‡´"><a href="#é¡¹ç›®ç»“æ„ä¸€è‡´" class="headerlink" title="é¡¹ç›®ç»“æ„ä¸€è‡´"></a>é¡¹ç›®ç»“æ„ä¸€è‡´</h3><pre class="line-numbers language-none"><code class="language-none">åˆ¶å®šä¸€å¥—æ ‡å‡†çš„Javaé¡¹ç›®ç»“æ„,è§£å†³ä¸åŒideå¸¦æ¥çš„æ–‡ä»¶ç›®å½•ä¸ä¸€è‡´é—®é¢˜ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><table><thead><tr><th>Maven é¡¹ç›®ç›®å½•ç»“æ„</th><th></th></tr></thead><tbody><tr><td>${basedir}</td><td>pom.xml åŠ æ‰€æœ‰ç›®å½•</td></tr><tr><td>${basedir}/src/main/java</td><td>Javaæºä»£ç </td></tr><tr><td>${basedir}/src/main/resources</td><td>èµ„æºï¼ˆpropertyï¼‰</td></tr><tr><td>${basedir}/src/test/java</td><td>Javaæµ‹è¯•ä»£ç ï¼ˆJUnitï¼‰</td></tr><tr><td>${basedir}/src/test/resources</td><td>æµ‹è¯•èµ„æº</td></tr></tbody></table><h3 id="æ„å»ºæ¨¡å‹ã€æ’ä»¶æœºåˆ¶ä¸€è‡´"><a href="#æ„å»ºæ¨¡å‹ã€æ’ä»¶æœºåˆ¶ä¸€è‡´" class="headerlink" title="æ„å»ºæ¨¡å‹ã€æ’ä»¶æœºåˆ¶ä¸€è‡´"></a>æ„å»ºæ¨¡å‹ã€æ’ä»¶æœºåˆ¶ä¸€è‡´</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.mortbay.jetty<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-jetty-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.1.25<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scanIntervalSeconds</span><span class="token punctuation">&gt;</span></span>10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scanIntervalSeconds</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>contextPath</span><span class="token punctuation">&gt;</span></span>/test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>contextPath</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é¡¹ç›®æ‰“åŒ…"><a href="#é¡¹ç›®æ‰“åŒ…" class="headerlink" title="é¡¹ç›®æ‰“åŒ…"></a>é¡¹ç›®æ‰“åŒ…</h2><h3 id="å®Œå–„é¡¹ç›®ç›®å½•ç»“æ„"><a href="#å®Œå–„é¡¹ç›®ç›®å½•ç»“æ„" class="headerlink" title="å®Œå–„é¡¹ç›®ç›®å½•ç»“æ„"></a>å®Œå–„é¡¹ç›®ç›®å½•ç»“æ„</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225516.png"></p><h3 id="é…ç½®-Profile-æ‰“åŒ…ç¯å¢ƒ-pom-xml"><a href="#é…ç½®-Profile-æ‰“åŒ…ç¯å¢ƒ-pom-xml" class="headerlink" title="é…ç½® Profile æ‰“åŒ…ç¯å¢ƒ pom.xml"></a>é…ç½® Profile æ‰“åŒ…ç¯å¢ƒ pom.xml</h3><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- æ‰“åŒ…ç¯å¢ƒé…ç½® å¼€å‘ç¯å¢ƒ æµ‹è¯•ç¯å¢ƒ æ­£å¼ç¯å¢ƒ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>dev<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>env</span><span class="token punctuation">&gt;</span></span>dev<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>env</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- æœªæŒ‡å®šç¯å¢ƒæ—¶ï¼Œé»˜è®¤æ‰“åŒ…devç¯å¢ƒ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activation</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeByDefault</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activation</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>tes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>env</span><span class="token punctuation">&gt;</span></span>tes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>env</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>pro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>env</span><span class="token punctuation">&gt;</span></span>pro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>env</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>finalName</span><span class="token punctuation">&gt;</span></span>WebappTest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>finalName</span><span class="token punctuation">&gt;</span></span>  <span class="token comment">&lt;!-- èµ„æºæ–‡ä»¶é…ç½® --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- å®šä¹‰å˜é‡é…ç½®æ–‡ä»¶çš„åœ°å€ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/resources/${env}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- å®šä¹‰å“ªäº›ç›®å½•ä¸‹çš„æ–‡ä»¶ä¼šè¢«é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å˜é‡æ›¿æ¢ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>src/main/java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.properties<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*.tld<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filtering</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filtering</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰“åŒ…"><a href="#æ‰“åŒ…" class="headerlink" title="æ‰“åŒ…"></a>æ‰“åŒ…</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">clean compile package -Pdev -Dmaven.test.skip<span class="token operator">=</span>true<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827225519.png"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç»œåè®®åˆ†å±‚</title>
      <link href="/2021/08/27/wang-luo-xie-yi-fen-ceng/"/>
      <url>/2021/08/27/wang-luo-xie-yi-fen-ceng/</url>
      
        <content type="html"><![CDATA[<h2 id="é€šä¿¡åè®®"><a href="#é€šä¿¡åè®®" class="headerlink" title="é€šä¿¡åè®®"></a>é€šä¿¡åè®®</h2><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½œç”¨ï¼šè®©ä¸åŒç½‘ç»œæ¶æ„ã€ä¸åŒæ“ä½œç³»ç»Ÿçš„è®¡ç®—æœºä¹‹é—´äº’ç›¸é€šä¿¡ã€‚</p><h2 id="OSI"><a href="#OSI" class="headerlink" title="OSI"></a>OSI</h2><p>ä¸ƒå±‚ï¼Œç‰©æ•°ç½‘ä¼ ä¼šè¡¨åº”ã€‚</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827194815.png"></p><h2 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h2><p>å››å±‚ï¼Œç‰©ï¼ˆç‰©æ•°ï¼‰ç½‘ã€ä¼ ã€åº”ï¼ˆä¼šè¡¨åº”ï¼‰ã€‚</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210827195457.png"></p><table><thead><tr><th>TCP/IP</th><th></th></tr></thead><tbody><tr><td>åº”ç”¨å±‚</td><td>HTTP HTTPS  FTP  Telnet</td></tr><tr><td>ä¼ è¾“å±‚</td><td>TCP  UDP</td></tr><tr><td>ç½‘ç»œå±‚</td><td>IP  ARP  è·¯ç”±</td></tr><tr><td>é“¾è·¯å±‚</td><td>ä»¥å¤ªç½‘  ç½‘æ¡¥</td></tr></tbody></table><h2 id="ç‰©ç†å±‚"><a href="#ç‰©ç†å±‚" class="headerlink" title="ç‰©ç†å±‚"></a>ç‰©ç†å±‚</h2><p>ä¼ é€çš„æ•°æ®å•ä½ï¼šâ½ç‰¹ã€‚</p><p>ä½œâ½¤ï¼šå®ç°ç›¸é‚»è®¡ç®—æœºèŠ‚ç‚¹ä¹‹é—´â½ç‰¹æµçš„é€æ˜ä¼ é€ï¼Œå°½å¯èƒ½å±è”½æ‰å…·ä½“ä¼ è¾“ä»‹è´¨å’Œç‰©ç†è®¾å¤‡çš„å·®å¼‚ã€‚ä½¿æ•°æ®é“¾è·¯å±‚ä¸å¿…è€ƒè™‘â½¹ç»œçš„å…·ä½“ä¼ è¾“ä»‹è´¨æ˜¯ä»€ä¹ˆã€‚ â€œé€æ˜ä¼ é€â½ç‰¹æµâ€è¡¨ç¤ºç»å®é™…ç”µè·¯ä¼ é€åçš„â½ç‰¹æµæ²¡æœ‰å‘â½£å˜åŒ–ï¼Œå¯¹ä¼ é€çš„â½ç‰¹æµæ¥è¯´ï¼Œè¿™ä¸ªç”µè·¯å¥½åƒæ˜¯çœ‹ä¸â»…çš„ã€‚</p><h2 id="æ•°æ®é“¾è·¯å±‚"><a href="#æ•°æ®é“¾è·¯å±‚" class="headerlink" title="æ•°æ®é“¾è·¯å±‚"></a>æ•°æ®é“¾è·¯å±‚</h2><p>ä¸¤å°ä¸»æœºä¹‹é—´çš„æ•°æ®ä¼ è¾“ï¼Œæ€»æ˜¯åœ¨â¼€æ®µâ¼€æ®µçš„é“¾è·¯ä¸Šä¼ è¾“çš„ï¼Œè¿™å°±éœ€è¦ä½¿â½¤ä¸“â»”çš„é“¾è·¯å±‚çš„åè®®ã€‚ åœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹ä¹‹é—´ä¼ é€æ•°æ®æ—¶ï¼Œæ•°æ®é“¾è·¯å±‚å°†â½¹ç»œå±‚äº¤ä¸‹æ¥çš„ IP æ•°æ®æŠ¥ç»„è£…æˆå¸§ï¼Œåœ¨ä¸¤ä¸ªç›¸é‚»èŠ‚ç‚¹é—´çš„é“¾è·¯ä¸Šä¼ é€å¸§ã€‚æ¯â¼€å¸§åŒ…æ‹¬æ•°æ®å’Œå¿…è¦çš„æ§åˆ¶ä¿¡æ¯ï¼ˆå¦‚åŒæ­¥ä¿¡æ¯ï¼Œåœ°å€ä¿¡æ¯ï¼Œå·®é”™æ§åˆ¶ç­‰ï¼‰ã€‚<br>åœ¨æ¥æ”¶æ•°æ®æ—¶ï¼Œæ§åˆ¶ä¿¡æ¯ä½¿æ¥æ”¶ç«¯èƒ½å¤ŸçŸ¥é“â¼€ä¸ªå¸§ä»å“ªä¸ªâ½ç‰¹å¼€å§‹å’Œåˆ°å“ªä¸ªâ½ç‰¹ç»“æŸã€‚è¿™æ ·ï¼Œæ•°æ®é“¾è·¯å±‚åœ¨æ”¶åˆ°â¼€ä¸ªå¸§åï¼Œå°±å¯ä»ä¸­æå‡ºæ•°æ®éƒ¨åˆ†ï¼Œä¸Šäº¤ç»™â½¹ç»œå±‚ã€‚<br>æ§åˆ¶ä¿¡æ¯è¿˜ä½¿æ¥æ”¶ç«¯èƒ½å¤Ÿæ£€æµ‹åˆ°æ‰€æ”¶åˆ°çš„å¸§ä¸­æœ‰è¯¯å·®é”™ã€‚å¦‚æœå‘ç°å·®é”™ï¼Œæ•°æ®é“¾è·¯å±‚å°±ç®€å•åœ°ä¸¢å¼ƒè¿™ä¸ªå‡ºäº†å·®é”™çš„å¸§ï¼Œä»¥é¿å…ç»§ç»­åœ¨â½¹ç»œä¸­ä¼ é€ä¸‹å»â½©â½©æµªè´¹â½¹ç»œèµ„æºã€‚å¦‚æœéœ€è¦æ”¹æ­£æ•°æ®åœ¨é“¾ è·¯å±‚ä¼ è¾“æ—¶å‡ºç°å·®é”™ï¼ˆè¿™å°±æ˜¯è¯´ï¼Œæ•°æ®é“¾è·¯å±‚ä¸ä»…è¦æ£€é”™ï¼Œâ½½ä¸”è¿˜è¦çº é”™ï¼‰ï¼Œé‚£ä¹ˆå°±è¦é‡‡â½¤å¯é æ€§ä¼ è¾“åè®®æ¥çº æ­£å‡ºç°çš„å·®é”™ã€‚è¿™ç§â½…æ³•ä¼šä½¿é“¾è·¯å±‚çš„åè®®å¤æ‚äº›ã€‚</p><h2 id="ç½‘ç»œå±‚"><a href="#ç½‘ç»œå±‚" class="headerlink" title="ç½‘ç»œå±‚"></a>ç½‘ç»œå±‚</h2><p>åœ¨è®¡ç®—æœºâ½¹ç»œä¸­è¿›â¾é€šä¿¡çš„ä¸¤ä¸ªè®¡ç®—æœºä¹‹é—´å¯èƒ½ä¼šç»è¿‡å¾ˆå¤šä¸ªæ•°æ®é“¾è·¯ï¼Œä¹Ÿå¯èƒ½è¿˜è¦ç»è¿‡å¾ˆå¤šé€šä¿¡â¼¦â½¹ã€‚â½¹ç»œå±‚çš„ä»»åŠ¡å°±æ˜¯é€‰æ‹©åˆé€‚çš„ç½‘é—´è·¯ç”±å’Œäº¤æ¢ç»“ç‚¹ï¼Œ ç¡®ä¿æ•°æ®åŠæ—¶ä¼ é€ã€‚ åœ¨å‘é€æ•°æ®æ—¶ï¼Œâ½¹ç»œå±‚æŠŠä¼ è¾“å±‚äº§â½£çš„æŠ¥â½‚æ®µæˆ–â½¤æˆ·æ•°æ®æŠ¥å°è£…æˆåˆ†ç»„å’ŒåŒ…è¿›â¾ä¼ é€ã€‚åœ¨ TCP/IP ä½“ç³»ç»“æ„ ä¸­ï¼Œç”±äºâ½¹ç»œå±‚ä½¿â½¤ IP åè®®ï¼Œå› æ­¤åˆ†ç»„ä¹Ÿå« IP æ•°æ®æŠ¥ ã€‚<br>è¿™â¾¥è¦æ³¨æ„ï¼šä¸è¦æŠŠè¿è¾“å±‚çš„â€œâ½¤æˆ·æ•°æ®æŠ¥ UDP â€å’Œâ½¹ç»œå±‚çš„â€œ IP æ•°æ®æŠ¥â€å¼„æ··ã€‚å¦å¤–ï¼Œâ½†è®ºæ˜¯å“ªâ¼€å±‚çš„æ•°æ®å•å…ƒï¼Œéƒ½å¯ç¬¼ç»Ÿåœ°â½¤â€œåˆ†ç»„â€æ¥è¡¨ç¤ºã€‚è¿™â¾¥å¼ºè°ƒæŒ‡å‡ºï¼Œâ½¹ç»œå±‚ä¸­çš„â€œâ½¹ç»œâ€â¼†å­—å·²ç»ä¸æ˜¯æˆ‘ä»¬é€šå¸¸è°ˆåˆ°çš„å…·ä½“â½¹ç»œï¼Œâ½½æ˜¯æŒ‡è®¡ç®—æœºâ½¹ç»œä½“ç³»ç»“æ„æ¨¡å‹ä¸­ç¬¬ä¸‰å±‚çš„åç§°ã€‚äº’è”â½¹æ˜¯ç”±â¼¤é‡çš„å¼‚æ„ï¼ˆheterogeneousï¼‰â½¹ç»œé€šè¿‡è·¯ç”±å™¨ï¼ˆrouterï¼‰ç›¸äº’è¿æ¥èµ·æ¥çš„ã€‚äº’è”â½¹ä½¿â½¤çš„â½¹ç»œå±‚åè®®æ˜¯â½†è¿æ¥çš„â½¹é™…åè®®ï¼ˆIntert Protocolï¼‰å’Œè®¸å¤šè·¯ç”±é€‰æ‹©åè®®ï¼Œå› æ­¤äº’è”â½¹çš„â½¹ç»œå±‚ä¹Ÿå«åšâ½¹é™…å±‚æˆ–IPå±‚ã€‚</p><h3 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Internet</span> <span class="token class-name">Protocol</span>ä½œç”¨ï¼šæ ‡è¯†ç½‘ç»œä¸­çš„ä¸»æœºã€‚ç»„æˆï¼šç½‘ç»œä½ <span class="token operator">+</span> ä¸»æœºä½è¡¨ç¤ºï¼šç‚¹åˆ†åè¿›åˆ¶ç±»å‹ï¼š     <span class="token class-name">IPv4</span>ï¼š <span class="token number">4</span>å­—èŠ‚ã€<span class="token number">8</span> <span class="token number">8</span> <span class="token number">8</span> <span class="token number">8</span>        <span class="token punctuation">[</span><span class="token number">0</span>ï¼Œ<span class="token number">255</span><span class="token punctuation">]</span>   <span class="token number">255</span><span class="token operator">^</span><span class="token number">4</span>     <span class="token class-name">IPv6</span>ï¼š<span class="token number">16</span>å­—èŠ‚ã€<span class="token number">128</span> <span class="token number">128</span> <span class="token number">128.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">65535</span><span class="token punctuation">]</span> <span class="token number">65535</span><span class="token operator">^</span><span class="token number">8</span>ç†è§£ï¼šå…¬å¸    åˆ†ç±»ï¼š        <span class="token class-name">A</span>   <span class="token number">1</span>   <span class="token operator">~</span> <span class="token number">127</span>   ç½‘<span class="token operator">+</span>ä¸»<span class="token operator">+</span>ä¸»<span class="token operator">+</span>ä¸»        <span class="token class-name">B</span>   <span class="token number">128</span> <span class="token operator">~</span> <span class="token number">191</span>   ç½‘<span class="token operator">+</span>ç½‘<span class="token operator">+</span>ä¸»<span class="token operator">+</span>ä¸»        <span class="token class-name">C</span>   <span class="token number">192</span> <span class="token operator">~</span> <span class="token number">223</span>   ç½‘<span class="token operator">+</span>ç½‘<span class="token operator">+</span>ç½‘<span class="token operator">+</span>ä¸»        <span class="token class-name">D</span>   <span class="token number">224</span> <span class="token operator">~</span> <span class="token number">239</span>   ç»„æ’­<span class="token punctuation">(</span>å¤šæ’­<span class="token punctuation">)</span>        <span class="token class-name">E</span>   <span class="token number">240</span> <span class="token operator">~</span> <span class="token number">254</span>   ç§‘ç ”å…¬æœ‰IPã€ç§æœ‰IP    å…¬æœ‰IPï¼šå…¬ç½‘åœ°å€ï¼Œé€šè¿‡å®ƒç›´æ¥è®¿é—®å› ç‰¹ç½‘ï¼ˆå¹¿åŸŸç½‘ï¼‰     ç§æœ‰IPï¼šä¸“ç½‘åœ°å€ï¼Œå…è´¹ä¸ºä¼ä¸šå†…éƒ¨ä½¿ç”¨ï¼Œï¼ˆå±€åŸŸç½‘ï¼‰ï¼Œå‡ºäº†æ‰€åœ¨å±€åŸŸç½‘æ˜¯æ— æ³•è®¿é—®å› ç‰¹ç½‘çš„ã€‚     ç§æœ‰IPåˆ†ç±»ï¼š        <span class="token class-name">A</span><span class="token number">10.0</span><span class="token number">.0</span><span class="token number">.1</span>    <span class="token operator">~</span> <span class="token number">10.255</span><span class="token number">.255</span><span class="token number">.255</span>        <span class="token class-name">B</span><span class="token number">172.16</span><span class="token number">.0</span><span class="token number">.1</span>  <span class="token operator">~</span> <span class="token number">172.31</span><span class="token number">.255</span><span class="token number">.254</span>        <span class="token class-name">C</span><span class="token number">192.168</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">~</span> <span class="token number">192.168</span><span class="token number">.255</span><span class="token number">.254</span>å­ç½‘æ©ç  NETMASKé•¿åº¦ï¼š<span class="token number">32</span>ä¸ªäºŒè¿›åˆ¶ä½ç‰¹ç‚¹ï¼šä¸èƒ½å•ç‹¬å­˜åœ¨ï¼Œå¿…é¡»ç»“åˆIPåœ°å€ä¸€èµ·ä½¿ç”¨ä½œç”¨ï¼šé€šè¿‡ä¸è¿ç®—ï¼ŒåŒºåˆ†ç½‘ç»œä½å’Œä¸»æœºä½ï¼Œåˆ¤æ–­ä¸¤å°è®¡ç®—æœºæ˜¯å¦åœ¨åŒä¸€å­ç½‘ã€‚å½“ä¸€å°è®¡ç®—æœºè®¿é—®å…¶ä»–IPåœ°å€æ—¶ï¼Œé€šè¿‡æ¯”è¾ƒæœ¬æœºä¸ç›®æ ‡ä¸»æœºçš„ç½‘ç»œä½æ¥å†³å®šæ˜¯å¦éœ€è¦æ‰¾ç½‘å…³ã€‚åˆ†ç±»ï¼š        <span class="token class-name">A</span>  <span class="token number">255.0</span><span class="token number">.0</span><span class="token number">.0</span>      ï¼ˆ<span class="token number">1</span>ç½‘<span class="token number">3</span>ä¸»ï¼‰        <span class="token class-name">B</span>  <span class="token number">255.255</span><span class="token number">.0</span><span class="token number">.0</span>    ï¼ˆ<span class="token number">2</span>ç½‘<span class="token number">2</span>ä¸»ï¼‰        <span class="token class-name">C</span>  <span class="token number">255.255</span><span class="token number">.255</span><span class="token number">.0</span>  ï¼ˆ<span class="token number">3</span>ç½‘<span class="token number">1</span>ä¸»ï¼‰ç½‘å…³ GATEWAYæ¦‚å¿µï¼šä¸€ä¸ªç½‘ç»œè¿æ¥åˆ°å¦ä¸€ä¸ªç½‘ç»œçš„â€œå…³å£â€ã€‚ç½‘å…³è®¾å¤‡ï¼šè¿æ¥ä¸¤ä¸ªä¸åŒç½‘ç»œçš„è®¾å¤‡ã€‚ç½‘å…³åœ°å€ï¼šç½‘å…³è®¾å¤‡çš„IPã€‚ä½œç”¨ï¼šå®ç°ä¸¤ä¸ªç½‘ç»œé—´çš„é€šè®¯å’Œæ§åˆ¶ã€‚åŸŸåæœåŠ¡å™¨ DNSä½œç”¨ï¼šè§£æåŸŸåï¼ˆåŸŸåå’ŒIPä¹‹é—´çš„è§£æï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Port"><a href="#Port" class="headerlink" title="Port"></a>Port</h3><pre class="line-numbers language-none"><code class="language-none">ç«¯å£ï¼Œæ¯ä¸€ä¸ªåº”ç”¨éƒ½ä¼šç›‘å¬ä¸€æˆ–å¤šä¸ªç«¯å£ï¼Œç›¸åŒçš„åº”ç”¨ä½¿ç”¨è¿™ä¸ªç«¯å£å‘é€ç¨‹åºï¼Œä½†ä¸€ä¸ªç«¯å£ä¸èƒ½è¢«ä¸¤ä¸ªåº”ç”¨åŒæ—¶ä½¿ç”¨ã€‚ä¸€ä¸ªç«¯å£å 2å­—èŠ‚[0Â·65535]ï¼Œä¸ªäººä½¿ç”¨ç«¯å£æœ€å¥½1wä»¥ä¸Šã€‚ç†è§£ï¼šéƒ¨é—¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="URL"><a href="#URL" class="headerlink" title="URL"></a>URL</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817170042.png"></p><h2 id="ä¼ è¾“å±‚"><a href="#ä¼ è¾“å±‚" class="headerlink" title="ä¼ è¾“å±‚"></a>ä¼ è¾“å±‚</h2><h3 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822193236.png"></p><h3 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h3><pre class="line-numbers language-none"><code class="language-none">æ¦‚å¿µï¼šUser Data Protocolï¼Œç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼ˆä¼šä¸¢åŒ…ï¼‰ç‰¹ç‚¹ï¼šæ— è¿æ¥ï¼ˆæ•ˆç‡é«˜ä½†å®‰å…¨æ€§ä½ï¼‰ã€‚åœºæ™¯ï¼šç”¨äºå¯¹å®æ—¶æ€§å’Œé«˜é€Ÿä¼ è¾“è¦æ±‚æ¯”è¾ƒé«˜çš„é€šä¿¡æˆ–å¹¿æ’­é€šä¿¡åœºåˆã€‚å¦‚ï¼šå³æ—¶é€šä¿¡ï¼ˆè§†é¢‘ï¼‰ï¼Œå®æ—¶æˆ˜æ–—æ¸¸æˆï¼ˆTCPçš„ç‰¹æ€§ï¼Œä¸€æ—¦ä¸¢åŒ…å°±ä¼šé‡å‘ï¼Œé˜»å¡ä½åç»­çš„æ•°æ®åŒ…ï¼Œä¼šæœ‰å»¶è¿Ÿï¼‰ã€‚ä¼˜ç‚¹ï¼šé€Ÿåº¦å¿«ã€èµ„æºæ¶ˆè€—å°ã€‚ç¼ºç‚¹ï¼šä¸å¯é æ€§ï¼ˆä¼ è¾“å‰ä¸å»ºç«‹è¿æ¥ï¼Œå¯¹æ¥æ”¶çš„æ•°æ®ä¹Ÿä¸å‘é€ç¡®è®¤ä¿¡å·ï¼Œå‘é€ç«¯ä¸çŸ¥é“æ•°æ®æ˜¯å¦ä¼šæ­£ç¡®æ¥æ”¶ï¼Œä¸é‡å‘ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h3><pre class="line-numbers language-none"><code class="language-none">æ¦‚å¿µï¼šTransmission Control Protocolï¼Œä¼ è¾“æ§åˆ¶åè®®ï¼ˆä¸ä¸¢åŒ…ï¼‰ç‰¹ç‚¹ï¼šæœ‰è¿æ¥ï¼Œé€šè¿‡3æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥ï¼Œæ•°æ®ä¼ è¾“å®Œæˆæ—¶ï¼Œé€šè¿‡4æ¬¡æŒ¥æ‰‹æ–­å¼€è¿æ¥ï¼ˆæ•ˆç‡ä½ä½†å®‰å…¨æ€§é«˜ï¼‰ã€‚ä½¿ç”¨åœºæ™¯ï¼šç”¨äºå¯¹å¯é æ€§è¦æ±‚æ¯”è¾ƒé«˜çš„é€šä¿¡åœºåˆã€‚å¦‚ï¼šç”µå­é‚®ä»¶ã€å¾®ä¿¡å‘ä¿¡æ¯ï¼ˆä¸èƒ½ä¸¢åŒ…æ‰€ä»¥TCPï¼‰ä¼˜ç‚¹ï¼šå¯é æ€§ï¼šTCP åœ¨æ•°æ®ä¼ é€’æ—¶ï¼Œæœ‰ç¡®è®¤ã€çª—å£ã€é‡ä¼ ã€é˜»å¡ç­‰æ§åˆ¶æœºåˆ¶ï¼Œèƒ½ä¿è¯æ•°æ®æ­£ç¡®æ€§ã€‚ç¼ºç‚¹ï¼šé€Ÿåº¦æ…¢ï¼Œèµ„æºæ¶ˆè€—å¤§ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-none"><code class="language-none">3æ¬¡æ¡æ‰‹ï¼š    1.å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€ä¸€ä¸ªå¸¦æœ‰SYNçš„è¿æ¥è¯·æ±‚ã€‚    2.æœåŠ¡ç«¯æ”¶åˆ°è¿æ¥è¯·æ±‚å¹¶ç¡®è®¤å¯ä»¥è¿æ¥ä¹‹åï¼Œå®¢æˆ·ç«¯å›å¤ä¸€ä¸ªå¸¦æœ‰SYNå’ŒACKçš„ç¡®è®¤ä¿¡æ¯ã€‚    3.å®¢æˆ·ç«¯æ”¶åˆ°ç¡®è®¤è¯·æ±‚åï¼Œç»™æœåŠ¡ç«¯å›å¤å¸¦æœ‰ ACK çš„ç¡®è®¤ä¿¡æ¯ã€‚    è‡³æ­¤ä¸‰æ¬¡æ¡æ‰‹è¿‡ç¨‹ç»“æŸï¼Œå®¢æˆ·ç«¯å¼€å§‹TCPæ•°æ®ä¼ è¾“ã€‚4æ¬¡æŒ¥æ‰‹ï¼š    ç”±äº TCP è¿æ¥æ˜¯å¯ä»¥åŒå‘é€šä¿¡çš„ï¼ˆå…¨åŒå·¥ï¼‰ï¼Œå› æ­¤æ¯ä¸ªæ–¹å‘éƒ½å¿…é¡»å•ç‹¬è¿›è¡Œå…³é—­    å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å¯ä»¥å…ˆå¼€å§‹æ–­å¼€è¿æ¥    1å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘é€å¸¦æœ‰FINçš„æ–­è¿è¯·æ±‚    2æœåŠ¡ç«¯æ”¶åˆ°æ–­è¿è¯·æ±‚å¹¶ç¡®å®šå¯ä»¥æ–­è¿ä¹‹åï¼Œå›å¤å¸¦æœ‰ACKçš„ç¡®è®¤ä¿¡æ¯    3æœåŠ¡ç«¯å›å¤å¸¦æœ‰FINçš„æ–­è¿çš„è¯·æ±‚    4å®¢æˆ·ç«¯å›å¤å¸¦æœ‰ACKçš„æ–­è¿ç¡®è®¤ä¿¡æ¯1ã€ACK æ˜¯TCPæŠ¥å¤´çš„æ§åˆ¶ä½ä¹‹ä¸€ï¼Œå¯¹æ•°æ®è¿›è¡Œç¡®è®¤ã€‚ç¡®è®¤ç”±ç›®çš„ç«¯å‘å‡ºï¼Œ ç”¨å®ƒæ¥å‘Šè¯‰å‘é€ç«¯è¿™ä¸ªåºåˆ—å·ä¹‹å‰çš„æ•°æ®æ®µéƒ½æ”¶åˆ°äº†ã€‚ æ¯”å¦‚ç¡®è®¤å·ä¸ºXï¼Œåˆ™è¡¨ç¤ºå‰X-1ä¸ªæ•°æ®æ®µéƒ½æ”¶åˆ°äº†ï¼Œåªæœ‰å½“ACK=1æ—¶,ç¡®è®¤å·æ‰æœ‰æ•ˆï¼Œå½“ACK=0æ—¶ï¼Œç¡®è®¤å·æ— æ•ˆï¼Œè¿™æ—¶ä¼šè¦æ±‚é‡ä¼ æ•°æ®ï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§ã€‚2ã€SYN åŒæ­¥åºåˆ—å·ï¼ŒTCPå»ºç«‹è¿æ¥æ—¶å°†è¿™ä¸ªä½ç½®1ã€‚3ã€FIN å‘é€ç«¯å®Œæˆå‘é€ä»»åŠ¡ä½ï¼Œå½“TCPå®Œæˆæ•°æ®ä¼ è¾“éœ€è¦æ–­å¼€æ—¶,ï¼Œæå‡ºæ–­å¼€è¿æ¥çš„ä¸€æ–¹å°†è¿™ä½ç½®1ã€‚TCPä¸ºä»€ä¹ˆè¦3æ¬¡æ¡æ‰‹ï¼Ÿè€Œä¸æ˜¯2æ¬¡ï¼Ÿ4æ¬¡ï¼Ÿ    TCPæ˜¯ä¼ è¾“æ§åˆ¶åè®®ï¼Œå…¶ä¼˜ç‚¹æ˜¯å…·æœ‰å¯é æ€§ï¼Œæ—¢è¦ä¿è¯æ•°æ®å¯é ä¼ è¾“ï¼Œåˆè¦æé«˜æ•°æ®ä¼ è¾“æ•ˆç‡ï¼Œç”¨ä¸‰æ¬¡æ°æ°å¯ä»¥æ»¡è¶³ä»¥ä¸Šä¸¤æ–¹é¢çš„éœ€æ±‚ï¼é˜²æ­¢æœåŠ¡å™¨æ¥æ”¶åˆ°å› ç½‘ç»œå»¶è¿Ÿå¯¼è‡´å¤±æ•ˆçš„å®¢æˆ·ç«¯è¿æ¥è¯·æ±‚ï¼Œé”™è¯¯çš„å»ºç«‹è¿æ¥ï¼Œè®©æœåŠ¡å™¨ä»¥ä¸ºä¼ è¾“è¿æ¥å·²å»ºç«‹ï¼Œå°±ä¸€ç›´ç­‰å®¢æˆ·ç«¯å‘é€æ•°æ®ï¼Œæµªè´¹æœåŠ¡å™¨èµ„æºã€‚ï¼ˆæ’é™¤2æ¬¡ï¼‰3æ¬¡çš„è¯ï¼Œæ­¤æ—¶å®¢æˆ·ç«¯ä¸ä¼šå†ç»™æœåŠ¡å™¨å‘é€ç¡®è®¤ï¼ŒæœåŠ¡å™¨ç”±äºæ”¶ä¸åˆ°ç¡®è®¤ï¼Œå°±ä¸ä¼šå»ºç«‹è¿æ¥ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¼šè¯å±‚"><a href="#ä¼šè¯å±‚" class="headerlink" title="ä¼šè¯å±‚"></a>ä¼šè¯å±‚</h2><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="è¡¨ç¤ºå±‚"><a href="#è¡¨ç¤ºå±‚" class="headerlink" title="è¡¨ç¤ºå±‚"></a>è¡¨ç¤ºå±‚</h2><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="åº”ç”¨å±‚"><a href="#åº”ç”¨å±‚" class="headerlink" title="åº”ç”¨å±‚"></a>åº”ç”¨å±‚</h2><h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">æ¦‚å¿µ    <span class="token class-name">Hypertext</span> <span class="token class-name">Transfer</span> <span class="token class-name">Protocol</span> è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯å®¢æˆ·ç«¯è¯·æ±‚å’Œå“åº”çš„æ ‡å‡†åè®®ã€‚    è§„å®šäº†æµè§ˆå™¨å’ŒæœåŠ¡å™¨ä¹‹é—´äº’ç›¸é€šä¿¡çš„è§„åˆ™ï¼ˆå†…å®¹æ ¼å¼ï¼‰ã€‚    å®¢æˆ·ç«¯å‘ç»™æœåŠ¡å™¨çš„æ ¼å¼å«<span class="token string">"è¯·æ±‚åè®®"</span>ï¼›æœåŠ¡å™¨å‘ç»™å®¢æˆ·ç«¯çš„æ ¼å¼å«<span class="token string">"å“åº”åè®®"</span>ã€‚ç‰¹ç‚¹    <span class="token number">1.</span> æ˜æ–‡ä¼ è¾“ï¼Œç«¯å£<span class="token number">80</span>    <span class="token number">2.</span> æ”¯æŒå®¢æˆ·ç«¯<span class="token operator">/</span>æœåŠ¡ç«¯æ¨¡å¼ã€‚    <span class="token number">3.</span> è¿æ¥ç®€å•å¿«é€Ÿï¼šå®¢æˆ·å‘æœåŠ¡å™¨è¯·æ±‚æœåŠ¡æ—¶ï¼Œåªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ï¼ŒHTTPæœåŠ¡å™¨ç¨‹åºè§„æ¨¡å°ï¼Œé€šä¿¡é€Ÿåº¦å¾ˆå¿«ã€‚    <span class="token number">4.</span> çµæ´»ï¼šå…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ï¼Œä¼ è¾“çš„ç±»å‹ç”±<span class="token class-name">Content</span><span class="token operator">-</span><span class="token class-name">Type</span>åŠ ä»¥æ ‡è®°ã€‚    <span class="token number">5.</span> æ— è¿æ¥ï¼šæŒ‡æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚ã€‚æœåŠ¡å™¨å¤„ç†å®Œè¯·æ±‚å¹¶æ”¶åˆ°å®¢æˆ·çš„åº”ç­”åå°±æ–­å¼€è¿æ¥ï¼ŒèŠ‚çœä¼ è¾“æ—¶é—´ï¼ˆä¸ºå¼¥è¡¥ä¸è¶³ï¼Œäº§ç”Ÿäº†ä¸¤ç§è®°å½•httpçŠ¶æ€çš„æŠ€æœ¯ï¼Œ<span class="token class-name">Cookie</span> å’Œ <span class="token class-name">Session</span> ï¼‰ã€‚HTTP1<span class="token punctuation">.</span><span class="token number">1</span> ç‰ˆæœ¬åæ”¯æŒå¯æŒç»­è¿æ¥ã€‚é€šè¿‡è¿™ç§è¿æ¥<span class="token punctuation">,</span>å°±æœ‰å¯èƒ½åœ¨å»ºç«‹ä¸€ä¸ª TCP è¿æ¥å<span class="token punctuation">,</span>å‘é€è¯·æ±‚å¹¶å¾—åˆ°å›åº”ï¼Œç„¶åå‘é€æ›´å¤šçš„è¯·æ±‚å¹¶å¾—åˆ°æ›´å¤šçš„å›åº”<span class="token punctuation">.</span>é€šè¿‡æŠŠå»ºç«‹å’Œé‡Šæ”¾ TCP è¿æ¥çš„å¼€é”€åˆ†æ‘Šåˆ°å¤šä¸ªè¯·æ±‚ä¸Šï¼Œåˆ™å¯¹äºæ¯ä¸ªè¯·æ±‚è€Œè¨€ï¼Œç”±äº TCP è€Œé€ æˆçš„ç›¸å¯¹å¼€é”€è¢«å¤§å¤§åœ°é™ä½äº†ã€‚è€Œä¸”ï¼Œè¿˜å¯ä»¥å‘é€æµæ°´çº¿è¯·æ±‚<span class="token punctuation">,</span>ä¹Ÿå°±æ˜¯è¯´åœ¨å‘é€è¯·æ±‚ <span class="token number">1</span> ä¹‹åçš„å›åº”åˆ°æ¥ä¹‹å‰å°±å¯ä»¥å‘é€è¯·æ±‚ <span class="token number">2.</span>ä¹Ÿå¯ä»¥è®¤ä¸ºï¼Œä¸€æ¬¡è¿æ¥å‘é€å¤šä¸ªè¯·æ±‚ï¼Œç”±å®¢æˆ·æœºç¡®è®¤æ˜¯å¦å…³é—­è¿æ¥ï¼Œè€ŒæœåŠ¡å™¨ä¼šè®¤ä¸ºè¿™äº›è¯·æ±‚åˆ†åˆ«æ¥è‡ªä¸åŒçš„å®¢æˆ·ç«¯ã€‚    <span class="token number">6.</span> æ— çŠ¶æ€ï¼šæŒ‡å¯¹äº‹åŠ¡å¤„ç†æ²¡æœ‰è®°å¿†èƒ½åŠ›ï¼Œæ„å‘³ç€å¦‚æœåç»­å¤„ç†éœ€è¦å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å¿…é¡»é‡ä¼ ï¼Œè¿™æ ·å¯èƒ½å¯¼è‡´æ¯æ¬¡è¿æ¥ä¼ é€ çš„æ•°æ®é‡å¢å¤§ã€‚å¦ä¸€æ–¹é¢ï¼Œåœ¨æœåŠ¡å™¨ä¸éœ€è¦å…ˆå‰ä¿¡æ¯æ—¶å®ƒçš„åº”ç­”å°±è¾ƒå¿«ã€‚HTTP URLhttp<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>host<span class="token punctuation">[</span><span class="token operator">:</span>port<span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">[</span>abs_path<span class="token punctuation">]</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>IPæˆ–åŸŸå<span class="token operator">:</span>ç«¯å£<span class="token operator">/</span>èµ„æºè·¯å¾„HTTP è¯·æ±‚ç»„æˆï¼šè¯·æ±‚è¡Œï¼ˆç¬¬ä¸€è¡Œï¼‰ã€è¯·æ±‚å¤´ï¼ˆæ‰€æœ‰çš„é”®å€¼å¯¹ï¼‰ã€è¯·æ±‚æ­£æ–‡ï¼ˆgetè¯·æ±‚æ²¡æœ‰ï¼‰è¯·æ±‚è¡Œæ ¼å¼ï¼š<span class="token class-name">Method</span> <span class="token class-name">Request</span><span class="token operator">-</span>URI HTTP<span class="token operator">-</span><span class="token class-name">Version</span> CRLF            <span class="token class-name">Method</span> è¯·æ±‚æ–¹æ³•  <span class="token class-name">Request</span><span class="token operator">-</span>URI ç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦            HTTP<span class="token operator">-</span><span class="token class-name">Version</span> HTTP åè®®ç‰ˆæœ¬  CRLF å›è½¦å’Œæ¢è¡Œ    è¯·æ±‚å¤´ï¼š<span class="token class-name">Request</span> <span class="token class-name">Headers</span> å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯ä¼ é€’è¯·æ±‚çš„é™„åŠ ä¿¡æ¯ä»¥åŠå®¢æˆ·ç«¯è‡ªèº«çš„ä¿¡æ¯        <span class="token class-name">Referer</span>ï¼šè¯¥è¯·æ±‚å¤´æŒ‡æ˜è¯·æ±‚ä»å“ªé‡Œæ¥ ã€‚HTTP å“åº”ç»„æˆï¼šå“åº”è¡Œã€å“åº”å¤´ã€å“åº”æ­£æ–‡    å“åº”å¤´ï¼š<span class="token class-name">Response</span> <span class="token class-name">Headers</span> æœåŠ¡å™¨ä¼ é€’ä¸èƒ½æ”¾åœ¨çŠ¶æ€è¡Œä¸­çš„é™„åŠ å“åº”ä¿¡æ¯ã€å…³äºæœåŠ¡å™¨çš„ä¿¡æ¯ã€å¯¹<span class="token class-name">Request</span><span class="token operator">-</span>URIæ‰€æ ‡è¯†çš„èµ„æºè¿›è¡Œä¸‹ä¸€æ­¥è®¿é—®çš„ä¿¡æ¯ã€‚    <span class="token class-name">Location</span> å“åº”æŠ¥å¤´åŸŸï¼šé‡å®šå‘æ¥å—è€…åˆ°ä¸€ä¸ªæ–°çš„ä½ç½®ï¼ˆå¸¸ç”¨äºæ›´æ¢åŸŸåï¼‰ã€‚    response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"http://www.baidu.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Refresh</span>ï¼šè‡ªåŠ¨è·³è½¬ï¼ˆå•ä½æ˜¯ç§’ï¼‰ï¼Œå¯ä»¥åœ¨é¡µé¢é€šè¿‡metaæ ‡ç­¾å®ç°ï¼Œä¹Ÿå¯åœ¨åå°å®ç°ã€‚    <span class="token comment">//æ¯3ç§’åˆ·æ–°ä¸€æ¬¡å½“å‰é¡µé¢</span>    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"refresh"</span> content<span class="token operator">=</span><span class="token string">"3;url=http://www.baidu.com"</span><span class="token operator">&gt;</span>    <span class="token comment">//3ç§’åè·³è½¬åˆ°ç™¾åº¦</span>    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">"refresh"</span> content<span class="token operator">=</span><span class="token string">"3;url=http://www.baidu.com"</span><span class="token operator">&gt;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="get"><a href="#get" class="headerlink" title="get"></a>get</h4><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822193557.png"></p><h4 id="post"><a href="#post" class="headerlink" title="post"></a>post</h4><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822193559.png"></p><h3 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h3><pre class="line-numbers language-none"><code class="language-none">ç‰¹ç‚¹ï¼šåŠ å¯†ä¼ è¾“ï¼Œç«¯å£443æ”¯æŒèº«ä»½éªŒè¯ï¼ˆSSLæ•´è¯ä¹¦+HTTPï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> è®¡ç®—æœºåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç½‘ç»œåè®® </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è°·æ­Œæµè§ˆå™¨ç¦ç”¨ç‰ˆæœ¬å¤ªæ—§æç¤º</title>
      <link href="/2021/08/20/gu-ge-liu-lan-qi-jin-yong-ban-ben-tai-jiu-ti-shi/"/>
      <url>/2021/08/20/gu-ge-liu-lan-qi-jin-yong-ban-ben-tai-jiu-ti-shi/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ Google Chrome å¿«æ·æ–¹å¼å±æ€§çš„ç›®æ ‡å€¼å¢åŠ åç¼€ï¼ˆæ³¨æ„ï¼šâ€“å‰é¢æœ‰ç©ºæ ¼ï¼‰ï¼š</p><pre class="line-numbers language-none"><code class="language-none">--disable-background-networking<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210820113019.png"></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>é¢å‘å¯¹è±¡å’Œé¢å‘è¿‡ç¨‹çš„åŒºåˆ«</title>
      <link href="/2021/08/19/mian-xiang-dui-xiang-he-mian-xiang-guo-cheng-de-qu-bie/"/>
      <url>/2021/08/19/mian-xiang-dui-xiang-he-mian-xiang-guo-cheng-de-qu-bie/</url>
      
        <content type="html"><![CDATA[<p>ä¸¤ç§ä¸åŒçš„æ€ç»´æ–¹å¼ï¼Œå³å¤„ç†é—®é¢˜çš„è§’åº¦ä¸ä¸€æ ·ã€‚</p><p>é¢å‘å¯¹è±¡</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ¦‚å¿µï¼šæ³¨é‡å®Œæˆä¸€ä»¶äº‹æƒ…ï¼Œéœ€è¦å“ªäº›å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡å„è‡ªè¦åšä»€ä¹ˆã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¼˜ç‚¹ï¼šå¯å¤ç”¨æ€§ã€å¯æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§é«˜ã€‚</p><p>é¢å‘è¿‡ç¨‹</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ¦‚å¿µï¼šæ³¨é‡å®Œæˆä¸€ä»¶äº‹æƒ…ï¼Œçš„æ¯ä¸€ä¸ªæ­¥éª¤å’Œé¡ºåºã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¼˜ç‚¹ï¼šæ‰§è¡Œæ•ˆç‡é«˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> é¢å‘å¯¹è±¡ </tag>
            
            <tag> é¢å‘è¿‡ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>superå’Œthisçš„åŒºåˆ«</title>
      <link href="/2021/08/19/super-he-this-de-qu-bie/"/>
      <url>/2021/08/19/super-he-this-de-qu-bie/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>super</th><th></th></tr></thead><tbody><tr><td>super</td><td>çˆ¶ç±»å¯¹è±¡ï¼ˆå‡ï¼‰</td></tr><tr><td>super.çˆ¶ç±»å±æ€§å</td><td>è°ƒç”¨çˆ¶ç±»å¯¹è±¡çš„å±æ€§ï¼Œå‰ææœ‰è®¿é—®æƒé™</td></tr><tr><td>super( )</td><td>è°ƒç”¨çˆ¶ç±»å¯¹è±¡æ‰€å±ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¿…é¡»ä½äºå­ç±»æ„é€ å™¨é¦–è¡Œï¼Œå‰ææœ‰è®¿é—®æƒé™</td></tr><tr><td>super.çˆ¶ç±»æ–¹æ³•å( )</td><td>è°ƒç”¨çˆ¶ç±»å¯¹è±¡æ–¹æ³•ï¼Œå‰ææœ‰è®¿é—®æƒé™</td></tr></tbody></table><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> a <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"run"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Benchi</span> <span class="token keyword">extends</span> <span class="token class-name">Car</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">Benchi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è°ƒç”¨çˆ¶ç±»å¯¹è±¡æ‰€å±ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¿…é¡»ä½äºå­ç±»æ„é€ å™¨é¦–è¡Œ</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//class test.Benchi çˆ¶ç±»å¯¹è±¡ï¼ˆå‡ï¼‰</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//"a" è°ƒç”¨çˆ¶ç±»å¯¹è±¡å±æ€§</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//"run" è°ƒç”¨çˆ¶ç±»å¯¹è±¡æ–¹æ³•</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>this</th><th></th></tr></thead><tbody><tr><td>this</td><td>å½“å‰ç±»å¯¹è±¡</td></tr><tr><td>this.å½“å‰ç±»å±æ€§å</td><td>è°ƒç”¨å½“å‰ç±»å¯¹è±¡çš„å±æ€§</td></tr><tr><td>this( )</td><td>è°ƒç”¨å½“å‰ç±»å¯¹è±¡æ‰€å±ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¿…é¡»æ”¾åœ¨å½“å‰ç±»æ„é€ å™¨é¦–è¡Œ</td></tr><tr><td>this.å½“å‰ç±»æ–¹æ³•å( )</td><td>è°ƒç”¨å½“å‰ç±»å¯¹è±¡çš„æ–¹æ³•</td></tr></tbody></table><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Fish</span> fish <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fish</span><span class="token punctuation">(</span><span class="token string">"fish"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Fish</span> <span class="token punctuation">{</span>    <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">int</span> price<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Fish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">Fish</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">Fish</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> price<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//        this();</span>        <span class="token keyword">this</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//2 è°ƒç”¨å½“å‰ç±»å¯¹è±¡æ‰€å±ç±»çš„æ„é€ æ–¹æ³•ï¼Œå¿…é¡»æ”¾åœ¨å½“å‰ç±»æ„é€ å™¨é¦–è¡Œ</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//class test.Fish  è°ƒç”¨å½“å‰ç±»å¯¹è±¡</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//"fish" è°ƒç”¨å½“å‰ç±»å¯¹è±¡çš„å±æ€§</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">swim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//"swim" è°ƒç”¨å½“å‰ç±»å¯¹è±¡çš„æ–¹æ³•</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">swim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"swim"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> é¢å‘å¯¹è±¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Excel æŒ‰æŒ‡å®šç¬¦å·åˆ†éš”æ•°æ®</title>
      <link href="/2021/08/17/excel-an-zhi-ding-fu-hao-fen-ge-shu-ju/"/>
      <url>/2021/08/17/excel-an-zhi-ding-fu-hao-fen-ge-shu-ju/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>ä½¿ç”¨ Excel å¤„ç†æ•°æ®æ—¶ï¼Œç¢°åˆ°ä¸€è¿ä¸²è¢«ç‰¹å®šç¬¦å·ï¼ˆå¦‚é€—å·ï¼‰åˆ†éš”çš„æ•°æ®æ—¶ï¼Œå¯ä»¥ä½¿ç”¨â€œæ•°æ®â€ä¸­çš„â€œåˆ†åˆ—â€åŠŸèƒ½å°†å…¶æ‹†åˆ†æˆå¤šåˆ—æ•°æ®ã€‚</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> é€‰ä¸­å¾…åˆ†éš”æ•°æ®çš„å•å…ƒæ ¼</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817162504.png"></p><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> é€‰æ‹©â€œ<strong>æ•°æ®</strong>â€ï¼Œæ•°æ®å·¥å…·ä¸­çš„â€œ<strong>åˆ†åˆ—</strong>â€</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817162801.png"></p><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> é€‰æ‹©â€œ<strong>åˆ†éš”ç¬¦å·</strong>â€ï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817162757.png"></p><p><span class="github-emoji"><span>4âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0034-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è®¾ç½®â€œ<strong>åˆ†éš”ç¬¦å·</strong>â€ï¼Œæ­¤æ—¶åœ¨æ•°æ®é¢„è§ˆåŒºå¯ä»¥çœ‹åˆ°å¤§è‡´çš„å¤„ç†æ•ˆæœï¼Œç‚¹å‡»ä¸‹ä¸€æ­¥</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817162805.png"></p><p><span class="github-emoji"><span>5âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0035-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç‚¹å‡»â€œ<strong>å®Œæˆ</strong>â€ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®å·²ç»è¢«æˆåŠŸåˆ†æˆäº†å¤šåˆ—ï¼</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817162906.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817162938.png"></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Excel </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨å®‰è£…æ‰©å±•ç¨‹åºçš„æ•™ç¨‹</title>
      <link href="/2021/08/12/liu-lan-qi-an-zhuang-kuo-zhan-cheng-xu-de-jiao-cheng/"/>
      <url>/2021/08/12/liu-lan-qi-an-zhuang-kuo-zhan-cheng-xu-de-jiao-cheng/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p><span class="github-emoji"><span>â˜€</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2600.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æµè§ˆå™¨æ‰©å±•ç¨‹åºèƒ½å¤Ÿè®©æµè§ˆå™¨çš„åŠŸèƒ½æ›´åŠ å¤šæ ·åŒ–ï¼Œé’ˆå¯¹ä¸åŒç±»å‹çš„æµè§ˆå™¨ï¼Œå®‰è£…çš„æ–¹å¼ä¸å°½ç›¸åŒã€‚</p><h2 id="360-å®‰å…¨æµè§ˆå™¨"><a href="#360-å®‰å…¨æµè§ˆå™¨" class="headerlink" title="360 å®‰å…¨æµè§ˆå™¨"></a>360 å®‰å…¨æµè§ˆå™¨</h2><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åœ¨æµè§ˆå™¨åœ°å€æ è¾“å…¥ï¼š<strong>se://extensions/</strong> è¿›å…¥æ·»åŠ æ‰©å±•ç¨‹åºçš„é¡µé¢ï¼Œå‹¾é€‰ <strong>å¼€å‘è€…æ¨¡å¼</strong>ï¼š</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812161546.png"></p><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å°†å‡†å¤‡å¥½çš„æ‰©å±•ç¨‹åºæ‹–æ‹½åˆ°æ­¤é¡µé¢ï¼š</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812163755.gif"></p><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å½“ä½ çœ‹åˆ°å³ä¸Šè§’å‡ºç°æ‰©å±•å›¾æ ‡æ—¶ï¼Œå³å®‰è£…æˆåŠŸï¼</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812164002.png"></p><h2 id="Chrome-æµè§ˆå™¨"><a href="#Chrome-æµè§ˆå™¨" class="headerlink" title="Chrome æµè§ˆå™¨"></a>Chrome æµè§ˆå™¨</h2><p>å°†æµè§ˆå™¨åœ°å€æ çš„åœ°å€ä¿®æ”¹ä¸ºï¼š<strong>chrome://extensions/</strong> ï¼ŒåŒç†ã€‚</p><h2 id="QQ-æµè§ˆå™¨"><a href="#QQ-æµè§ˆå™¨" class="headerlink" title="QQ æµè§ˆå™¨"></a>QQ æµè§ˆå™¨</h2><p>å°†æµè§ˆå™¨åœ°å€æ çš„åœ°å€ä¿®æ”¹ä¸ºï¼š<strong>qqbrowser://extensions/manage</strong> ï¼ŒåŒç†ã€‚</p><h2 id="Microsoft-Edge-æµè§ˆå™¨"><a href="#Microsoft-Edge-æµè§ˆå™¨" class="headerlink" title="Microsoft Edge æµè§ˆå™¨"></a>Microsoft Edge æµè§ˆå™¨</h2><p>å°†æµè§ˆå™¨åœ°å€æ çš„åœ°å€ä¿®æ”¹ä¸ºï¼š<strong>edge://extensions/</strong> ï¼ŒåŒç†ã€‚</p><h2 id="Firefox-æµè§ˆå™¨"><a href="#Firefox-æµè§ˆå™¨" class="headerlink" title="Firefox æµè§ˆå™¨"></a>Firefox æµè§ˆå™¨</h2><p>ç«ç‹æµè§ˆå™¨æ¯”è¾ƒç‰¹åˆ«ï¼Œä¸æ”¯æŒä» Chrome æµè§ˆå™¨æ‰©å±•å•†åº—ä¸‹è½½è€Œæ¥çš„æ‰©å±•ç¨‹åºï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä»å¯ä»¥é€šè¿‡ç«ç‹é™„åŠ ç»„ä»¶é‡Œçš„å¼€å‘è€…ä¸­å¿ƒä¸Šä¼ æ‰©å±•ç¨‹åºã€‚</p><blockquote><p>æ³¨æ„ï¼š</p><ol><li><p>å»ºè®®ä½¿ç”¨å›½é™…ç‰ˆçš„ç«ç‹æµè§ˆå™¨ã€‚</p></li><li><p>ä¸ä¿è¯æ‰€æœ‰è¢«ç§»æ¤çš„æ‰©å±•ç¨‹åºå¯ç”¨ã€‚</p></li></ol></blockquote><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åœ¨æµè§ˆå™¨åœ°å€è¾“å…¥ï¼š<a href="https://addons.mozilla.org/zh-CN/developers/">https://addons.mozilla.org/zh-CN/developers/</a> è¿›å…¥ <strong>å¼€å‘è€…ä¸­å¿ƒ</strong>ï¼Œç‚¹å‡» <strong>æäº¤æ–°é™„åŠ ç»„ä»¶</strong>ï¼š</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812181328.png"></p><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> é€‰æ‹© <strong>æˆ‘è‡ªå·±æ‰˜ç®¡</strong>ï¼Œç‚¹å‡» <strong>ç»§ç»­</strong>ï¼š</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812183652.png"></p><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç‚¹å‡» <strong>é€‰æ‹©æ–‡ä»¶</strong>ï¼Œé€‰æ‹©ä½ æƒ³è¦ä¸Šä¼ çš„æ‰©å±•ç¨‹åºï¼š</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812181727.png"></p><p><span class="github-emoji"><span>4âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0034-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç­‰å¾…æ‰©å±•ç¨‹åºä¸Šä¼ æˆåŠŸï¼Œç‚¹å‡» <strong>ç­¾åé™„åŠ ç»„ä»¶</strong>ï¼š</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812181854.png"></p><p><span class="github-emoji"><span>5âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0035-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> é€‰æ‹© <strong>å¦</strong>ï¼Œç‚¹å‡» <strong>ç»§ç»­</strong>ï¼Œå†è·³è½¬åˆ° <strong>æˆ‘çš„æäº¤</strong>ï¼Œåœ¨æ­¤é¡µé¢å¯ä»¥çœ‹åˆ°æ‰©å±•ç¨‹åºæ˜¯å¦ä¸Šä¼ æˆåŠŸï¼š</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812183725.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812182118.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812182304.png"></p><p><span class="github-emoji"><span>6âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0036-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç‚¹è¿›æ‰©å±•ç¨‹åºï¼Œç‚¹å‡» <strong>æŸ¥çœ‹å…¨éƒ¨</strong>ï¼Œç­‰å¾…çŠ¶æ€æ˜¾ç¤ºâ€œå·²æ ¸å‡†â€ï¼Œå°±å¯ä»¥ä½¿ç”¨äº†ï¼š</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812182410.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812182441.png"></p><p><span class="github-emoji"><span>7âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0037-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç‚¹å‡» <strong>.xpi æ–‡ä»¶</strong>ï¼Œæ·»åŠ æ‰©å±•ç¨‹åºåˆ°æµè§ˆå™¨é‡Œï¼Œå¤§åŠŸå‘Šæˆï¼</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812183911.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812183209.png"></p>]]></content>
      
      
      <categories>
          
          <category> Windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Windows æŠ€å·§ </tag>
            
            <tag> æµè§ˆå™¨æ‰©å±•ç¨‹åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Screw å¿«é€Ÿå…¥é—¨</title>
      <link href="/2021/08/05/screw-kuai-su-ru-men/"/>
      <url>/2021/08/05/screw-kuai-su-ru-men/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>å·¥ä½œä¹‹ä½™ï¼Œåœ¨ Github ä¸Šçœ‹åˆ°ä¸€æ¬¾å¼€æºçš„æ•°æ®åº“æ–‡æ¡£ç”Ÿæˆå·¥å…· â€”â€” screwï¼ˆèºä¸é’‰ï¼‰ ã€‚</p><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½è¦ä¸ºåœ¨å„ç§å„æ ·çš„é¡¹ç›®ï¼Œæ‰‹åŠ¨åœ°å»æ•´ç†å’Œç»´æŠ¤æ•°æ®åº“è¡¨ç»“æ„æ–‡æ¡£ï¼Œå½“æ•°æ®åº“è¡¨çš„æ•°é‡ç¹å¤šå¤æ‚ï¼Œäº¦æˆ–æ˜¯æ›´æ”¹å˜åŠ¨å¤šæ—¶ï¼Œæˆ‘ä»¬æ•´ç†å’Œç»´æŠ¤æ–‡æ¡£çš„æ—¶é—´æˆæœ¬å°±ä¼šå˜é«˜ï¼Œé™ä½å·¥ä½œæ•ˆç‡ï¼Œé€ æˆè¯¸å¤šä¸ä¾¿ï¼</p><p>ç°åœ¨ï¼Œscrew è¿™æ¬¾æ’ä»¶å·¥å…·æ¨ªç©ºå‡ºä¸–ï¼Œæ—¨åœ¨å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿè‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨ç»“æ„æ–‡æ¡£ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯ç®€æ´æ˜“ç”¨ã€è½»é‡ã€æ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼ï¼ˆHTMLã€Markdownã€Wordï¼‰ã€æ‰©å±•çµæ´»ï¼Œå¯¹å¸‚é¢ä¸Šå¤šç§æ•°æ®åº“ä¹Ÿéƒ½åšäº†æ¯”è¾ƒå¥½çš„æ”¯æŒï¼Œè¯¸å¦‚ï¼šMySQLã€MariaDBã€TIDBã€Oracleã€SqlServerã€PostgreSQL ç­‰ç­‰ï¼Œå…¶ä»–çš„æ­£åœ¨åŠªåŠ›å¼€å‘å½“ä¸­ã€‚</p><p>æ­¤å¤„è´´ä¸Š Github é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/pingfangushi/screw">https://github.com/pingfangushi/screw</a> </p><h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ•°æ®åº“è¡¨ç»“æ„æ–‡æ¡£ï¼Œçœ‹çœ‹æ•ˆæœå§ï¼ç›®å‰è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£çš„æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ–¹å¼æ˜¯åŸºäº Java ä»£ç ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯åŸºäº Maven æ’ä»¶ã€‚</p><h3 id="åŸºäº-Java-ä»£ç -ï¼ˆ-SpringBoot-é¡¹ç›®ï¼‰"><a href="#åŸºäº-Java-ä»£ç -ï¼ˆ-SpringBoot-é¡¹ç›®ï¼‰" class="headerlink" title="åŸºäº Java ä»£ç  ï¼ˆ SpringBoot é¡¹ç›®ï¼‰"></a>åŸºäº Java ä»£ç  ï¼ˆ SpringBoot é¡¹ç›®ï¼‰</h3><p>é¦–å…ˆï¼Œåœ¨æ•°æ®åº“ä¸­åˆ›å»ºä¸€ä¸ªç”¨äºæµ‹è¯•çš„ user è¡¨ï¼š</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span><span class="token punctuation">;</span><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token punctuation">(</span>  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'ç”¨æˆ·ID'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'ç”¨æˆ·å'</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>pwd<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'ç”¨æˆ·å¯†ç '</span><span class="token punctuation">,</span>  <span class="token punctuation">`</span>perms<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'ç”¨æˆ·æƒé™'</span><span class="token punctuation">,</span>  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token operator">=</span><span class="token number">2</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'ç”¨æˆ·è¡¨'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ç€ï¼Œå¯¼å…¥ç›¸å…³ä¾èµ–ï¼ˆè‹¥ä¸º SpringBoot é¡¹ç›®ï¼Œå› å…¶è‡ªå¸¦æ•°æ®æºä¸º HikariCP ï¼Œæ•…ä¸å¿…å¯¼å…¥ HikariCP ï¼‰ã€‚</p><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.smallbun.screw<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>screw-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.zaxxer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>HikariCP<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬å¯ä»¥æŒ‰ç…§è‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨ç»“æ„æ–‡æ¡£çš„å¤§è‡´çš„ä»£ç é€»è¾‘å»å®ç°ï¼Œæœ‰å¦‚ä¸‹ 5 æ­¥ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 1. è·å–æ•°æ®æºï¼ˆç›®å‰ MySQL åªé€‚é…äº† HikariCP æ•°æ®æºï¼Œå°šä¸å…¼å®¹å…¶ä»–æ•°æ®æºæ¯”å¦‚ï¼šDriud ç­‰ï¼Œå‚¬ä¼˜åŒ–~ï¼‰</span><span class="token class-name">DataSource</span> dataSource <span class="token operator">=</span> <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2. è·å–æ–‡æ¡£çš„ç”Ÿæˆé…ç½®ï¼ˆæ–‡æ¡£çš„è¾“å‡ºè·¯å¾„ã€æ–‡ä»¶ç±»å‹ã€è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶åç­‰ï¼‰</span><span class="token class-name">EngineConfig</span> engineConfig <span class="token operator">=</span> <span class="token function">getEngineConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3. è·å–æ–‡æ¡£çš„è¡¨å¤„ç†é…ç½®ï¼ˆæŒ‰æŒ‡å®šæ¡ä»¶ç”Ÿæˆã€å¿½ç•¥è¡¨ï¼‰</span><span class="token class-name">ProcessConfig</span> processConfig <span class="token operator">=</span> <span class="token function">getProcessConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 4. è·å– Screw æ€»é…ç½®ï¼ˆè®¾ç½®æ–‡æ¡£ç‰ˆæœ¬ã€æè¿°ç­‰è¯¦ç»†ä¿¡æ¯ï¼‰</span><span class="token class-name">Configuration</span> config <span class="token operator">=</span> <span class="token function">getScrewConfig</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">,</span> engineConfig<span class="token punctuation">,</span> processConfig<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 5. æ‰§è¡Œç”Ÿæˆ</span><span class="token keyword">new</span> <span class="token class-name">DocumentationExecute</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-è·å–æ•°æ®æº"><a href="#1-è·å–æ•°æ®æº" class="headerlink" title="1. è·å–æ•°æ®æº"></a>1. è·å–æ•°æ®æº</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">DataSource</span> <span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">HikariConfig</span> hikariConfig <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HikariConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariConfig<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span><span class="token string">"com.mysql.cj.jdbc.Driver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariConfig<span class="token punctuation">.</span><span class="token function">setJdbcUrl</span><span class="token punctuation">(</span><span class="token string">"jdbc:mysql://localhost:3307/mybatis?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;serverTimezone=GMT%2B8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariConfig<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"root"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariConfig<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariConfig<span class="token punctuation">.</span><span class="token function">addDataSourceProperty</span><span class="token punctuation">(</span><span class="token string">"useInformationSchema"</span><span class="token punctuation">,</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariConfig<span class="token punctuation">.</span><span class="token function">setMinimumIdle</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    hikariConfig<span class="token punctuation">.</span><span class="token function">setMaximumPoolSize</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HikariDataSource</span><span class="token punctuation">(</span>hikariConfig<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-è·å–æ–‡æ¡£çš„ç”Ÿæˆé…ç½®"><a href="#2-è·å–æ–‡æ¡£çš„ç”Ÿæˆé…ç½®" class="headerlink" title="2. è·å–æ–‡æ¡£çš„ç”Ÿæˆé…ç½®"></a>2. è·å–æ–‡æ¡£çš„ç”Ÿæˆé…ç½®</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">EngineConfig</span> <span class="token function">getEngineConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token class-name">EngineConfig</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">//æ–‡æ¡£çš„è¾“å‡ºè·¯å¾„</span>        <span class="token punctuation">.</span><span class="token function">fileOutputDir</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"user.dir"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/doc"</span><span class="token punctuation">)</span>        <span class="token comment">//æ–‡æ¡£ç”Ÿæˆåæ˜¯å¦è‡ªåŠ¨æ‰“å¼€</span>        <span class="token punctuation">.</span><span class="token function">openOutputDir</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>        <span class="token comment">//æ ¼å¼ï¼ˆæ”¯æŒHTMLã€WORDã€MDï¼‰</span>        <span class="token punctuation">.</span><span class="token function">fileType</span><span class="token punctuation">(</span><span class="token class-name">EngineFileType</span><span class="token punctuation">.</span>MD<span class="token punctuation">)</span>        <span class="token comment">//æ¨¡æ¿å®ç°</span>        <span class="token punctuation">.</span><span class="token function">produceType</span><span class="token punctuation">(</span><span class="token class-name">EngineTemplateType</span><span class="token punctuation">.</span>freemarker<span class="token punctuation">)</span>        <span class="token comment">//è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶å</span>        <span class="token punctuation">.</span><span class="token function">fileName</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“ç»“æ„æ–‡æ¡£"</span><span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-è·å–æ–‡æ¡£çš„è¡¨å¤„ç†é…ç½®"><a href="#3-è·å–æ–‡æ¡£çš„è¡¨å¤„ç†é…ç½®" class="headerlink" title="3. è·å–æ–‡æ¡£çš„è¡¨å¤„ç†é…ç½®"></a>3. è·å–æ–‡æ¡£çš„è¡¨å¤„ç†é…ç½®</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ProcessConfig</span> <span class="token function">getProcessConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> designatedTableName <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> designatedTablePrefix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> designatedTableSuffix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ignoreTableName <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"aa"</span><span class="token punctuation">,</span> <span class="token string">"test_group"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ignoreTablePrefix <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"test_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ignoreTableSuffix <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">"_test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token class-name">ProcessConfig</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">//æ ¹æ®è¡¨åç”Ÿæˆ</span>        <span class="token punctuation">.</span><span class="token function">designatedTableName</span><span class="token punctuation">(</span>designatedTableName<span class="token punctuation">)</span>        <span class="token comment">//æ ¹æ®è¡¨å‰ç¼€ç”Ÿæˆ</span>        <span class="token punctuation">.</span><span class="token function">designatedTablePrefix</span><span class="token punctuation">(</span>designatedTablePrefix<span class="token punctuation">)</span>        <span class="token comment">//æ ¹æ®è¡¨åç¼€ç”Ÿæˆ</span>        <span class="token punctuation">.</span><span class="token function">designatedTableSuffix</span><span class="token punctuation">(</span>designatedTableSuffix<span class="token punctuation">)</span>        <span class="token comment">//å¿½ç•¥è¡¨å</span>        <span class="token punctuation">.</span><span class="token function">ignoreTableName</span><span class="token punctuation">(</span>ignoreTableName<span class="token punctuation">)</span>        <span class="token comment">//å¿½ç•¥è¡¨å‰ç¼€</span>        <span class="token punctuation">.</span><span class="token function">ignoreTablePrefix</span><span class="token punctuation">(</span>ignoreTablePrefix<span class="token punctuation">)</span>        <span class="token comment">//å¿½ç•¥è¡¨åç¼€</span>        <span class="token punctuation">.</span><span class="token function">ignoreTableSuffix</span><span class="token punctuation">(</span>ignoreTableSuffix<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-è·å–-Screw-å®Œæ•´é…ç½®"><a href="#4-è·å–-Screw-å®Œæ•´é…ç½®" class="headerlink" title="4. è·å– Screw å®Œæ•´é…ç½®"></a>4. è·å– Screw å®Œæ•´é…ç½®</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Configuration</span> <span class="token function">getScrewConfig</span><span class="token punctuation">(</span><span class="token class-name">DataSource</span> dataSource<span class="token punctuation">,</span> <span class="token class-name">EngineConfig</span> engineConfig<span class="token punctuation">,</span> <span class="token class-name">ProcessConfig</span> processConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token class-name">Configuration</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment">//æ–‡æ¡£ç‰ˆæœ¬</span>        <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"1.0.0"</span><span class="token punctuation">)</span>        <span class="token comment">//æ–‡æ¡£æè¿°</span>        <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">"æ•°æ®åº“è®¾è®¡æ–‡æ¡£ç”Ÿæˆ"</span><span class="token punctuation">)</span>        <span class="token comment">//æ•°æ®æº</span>        <span class="token punctuation">.</span><span class="token function">dataSource</span><span class="token punctuation">(</span>dataSource<span class="token punctuation">)</span>        <span class="token comment">//æ–‡æ¡£çš„ç”Ÿæˆé…ç½®</span>        <span class="token punctuation">.</span><span class="token function">engineConfig</span><span class="token punctuation">(</span>engineConfig<span class="token punctuation">)</span>        <span class="token comment">//æ–‡æ¡£çš„è¡¨å¤„ç†é…ç½®</span>        <span class="token punctuation">.</span><span class="token function">produceConfig</span><span class="token punctuation">(</span>processConfig<span class="token punctuation">)</span>        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-æ‰§è¡Œç”Ÿæˆ"><a href="#5-æ‰§è¡Œç”Ÿæˆ" class="headerlink" title="5. æ‰§è¡Œç”Ÿæˆ"></a>5. æ‰§è¡Œç”Ÿæˆ</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">new</span> <span class="token class-name">DocumentationExecute</span><span class="token punctuation">(</span><span class="token function">getScrewConfig</span><span class="token punctuation">(</span><span class="token function">getDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getEngineConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getProcessConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶ï¼Œåœ¨é¡¹ç›®æ ¹è·¯å¾„çš„ doc æ–‡ä»¶å¤¹ä¸‹å·²ç»ç”Ÿæˆäº†ä¸€ä¸ª user æ•°æ®åº“è¡¨ç»“æ„æ–‡æ¡£äº†ï¼Œå¤§åŠŸå‘Šæˆï¼</p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210805000001.png"></p><h3 id="åŸºäº-Maven-æ’ä»¶"><a href="#åŸºäº-Maven-æ’ä»¶" class="headerlink" title="åŸºäº Maven æ’ä»¶"></a>åŸºäº Maven æ’ä»¶</h3><p>ç¬¬äºŒç§æ–¹å¼ï¼Œæ–‡æ¡£ä¹Ÿæ˜¯è‡ªåŠ¨ç”Ÿæˆåˆ°é¡¹ç›®æ ¹ç›®å½•çš„ doc æ–‡ä»¶å¤¹é‡Œã€‚</p><h4 id="1-å¯¼å…¥ä¾èµ–"><a href="#1-å¯¼å…¥ä¾èµ–" class="headerlink" title="1. å¯¼å…¥ä¾èµ–"></a>1. å¯¼å…¥ä¾èµ–</h4><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.smallbun.screw<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>screw-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>8.0.18<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--username--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">&gt;</span></span>root<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--password--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>123456<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--driver--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>driverClassName</span><span class="token punctuation">&gt;</span></span>com.mysql.cj.jdbc.Driver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>driverClassName</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--jdbc url--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>jdbcUrl</span><span class="token punctuation">&gt;</span></span>jdbc:mysql://localhost:3307/mybatis?useSSL=false<span class="token entity named-entity" title="&amp;">&amp;amp;</span>useUnicode=true<span class="token entity named-entity" title="&amp;">&amp;amp;</span>characterEncoding=utf-8<span class="token entity named-entity" title="&amp;">&amp;amp;</span>serverTimezone=GMT%2B8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>jdbcUrl</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--ç”Ÿæˆæ–‡ä»¶ç±»å‹--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileType</span><span class="token punctuation">&gt;</span></span>MD<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileType</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--æ‰“å¼€æ–‡ä»¶è¾“å‡ºç›®å½•--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>openOutputDir</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>openOutputDir</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--ç”Ÿæˆæ¨¡æ¿--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>produceType</span><span class="token punctuation">&gt;</span></span>freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>produceType</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--æ–‡æ¡£åç§° ä¸ºç©ºæ—¶:å°†é‡‡ç”¨[æ•°æ®åº“åç§°-æè¿°-ç‰ˆæœ¬å·]ä½œä¸ºæ–‡æ¡£åç§°--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>fileName</span><span class="token punctuation">&gt;</span></span>æµ‹è¯•æ–‡æ¡£åç§°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>fileName</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--æè¿°--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>æ•°æ®åº“æ–‡æ¡£ç”Ÿæˆ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--ç‰ˆæœ¬--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>                <span class="token comment">&lt;!--æ ‡é¢˜--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>æ•°æ®åº“æ–‡æ¡£<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>run<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-æ‰§è¡Œ-screw-run"><a href="#2-æ‰§è¡Œ-screw-run" class="headerlink" title="2. æ‰§è¡Œ screw:run"></a>2. æ‰§è¡Œ screw:run</h4><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210805004012.png"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
            <tag> Screw </tag>
            
            <tag> æ•°æ®åº“æ–‡æ¡£ç”Ÿæˆå·¥å…· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL é”</title>
      <link href="/2021/05/07/mysql-suo/"/>
      <url>/2021/05/07/mysql-suo/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¦‚å¿µ</p><p>æ•°æ®åº“æ˜¯ä¸€ä¸ªå¤šç”¨æˆ·ä½¿ç”¨çš„å…±äº«èµ„æºã€‚å½“å¤šä¸ªç”¨æˆ·å¹¶å‘åœ°å­˜å–æ•°æ®æ—¶ï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿå¤šä¸ªäº‹åŠ¡åŒæ—¶å­˜å–åŒä¸€æ•°æ®çš„æƒ…å†µã€‚ä¸ºäº†å®ç°å¹¶å‘æ§åˆ¶ï¼Œé¿å…å­˜å–ä¸æ­£ç¡®çš„æ•°æ®ï¼Œç ´åæ•°æ®åº“çš„ä¸€è‡´æ€§ã€‚å› è€Œå°±éœ€è¦åŠ é”ã€‚å½“äº‹åŠ¡åœ¨å¯¹æŸä¸ªæ•°æ®å¯¹è±¡è¿›è¡Œæ“ä½œå‰ï¼Œå…ˆå‘ç³»ç»Ÿå‘å‡ºè¯·æ±‚ï¼Œå¯¹å…¶åŠ é”ã€‚åŠ é”åäº‹åŠ¡å°±æ§åˆ¶äº†è¯¥æ•°æ®å¯¹è±¡ï¼Œåœ¨è¯¥äº‹åŠ¡é‡Šæ”¾é”ä¹‹å‰ï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½æ“ä½œè¯¥å¯¹è±¡ã€‚</p><h2 id="ç§ç±»"><a href="#ç§ç±»" class="headerlink" title="ç§ç±»"></a>ç§ç±»</h2><table><thead><tr><th>ç§ç±»</th><th></th><th></th></tr></thead><tbody><tr><td>è¡¨é”</td><td>æ“ä½œæ—¶é”ä¸€å¼ è¡¨</td><td>å¼€é”€å°ï¼ŒåŠ é”å¿«ï¼›ä¸ä¼šæ­»é”ï¼›é”é¢—ç²’å¤§ï¼Œé”å†²çªçš„æ¦‚ç‡é«˜ï¼Œå¹¶å‘åº¦ä½</td></tr><tr><td>é¡µé¢é”</td><td></td><td>ç•Œäºä¸¤è€…ä¹‹é—´ï¼›ä¼šæ­»é”ï¼›å¹¶å‘åº¦ä¸€èˆ¬</td></tr><tr><td>è¡Œé”</td><td>æ“ä½œæ—¶é”ä¸€è¡Œæ•°æ®ï¼Œé€‚åˆé«˜å¹¶å‘</td><td>å¼€é”€å¤§ï¼ŒåŠ é”æ…¢ï¼›ä¼šæ­»é”ï¼›é”é¢—ç²’æœ€å°ï¼Œé”å†²çªçš„æ¦‚ç‡ä½ï¼Œå¹¶å‘åº¦é«˜</td></tr></tbody></table><h2 id="ä¼˜åŒ–ç­–ç•¥"><a href="#ä¼˜åŒ–ç­–ç•¥" class="headerlink" title="ä¼˜åŒ–ç­–ç•¥"></a>ä¼˜åŒ–ç­–ç•¥</h2><ol><li><p>è¯»å†™åˆ†ç¦»ï¼›</p></li><li><p>åˆ†æ®µåŠ é”ï¼›</p></li><li><p>å‡å°‘é”æŒæœ‰çš„æ—¶é—´ï¼›</p></li><li><p>å¤šçº¿ç¨‹å°½é‡ä»¥ç›¸åŒçš„é¡ºåºå»è·å–èµ„æºï¼Œä¸èƒ½å°†é”çš„ç²’åº¦è¿‡äºç»†åŒ–ï¼Œä¸ç„¶å¯èƒ½ä¼šå‡ºç°çº¿ç¨‹çš„åŠ é”å’Œé‡Šæ”¾æ¬¡æ•°è¿‡å¤šï¼Œåè€Œæ•ˆç‡ä¸å¦‚ä¸€æ¬¡åŠ ä¸€æŠŠå¤§é”ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ‰æ•ˆçš„æ‹¬å·</title>
      <link href="/2020/11/01/you-xiao-de-gua-hao/"/>
      <url>/2020/11/01/you-xiao-de-gua-hao/</url>
      
        <content type="html"><![CDATA[<h2 id="20-æœ‰æ•ˆçš„æ‹¬å·"><a href="#20-æœ‰æ•ˆçš„æ‹¬å·" class="headerlink" title="20. æœ‰æ•ˆçš„æ‹¬å·"></a><a href="https://leetcode-cn.com/problems/valid-parentheses/">20. æœ‰æ•ˆçš„æ‹¬å·</a></h2><p>ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ â€˜(â€˜ï¼Œâ€™)â€™ï¼Œâ€™{â€˜ï¼Œâ€™}â€™ï¼Œâ€™[â€˜ï¼Œâ€™]â€™ çš„å­—ç¬¦ä¸² s ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚</p><p>æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š</p><p>å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚<br>å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><p>è¾“å…¥ï¼šs = â€œ()â€<br>è¾“å‡ºï¼štrue<br>ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼šs = â€œ()[]{}â€<br>è¾“å‡ºï¼štrue<br>ç¤ºä¾‹ 3ï¼š</p><p>è¾“å…¥ï¼šs = â€œ(]â€<br>è¾“å‡ºï¼šfalse<br>ç¤ºä¾‹ 4ï¼š</p><p>è¾“å…¥ï¼šs = â€œ([)]â€<br>è¾“å‡ºï¼šfalse<br>ç¤ºä¾‹ 5ï¼š</p><p>è¾“å…¥ï¼šs = â€œ{[]}â€<br>è¾“å‡ºï¼štrue</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">LinkedList</span><span class="token punctuation">;</span><span class="token comment">/** * æ ˆç±»ï¼šé“¾æ ˆ */</span><span class="token keyword">class</span> <span class="token class-name">MyStack</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> pointer<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Character</span><span class="token punctuation">&gt;</span></span> data<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">MyStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>pointer <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Character</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * åˆ¤æ–­æ ˆæ˜¯å¦ä¸ºç©º     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> pointer <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å…¥æ ˆ     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token class-name">Character</span> ch<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// æ ˆæ»¡</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>pointer <span class="token operator">==</span> n<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>pointer<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å‡ºæ ˆ     */</span>    <span class="token keyword">public</span> <span class="token class-name">Character</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">//æ ˆä¸ºç©ºæ—¶ï¼Œè¿”å›' '</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">' '</span><span class="token punctuation">;</span>        <span class="token class-name">Character</span> ch <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>pointer<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> ch<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * åˆ¤å®šå·¦å³æ‹¬å·æ˜¯å¦åŒ¹é…     */</span>    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token keyword">char</span> left<span class="token punctuation">,</span> <span class="token keyword">char</span> right<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">==</span> <span class="token string">'('</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> right <span class="token operator">==</span> <span class="token string">')'</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">==</span> <span class="token string">'['</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> right <span class="token operator">==</span> <span class="token string">']'</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">==</span> <span class="token string">'{'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> right <span class="token operator">==</span> <span class="token string">'}'</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>   <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isValid</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// æœ‰æ•ˆå­—ç¬¦ä¸²çš„é•¿åº¦ä¸€å®šä¸ºå¶æ•°ï¼Œå› æ­¤å¦‚æœå­—ç¬¦ä¸²çš„é•¿åº¦ä¸ºå¥‡æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è¿”å› False</span>        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token class-name">MyStack</span> stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è½¬ä¸ºå­—ç¬¦æ•°ç»„</span>        <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> temp <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1.å¥‡æ•°,å¤±è´¥</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> temp<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// éå†å­—ç¬¦æ•°ç»„</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> temp<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// å¦‚æœæ˜¯å·¦æ‹¬å·ï¼Œå‹æ ˆ</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">'('</span> <span class="token operator">==</span> temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'['</span> <span class="token operator">==</span> temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token string">'{'</span> <span class="token operator">==</span> temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// å¦‚æœæ˜¯å³æ‹¬å·ï¼Œå‡ºæ ˆ</span>                <span class="token keyword">char</span> left <span class="token operator">=</span> stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">char</span> right <span class="token operator">=</span> temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token comment">// 2.å¦‚æœå·¦å³æ‹¬å·ä¸åŒ¹é… æˆ– 3.æå‰æ ˆç©ºï¼Œå³å³æ‹¬å·å¤šï¼Œå¤±è´¥</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">isMatch</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> right<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">' '</span> <span class="token operator">==</span> left<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">// 4.éå†å®Œï¼Œå³å·¦æ‹¬å·å¤šï¼Œå¤±è´¥</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>stack<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> flag<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Solution</span> solution <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Solution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>solution<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token string">"(({[]})"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æœ‰æ•ˆçš„æ‹¬å· </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ äº‹åŠ¡</title>
      <link href="/2020/09/03/rabbitmq-shi-wu/"/>
      <url>/2020/09/03/rabbitmq-shi-wu/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>RabbitMQ çš„æ¶ˆæ¯ç¡®è®¤é—®é¢˜ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…ä¸çŸ¥é“æ¶ˆæ¯æ˜¯å¦å·²åˆ°è¾¾é˜Ÿåˆ—ã€‚<br><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è§£å†³æ–¹æ³•ï¼š<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. äº‹åŠ¡ï¼ˆä¸€èˆ¬å¾ˆå°‘ç”¨ï¼Œå› ä¸ºä¼šé™ä½ RabbitMQ æ€§èƒ½ï¼ï¼‰ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. ç¡®è®¤æ¨¡å¼ confirm ã€‚</p><h2 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h2><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åŸç†</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€šè¿‡ txSelect() å°†å½“å‰ä¿¡é“ channel è®¾ç½®æˆ transaction æ¨¡å¼å¼€å§‹äº‹åŠ¡ï¼Œäº‹åŠ¡æ‰§è¡Œå®Œæˆåç”¨ txCommit() æäº¤äº‹åŠ¡ï¼Œå¦‚æœæäº¤æˆåŠŸï¼Œåˆ™æ¶ˆæ¯ä¸€å®šåˆ°è¾¾äº†brokeräº†ï¼Œå¦‚æœä¸­é—´å‘ç”Ÿå¼‚å¸¸ï¼Œç”¨ txRollback() å›æ»šäº‹åŠ¡ã€‚</p><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç”Ÿäº§è€…</p><p><code>Send.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * äº‹åŠ¡-æ¶ˆæ¯ç”Ÿäº§è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"tx"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å¼€å¯äº‹åŠ¡</span>            channel<span class="token punctuation">.</span><span class="token function">txSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">0</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> QUEUE_NAME<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//æäº¤äº‹åŠ¡</span>            channel<span class="token punctuation">.</span><span class="token function">txCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//å›æ»šäº‹åŠ¡</span>            channel<span class="token punctuation">.</span><span class="token function">txRollback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¶ˆè´¹è€…</p><p><code>Recv.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * äº‹åŠ¡-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"tx"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¡®è®¤æ¨¡å¼"><a href="#ç¡®è®¤æ¨¡å¼" class="headerlink" title="ç¡®è®¤æ¨¡å¼"></a>ç¡®è®¤æ¨¡å¼</h2><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åŸç†</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç”Ÿäº§è€…å°†ä¿¡é“ channel è®¾ç½®æˆç¡®è®¤ confirm æ¨¡å¼ï¼Œä¸€æ—¦ä¿¡é“è¿›å…¥ç¡®è®¤æ¨¡å¼ï¼Œæ‰€æœ‰åœ¨è¯¥ä¿¡é“ä¸Šé¢å‘å¸ƒçš„æ¶ˆæ¯éƒ½ä¼šè¢«æŒ‡æ´¾ä¸€ä¸ªå”¯ä¸€çš„IDï¼ˆä»1å¼€å§‹ï¼‰ï¼Œä¸€æ—¦æ¶ˆæ¯è¢«æŠ•é€’åˆ°æ‰€æœ‰åŒ¹é…çš„é˜Ÿåˆ—ä¹‹åï¼Œbroker å°±ä¼šå‘é€ä¸€ä¸ªç¡®è®¤ç»™ç”Ÿäº§è€…ï¼ˆåŒ…å«æ¶ˆæ¯çš„å”¯ä¸€IDï¼‰,è¿™å°±ä½¿å¾—ç”Ÿäº§è€…çŸ¥é“æ¶ˆæ¯å·²ç»æ­£ç¡®åˆ°è¾¾ç›®çš„é˜Ÿåˆ—äº†ï¼Œå¦‚æœæ¶ˆæ¯å’Œé˜Ÿåˆ—æ˜¯å¯æŒä¹…åŒ–çš„ï¼Œé‚£ä¹ˆç¡®è®¤æ¶ˆæ¯ä¼šå°†æ¶ˆæ¯å†™å…¥ç£ç›˜ä¹‹åå‘å‡ºï¼Œbroker å›ä¼ ç»™ç”Ÿäº§è€…çš„ç¡®è®¤æ¶ˆæ¯ä¸­ deliver-tag åŸŸåŒ…å«äº†ç¡®è®¤æ¶ˆæ¯çš„åºåˆ—å·ï¼Œæ­¤å¤– broker ä¹Ÿå¯ä»¥è®¾ç½® basic.ack çš„  multiple åŸŸï¼Œè¡¨ç¤ºåˆ°è¿™ä¸ªåºåˆ—å·ä¹‹å‰çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å·²ç»å¾—åˆ°äº†å¤„ç†ã€‚ </p><p><span class="github-emoji"><span>â˜€</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2600.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¼˜ç‚¹<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å¼‚æ­¥ï¼šä¸€æ—¦å‘å¸ƒä¸€æ¡æ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºå°±å¯ä»¥åœ¨ç­‰ä¿¡é“è¿”å›ç¡®è®¤çš„åŒæ—¶ç»§ç»­å‘é€ä¸‹ä¸€æ¡æ¶ˆæ¯ï¼Œå½“æ¶ˆæ¯æœ€ç»ˆå¾—åˆ°ç¡®è®¤ä¹‹åï¼Œç”Ÿäº§è€…åº”ç”¨ä¾¿å¯ä»¥é€šè¿‡å›è°ƒæ–¹æ³•æ¥å¤„ç†è¯¥ç¡®è®¤æ¶ˆæ¯ï¼Œå¦‚æœ RabbitMQ å› ä¸ºè‡ªèº«å†…éƒ¨é”™è¯¯å¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼Œå°±ä¼šå‘é€ä¸€æ¡ nack æ¶ˆæ¯ï¼Œç”Ÿäº§è€…åº”ç”¨ç¨‹åºåŒæ ·å¯ä»¥åœ¨å›è°ƒæ–¹æ³•ä¸­å¤„ç†è¯¥ nack æ¶ˆæ¯ã€‚ </p><p><span class="github-emoji"><span>âš </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/26a0.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ³¨æ„<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨ channel è¢«è®¾ç½®æˆ confirm æ¨¡å¼ä¹‹åï¼Œæ‰€æœ‰è¢« publish çš„åç»­æ¶ˆæ¯éƒ½å°†è¢« confirmï¼ˆå³ ackï¼‰æˆ–è€…è¢« nack ä¸€æ¬¡ã€‚ä½†æ˜¯æ²¡æœ‰å¯¹æ¶ˆæ¯è¢« confirm çš„å¿«æ…¢åšä»»ä½•ä¿è¯ï¼Œå¹¶ä¸”åŒä¸€æ¡æ¶ˆæ¯ä¸ä¼šæ—¢è¢« confirm åˆè¢« nack ã€‚</p><p><span class="github-emoji"><span>ğŸŒˆ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f308.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å®ç°<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. æ™®é€šåŒæ­¥ç¡®è®¤ï¼šå®¢æˆ·ç«¯æ¯å‘é€ä¸€æ¡æ¶ˆæ¯åï¼Œè°ƒç”¨ waitForConfirms() æ–¹æ³•ï¼Œç­‰å¾…æœåŠ¡å™¨ç«¯ç¡®è®¤ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. æ‰¹é‡åŒæ­¥ç¡®è®¤ï¼šå®¢æˆ·ç«¯æ¯å‘é€ä¸€æ‰¹æ¶ˆæ¯åï¼Œè°ƒç”¨ waitForConfirmsOrDie() æ–¹æ³•ï¼Œç­‰å¾…æœåŠ¡å™¨ç«¯ç¡®è®¤ï¼Œåªè¦æœ‰ä¸€æ¡å¤±è´¥åˆ™æŠ›å¼‚å¸¸ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. å¼‚æ­¥ï¼šæä¾›ä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼ŒæœåŠ¡ç«¯ç¡®è®¤äº†ä¸€æ¡æˆ–å¤šæ¡æ¶ˆæ¯åå®¢æˆ·ç«¯ä¼šå›è°ƒè¿™ä¸ªæ–¹æ³•ã€‚</p><h3 id="åŒæ­¥"><a href="#åŒæ­¥" class="headerlink" title="åŒæ­¥"></a>åŒæ­¥</h3><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç”Ÿäº§è€…</p><p><code>Send.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç¡®è®¤æ¨¡å¼-åŒæ­¥-æ¶ˆæ¯ç”Ÿäº§è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token punctuation">{</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"confirm_sync"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">{</span>connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å¼€å¯ç¡®è®¤æ¨¡å¼</span>channel<span class="token punctuation">.</span><span class="token function">confirmSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> QUEUE_NAME<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æ™®é€šconfirmæ¨¡å¼</span><span class="token keyword">if</span> <span class="token punctuation">(</span>channel<span class="token punctuation">.</span><span class="token function">waitForConfirms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆæ¯å‘é€æˆåŠŸï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">//æ‰¹é‡confirmæ¨¡å¼ï¼Œåªè¦æœ‰ä¸€æ¡æœªç¡®è®¤ï¼Œç›´æ¥æŠ›å¼‚å¸¸</span>channel<span class="token punctuation">.</span><span class="token function">waitForConfirmsOrDie</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ¶ˆæ¯å‘é€æˆåŠŸï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¶ˆè´¹è€…</p><p><code>Recv.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç¡®è®¤æ¨¡å¼-åŒæ­¥-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"confirm_sync"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¼‚æ­¥"><a href="#å¼‚æ­¥" class="headerlink" title="å¼‚æ­¥"></a>å¼‚æ­¥</h3><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åŸç†</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å®¢æˆ·ç«¯å‘çš„æ¶ˆæ¯éƒ½é™„å¸¦ç¼–å·ï¼ˆå­˜å‚¨åœ¨ SorteSet ï¼Œä» 1 å¼€å§‹ï¼‰ï¼ŒæœåŠ¡ç«¯æ”¶åˆ°æ¶ˆæ¯å°±ä¼šå›ç¡®è®¤ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯æ ¹æ®ç›‘å¬å›è°ƒæ–¹æ³•å»å¤„ç†å¹¶åˆ æ‰å·²è¢«æœåŠ¡ç«¯ç¡®è®¤çš„æ¶ˆæ¯ç¼–å·ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨å®¢æˆ·ç«¯ä¸­è®¾ç½® Channel å¯¹è±¡æä¾›çš„ ConfirmListener() ç›‘å¬å›è°ƒæ–¹æ³•ï¼Œå…¶åŒ…å« deliveryTagï¼ˆå½“å‰Chanelå‘å‡ºçš„æ¶ˆæ¯åºå·ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±ä¸ºæ¯ä¸€ä¸ª Channel ç»´æŠ¤ä¸€ä¸ª unconfirm çš„æ¶ˆæ¯åºå·æœ‰åºé›†åˆ SortedSetï¼Œæ¯ publish ä¸€æ¡æ•°æ®ï¼Œé›†åˆä¸­å…ƒç´ åŠ  1 ï¼Œæ¯å›è°ƒä¸€æ¬¡ handleAck æ–¹æ³•ï¼Œunconfirm é›†åˆåˆ æ‰ç›¸åº”çš„ä¸€æ¡ ï¼ˆmultiple=falseï¼‰æˆ–å¤šæ¡ ï¼ˆmultiple=trueï¼‰è®°å½•ã€‚</p><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç”Ÿäº§è€…</p><p><code>Send.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ä¿¡é“ç¡®è®¤æ¨¡å¼-å¼‚æ­¥-ç”Ÿäº§è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"confirm_async"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// ç»´æŠ¤ä¿¡æ¯å‘é€å›æ‰§deliveryTag</span>            <span class="token keyword">final</span> <span class="token class-name">SortedSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> confirmSet <span class="token operator">=</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">synchronizedSortedSet</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TreeSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¼€å¯ confirm ç¡®è®¤æ¨¡å¼</span>            channel<span class="token punctuation">.</span><span class="token function">confirmSelect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// æ·»åŠ  channel ç›‘å¬</span>            channel<span class="token punctuation">.</span><span class="token function">addConfirmListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ConfirmListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// å·²ç¡®è®¤</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleAck</span><span class="token punctuation">(</span><span class="token keyword">long</span> deliveryTag<span class="token punctuation">,</span> <span class="token keyword">boolean</span> multiple<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>                    <span class="token comment">// multiple=trueå·²ç¡®è®¤å¤šæ¡ falseå·²ç¡®è®¤å•æ¡</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>multiple<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"handleAck--success--&gt;multiple"</span> <span class="token operator">+</span> deliveryTag<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// æ¸…é™¤å‰ deliveryTag é¡¹æ ‡è¯†id</span>                        confirmSet<span class="token punctuation">.</span><span class="token function">headSet</span><span class="token punctuation">(</span>deliveryTag <span class="token operator">+</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"handleAck--success--&gt;single"</span> <span class="token operator">+</span> deliveryTag<span class="token punctuation">)</span><span class="token punctuation">;</span>                        confirmSet<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>deliveryTag<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token comment">// æœªç¡®è®¤</span>                <span class="token annotation punctuation">@Override</span>                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleNack</span><span class="token punctuation">(</span><span class="token keyword">long</span> deliveryTag<span class="token punctuation">,</span> <span class="token keyword">boolean</span> multiple<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>                    <span class="token comment">// multiple=trueæœªç¡®è®¤å¤šæ¡ falseæœªç¡®è®¤å•æ¡</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>multiple<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"handleNack--failed--&gt;multiple--&gt;"</span> <span class="token operator">+</span> deliveryTag<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">// æ¸…é™¤å‰ deliveryTag é¡¹æ ‡è¯†id</span>                        confirmSet<span class="token punctuation">.</span><span class="token function">headSet</span><span class="token punctuation">(</span>deliveryTag <span class="token operator">+</span> <span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"handleNack--failed--&gt;single"</span> <span class="token operator">+</span> deliveryTag<span class="token punctuation">)</span><span class="token punctuation">;</span>                        confirmSet<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>deliveryTag<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¾ªç¯å‘é€æ¶ˆæ¯æ¼”ç¤ºæ¶ˆæ¯ç¡®è®¤</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// åˆ›å»ºæ¶ˆæ¯</span>                <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>                <span class="token comment">// è·å–unconfirmçš„æ¶ˆæ¯åºå·deliveryTag</span>                <span class="token class-name">Long</span> seqNo <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">getNextPublishSeqNo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> QUEUE_NAME<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// å°†æ¶ˆæ¯åºå·deliveryTagæ·»åŠ è‡³SortedSet</span>                confirmSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>seqNo<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">TimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token comment">// å…³é—­é€šé“</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> channel <span class="token operator">&amp;&amp;</span> channel<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    channel<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// å…³é—­è¿æ¥</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> connection <span class="token operator">&amp;&amp;</span> connection<span class="token punctuation">.</span><span class="token function">isOpen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                    connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¶ˆè´¹è€…</p><p><code>Recv.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç¡®è®¤æ¨¡å¼-å¼‚æ­¥-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"confirm_async"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> RabbitMQ </tag>
            
            <tag> åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ é˜Ÿåˆ—æ¨¡å¼</title>
      <link href="/2020/09/02/rabbitmq-dui-lie-mo-shi/"/>
      <url>/2020/09/02/rabbitmq-dui-lie-mo-shi/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>RabbitMQ æ¶ˆæ¯é˜Ÿåˆ—æœ‰å¤šç§æ¨¡å¼ï¼šç®€å•ã€å·¥ä½œã€å‘å¸ƒè®¢é˜…ã€è·¯ç”±ã€ä¸»ä½“ã€RPC æ¨¡å¼ï¼Œæœ¬æ–‡å°†é€ä¸ªè¿›è¡Œå®æˆ˜æµ‹è¯•ã€‚</p><p>åœ¨æµ‹è¯•ä¹‹å‰ï¼Œé¦–å…ˆå¯¼å…¥ RabbitMQ çš„ä¾èµ–ï¼š</p><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.rabbitmq<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>amqp-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç®€å•æ¨¡å¼"><a href="#ç®€å•æ¨¡å¼" class="headerlink" title="ç®€å•æ¨¡å¼"></a>ç®€å•æ¨¡å¼</h2><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123217.png"></p><p>ç®€å•æ¨¡å¼ä¸‹åªæœ‰ç”Ÿäº§è€…ã€é˜Ÿåˆ—ã€æ¶ˆè´¹è€…éƒ½åªæœ‰ä¸€ä¸ªã€‚</p><blockquote><p>å£°æ˜é˜Ÿåˆ—ï¼šchannel.queueDeclare(QUEUE_NAME, false, false, false, null);</p><p>å‚æ•°ä¸€ queueï¼šé˜Ÿåˆ—åç§°<br>å‚æ•°äºŒ durable ï¼šæ˜¯å¦æŒä¹…åŒ–<br>å‚æ•°ä¸‰ Exclusiveï¼š<br>    æ’ä»–é˜Ÿåˆ—ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—è¢«å£°æ˜ä¸ºæ’ä»–é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä»…å¯¹é¦–æ¬¡å£°æ˜å®ƒçš„è¿æ¥å¯è§ï¼Œå¹¶åœ¨è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤ã€‚<br>    æ³¨æ„ï¼š</p><ol><li><p> æ’ä»–é˜Ÿåˆ—æ˜¯åŸºäºè¿æ¥å¯è§çš„ï¼ŒåŒä¸€è¿æ¥çš„ä¸åŒé€šé“æ˜¯å¯ä»¥åŒæ—¶è®¿é—®åŒä¸€ä¸ªè¿æ¥åˆ›å»ºçš„æ’ä»–é˜Ÿåˆ—çš„ã€‚</p></li><li><p> â€œé¦–æ¬¡â€ï¼Œå¦‚æœä¸€ä¸ªè¿æ¥å·²ç»å£°æ˜äº†ä¸€ä¸ªæ’ä»–é˜Ÿåˆ—ï¼Œå…¶ä»–è¿æ¥æ˜¯ä¸å…è®¸å»ºç«‹åŒåçš„æ’ä»–é˜Ÿåˆ—çš„ã€‚</p></li><li><p>å³ä½¿è¯¥é˜Ÿåˆ—æ˜¯æŒä¹…åŒ–çš„ï¼Œä¸€æ—¦è¿æ¥å…³é—­æˆ–è€…å®¢æˆ·ç«¯é€€å‡ºï¼Œè¯¥æ’ä»–é˜Ÿåˆ—éƒ½ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ã€‚<br>   è¿™ç§é˜Ÿåˆ—é€‚ç”¨äºåªé™äºä¸€ä¸ªå®¢æˆ·ç«¯å‘é€è¯»å–æ¶ˆæ¯çš„åº”ç”¨åœºæ™¯ã€‚</p></li></ol><p>å‚æ•°å›› Auto-deleteï¼š<br>   è‡ªåŠ¨åˆ é™¤ï¼Œå¦‚æœè¯¥é˜Ÿåˆ—æ²¡æœ‰ä»»ä½•è®¢é˜…çš„æ¶ˆè´¹è€…çš„è¯ï¼Œè¯¥é˜Ÿåˆ—ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚è¿™ç§é˜Ÿåˆ—é€‚ç”¨äºä¸´æ—¶é˜Ÿåˆ—ã€‚</p></blockquote><p>å®šä¹‰ç”Ÿäº§è€…ï¼š</p><p><code>Send.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç®€å•é˜Ÿåˆ—-æ¶ˆæ¯ç”Ÿäº§è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token punctuation">{</span>    <span class="token comment">//å®šä¹‰é˜Ÿåˆ—</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>                <span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span>                <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//åˆ›å»ºä¿¡é“</span>                <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>            <span class="token comment">//å‘é€æ¶ˆæ¯</span>            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> QUEUE_NAME<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123224.png"></p><p>å®šä¹‰æ¶ˆè´¹è€…ï¼š</p><p><code>Recv.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç®€å•é˜Ÿåˆ—-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv</span> <span class="token punctuation">{</span>    <span class="token comment">//å®šä¹‰é˜Ÿåˆ—</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºä¿¡é“</span>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç»‘å®šé˜Ÿåˆ—</span>        channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123229.png"></p><h2 id="å·¥ä½œæ¨¡å¼"><a href="#å·¥ä½œæ¨¡å¼" class="headerlink" title="å·¥ä½œæ¨¡å¼"></a>å·¥ä½œæ¨¡å¼</h2><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123320.png"></p><h3 id="è½®è¯¢"><a href="#è½®è¯¢" class="headerlink" title="è½®è¯¢"></a>è½®è¯¢</h3><p>ä½¿ç”¨åœºæ™¯ï¼šç”Ÿäº§è€…å‘å¸ƒä¿¡æ¯çš„èƒ½åŠ› &gt; æ¶ˆè´¹è€…æ¶ˆè´¹ä¿¡æ¯çš„èƒ½åŠ› ã€‚</p><p><code>Send.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å·¥ä½œé˜Ÿåˆ—-è½®è¯¢-æ¶ˆæ¯ç”Ÿäº§è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰é˜Ÿåˆ—åç§°</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"work_rr"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¿¡é“</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/** * å£°æ˜é˜Ÿåˆ— *  ç¬¬ä¸€ä¸ªå‚æ•°queueï¼šé˜Ÿåˆ—åç§° *  ç¬¬äºŒä¸ªå‚æ•°durableï¼šæ˜¯å¦æŒä¹…åŒ– *  ç¬¬ä¸‰ä¸ªå‚æ•°Exclusiveï¼šæ’ä»–é˜Ÿåˆ—ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—è¢«å£°æ˜ä¸ºæ’ä»–é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä»…å¯¹é¦–æ¬¡å£°æ˜å®ƒçš„è¿æ¥å¯è§ï¼Œå¹¶åœ¨è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤ã€‚ *      è¿™é‡Œéœ€è¦æ³¨æ„ä¸‰ç‚¹ï¼š *          1. æ’ä»–é˜Ÿåˆ—æ˜¯åŸºäºè¿æ¥å¯è§çš„ï¼ŒåŒä¸€è¿æ¥çš„ä¸åŒé€šé“æ˜¯å¯ä»¥åŒæ—¶è®¿é—®åŒä¸€ä¸ªè¿æ¥åˆ›å»ºçš„æ’ä»–é˜Ÿåˆ—çš„ã€‚ *          2. "é¦–æ¬¡"ï¼Œå¦‚æœä¸€ä¸ªè¿æ¥å·²ç»å£°æ˜äº†ä¸€ä¸ªæ’ä»–é˜Ÿåˆ—ï¼Œå…¶ä»–è¿æ¥æ˜¯ä¸å…è®¸å»ºç«‹åŒåçš„æ’ä»–é˜Ÿåˆ—çš„ï¼Œè¿™ä¸ªä¸æ™®é€šé˜Ÿåˆ—ä¸åŒã€‚ *          3. å³ä½¿è¯¥é˜Ÿåˆ—æ˜¯æŒä¹…åŒ–çš„ï¼Œä¸€æ—¦è¿æ¥å…³é—­æˆ–è€…å®¢æˆ·ç«¯é€€å‡ºï¼Œè¯¥æ’ä»–é˜Ÿåˆ—éƒ½ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ã€‚ *          è¿™ç§é˜Ÿåˆ—é€‚ç”¨äºåªé™äºä¸€ä¸ªå®¢æˆ·ç«¯å‘é€è¯»å–æ¶ˆæ¯çš„åº”ç”¨åœºæ™¯ã€‚ *  ç¬¬å››ä¸ªå‚æ•°Auto-deleteï¼šè‡ªåŠ¨åˆ é™¤ï¼Œå¦‚æœè¯¥é˜Ÿåˆ—æ²¡æœ‰ä»»ä½•è®¢é˜…çš„æ¶ˆè´¹è€…çš„è¯ï¼Œè¯¥é˜Ÿåˆ—ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚ *                          è¿™ç§é˜Ÿåˆ—é€‚ç”¨äºä¸´æ—¶é˜Ÿåˆ—ã€‚ */</span>channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"Hello World!"</span> <span class="token operator">+</span> i<span class="token punctuation">;</span><span class="token comment">//å‘é€æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> QUEUE_NAME<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Recv01.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å·¥ä½œé˜Ÿåˆ—-è½®è¯¢-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv01</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰é˜Ÿåˆ—</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"work_rr"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¿¡é“</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šé˜Ÿåˆ—</span>channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token comment">//æ¨¡æ‹Ÿæ¶ˆè´¹è€—æ—¶</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/**             * æ‰‹åŠ¨ç¡®è®¤             * multipleï¼šæ˜¯å¦ç¡®è®¤å¤šæ¡             */</span>channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Recv02.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å·¥ä½œé˜Ÿåˆ—-è½®è¯¢-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv02</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰é˜Ÿåˆ—</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"work_rr"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¿¡é“</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šé˜Ÿåˆ—</span>channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token comment">//æ¨¡æ‹Ÿæ¶ˆè´¹è€—æ—¶</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/**             * æ‰‹åŠ¨ç¡®è®¤             * multipleï¼šæ˜¯å¦ç¡®è®¤å¤šæ¡             */</span>channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123351.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123356.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123402.png"></p><h3 id="å…¬å¹³"><a href="#å…¬å¹³" class="headerlink" title="å…¬å¹³"></a>å…¬å¹³</h3><p>æ”¹è¿›è½®è¯¢æ¨¡å¼ï¼Œå½“ä¸åŒæ¶ˆè´¹è€…æ¶ˆè´¹èƒ½åŠ›ä¸åŒæ—¶ï¼Œèƒ½è€…å¤šåŠ³ï¼Œå³å¤„ç†å¿«çš„å¸®æ…¢çš„ã€‚</p><blockquote><p>ä¼˜ç‚¹ï¼š</p><ol><li>é¿å…èµ„æºæµªè´¹</li><li>èŠ‚çº¦å¤„ç†æ—¶é—´</li></ol></blockquote><p><code>Send.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å·¥ä½œé˜Ÿåˆ—-å…¬å¹³-æ¶ˆæ¯ç”Ÿäº§è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰é˜Ÿåˆ—åç§°</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"work_fair"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¿¡é“</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">/** * å£°æ˜é˜Ÿåˆ— *  ç¬¬ä¸€ä¸ªå‚æ•°queueï¼šé˜Ÿåˆ—åç§° *  ç¬¬äºŒä¸ªå‚æ•°durableï¼šæ˜¯å¦æŒä¹…åŒ– *  ç¬¬ä¸‰ä¸ªå‚æ•°Exclusiveï¼šæ’ä»–é˜Ÿåˆ—ï¼Œå¦‚æœä¸€ä¸ªé˜Ÿåˆ—è¢«å£°æ˜ä¸ºæ’ä»–é˜Ÿåˆ—ï¼Œè¯¥é˜Ÿåˆ—ä»…å¯¹é¦–æ¬¡å£°æ˜å®ƒçš„è¿æ¥å¯è§ï¼Œå¹¶åœ¨è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨åˆ é™¤ã€‚ *      è¿™é‡Œéœ€è¦æ³¨æ„ä¸‰ç‚¹ï¼š *          1. æ’ä»–é˜Ÿåˆ—æ˜¯åŸºäºè¿æ¥å¯è§çš„ï¼ŒåŒä¸€è¿æ¥çš„ä¸åŒé€šé“æ˜¯å¯ä»¥åŒæ—¶è®¿é—®åŒä¸€ä¸ªè¿æ¥åˆ›å»ºçš„æ’ä»–é˜Ÿåˆ—çš„ã€‚ *          2. "é¦–æ¬¡"ï¼Œå¦‚æœä¸€ä¸ªè¿æ¥å·²ç»å£°æ˜äº†ä¸€ä¸ªæ’ä»–é˜Ÿåˆ—ï¼Œå…¶ä»–è¿æ¥æ˜¯ä¸å…è®¸å»ºç«‹åŒåçš„æ’ä»–é˜Ÿåˆ—çš„ï¼Œè¿™ä¸ªä¸æ™®é€šé˜Ÿåˆ—ä¸åŒã€‚ *          3. å³ä½¿è¯¥é˜Ÿåˆ—æ˜¯æŒä¹…åŒ–çš„ï¼Œä¸€æ—¦è¿æ¥å…³é—­æˆ–è€…å®¢æˆ·ç«¯é€€å‡ºï¼Œè¯¥æ’ä»–é˜Ÿåˆ—éƒ½ä¼šè¢«è‡ªåŠ¨åˆ é™¤çš„ã€‚ *          è¿™ç§é˜Ÿåˆ—é€‚ç”¨äºåªé™äºä¸€ä¸ªå®¢æˆ·ç«¯å‘é€è¯»å–æ¶ˆæ¯çš„åº”ç”¨åœºæ™¯ã€‚ *  ç¬¬å››ä¸ªå‚æ•°Auto-deleteï¼šè‡ªåŠ¨åˆ é™¤ï¼Œå¦‚æœè¯¥é˜Ÿåˆ—æ²¡æœ‰ä»»ä½•è®¢é˜…çš„æ¶ˆè´¹è€…çš„è¯ï¼Œè¯¥é˜Ÿåˆ—ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚ *                          è¿™ç§é˜Ÿåˆ—é€‚ç”¨äºä¸´æ—¶é˜Ÿåˆ—ã€‚ */</span>channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"Hello World!"</span> <span class="token operator">+</span> i<span class="token punctuation">;</span><span class="token comment">//å‘é€æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> QUEUE_NAME<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Recv01.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å·¥ä½œé˜Ÿåˆ—-å…¬å¹³-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv01</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰é˜Ÿåˆ—</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"work_fair"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¿¡é“</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šé˜Ÿåˆ—</span>channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> prefetchCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//é™åˆ¶æ¶ˆè´¹è€…æ¯æ¬¡åªèƒ½æ¥å—ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæ‰èƒ½æ¥å—ä¸‹ä¸€æ¡æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicQos</span><span class="token punctuation">(</span>prefetchCount<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token comment">//æ¨¡æ‹Ÿæ¶ˆè´¹è€—æ—¶</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/**             * æ‰‹åŠ¨ç¡®è®¤             * multipleï¼šæ˜¯å¦ç¡®è®¤å¤šæ¡             */</span>channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Recv02.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å·¥ä½œé˜Ÿåˆ—-å…¬å¹³-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv02</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰é˜Ÿåˆ—</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> QUEUE_NAME <span class="token operator">=</span> <span class="token string">"work_fair"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¿¡é“</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šé˜Ÿåˆ—</span>channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> prefetchCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//é™åˆ¶æ¶ˆè´¹è€…æ¯æ¬¡åªèƒ½æ¥å—ä¸€æ¡æ¶ˆæ¯ï¼Œå¤„ç†å®Œæ‰èƒ½æ¥å—ä¸‹ä¸€æ¡æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicQos</span><span class="token punctuation">(</span>prefetchCount<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token comment">//æ¨¡æ‹Ÿæ¶ˆè´¹è€—æ—¶</span><span class="token keyword">try</span> <span class="token punctuation">{</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/** * æ‰‹åŠ¨ç¡®è®¤ * multipleï¼šæ˜¯å¦ç¡®è®¤å¤šæ¡ */</span>channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123500.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123505.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123510.png"></p><h2 id="å‘å¸ƒè®¢é˜…æ¨¡å¼"><a href="#å‘å¸ƒè®¢é˜…æ¨¡å¼" class="headerlink" title="å‘å¸ƒè®¢é˜…æ¨¡å¼"></a>å‘å¸ƒè®¢é˜…æ¨¡å¼</h2><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123708.png" alt="img"></p><p>ä½œç”¨ï¼šå‘å¸ƒè€…å‘å¸ƒä¿¡æ¯æ—¶ï¼Œæ‰€æœ‰æ¶ˆè´¹è€…éƒ½èƒ½æ¥æ”¶åˆ°ã€‚<br>å®ç°ï¼šåˆ›å»ºäº¤æ¢æœºå¹¶è®¾ç½®æ¨¡å¼ä¸ºå¹¿æ’­æ¨¡å¼ï¼Œç”±äº¤æ¢æœºè‡ªåŠ¨åˆ›å»ºä¸¤ä¸ªæ’ä»–é˜Ÿåˆ—ï¼ˆè‡ªåŠ¨åˆ é™¤ï¼‰ã€‚</p><p><code>Send.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å‘å¸ƒ/è®¢é˜…-æ¶ˆæ¯ç”Ÿäº§è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token punctuation">{</span>    <span class="token comment">//å®šä¹‰äº¤æ¢æœºåç§°</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> EXCHANGE_NAME <span class="token operator">=</span> <span class="token string">"exchange_fanout"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>                <span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span>                <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//åˆ›å»ºä¿¡é“</span>                <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//ç»‘å®šäº¤æ¢æœº</span>            channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>FANOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>            <span class="token comment">//å‘é€æ¶ˆæ¯</span>            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Recv01.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å‘å¸ƒ/è®¢é˜…-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv01</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰äº¤æ¢æœº</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> EXCHANGE_NAME <span class="token operator">=</span> <span class="token string">"exchange_fanout"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºä¿¡é“</span>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç»‘å®šäº¤æ¢æœº</span>        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>FANOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–é˜Ÿåˆ—(æ’ä»–é˜Ÿåˆ—)</span>        <span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span>        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Recv02.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å‘å¸ƒ/è®¢é˜…-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv02</span> <span class="token punctuation">{</span>    <span class="token comment">//å®šä¹‰äº¤æ¢æœº</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> EXCHANGE_NAME <span class="token operator">=</span> <span class="token string">"exchange_fanout"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span>        <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//åˆ›å»ºä¿¡é“</span>        <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç»‘å®šäº¤æ¢æœº</span>        channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>FANOUT<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–é˜Ÿåˆ—(æ’ä»–é˜Ÿåˆ—)</span>        <span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span>        channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>        channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123629.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123633.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123638.png"></p><h2 id="è·¯ç”±æ¨¡å¼"><a href="#è·¯ç”±æ¨¡å¼" class="headerlink" title="è·¯ç”±æ¨¡å¼"></a>è·¯ç”±æ¨¡å¼</h2><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123722.png" alt="img"></p><p>å®ç°ï¼šåˆ›å»ºäº¤æ¢æœºå¹¶è®¾ç½®æ¨¡å¼ä¸ºè·¯ç”±æ¨¡å¼ï¼Œç»™é˜Ÿåˆ—ç»‘å®šä¸åŒçš„è·¯ç”± key ï¼Œç”Ÿäº§è€…å‘é€å¤šæ¡æºå¸¦ä¸åŒè·¯ç”± key çš„æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…æ ¹æ®å…¶è·¯ç”± key åˆ°å¯¹åº”é˜Ÿåˆ—é‡Œæ¥æ”¶ä¸åŒçš„ä¿¡æ¯ã€‚</p><blockquote><p>ç®€å•æ¨¡å¼è™½ç„¶æ²¡æœ‰ä½¿ç”¨äº¤æ¢æœºï¼Œä½†å…¶æœ¬è´¨è¿˜æ˜¯è·¯ç”±æ¨¡å¼ã€‚</p></blockquote><p><code>Send.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è·¯ç”±é˜Ÿåˆ—-æ¶ˆæ¯ç”Ÿäº§è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token punctuation">{</span>    <span class="token comment">//å®šä¹‰äº¤æ¢æœºåç§°</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> EXCHANGE_NAME <span class="token operator">=</span> <span class="token string">"exchange_direct"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>                <span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span>                <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//åˆ›å»ºä¿¡é“</span>                <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//ç»‘å®šäº¤æ¢æœº</span>            channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>DIRECT<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> infoMessage <span class="token operator">=</span> <span class="token string">"æ™®é€šä¿¡æ¯ï¼"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> errorMessage <span class="token operator">=</span> <span class="token string">"é”™è¯¯ä¿¡æ¯ï¼"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> warningMessage <span class="token operator">=</span> <span class="token string">"è­¦å‘Šä¿¡æ¯ï¼"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> infoRoutingKey <span class="token operator">=</span> <span class="token string">"info"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> errorRoutingKey <span class="token operator">=</span> <span class="token string">"error"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> warningRoutingKey <span class="token operator">=</span> <span class="token string">"warning"</span><span class="token punctuation">;</span>            <span class="token comment">//å‘é€æ¶ˆæ¯</span>            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> infoRoutingKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> infoMessage<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> errorRoutingKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> errorMessage<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> warningRoutingKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> warningMessage<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> infoMessage <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> errorMessage <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> warningMessage <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Recv01.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è·¯ç”±é˜Ÿåˆ—-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv01</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰é˜Ÿåˆ—</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> EXCHANGE_NAME <span class="token operator">=</span> <span class="token string">"exchange_direct"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¿¡é“</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šäº¤æ¢æœº</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>DIRECT<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è·å–é˜Ÿåˆ—(æ’ä»–é˜Ÿåˆ—)</span><span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span><span class="token class-name">String</span> errorRoutingKey <span class="token operator">=</span> <span class="token string">"error"</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> EXCHANGE_NAME<span class="token punctuation">,</span> errorRoutingKey<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Recv02.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è·¯ç”±é˜Ÿåˆ—-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv02</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰é˜Ÿåˆ—</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> EXCHANGE_NAME <span class="token operator">=</span> <span class="token string">"exchange_direct"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¿¡é“</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šäº¤æ¢æœº</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>DIRECT<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è·å–é˜Ÿåˆ—(æ’ä»–é˜Ÿåˆ—)</span><span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span><span class="token class-name">String</span> infoRoutingKey <span class="token operator">=</span> <span class="token string">"info"</span><span class="token punctuation">;</span><span class="token class-name">String</span> errorRoutingKey <span class="token operator">=</span> <span class="token string">"error"</span><span class="token punctuation">;</span><span class="token class-name">String</span> warningRoutingKey <span class="token operator">=</span> <span class="token string">"warning"</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> EXCHANGE_NAME<span class="token punctuation">,</span> infoRoutingKey<span class="token punctuation">)</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> EXCHANGE_NAME<span class="token punctuation">,</span> errorRoutingKey<span class="token punctuation">)</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> EXCHANGE_NAME<span class="token punctuation">,</span> warningRoutingKey<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123808.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123813.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123818.png"></p><h2 id="ä¸»é¢˜æ¨¡å¼"><a href="#ä¸»é¢˜æ¨¡å¼" class="headerlink" title="ä¸»é¢˜æ¨¡å¼"></a>ä¸»é¢˜æ¨¡å¼</h2><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809123828.png" alt="img"></p><p>ä½œç”¨ï¼šè§£å†³è·¯ç”±æ¨¡å¼è·¯ç”± key ç¹å¤šç®¡ç†å¤æ‚çš„é—®é¢˜</p><table><thead><tr><th align="center">è·¯ç”± key é€šé…ç¬¦</th><th align="center">åŒ¹é…è§„åˆ™</th></tr></thead><tbody><tr><td align="center"><code>*</code></td><td align="center">åŒ¹é… 1 ä¸ª</td></tr><tr><td align="center"><code>#</code></td><td align="center">åŒ¹é… 0 æˆ– å¤šä¸ª</td></tr></tbody></table><p><code>Send.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ä¸»é¢˜é˜Ÿåˆ—-æ¶ˆæ¯ç”Ÿäº§è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token punctuation">{</span>    <span class="token comment">//å®šä¹‰äº¤æ¢æœºåç§°</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> EXCHANGE_NAME <span class="token operator">=</span> <span class="token string">"exchange_topic"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span>                <span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span>                <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//åˆ›å»ºä¿¡é“</span>                <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//ç»‘å®šäº¤æ¢æœº</span>            channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> infoMessage <span class="token operator">=</span> <span class="token string">"æ™®é€šä¿¡æ¯ï¼"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> errorMessage <span class="token operator">=</span> <span class="token string">"é”™è¯¯ä¿¡æ¯ï¼"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> warningMessage <span class="token operator">=</span> <span class="token string">"è­¦å‘Šä¿¡æ¯ï¼"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> infoRoutingKey <span class="token operator">=</span> <span class="token string">"info.message.orange"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> errorRoutingKey <span class="token operator">=</span> <span class="token string">"error.rabbit.lazy"</span><span class="token punctuation">;</span>            <span class="token class-name">String</span> warningRoutingKey <span class="token operator">=</span> <span class="token string">"orange.warning.message"</span><span class="token punctuation">;</span>            <span class="token comment">//å‘é€æ¶ˆæ¯</span>            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> infoRoutingKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> infoMessage<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> errorRoutingKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> errorMessage<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> warningRoutingKey<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> warningMessage<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> infoMessage <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> errorMessage <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Sent '"</span> <span class="token operator">+</span> warningMessage <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Recv01.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ä¸»é¢˜é˜Ÿåˆ—-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv01</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰äº¤æ¢æœºåç§°</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> EXCHANGE_NAME <span class="token operator">=</span> <span class="token string">"exchange_topic"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¿¡é“</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šäº¤æ¢æœº</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è·å–é˜Ÿåˆ—(æ’ä»–é˜Ÿåˆ—)</span><span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span><span class="token class-name">String</span> routingKey <span class="token operator">=</span> <span class="token string">"#.message.#"</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> EXCHANGE_NAME<span class="token punctuation">,</span> routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Recv02.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ä¸»é¢˜é˜Ÿåˆ—-æ¶ˆæ¯æ¶ˆè´¹è€… */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Recv02</span> <span class="token punctuation">{</span><span class="token comment">//å®šä¹‰äº¤æ¢æœºåç§°</span><span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> EXCHANGE_NAME <span class="token operator">=</span> <span class="token string">"exchange_topic"</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> argv<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span><span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span><span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è¿æ¥å·¥å‚åˆ›å»ºè¿æ¥</span><span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åˆ›å»ºä¿¡é“</span><span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šäº¤æ¢æœº</span>channel<span class="token punctuation">.</span><span class="token function">exchangeDeclare</span><span class="token punctuation">(</span>EXCHANGE_NAME<span class="token punctuation">,</span> <span class="token class-name">BuiltinExchangeType</span><span class="token punctuation">.</span>TOPIC<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//è·å–é˜Ÿåˆ—(æ’ä»–é˜Ÿåˆ—)</span><span class="token class-name">String</span> queueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç»‘å®šé˜Ÿåˆ—å’Œäº¤æ¢æœº</span><span class="token class-name">String</span> routingKey <span class="token operator">=</span> <span class="token string">"*.rabbit.*"</span><span class="token punctuation">;</span>channel<span class="token punctuation">.</span><span class="token function">queueBind</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> EXCHANGE_NAME<span class="token punctuation">,</span> routingKey<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [*] Waiting for messages. To exit press CTRL+C"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Received '"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//ç›‘å¬é˜Ÿåˆ—æ¶ˆè´¹æ¶ˆæ¯</span>channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>queueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809124000.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809124004.png"></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809124009.png"></p><h2 id="RPC-æ¨¡å¼"><a href="#RPC-æ¨¡å¼" class="headerlink" title="RPC æ¨¡å¼"></a>RPC æ¨¡å¼</h2><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210809124017.png"></p><p><code>RPCClient</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * RPCæ¨¡å¼é˜Ÿåˆ—-å®¢æˆ·ç«¯ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RPCClient</span> <span class="token keyword">implements</span> <span class="token class-name">AutoCloseable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">Connection</span> connection<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Channel</span> channel<span class="token punctuation">;</span>    <span class="token comment">// é˜Ÿåˆ—åç§°</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> requestQueueName <span class="token operator">=</span> <span class="token string">"rpc_queue"</span><span class="token punctuation">;</span>    <span class="token comment">// åˆå§‹åŒ–è¿æ¥</span>    <span class="token keyword">public</span> <span class="token class-name">RPCClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">TimeoutException</span> <span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">RPCClient</span> fibonacciRpc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RPCClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">String</span> i_str <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Requesting fib("</span> <span class="token operator">+</span> i_str <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è¯·æ±‚æœåŠ¡ç«¯</span>                <span class="token class-name">String</span> response <span class="token operator">=</span> fibonacciRpc<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>i_str<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [.] Got '"</span> <span class="token operator">+</span> response <span class="token operator">+</span> <span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">TimeoutException</span> <span class="token operator">|</span> <span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// è¯·æ±‚æœåŠ¡ç«¯</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>        <span class="token comment">// correlationIdè¯·æ±‚æ ‡è¯†ID</span>        <span class="token keyword">final</span> <span class="token class-name">String</span> corrId <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–é˜Ÿåˆ—åç§°</span>        <span class="token class-name">String</span> replyQueueName <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®replyToé˜Ÿåˆ—å’ŒcorrelationIdè¯·æ±‚æ ‡è¯†</span>        <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> props <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties                <span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">correlationId</span><span class="token punctuation">(</span>corrId<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">replyTo</span><span class="token punctuation">(</span>replyQueueName<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å‘é€æ¶ˆæ¯è‡³é˜Ÿåˆ—</span>        channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> requestQueueName<span class="token punctuation">,</span> props<span class="token punctuation">,</span> message<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®çº¿ç¨‹ç­‰å¾…ï¼Œæ¯æ¬¡åªæ¥æ”¶ä¸€ä¸ªå“åº”ç»“æœ</span>        <span class="token keyword">final</span> <span class="token class-name">BlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ¥å—æœåŠ¡å™¨è¿”å›ç»“æœ</span>        <span class="token class-name">String</span> ctag <span class="token operator">=</span> channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>replyQueueName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorrelationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>corrId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// å°†ç»™å®šçš„å…ƒç´ åœ¨ç»™å®šçš„æ—¶é—´å†…è®¾ç½®åˆ°çº¿ç¨‹é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœè®¾ç½®æˆåŠŸè¿”å›true, å¦åˆ™è¿”å›false</span>                response<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä»çº¿ç¨‹é˜Ÿåˆ—ä¸­è·å–å€¼ï¼Œå¦‚æœçº¿ç¨‹é˜Ÿåˆ—ä¸­æ²¡æœ‰å€¼ï¼Œçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ï¼Œç›´åˆ°çº¿ç¨‹é˜Ÿåˆ—ä¸­æœ‰å€¼ï¼Œå¹¶ä¸”å–å¾—è¯¥å€¼</span>        <span class="token class-name">String</span> result <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">take</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­ä¸¢å¼ƒè¯¥å€¼</span>        channel<span class="token punctuation">.</span><span class="token function">basicCancel</span><span class="token punctuation">(</span>ctag<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// å…³é—­è¿æ¥</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>RPCServer</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * RPCæ¨¡å¼é˜Ÿåˆ—-æœåŠ¡ç«¯ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RPCServer</span> <span class="token punctuation">{</span>    <span class="token comment">// é˜Ÿåˆ—åç§°</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> RPC_QUEUE_NAME <span class="token operator">=</span> <span class="token string">"rpc_queue"</span><span class="token punctuation">;</span>    <span class="token comment">/**     * è®¡ç®—æ–æ³¢é‚£å¥‘æ•°åˆ—     *     * @param n     * @return     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">fib</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">fib</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºè¿æ¥å·¥å‚</span>        <span class="token class-name">ConnectionFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setHost</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"revelvy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setVirtualHost</span><span class="token punctuation">(</span><span class="token string">"/test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        factory<span class="token punctuation">.</span><span class="token function">setPort</span><span class="token punctuation">(</span><span class="token number">5672</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// é€šè¿‡å·¥å‚åˆ›å»ºè¿æ¥</span>            <span class="token keyword">final</span> <span class="token class-name">Connection</span> connection <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">newConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å–é€šé“</span>            <span class="token keyword">final</span> <span class="token class-name">Channel</span> channel <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å£°æ˜é˜Ÿåˆ—</span>            channel<span class="token punctuation">.</span><span class="token function">queueDeclare</span><span class="token punctuation">(</span>RPC_QUEUE_NAME<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">queuePurge</span><span class="token punctuation">(</span>RPC_QUEUE_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/*                é™åˆ¶RabbitMQåªå‘ä¸è¶…è¿‡1æ¡çš„æ¶ˆæ¯ç»™åŒä¸€ä¸ªæ¶ˆè´¹è€…ã€‚                å½“æ¶ˆæ¯å¤„ç†å®Œæ¯•åï¼Œæœ‰äº†åé¦ˆï¼Œæ‰ä¼šè¿›è¡Œç¬¬äºŒæ¬¡å‘é€ã€‚             */</span>            <span class="token keyword">int</span> prefetchCount <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">basicQos</span><span class="token punctuation">(</span>prefetchCount<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [x] Awaiting RPC requests"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Object</span> monitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å–æ¶ˆæ¯</span>            <span class="token class-name">DeliverCallback</span> deliverCallback <span class="token operator">=</span> <span class="token punctuation">(</span>consumerTag<span class="token punctuation">,</span> delivery<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>                <span class="token comment">// è·å–replyToé˜Ÿåˆ—å’ŒcorrelationIdè¯·æ±‚æ ‡è¯†</span>                <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties</span> replyProps <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AMQP<span class="token punctuation">.</span>BasicProperties                        <span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">correlationId</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCorrelationId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> response <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    <span class="token comment">// æ¥æ”¶å®¢æˆ·ç«¯æ¶ˆæ¯</span>                    <span class="token class-name">String</span> message <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [.] fib("</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// æœåŠ¡ç«¯æ ¹æ®ä¸šåŠ¡éœ€æ±‚å¤„ç†</span>                    response <span class="token operator">+=</span> <span class="token function">fib</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">" [.] "</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>                    <span class="token comment">// å°†å¤„ç†ç»“æœå‘é€è‡³replyToé˜Ÿåˆ—åŒæ—¶æºå¸¦correlationIdå±æ€§</span>                    channel<span class="token punctuation">.</span><span class="token function">basicPublish</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> delivery<span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getReplyTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> replyProps<span class="token punctuation">,</span>                            response<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// æ‰‹åŠ¨å›æ‰§æ¶ˆæ¯</span>                    channel<span class="token punctuation">.</span><span class="token function">basicAck</span><span class="token punctuation">(</span>delivery<span class="token punctuation">.</span><span class="token function">getEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDeliveryTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// RabbitMq consumer worker thread notifies the RPC server owner thread</span>                    <span class="token comment">// RabbitMqæ¶ˆè´¹è€…å·¥ä½œçº¿ç¨‹é€šçŸ¥RPCæœåŠ¡å™¨å…¶ä»–æ‰€æœ‰çº¿ç¨‹è¿è¡Œ</span>                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>monitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        monitor<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">;</span>            <span class="token comment">// ç›‘å¬é˜Ÿåˆ—</span>            <span class="token comment">/*                autoAck = trueä»£è¡¨è‡ªåŠ¨ç¡®è®¤æ¶ˆæ¯                autoAck = falseä»£è¡¨æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯             */</span>            <span class="token keyword">boolean</span> autoAck <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            channel<span class="token punctuation">.</span><span class="token function">basicConsume</span><span class="token punctuation">(</span>RPC_QUEUE_NAME<span class="token punctuation">,</span> autoAck<span class="token punctuation">,</span> deliverCallback<span class="token punctuation">,</span> consumerTag <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Wait and be prepared to consume the message from RPC client.</span>            <span class="token comment">// çº¿ç¨‹ç­‰å¾…å¹¶å‡†å¤‡æ¥æ”¶æ¥è‡ªRPCå®¢æˆ·ç«¯çš„æ¶ˆæ¯</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>monitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">try</span> <span class="token punctuation">{</span>                        monitor<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">TimeoutException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> ä¸­é—´ä»¶ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> RabbitMQ </tag>
            
            <tag> åˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MyBatis</title>
      <link href="/2020/09/01/mybatis/"/>
      <url>/2020/09/01/mybatis/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><pre class="line-numbers language-none"><code class="language-none">æ¦‚å¿µæ˜¯ä¸€ä¸ªæ”¯æŒæ™®é€šSQLæŸ¥è¯¢ã€å­˜å‚¨è¿‡ç¨‹ã€é«˜çº§æ˜ å°„çš„æŒä¹…å±‚ ORM æ¡†æ¶ã€‚æŒä¹…å±‚ï¼šå°†å†…å­˜ä¸­çš„å¯¹è±¡æ•°æ®ï¼Œè½¬ç§»åˆ°æ•°æ®åº“ä¸­çš„è¿‡ç¨‹ã€‚ä½œç”¨ç®€åŒ–JDBCä»£ç ã€æŒä¹…å±‚ï¼Œå°†SQLè¯­å¥ä»ä»£ç ä¸­åˆ†ç¦»ï¼Œåˆ©ç”¨ ORM å¯¹è±¡å…³ç³»æ˜ å°„ï¼Œå°†è¡¨ä¸­æ•°æ®ä¸ JavaBean å±æ€§ä¸€ä¸€æ˜ å°„ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><pre class="line-numbers language-none"><code class="language-none">æ¦‚å¿µObject Relational Mappingï¼Œå¯¹è±¡å…³ç³»æ˜ å°„æ˜ å°„ç±»    è¡¨ç»“æ„å¯¹è±¡é›†åˆ   è¡¨å¯¹è±¡    è®°å½•ï¼ˆè¡Œï¼‰å±æ€§     å­—æ®µï¼ˆåˆ—ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818231329.png"><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818231334.png"></p><h2 id="æ¶æ„å›¾"><a href="#æ¶æ„å›¾" class="headerlink" title="æ¶æ„å›¾"></a>æ¶æ„å›¾</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818231338.png"></p><pre class="line-numbers language-none"><code class="language-none">APIæ¥å£å±‚æä¾›ç»™å¤–éƒ¨ä½¿ç”¨çš„æ¥å£APIï¼Œé€šè¿‡APIæ“ä½œæ•°æ®åº“ã€‚æ¥å£å±‚æ¥æ”¶åˆ°è°ƒç”¨è¯·æ±‚å°±ä¼šè°ƒç”¨æ•°æ®å¤„ç†å±‚æ¥å®Œæˆå…·ä½“çš„æ•°æ®å¤„ç†ã€‚æ•°æ®å¤„ç†å±‚è´Ÿè´£å…·ä½“çš„SQLæŸ¥æ‰¾ã€è§£æã€æ‰§è¡Œã€æ‰§è¡Œç»“æœæ˜ å°„å¤„ç†ç­‰ã€‚æ ¹æ®è°ƒç”¨çš„è¯·æ±‚å®Œæˆä¸€æ¬¡æ•°æ®åº“æ“ä½œã€‚åŸºç¡€æ”¯æ’‘å±‚è´Ÿè´£ä¸ºæ•°æ®å¤„ç†å±‚æä¾›åŸºç¡€åŠŸèƒ½æ”¯æ’‘ï¼ˆè¿æ¥ç®¡ç†ã€äº‹åŠ¡ç®¡ç†ã€é…ç½®åŠ è½½ã€ç¼“å­˜å¤„ç†ï¼‰ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å†…ç½®åˆ«å"><a href="#å†…ç½®åˆ«å" class="headerlink" title="å†…ç½®åˆ«å"></a>å†…ç½®åˆ«å</h2><table><thead><tr><th>åˆ«å</th><th>æ˜ å°„ç±»å‹</th></tr></thead><tbody><tr><td>_byte _short _long _double _float _boolean</td><td>byte short long double float boolean</td></tr><tr><td>_int _integer</td><td>int</td></tr><tr><td>byte short long double float boolean</td><td>Byte Short Long Double Float Boolean</td></tr><tr><td>int integer</td><td>Integer</td></tr><tr><td>string date object map hashmap</td><td>String Date Object Map Hashmap</td></tr><tr><td>list arraylist collection iterator</td><td>List ArrayList Collection Iterator</td></tr><tr><td>decimal bigdecimal</td><td>BigDecimal</td></tr></tbody></table><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818231400.png"></p><pre class="line-numbers language-none"><code class="language-none">SqlSessionFactoryBuilderä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±ä¸éœ€è¦äº†ä½œç”¨åŸŸï¼šå±€éƒ¨SqlSessionFactoryä¸€æ—¦è¢«åˆ›å»ºï¼Œåœ¨åº”ç”¨è¿è¡ŒæœŸé—´å°±ä¸€ç›´å­˜åœ¨ï¼Œåªéœ€åˆ›å»ºä¸€ä¸ªä½œç”¨åŸŸï¼šåº”ç”¨å…¨å±€åˆ›å»ºï¼šå•ä¾‹æ¨¡å¼ / é™æ€å•ä¾‹æ¨¡å¼ç†è§£ï¼šæ•°æ®åº“è¿æ¥æ± SqlSessionSqlSessionçš„å®ä¾‹çº¿ç¨‹ä¸å®‰å…¨ï¼Œå› æ­¤ä¸èƒ½è¢«å…±äº«ï¼Œç”¨å®Œåº”å…³é—­å¦åˆ™å ç”¨èµ„æºä½œç”¨åŸŸï¼šè¯·æ±‚ / æ–¹æ³•ç†è§£ï¼šè¿æ¥åˆ°æ•°æ®åº“è¿æ¥æ± çš„ä¸€ä¸ªè¯·æ±‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="IDEA-é›†æˆ-MyBatis"><a href="#IDEA-é›†æˆ-MyBatis" class="headerlink" title="IDEA é›†æˆ MyBatis"></a>IDEA é›†æˆ MyBatis</h1><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818231427.png"></p><p><code>mybatis-config.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ•°æ®åº“é…ç½®æ–‡ä»¶ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>db.properties<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token comment">&lt;!-- å®ä½“ç±»åˆ«å --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ–¹å¼1ï¼šæ‰‹åŠ¨DIY --&gt;</span>        <span class="token comment">&lt;!--        &lt;typeAlias type="com.xxxx.pojo.User" alias="user"/&gt;--&gt;</span>        <span class="token comment">&lt;!-- æ–¹å¼2ï¼šè‡ªåŠ¨æ‰«æï¼ˆä½¿ç”¨é¦–å­—æ¯å°å†™ç±»åè°ƒç”¨ï¼‰+ å®ä½“ç±»æ³¨è§£ï¼ˆæ‰‹åŠ¨DIYï¼‰ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- ä¸»é…ç½®ç¯å¢ƒ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å¼€å‘ç¯å¢ƒ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- äº‹åŠ¡ç®¡ç†å™¨ --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token comment">&lt;!-- æ•°æ®æº --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--                                &lt;property name="driver" value="com.mysql.cj.jdbc.Driver"/&gt;--&gt;</span><span class="token comment">&lt;!--                                &lt;property name="url"--&gt;</span><span class="token comment">&lt;!--                                          value="jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;serverTimezone=GMT%2B8"/&gt;--&gt;</span><span class="token comment">&lt;!--                                &lt;property name="username" value="root"/&gt;--&gt;</span><span class="token comment">&lt;!--                                &lt;property name="password" value="Delicious.2222"/&gt;--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${jdbc.driver}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${jdbc.url}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${jdbc.username}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${jdbc.password}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ³¨å†Œå­é…ç½®æ–‡ä»¶ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com/xxxx/dao/UserMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>db.properties</code></p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># é©±åŠ¨å</span><span class="token attr-name">jdbc.driver</span><span class="token punctuation">=</span><span class="token attr-value">com.mysql.cj.jdbc.Driver</span><span class="token comment"># æ•°æ®åº“è¿æ¥ï¼ˆMySQL8.0+ æ·»åŠ æ—¶åŒºserverTimezone=GMT%2B8ï¼‰</span><span class="token attr-name">jdbc.url</span><span class="token punctuation">=</span><span class="token attr-value">jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=GMT%2B8</span><span class="token comment"># æ•°æ®åº“ç”¨æˆ·åç§°</span><span class="token attr-name">jdbc.username</span><span class="token punctuation">=</span><span class="token attr-value">root</span><span class="token comment"># æ•°æ®åº“ç”¨æˆ·å¯†ç </span><span class="token attr-name">jdbc.password</span><span class="token punctuation">=</span><span class="token attr-value">Delicious.2222</span><span class="token comment"># å¯é€‰é…ç½®</span><span class="token comment"># æŒ‡å®šè¿æ¥æ± çš„åˆå§‹åŒ–è¿æ¥æ•°ã€‚å–å€¼åº”åœ¨minPoolSize ä¸ maxPoolSize ä¹‹é—´.Default:3</span><span class="token attr-name">initialPoolSize</span><span class="token punctuation">=</span><span class="token attr-value">20</span><span class="token comment"># æŒ‡å®šè¿æ¥æ± ä¸­ä¿ç•™çš„æœ€å¤§è¿æ¥æ•°. Default:15</span><span class="token attr-name">maxPoolSize</span><span class="token punctuation">=</span><span class="token attr-value">100</span><span class="token comment"># æŒ‡å®šè¿æ¥æ± ä¸­ä¿ç•™çš„æœ€å°è¿æ¥æ•°</span><span class="token attr-name">minPoolSize</span><span class="token punctuation">=</span><span class="token attr-value">10</span><span class="token comment"># æœ€å¤§ç©ºé—²æ—¶é—´,60ç§’å†…æœªä½¿ç”¨åˆ™è¿æ¥è¢«ä¸¢å¼ƒã€‚è‹¥ä¸º0åˆ™æ°¸ä¸ä¸¢å¼ƒã€‚ Default:0</span><span class="token attr-name">maxIdleTime</span><span class="token punctuation">=</span><span class="token attr-value">600</span><span class="token comment"># å½“è¿æ¥æ± ä¸­çš„è¿æ¥è€—å°½çš„æ—¶å€™c3p0ä¸€æ¬¡åŒæ—¶è·å–çš„è¿æ¥æ•°. Default:3</span><span class="token attr-name">acquireIncrement</span><span class="token punctuation">=</span><span class="token attr-value">5</span><span class="token comment"># JDBCçš„æ ‡å‡†,ç”¨ä»¥æ§åˆ¶æ•°æ®æºå†…åŠ è½½çš„PreparedStatementsæ•°é‡ã€‚</span><span class="token attr-name">maxStatements</span><span class="token punctuation">=</span><span class="token attr-value">5</span><span class="token comment"># æ¯60ç§’æ£€æŸ¥æ‰€æœ‰è¿æ¥æ± ä¸­çš„ç©ºé—²è¿æ¥.Default:0</span><span class="token attr-name">idleConnectionTestPeriod</span><span class="token punctuation">=</span><span class="token attr-value">60</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>MybatisUtils.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// sqlSessionFactory --&gt; selSession</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MybatisUtils</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">SqlSessionFactory</span> sqlSessionFactory<span class="token punctuation">;</span>    <span class="token comment">// è·å– sqlSessionFactory</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> <span class="token class-name">Resources</span><span class="token punctuation">.</span><span class="token function">getResourceAsStream</span><span class="token punctuation">(</span><span class="token string">"mybatis-config.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            sqlSessionFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SqlSessionFactoryBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å– sqlSession ï¼Œé‡Œé¢åŒ…å«é¢å‘æ•°æ®åº“æ‰§è¡ŒSQLå‘½ä»¤çš„æ‰€æœ‰æ–¹æ³•     *     * @return sqlSession     */</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">SqlSession</span> <span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> sqlSessionFactory<span class="token punctuation">.</span><span class="token function">openSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>User.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å®ä½“ç±»</span><span class="token annotation punctuation">@Alias</span><span class="token punctuation">(</span><span class="token string">"usr"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> pwd<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> pwd<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>pwd <span class="token operator">=</span> pwd<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"User{"</span> <span class="token operator">+</span>                <span class="token string">"id="</span> <span class="token operator">+</span> id <span class="token operator">+</span>                <span class="token string">", name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>                <span class="token string">", pwd='"</span> <span class="token operator">+</span> pwd <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>                <span class="token string">'}'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getPwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> pwd<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPwd</span><span class="token punctuation">(</span><span class="token class-name">String</span> pwd<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>pwd <span class="token operator">=</span> pwd<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>UserMapper.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ¥å£</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">User</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">void</span> <span class="token function">updateUserByMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserByNameLike</span><span class="token punctuation">(</span><span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>UserMapper.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- namespaceï¼šç»‘å®šå¯¹åº”æ¥å£ ä¸€ä¸ªMapperå¯¹åº”ä¸€ä¸ªæ¥å£ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.dao.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserList<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>usr<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select *        from mybatis.user;    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- å¢åˆ æ”¹æŸ¥ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addUser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>usr<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        insert into mybatis.user (id, name, pwd)        VALUES (#{id}, #{name}, #{pwd});    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>delete</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteUser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        delete        from mybatis.user        where id = #{id};    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>delete</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateUser<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>usr<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        update mybatis.user        set name=#{name},            pwd=#{pwd}        where id = #{id};    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserById<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>usr<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select *        from mybatis.user        where id = #{id};    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- Mapï¼šå®ä½“ç±»ä¸­å­—æ®µè¿‡å¤šæ—¶ï¼Œä¸ºäº†è‡ªå®šä¹‰å‚æ•°ä¼ é€’è€Œä½¿ç”¨ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateUserByMap<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        update mybatis.user        set pwd=#{passWord}        where id = #{id};    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- likeï¼šæ¨¡ç³ŠæŸ¥è¯¢ é˜²SQLæ³¨å…¥ --&gt;</span>    <span class="token comment">&lt;!-- select * from unicon.tb_users where username like CONCAT('%','ä¸€','%') limit 0,3; --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserByNameLike<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>String<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>usr<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select *        from mybatis.user        where name like concat('%',#{value},'%');    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>log4j.properties</code></p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token comment"># æ—¥å¿—çº§åˆ« æ—¥å¿—è¾“å‡ºç›®çš„åœ°</span><span class="token attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG,console,LOGFILE</span><span class="token comment"># æ§åˆ¶å°è¾“å‡ºè®¾ç½®</span><span class="token attr-name">log4j.appender.console</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.ConsoleAppender</span><span class="token attr-name">log4j.appender.console.Target</span><span class="token punctuation">=</span><span class="token attr-value">System.out</span><span class="token attr-name">log4j.appender.console.Threshold</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.appender.console.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span><span class="token attr-name">log4j.appender.console.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">[%p][%d{yyyy/MM/dd HH:mm:ss}][%c]%m%n</span><span class="token comment"># æ–‡ä»¶è¾“å‡ºè®¾ç½®</span><span class="token attr-name">log4j.appender.LOGFILE</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.RollingFileAppender</span><span class="token attr-name">log4j.appender.LOGFILE.File</span><span class="token punctuation">=</span><span class="token attr-value">./logs/Project.log</span><span class="token attr-name">log4j.appender.LOGFILE.Append</span><span class="token punctuation">=</span><span class="token attr-value">false</span><span class="token attr-name">log4j.appender.LOGFILE.Threshold</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.appender.LOGFILE.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span><span class="token attr-name">log4j.appender.LOGFILE.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">[%p][%d{yyyy/MM/dd HH:mm:ss}][%c]%m%n</span><span class="token comment"># æ—¥å¿—è¾“å‡ºçº§åˆ«</span><span class="token attr-name">log4j.logger.org.mybatis</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.logger.java.sql</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.logger.java.sql.Statement</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.logger.java.sql.ResultSet</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span class="token attr-name">log4j.logger.java.sql.PreparedStatement</span><span class="token punctuation">=</span><span class="token attr-value">DEBUG</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>UserMapperTest.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserMapperTest</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getUserListTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 1. è·å– sqlSession</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// 2. sqlSessionæ‰§è¡ŒSQL æ–¹å¼1ï¼ˆæ¨èï¼‰</span>            <span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> userList <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// sqlSessionæ‰§è¡ŒSQL æ–¹å¼2</span><span class="token comment">//        List&lt;User&gt; userList = sqlSession.selectList("com.xxxx.dao.UserDao.getUserList");</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> userList<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token comment">// 3. å…³é—­sqlSession</span>            sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUserTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            userMapper<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token string">"èµµå››"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¢åˆ æ”¹ å¿…é¡»æäº¤äº‹åŠ¡</span>            sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteUserTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            userMapper<span class="token punctuation">.</span><span class="token function">deleteUser</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¢åˆ æ”¹ å¿…é¡»æäº¤äº‹åŠ¡</span>            sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUserTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            userMapper<span class="token punctuation">.</span><span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token string">"è¯»ä¹¦å¤š"</span><span class="token punctuation">,</span><span class="token string">"67890"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¢åˆ æ”¹ å¿…é¡»æäº¤äº‹åŠ¡</span>            sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getUserByIdTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">User</span> user <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateUserByMapTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span><span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">,</span><span class="token string">"888888"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            userMapper<span class="token punctuation">.</span><span class="token function">updateUserByMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¢åˆ æ”¹ å¿…é¡»æäº¤äº‹åŠ¡</span>            sqlSession<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getUserByNameLikeTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">UserMapper</span> userMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserByNameLike</span><span class="token punctuation">(</span><span class="token string">"å¼ "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818231605.png"></p><p><code>UserMMapper</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMMapper</span> <span class="token punctuation">{</span>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserM</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUserByIdMap</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>UserMMapper.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- namespaceï¼šç»‘å®šå¯¹åº”æ¥å£ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.dao.UserMMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- resultMapï¼šç»“æœæ˜ å°„ è¡¨å­—æ®µä¸å®ä½“ç±»å±æ€§ä¸ä¸€è‡´æ—¶ å°†è¡¨çš„åˆ—å­—æ®µæ˜ å°„ä½å®ä½“ç±»JavaBeançš„å±æ€§ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Map1<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>usrm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- columnï¼šè¡¨çš„åˆ—å­—æ®µ propertyï¼šå®ä½“ç±»JavaBeançš„å±æ€§ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uname<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pwd<span class="token punctuation">"</span></span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>upwd<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserByIdMap<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>int<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Map1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        select *        from mybatis.user        where id = #{id};    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>UserM</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å®ä½“ç±»</span><span class="token annotation punctuation">@Alias</span><span class="token punctuation">(</span><span class="token string">"usrm"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserM</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> uname<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> upwd<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">UserM</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> uname<span class="token punctuation">,</span> <span class="token class-name">String</span> upwd<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> uname<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>upwd <span class="token operator">=</span> upwd<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"UserMap{"</span> <span class="token operator">+</span>                <span class="token string">"id="</span> <span class="token operator">+</span> id <span class="token operator">+</span>                <span class="token string">", uname='"</span> <span class="token operator">+</span> uname <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>                <span class="token string">", upwd='"</span> <span class="token operator">+</span> upwd <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>                <span class="token string">'}'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> uname<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUname</span><span class="token punctuation">(</span><span class="token class-name">String</span> uname<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> uname<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getUpwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> upwd<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUpwd</span><span class="token punctuation">(</span><span class="token class-name">String</span> upwd<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>upwd <span class="token operator">=</span> upwd<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>mybatis-config.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">configuration</span>        <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="token string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- è¯»å–å…¶ä»–é…ç½®æ–‡ä»¶ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>db.properties<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- å®ä½“ç±»åˆ«å --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>typeAliases</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- æ–¹å¼1ï¼šæ‰‹åŠ¨DIY --&gt;</span>        <span class="token comment">&lt;!--        &lt;typeAlias type="com.xxxx.pojo.User" alias="user"/&gt;--&gt;</span>        <span class="token comment">&lt;!-- æ–¹å¼2ï¼šè‡ªåŠ¨æ‰«æï¼ˆä½¿ç”¨é¦–å­—æ¯å°å†™ç±»åè°ƒç”¨ï¼‰+ å®ä½“ç±»æ³¨è§£ï¼ˆæ‰‹åŠ¨DIYï¼‰ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>typeAliases</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- ä¸»é…ç½®ç¯å¢ƒ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environments</span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å¼€å‘ç¯å¢ƒ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>environment</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>development<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- äº‹åŠ¡ç®¡ç†å™¨ --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transactionManager</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>JDBC<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token comment">&lt;!-- æ•°æ®æº --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dataSource</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>POOLED<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--                                &lt;property name="driver" value="com.mysql.cj.jdbc.Driver"/&gt;--&gt;</span><span class="token comment">&lt;!--                                &lt;property name="url"--&gt;</span><span class="token comment">&lt;!--                                          value="jdbc:mysql://localhost:3306/mybatis?useSSL=true&amp;amp;useUnicode=true&amp;amp;characterEncoding=utf8&amp;amp;serverTimezone=GMT%2B8"/&gt;--&gt;</span><span class="token comment">&lt;!--                                &lt;property name="username" value="root"/&gt;--&gt;</span><span class="token comment">&lt;!--                                &lt;property name="password" value="Delicious.2222"/&gt;--&gt;</span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>driver<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${jdbc.driver}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${jdbc.url}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${jdbc.username}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${jdbc.password}<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dataSource</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environment</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>environments</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- æ³¨å†Œå­é…ç½®æ–‡ä»¶ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mappers</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com/xxxx/dao/UserMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">resource</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com/xxxx/dao/UserMMapper.xml<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mappers</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>UserMMapperTest</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserMMapperTest</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getUserByIdMapTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SqlSession</span> sqlSession <span class="token operator">=</span> <span class="token class-name">MybatisUtils</span><span class="token punctuation">.</span><span class="token function">getSqlSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">UserMMapper</span> userMMapper <span class="token operator">=</span> sqlSession<span class="token punctuation">.</span><span class="token function">getMapper</span><span class="token punctuation">(</span><span class="token class-name">UserMMapper</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserM</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> userMMapper<span class="token punctuation">.</span><span class="token function">getUserByIdMap</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">UserM</span> user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>            sqlSession<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="é¢å‘æ¥å£ç¼–ç¨‹"><a href="#é¢å‘æ¥å£ç¼–ç¨‹" class="headerlink" title="é¢å‘æ¥å£ç¼–ç¨‹"></a>é¢å‘æ¥å£ç¼–ç¨‹</h1><pre class="line-numbers language-none"><code class="language-none">ç›®çš„è§£è€¦ï¼Œå¯æ‹“å±•ï¼Œæé«˜å¤ç”¨ï¼Œåˆ†å±‚å¼€å‘æ—¶å®šä¹‰ä¸å®ç°çš„åˆ†ç¦»ç±»å‹æŠ½è±¡ä½“ï¼ˆabstract classï¼‰ï¼šä¸€ä¸ªä¸ªä½“çš„æŠ½è±¡æŠ½è±¡é¢ï¼ˆinterfaceï¼‰ï¼šä¸€ä¸ªä¸ªä½“æŸæ–¹é¢çš„æŠ½è±¡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> MyBatis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MyBatis </tag>
            
            <tag> ORM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis ç¼“å­˜ç©¿é€ å‡»ç©¿ é›ªå´©</title>
      <link href="/2020/08/06/redis-huan-cun-chuan-tou-ji-chuan-xue-beng/"/>
      <url>/2020/08/06/redis-huan-cun-chuan-tou-ji-chuan-xue-beng/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h2><p>æŒ‡ç”¨æˆ·æƒ³è¦æŸ¥è¯¢ä¸€ä¸ªæ•°æ®ï¼Œå‘ç° Redis å†…å­˜æ•°æ®åº“æ²¡æœ‰ï¼ˆç¼“å­˜æ²¡æœ‰å‘½ä¸­ï¼‰ï¼Œäºæ˜¯å‘æŒä¹…å±‚æ•°æ®åº“æŸ¥è¯¢ï¼Œå‘ç°ä¹Ÿæ²¡æœ‰ï¼ˆæ•°æ®åº“ä¹Ÿæ²¡æœ‰å‘½ä¸­ï¼‰ï¼Œäºæ˜¯æœ¬æ¬¡æŸ¥è¯¢å¤±è´¥ã€‚å³å½“ç”¨æˆ·å¾ˆå¤šæ—¶ï¼Œç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­ï¼ˆç§’æ€ï¼‰ï¼Œäºæ˜¯éƒ½å»äº†è¯·æ±‚æŒä¹…å±‚æ•°æ®åº“ï¼Œé€ æˆå·¨å¤§æŸ¥è¯¢å‹åŠ›ï¼Œå‡ºç°ç¼“å­˜ç©¿é€ã€‚ </p><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç†è§£ï¼šç¼“å­˜å’Œæ•°æ®åº“éƒ½æŸ¥ä¸åˆ°æ•°æ®ï¼ˆéƒ½æ²¡æœ‰å‘½ä¸­ï¼‰ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><h4 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h4><p>ä¸€ç§æ•°æ®ç»“æ„ï¼Œå¯¹æ‰€æœ‰å¯èƒ½æŸ¥è¯¢çš„å‚æ•°ä»¥ hash å½¢å¼å­˜å‚¨ï¼Œåœ¨æ§åˆ¶å±‚å…ˆè¿›è¡Œæ ¡éªŒï¼Œä¸ç¬¦åˆåˆ™ä¸¢å¼ƒï¼Œä»è€Œç¼“è§£æŸ¥è¯¢å‹åŠ›ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806180935.png"></p><h4 id="ç¼“å­˜ç©ºå¯¹è±¡"><a href="#ç¼“å­˜ç©ºå¯¹è±¡" class="headerlink" title="ç¼“å­˜ç©ºå¯¹è±¡"></a>ç¼“å­˜ç©ºå¯¹è±¡</h4><p>å½“ç¼“å­˜å’Œæ•°æ®åº“éƒ½æ²¡æœ‰å‘½ä¸­åï¼Œå³ä½¿è¿”å›çš„ç©ºå¯¹è±¡ä¹Ÿå°†å…¶ç¼“å­˜èµ·æ¥ï¼ŒåŒæ—¶è®¾ç½®ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œä¹‹åå†è®¿é—®è¿™ä¸ªæ•°æ®å°†ä¼šç›´æ¥ä»ç¼“å­˜ä¸­è·å–ï¼Œä¿æŠ¤äº†æ•°æ®åº“ã€‚<br>ä½†è¿™ç§æ–¹æ³•ä¼šå­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š </p><ol><li>å¦‚æœç¼“å­˜ç©ºå€¼ï¼Œæ„å‘³ç€ç¼“å­˜å±‚éœ€è¦é¢å¤–ç©ºé—´å­˜å‚¨æ›´å¤šçš„é”®ã€‚</li><li>å³ä½¿å¯¹ç©ºå€¼è®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œè¿˜æ˜¯ä¼šå­˜åœ¨ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚çš„æ•°æ®ä¼šæœ‰ä¸€æ®µæ—¶é—´çª—å£çš„ä¸ä¸€è‡´ï¼Œè¿™å¯¹äºéœ€è¦ä¿æŒä¸€è‡´æ€§çš„ä¸šåŠ¡ä¼šæœ‰å½±å“ã€‚ </li></ol><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806180943.png"></p><h2 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h2><p>æŒ‡ä¸€ä¸ªçƒ­ç‚¹æ•°æ® key ï¼Œåœ¨è¿™ä¸ª key å¤±æ•ˆç¬é—´ï¼Œå¤§é‡å¹¶å‘è¯·æ±‚è®¿é—®è¿™ä¸ª key ï¼Œå¯¼è‡´å•ç‚¹æŒç»­ä¸åœåœ°æ‰›ç€å¤§å¹¶å‘è®¿é—®ï¼Œç©¿ç ´ç¼“å­˜å†ç›´æ¥è¯·æ±‚æ•°æ®åº“ï¼Œå¹¶ä¸”å›å†™ç¼“å­˜ï¼Œå¯¼ä½¿æ•°æ®åº“ç¬é—´å‹åŠ›è¿‡å¤§ï¼Œç›¸å½“äºåœ¨ä¸€ä¸ªå±éšœä¸Šå‡¿å¼€äº†ä¸€ä¸ªæ´ã€‚</p><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç†è§£ï¼šå› ç¼“å­˜å•ä¸ªè¿‡æœŸï¼Œå¯¼è‡´å•ç‚¹è®¿é—®é‡è¿‡å¤§ã€‚</p><h3 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><h4 id="è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ"><a href="#è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ" class="headerlink" title="è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ"></a>è®¾ç½®çƒ­ç‚¹æ•°æ®æ°¸ä¸è¿‡æœŸ</h4><p>ä»ç¼“å­˜å±‚æ¥çœ‹ï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´æ°¸ä¹…ï¼Œå°±ä¸ä¼šå‡ºç°çƒ­ç‚¹ key è¿‡æœŸåäº§ç”Ÿçš„é—®é¢˜ã€‚ </p><h4 id="åŠ äº’æ–¥é”"><a href="#åŠ äº’æ–¥é”" class="headerlink" title="åŠ äº’æ–¥é”"></a>åŠ äº’æ–¥é”</h4><p>åŠ åˆ†å¸ƒå¼é”ï¼Œä¿è¯å¯¹äºæ¯ä¸ª key åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»æŸ¥è¯¢åç«¯æœåŠ¡ï¼Œå…¶ä»–çº¿ç¨‹æ²¡æœ‰è·å¾—åˆ†å¸ƒå¼é”çš„æƒé™åªèƒ½ç­‰å¾…ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806180939.png"></p><h2 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h2><p>æŒ‡åœ¨æŸä¸€ä¸ªæ—¶é—´æ®µï¼Œç¼“å­˜é›†ä¸­è¿‡æœŸå¤±æ•ˆã€‚<br>å…¶å®é›†ä¸­è¿‡æœŸï¼Œå€’ä¸æ˜¯éå¸¸è‡´å‘½ï¼Œæ¯”è¾ƒè‡´å‘½çš„ç¼“å­˜é›ªå´©ï¼Œæ˜¯ç¼“å­˜æœåŠ¡å™¨æŸä¸ªèŠ‚ç‚¹å®•æœºæˆ–æ–­ç½‘ã€‚å› ä¸ºè‡ªç„¶å½¢æˆçš„ç¼“å­˜é›ªå´©ï¼Œä¸€å®šæ˜¯åœ¨æŸä¸ªæ—¶é—´æ®µé›†ä¸­åˆ›å»ºç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæ•°æ®åº“ä¹Ÿæ˜¯å¯ä»¥é¡¶ä½å‹åŠ›çš„ã€‚æ— éå°±æ˜¯å¯¹æ•°æ®åº“äº§ç”Ÿå‘¨æœŸæ€§çš„å‹åŠ›è€Œå·²ã€‚è€Œç¼“å­˜æœåŠ¡èŠ‚ç‚¹çš„å®•æœºï¼Œå¯¹æ•°æ®åº“æœåŠ¡å™¨é€ æˆçš„å‹åŠ›æ˜¯ä¸å¯é¢„çŸ¥çš„ï¼Œå¾ˆæœ‰å¯èƒ½ç¬é—´å°±æŠŠæ•°æ®åº“å‹å®ã€‚ </p><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç†è§£ï¼šå› ç¼“å­˜é›†ä½“è¿‡æœŸï¼Œå¯¼è‡´è®¿é—®é‡è¿‡å¤§ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806180952.png"></p><h3 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><h4 id="Redis-é«˜å¯ç”¨"><a href="#Redis-é«˜å¯ç”¨" class="headerlink" title="Redis é«˜å¯ç”¨"></a>Redis é«˜å¯ç”¨</h4><p>å¢è®¾å‡ å° Redisï¼Œæ­å»ºé›†ç¾¤ï¼ˆ å¼‚åœ°å¤šæ´» ï¼‰ï¼Œä¸€å°æŒ‚æ‰ä¹‹åå…¶ä»–çš„è¿˜å¯ä»¥ç»§ç»­å·¥ä½œã€‚</p><h4 id="é™æµé™çº§"><a href="#é™æµé™çº§" class="headerlink" title="é™æµé™çº§"></a>é™æµé™çº§</h4><p>åœ¨ç¼“å­˜å¤±æ•ˆåï¼Œé€šè¿‡åŠ é”æˆ–é˜Ÿåˆ—æ¥æ§åˆ¶è¯»æ•°æ®åº“å†™ç¼“å­˜çš„çº¿ç¨‹æ•°é‡ï¼Œæ¯”å¦‚å¯¹æŸä¸ª key åªå…è®¸ä¸€ä¸ªçº¿ç¨‹æŸ¥è¯¢æ•°æ®å’Œå†™ç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…ã€‚ </p><h4 id="æ•°æ®é¢„çƒ­"><a href="#æ•°æ®é¢„çƒ­" class="headerlink" title="æ•°æ®é¢„çƒ­"></a>æ•°æ®é¢„çƒ­</h4><p>åœ¨æ­£å¼éƒ¨ç½²ä¹‹å‰ï¼Œå…ˆæŠŠå¯èƒ½çš„æ•°æ®å…ˆé¢„å…ˆè®¿é—®ä¸€éï¼Œå°†éƒ¨åˆ†æœªæ¥å¯èƒ½å¤§é‡è®¿é—®çš„æ•°æ®å°±ä¼šåŠ è½½åˆ°ç¼“å­˜ä¸­ã€‚åœ¨å³å°†å‘ç”Ÿå¤§å¹¶å‘è®¿é—®å‰æ‰‹åŠ¨è§¦å‘åŠ è½½ç¼“å­˜ä¸åŒçš„ keyï¼Œè®¾ç½®ä¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œè®©ç¼“å­˜å¤±æ•ˆçš„æ—¶é—´ç‚¹å°½é‡å‡åŒ€ã€‚ </p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°ç»„é¢‘æ•°ç»Ÿè®¡</title>
      <link href="/2020/07/02/shu-zu-pin-shu-tong-ji/"/>
      <url>/2020/07/02/shu-zu-pin-shu-tong-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="æ•°ç»„é¢‘æ•°ç»Ÿè®¡"><a href="#æ•°ç»„é¢‘æ•°ç»Ÿè®¡" class="headerlink" title="æ•°ç»„é¢‘æ•°ç»Ÿè®¡"></a>æ•°ç»„é¢‘æ•°ç»Ÿè®¡</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> nums <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> hm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">;</span> i <span class="token operator">&lt;</span> nums<span class="token punctuation">.</span>length <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        hm<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> hm<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> integer <span class="token operator">:</span> hm<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        max <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>max<span class="token punctuation">,</span> integer<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>MySQL è®¾è®¡</title>
      <link href="/2020/05/10/mysql-she-ji/"/>
      <url>/2020/05/10/mysql-she-ji/</url>
      
        <content type="html"><![CDATA[<h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åˆ†æéœ€æ±‚ï¼šåˆ†æä¸šåŠ¡éœ€æ±‚ã€‚<br><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¦‚è¦è®¾è®¡ï¼šERå…³ç³»å›¾ã€‚</p><h2 id="èŒƒå¼"><a href="#èŒƒå¼" class="headerlink" title="èŒƒå¼"></a>èŒƒå¼</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210821123113.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210821123118.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210821123121.png"></p><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç¬¬ä¸€èŒƒå¼ 1NF</p><p>ä¿è¯æ¯åˆ—çš„åŸå­æ€§ï¼Œæ•°æ®åº“è¡¨çš„æ¯ä¸€åˆ—éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„åŸå­æ•°æ®é¡¹ï¼Œå³ <strong>åˆ—ä¸å¯æ‹†åˆ†</strong> ã€‚</p><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç¬¬äºŒèŒƒå¼ 2NF</p><p>ä¸€èŒƒåŸºç¡€ä¸Šï¼Œä¿è¯ä¸€å¼ è¡¨åªæè¿°ä¸€ä»¶äº‹ã€‚</p><p>ä¸€èŒƒåŸºç¡€ä¸Šï¼Œè¡¨ä¸­çš„æ¯æ¡è®°å½•å¿…é¡»æ˜¯å”¯ä¸€è¢«åŒºåˆ†çš„ï¼Œå³ <strong>åˆ—è¢«ä¸»é”®å”¯ä¸€æ ‡è¯†</strong> ã€‚</p><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç¬¬ä¸‰èŒƒå¼ 3NF</p><p>äºŒèŒƒåŸºç¡€ä¸Šï¼Œä¿è¯æ¯åˆ—éƒ½å’Œä¸»é”®ç›´æ¥ç›¸å…³ï¼Œè¯´ç™½äº†ï¼Œå†³å®šæŸå­—æ®µå€¼çš„å¿…é¡»æ˜¯ä¸»é”®ã€‚</p><p>äºŒèŒƒåŸºç¡€ä¸Šï¼Œä»»ä½•éä¸»å±æ€§ä¸ä¾èµ–ä¸å…¶ä»–éä¸»å±æ€§ï¼ˆæ¶ˆé™¤ä¼ é€’ä¾èµ–ï¼‰ï¼Œå³ <strong>åˆ—å’Œä¸»é”®ç›´æ¥ç›¸å…³</strong> ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL å››ç§è¯­è¨€</title>
      <link href="/2020/05/07/mysql-si-chong-yu-yan/"/>
      <url>/2020/05/07/mysql-si-chong-yu-yan/</url>
      
        <content type="html"><![CDATA[<h1 id="DDL-æ•°æ®å®šä¹‰è¯­è¨€"><a href="#DDL-æ•°æ®å®šä¹‰è¯­è¨€" class="headerlink" title="DDL æ•°æ®å®šä¹‰è¯­è¨€"></a>DDL æ•°æ®å®šä¹‰è¯­è¨€</h1><p>ç”¨æ¥åˆ›å»ºæ•°æ®åº“ä¸­çš„å„ç§å¯¹è±¡ï¼šè¡¨ã€è§†å›¾ã€ç´¢å¼•ã€åŒä¹‰è¯ã€èšç°‡ç­‰ï¼Œéšæ€§æäº¤ä¸èƒ½å›æ»šã€‚</p><h2 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span><span class="token keyword">IF</span> <span class="token operator">NOT</span> <span class="token keyword">EXISTS</span><span class="token punctuation">]</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token string">'å­—æ®µå'</span> æ•°æ®ç±»å‹ <span class="token punctuation">[</span>å±æ€§<span class="token punctuation">]</span> <span class="token punctuation">[</span>ç´¢å¼•<span class="token punctuation">]</span> <span class="token punctuation">[</span>æ³¨é‡Š<span class="token punctuation">]</span><span class="token punctuation">,</span>  <span class="token string">'å­—æ®µå'</span> æ•°æ®ç±»å‹ <span class="token punctuation">[</span>å±æ€§<span class="token punctuation">]</span> <span class="token punctuation">[</span>ç´¢å¼•<span class="token punctuation">]</span> <span class="token punctuation">[</span>æ³¨é‡Š<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">[</span>è¡¨ç±»å‹<span class="token punctuation">]</span><span class="token punctuation">[</span>å­—ç¬¦é›†<span class="token punctuation">]</span><span class="token punctuation">[</span>æ³¨é‡Š<span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¿®æ”¹è¡¨"><a href="#ä¿®æ”¹è¡¨" class="headerlink" title="ä¿®æ”¹è¡¨"></a>ä¿®æ”¹è¡¨</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token punctuation">`</span>å­—æ®µå<span class="token punctuation">`</span> <span class="token punctuation">`</span>åˆ—å±æ€§<span class="token punctuation">`</span><span class="token punctuation">;</span>        <span class="token comment">-- å¢åŠ å­—æ®µ</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span> <span class="token keyword">MODIFY</span> <span class="token punctuation">`</span>å­—æ®µå<span class="token punctuation">`</span> <span class="token punctuation">`</span>åˆ—å±æ€§<span class="token punctuation">`</span><span class="token punctuation">;</span>      <span class="token comment">-- ä¿®æ”¹å­—æ®µçš„æ•°æ®ç±»å‹æˆ–çº¦æŸ</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>æ—§è¡¨å<span class="token punctuation">`</span> <span class="token keyword">RENAME</span> <span class="token keyword">AS</span> <span class="token punctuation">`</span>æ–°è¡¨å<span class="token punctuation">`</span><span class="token punctuation">;</span>         <span class="token comment">-- ä¿®æ”¹è¡¨å</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span> CHANGE <span class="token punctuation">`</span>æ—§å­—æ®µå<span class="token punctuation">`</span> <span class="token punctuation">`</span>æ–°å­—æ®µå<span class="token punctuation">`</span><span class="token punctuation">;</span>  <span class="token comment">-- ä¿®æ”¹å­—æ®µå</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åˆ é™¤è¡¨"><a href="#åˆ é™¤è¡¨" class="headerlink" title="åˆ é™¤è¡¨"></a>åˆ é™¤è¡¨</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span><span class="token punctuation">;</span>                    <span class="token comment">-- åˆ é™¤è¡¨</span><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span> <span class="token keyword">DROP</span> <span class="token punctuation">`</span>å­—æ®µå<span class="token punctuation">`</span><span class="token punctuation">;</span>                <span class="token comment">-- åˆ é™¤å­—æ®µ</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="DML-æ•°æ®æ“ä½œè¯­è¨€"><a href="#DML-æ•°æ®æ“ä½œè¯­è¨€" class="headerlink" title="DML æ•°æ®æ“ä½œè¯­è¨€"></a>DML æ•°æ®æ“ä½œè¯­è¨€</h1><h2 id="begin"><a href="#begin" class="headerlink" title="begin"></a>begin</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- ç›´æ¥æ“ä½œæ•°æ®åº“å‰ï¼Œå¿…é¡»åŠ begin</span><span class="token keyword">begin</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span>ï¼›<span class="token keyword">end</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="insert"><a href="#insert" class="headerlink" title="insert"></a>insert</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>å­—æ®µå<span class="token number">1</span><span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>å­—æ®µå<span class="token number">2</span><span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'å€¼1'</span><span class="token punctuation">,</span><span class="token string">'å€¼2'</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">delete</span> <span class="token keyword">from</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span> <span class="token keyword">where</span> æ¡ä»¶è¡¨è¾¾å¼<span class="token punctuation">;</span><span class="token keyword">truncate</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span><span class="token comment">-- åŒºåˆ«</span><span class="token comment">-- ç›¸åŒç‚¹ï¼šéƒ½èƒ½åˆ é™¤æ•°æ®ï¼Œä¸åˆ è¡¨ç»“æ„</span><span class="token comment">-- ä¸åŒç‚¹ï¼š</span><span class="token comment">--       truncate è‡ªå¢å½’é›¶ è®¡æ•°å™¨å½’é›¶ ä¸å½±å“äº‹åŠ¡</span><span class="token comment">--       delete åˆ é™¤é—®é¢˜ï¼šé‡å¯æ•°æ®åº“</span><span class="token comment">--              InnoDB è‡ªå¢æ¸…é›¶ï¼ˆå­˜åœ¨å†…å­˜ä¸­ï¼Œæ–­ç”µå³å¤±ï¼‰</span><span class="token comment">--              MyISAM è‡ªå¢ä¸æ¸…é›¶ï¼ˆå­˜åœ¨æ–‡ä»¶ä¸­ï¼Œä¸ä¸¢å¤±ï¼‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="update"><a href="#update" class="headerlink" title="update"></a>update</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">update</span> <span class="token string">'è¡¨å'</span> <span class="token keyword">set</span> <span class="token punctuation">`</span>å­—æ®µå<span class="token number">1</span><span class="token punctuation">`</span><span class="token operator">=</span><span class="token punctuation">`</span>æ–°å€¼<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>å­—æ®µå<span class="token number">2</span><span class="token punctuation">`</span><span class="token operator">=</span><span class="token punctuation">`</span>æ–°å€¼<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">where</span> æ¡ä»¶è¡¨è¾¾å¼<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="DQL-æ•°æ®æŸ¥è¯¢è¯­è¨€"><a href="#DQL-æ•°æ®æŸ¥è¯¢è¯­è¨€" class="headerlink" title="DQL æ•°æ®æŸ¥è¯¢è¯­è¨€"></a>DQL æ•°æ®æŸ¥è¯¢è¯­è¨€</h1><h2 id="show"><a href="#show" class="headerlink" title="show"></a>show</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>mysql<span class="token punctuation">`</span><span class="token punctuation">;</span>  <span class="token comment">-- åº“å®šä¹‰è¯­å¥</span><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span><span class="token punctuation">;</span>   <span class="token comment">-- è¡¨å®šä¹‰è¯­å¥</span><span class="token keyword">DESC</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span><span class="token punctuation">;</span>                <span class="token comment">-- è¡¨ç»“æ„</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="select"><a href="#select" class="headerlink" title="select"></a>select</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">å®Œæ•´è¯­æ³•ï¼š<span class="token keyword">select</span> <span class="token punctuation">[</span><span class="token keyword">all</span> <span class="token operator">|</span> <span class="token keyword">distinct</span><span class="token punctuation">]</span> <span class="token keyword">from</span> table1<span class="token punctuation">.</span>filed1 <span class="token punctuation">[</span><span class="token keyword">as</span> alias1<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment">-- distinct å»é‡</span><span class="token punctuation">[</span><span class="token keyword">left</span> <span class="token operator">|</span> <span class="token keyword">right</span> <span class="token operator">|</span> <span class="token keyword">inner</span> <span class="token operator">|</span> <span class="token keyword">join</span> table2 <span class="token keyword">on</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>  <span class="token comment">-- è¿æ¥æŸ¥è¯¢</span><span class="token punctuation">[</span><span class="token keyword">where</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>  <span class="token comment">-- æ¡ä»¶æŸ¥è¯¢</span><span class="token punctuation">[</span><span class="token keyword">group</span> <span class="token keyword">by</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>  <span class="token comment">-- åˆ†ç»„æŸ¥è¯¢ï¼šæŒ‡å®šç»“æœæŒ‰ç…§å“ªäº›å­—æ®µæ¥åˆ†ç»„</span><span class="token punctuation">[</span><span class="token keyword">having</span>   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>  <span class="token comment">-- è¿‡æ»¤ï¼šè¿‡æ»¤åˆ†ç»„æŸ¥è¯¢åçš„è®°å½•é¡»æ»¡è¶³çš„æ¬¡è¦æ¡ä»¶</span><span class="token punctuation">[</span><span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span>  <span class="token comment">-- æ’åºï¼šé€šè¿‡æŒ‡å®šå­—æ®µå¯¹æ‰€æŸ¥è¯¢çš„è®°å½•æŒ‰æŒ‡å®šæ–¹å¼æ’åº å‡åº ASC é™åº DESC</span><span class="token punctuation">[</span><span class="token keyword">limit</span>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">-- åˆ†é¡µæŸ¥è¯¢ï¼šæŒ‡å®šæŸ¥è¯¢è®°å½•ä»å“ªæ¡åˆ°å“ªæ¡</span><span class="token keyword">select</span> <span class="token punctuation">`</span>å­—æ®µ<span class="token number">1</span><span class="token punctuation">`</span> <span class="token keyword">as</span> <span class="token punctuation">`</span>åˆ«å<span class="token number">1</span><span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>å­—æ®µ<span class="token number">2</span><span class="token punctuation">`</span> <span class="token keyword">as</span> <span class="token punctuation">`</span>åˆ«å<span class="token number">2</span><span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">from</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span> <span class="token keyword">as</span> <span class="token punctuation">`</span>è¡¨åˆ«å<span class="token punctuation">`</span><span class="token keyword">select</span> concat<span class="token punctuation">(</span><span class="token string">'å§“å'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span> <span class="token keyword">as</span> æ–°åå­— <span class="token keyword">from</span> student        <span class="token comment">-- å‡½æ•°ï¼šæ‹¼æ¥ concat(a,b)</span><span class="token keyword">select</span> <span class="token keyword">distinct</span> <span class="token punctuation">`</span>score<span class="token punctuation">`</span> <span class="token keyword">from</span> student                    <span class="token comment">-- å‡½æ•°ï¼šå»é‡</span><span class="token keyword">select</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span>                                        <span class="token comment">-- MySQLç‰ˆæœ¬</span><span class="token keyword">select</span> <span class="token punctuation">`</span>num<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>score<span class="token punctuation">`</span><span class="token operator">+</span><span class="token number">1</span> <span class="token keyword">as</span> <span class="token string">'åŠ ä¸€åˆ†åçš„æˆç»©'</span> <span class="token keyword">from</span> student  <span class="token comment">-- è®¡ç®—</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> <span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">-- å¹´æœˆæ—¥æ—¶åˆ†ç§’  2021-01-01 12:22:00</span><span class="token keyword">SELECT</span> <span class="token keyword">CURRENT_DATE</span><span class="token punctuation">;</span>  <span class="token comment">-- å¹´æœˆæ—¥  2021-01-01</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="join-on-è¿æ¥æŸ¥è¯¢"><a href="#join-on-è¿æ¥æŸ¥è¯¢" class="headerlink" title="join on è¿æ¥æŸ¥è¯¢"></a>join on è¿æ¥æŸ¥è¯¢</h2><pre class="line-numbers language-none"><code class="language-none">è¯­æ³•ï¼šjoin è¿æ¥çš„è¡¨ on äº¤å‰æ¡ä»¶/ç­‰å€¼åˆ¤æ–­æ€è·¯ï¼š1.åˆ†æå¾…æŸ¥è¯¢çš„å­—æ®µæ¥è‡ªå“ªäº›è¡¨ï¼Ÿ2.é€‰æ‹©å“ªç§è¿æ¥æŸ¥è¯¢ï¼Ÿç¡®å®šäº¤å‰æ¡ä»¶ï¼ˆä¸¤è¡¨ä¸­å“ªäº›å­—æ®µç›¸åŒï¼Ÿ ç­‰å€¼åˆ¤æ–­ï¼šå­¦ç”Ÿè¡¨num=æˆç»©è¡¨numï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816113641.png"></p><pre class="line-numbers language-mysql" data-language="mysql"><code class="language-mysql"># 1.å…§è¿ï¼šå¦‚æœè¡¨ä¸­è‡³å°‘æœ‰ä¸€ä¸ªåŒ¹é…ï¼Œå°±è¿”å›è¡ŒSELECT * FROM tb_emp a INNER JOIN tb_dept b ON a.deptId = b.id# 2.å·¦è¿ï¼šè¿”å›å·¦è¡¨æ‰€æœ‰å€¼ï¼Œå³ä½¿å³è¡¨æ²¡æœ‰åŒ¹é…SELECT * FROM tb_emp a LEFT JOIN tb_dept b ON a.deptId = b.id where rusult is null# 3.å³è¿SELECT * FROM tb_emp a RIGHT JOIN tb_dept b ON a.deptId = b.id# 4.å·¦è¿ç•™å·¦SELECT * FROM tb_emp a LEFT JOIN tb_dept b ON a.deptId = b.id WHERE b.id = null# 5.å³è¿ç•™å³SELECT * FROM tb_emp a RIGHT JOIN tb_dept b ON a.deptId = b.id WHERE a.deptId = null# 6.å…¨éƒ¨SELECT * FROM tb_emp a LEFT JOIN tb_dept b ON a.deptId = b.idUNIONSELECT * FROM tb_emp a RIGHT JOIN tb_dept b ON a.deptId = b.id# 7.å…¨éƒ¨ç•™å·¦å³SELECT * FROM tb1emp a LEFT JOIN tb_dept b ON a.deptId = b.id WHERE b.id = nullUNIONSELECT * FROM tb_emp a RIGHT JOIN tb_dept b ON a.deptId = b.id WHERE a.deptId = null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>è‡ªè¿æ¥</strong></p><pre class="line-numbers language-none"><code class="language-none">è‡ªå·±çš„è¡¨å’Œè‡ªå·±çš„è¡¨è¿æ¥ï¼ˆä¸€å¼ è¡¨æ‹†åˆ†ä¸ºä¸¤å¼ ä¸€æ ·çš„è¡¨ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816113646.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816113648.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816113653.png"></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- æŸ¥è¯¢çˆ¶å­ä¿¡æ¯</span><span class="token keyword">select</span> a<span class="token punctuation">.</span><span class="token punctuation">`</span>catrgoryName<span class="token punctuation">`</span> <span class="token keyword">as</span> <span class="token string">'çˆ¶æ ç›®'</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span><span class="token punctuation">`</span>catrgoryName<span class="token punctuation">`</span> <span class="token keyword">as</span> <span class="token string">'å­æ ç›®'</span><span class="token keyword">from</span> <span class="token punctuation">`</span>catrgory<span class="token punctuation">`</span> <span class="token keyword">as</span> a<span class="token punctuation">,</span> <span class="token punctuation">`</span>catrgory<span class="token punctuation">`</span> <span class="token keyword">as</span> b<span class="token keyword">where</span> a<span class="token punctuation">.</span><span class="token punctuation">`</span>catrgory<span class="token punctuation">`</span> <span class="token operator">=</span> b<span class="token punctuation">.</span><span class="token punctuation">`</span>pid<span class="token punctuation">`</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="where-æ¡ä»¶æŸ¥è¯¢"><a href="#where-æ¡ä»¶æŸ¥è¯¢" class="headerlink" title="where   æ¡ä»¶æŸ¥è¯¢"></a>where   æ¡ä»¶æŸ¥è¯¢</h2><pre class="line-numbers language-none"><code class="language-none">è¿”å›å€¼ï¼šBoolean<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">é€»è¾‘è¿ç®—ç¬¦    <span class="token operator">=</span> <span class="token operator">!=</span> <span class="token operator">&gt;</span> <span class="token operator">&lt;</span> <span class="token operator">&gt;=</span> <span class="token operator">&lt;=</span>       æ¯”è¾ƒ    <span class="token operator">and</span>                  ä¸    <span class="token operator">or</span>                   æˆ–    <span class="token operator">between</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token operator">and</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  åŒºé—´<span class="token keyword">select</span> <span class="token punctuation">`</span>num<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>score<span class="token punctuation">`</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> <span class="token punctuation">`</span>score<span class="token punctuation">`</span><span class="token operator">&gt;</span><span class="token number">90</span> <span class="token operator">and</span> <span class="token punctuation">`</span>score<span class="token punctuation">`</span><span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>  <span class="token comment">-- </span><span class="token keyword">select</span> <span class="token punctuation">`</span>num<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>score<span class="token punctuation">`</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> <span class="token punctuation">`</span>score<span class="token punctuation">`</span> <span class="token operator">between</span> <span class="token operator">and</span> <span class="token number">100</span><span class="token punctuation">;</span>     <span class="token comment">-- åŒºé—´</span>æ¯”è¾ƒè¿ç®—ç¬¦<span class="token operator">is</span> <span class="token boolean">null</span> <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token operator">between</span><span class="token operator">like</span> <span class="token operator">+</span> <span class="token operator">%</span>   <span class="token comment"># åŒ¹é…0æˆ–ä»»æ„ä¸ªå­—ç¬¦)</span><span class="token operator">like</span> <span class="token operator">+</span> _   <span class="token comment"># åŒ¹é…ä¸€ä¸ªå­—ç¬¦</span><span class="token operator">in</span><span class="token keyword">select</span> <span class="token punctuation">`</span>num<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> <span class="token punctuation">`</span>addr<span class="token punctuation">`</span> <span class="token operator">is</span> <span class="token boolean">null</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token punctuation">`</span>num<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">like</span> <span class="token string">'é™ˆ%'</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token punctuation">`</span>num<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">like</span> <span class="token string">'é™ˆ_'</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token punctuation">`</span>num<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">from</span> student <span class="token keyword">where</span> <span class="token punctuation">`</span>num<span class="token punctuation">`</span> <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>å­æŸ¥è¯¢</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- è¿æ¥æŸ¥è¯¢</span><span class="token keyword">select</span> s<span class="token punctuation">.</span><span class="token punctuation">`</span>studentNo<span class="token punctuation">`</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token punctuation">`</span>subjectNo<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>studentResult<span class="token punctuation">`</span><span class="token keyword">from</span> <span class="token punctuation">`</span>result<span class="token punctuation">`</span> r innner <span class="token keyword">join</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> sub <span class="token keyword">on</span> r<span class="token punctuation">.</span>subjectNo <span class="token operator">=</span> sub<span class="token punctuation">.</span>subjectNo<span class="token keyword">where</span> subjectName <span class="token operator">=</span> <span class="token string">'æ•°æ®åº“ç»“æ„'</span><span class="token keyword">order</span> <span class="token keyword">by</span> studentResult <span class="token keyword">desc</span><span class="token punctuation">;</span><span class="token comment">-- å­æŸ¥è¯¢ whereåµŒå¥— ç”±é‡ŒåŠå¤–</span><span class="token keyword">select</span> s<span class="token punctuation">.</span><span class="token punctuation">`</span>studentNo<span class="token punctuation">`</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token punctuation">`</span>subjectNo<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>studentResult<span class="token punctuation">`</span><span class="token keyword">from</span> <span class="token punctuation">`</span>result<span class="token punctuation">`</span><span class="token keyword">where</span> subjectNo <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">select</span> subjectNo <span class="token keyword">from</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span><span class="token keyword">where</span> subjectName <span class="token operator">=</span> <span class="token string">'æ•°æ®åº“ç»“æ„'</span> <span class="token punctuation">)</span><span class="token keyword">order</span> <span class="token keyword">by</span> studentResult <span class="token keyword">desc</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="group-by-having-åˆ†ç»„-è¿‡æ»¤"><a href="#group-by-having-åˆ†ç»„-è¿‡æ»¤" class="headerlink" title="group by having åˆ†ç»„ è¿‡æ»¤"></a>group by having åˆ†ç»„ è¿‡æ»¤</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">è¯­æ³•ï¼š<span class="token keyword">group</span> <span class="token keyword">by</span> å­—æ®µ <span class="token keyword">having</span> è¿‡æ»¤æ¡ä»¶<span class="token punctuation">;</span><span class="token keyword">select</span> subjectName<span class="token punctuation">,</span> <span class="token function">avg</span><span class="token punctuation">(</span>stuResult<span class="token punctuation">)</span> <span class="token keyword">as</span> å¹³å‡åˆ†<span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span>stuResult<span class="token punctuation">)</span> <span class="token keyword">as</span> æœ€é«˜åˆ†<span class="token punctuation">,</span> <span class="token function">min</span><span class="token punctuation">(</span>stuResult<span class="token punctuation">)</span> <span class="token keyword">as</span> æœ€ä½åˆ†<span class="token keyword">from</span> result <span class="token keyword">as</span> r <span class="token keyword">inner</span> <span class="token keyword">join</span> <span class="token punctuation">`</span>subject<span class="token punctuation">`</span> sub <span class="token keyword">on</span> r<span class="token punctuation">.</span><span class="token punctuation">`</span>subjectNo<span class="token punctuation">`</span> <span class="token operator">=</span> sub<span class="token punctuation">.</span><span class="token punctuation">`</span>subjectNo<span class="token punctuation">`</span><span class="token keyword">group</span> <span class="token keyword">by</span> r<span class="token punctuation">.</span><span class="token punctuation">`</span>subjectNo<span class="token punctuation">`</span> <span class="token keyword">having</span> å¹³å‡åˆ†<span class="token operator">&gt;</span><span class="token number">80</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="order-by-æ’åº"><a href="#order-by-æ’åº" class="headerlink" title="order by æ’åº"></a>order by æ’åº</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">æ¦‚å¿µï¼šé€šè¿‡æŒ‡å®šå­—æ®µå¯¹æ‰€æŸ¥è¯¢çš„è®°å½•æŒ‰æŒ‡å®šæ–¹å¼æ’åº å‡åº <span class="token keyword">ASC</span> é™åº <span class="token keyword">DESC</span>è¯­æ³•ï¼š<span class="token punctuation">[</span><span class="token keyword">order</span> <span class="token keyword">by</span> å­—æ®µ æ’åºæ–¹å¼<span class="token punctuation">]</span>  <span class="token comment">-- æ’åºï¼šé€šè¿‡æŒ‡å®šå­—æ®µå¯¹æ‰€æŸ¥è¯¢çš„è®°å½•æŒ‰æŒ‡å®šæ–¹å¼æ’åº å‡åº ASC é™åº DESC</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="limit-åˆ†é¡µ"><a href="#limit-åˆ†é¡µ" class="headerlink" title="limit åˆ†é¡µ"></a>limit åˆ†é¡µ</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">ä½œç”¨ï¼šç¼“è§£æ•°æ®åº“å‹åŠ›ï¼ˆç€‘å¸ƒæµå°±ä¸åŒäº†ï¼‰è¯­æ³•ï¼š<span class="token punctuation">[</span><span class="token keyword">limit</span> èµ·å§‹ç´¢å¼•<span class="token punctuation">,</span> æ¡æ•°<span class="token operator">/</span>é¡µé¢å¤§å°<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">-- åˆ†é¡µæŸ¥è¯¢ï¼šæŒ‡å®šæŸ¥è¯¢è®°å½•ä»å“ªæ¡åˆ°å“ªæ¡</span>è§„å¾‹ï¼šç¬¬<span class="token number">1</span>é¡µ <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span>ç¬¬<span class="token number">2</span>é¡µ <span class="token keyword">limit</span> <span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span>ç¬¬<span class="token number">3</span>é¡µ <span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span>èµ·å§‹ç´¢å¼• <span class="token operator">=</span> <span class="token punctuation">(</span>å½“å‰é¡µ <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> æ¡æ•°     startIndex <span class="token operator">=</span> <span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSizeæ€»é¡µæ•° <span class="token operator">=</span> æ€»æ•° <span class="token operator">/</span> æ¡æ•°               totalPage <span class="token operator">=</span> sum <span class="token operator">/</span> pageSize<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># æ˜¾ç¤ºå‰ 50 è¡Œ</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token keyword">limit</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="DCL-æ•°æ®æ§åˆ¶è¯­è¨€"><a href="#DCL-æ•°æ®æ§åˆ¶è¯­è¨€" class="headerlink" title="DCL æ•°æ®æ§åˆ¶è¯­è¨€"></a>DCL æ•°æ®æ§åˆ¶è¯­è¨€</h1><p>ç”¨æ¥æˆäºˆå’Œæ’¤é”€ç”¨æˆ·æƒé™ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL ç´¢å¼•</title>
      <link href="/2020/05/06/mysql-suo-yin/"/>
      <url>/2020/05/06/mysql-suo-yin/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¦‚å¿µ</p><p>indexï¼Œé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼ˆæ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„ï¼‰ï¼ŒæŒ‡å‘æ•°æ®åº“è¡¨æ–‡ä»¶è®°å½•çš„æŒ‡é’ˆæ„æˆçš„æ–‡ä»¶ã€‚</p><blockquote><p>æ•°æ®åº“é™¤äº†ç»´æŠ¤æ•°æ®ï¼Œè¿˜ç»´æŠ¤ç€ä¸€ä¸ªæ»¡è¶³ç‰¹å®šæŸ¥æ‰¾ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œå®ƒä»¥æŸç§æ–¹å¼æŒ‡å‘æ•°æ®ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨è¿™äº›æ•°æ®ç»“æ„åŸºç¡€ä¸Šå®ç°é«˜çº§æŸ¥æ‰¾ç®—æ³•ã€‚</p></blockquote><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç†è§£ï¼šç»™æ­£æ–‡ï¼ˆæ•°æ®ï¼‰åŠ ç›®å½•ï¼ˆç´¢å¼•ï¼‰ã€‚</p><p><span class="github-emoji"><span>ğŸŒŸ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f31f.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½œç”¨</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. æé«˜æ•°æ®æ£€ç´¢é€Ÿåº¦ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. æé«˜è¡¨å’Œè¡¨ä¹‹é—´çš„è¿æ¥é€Ÿåº¦ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ã€‚</p><p><span class="github-emoji"><span>ğŸ“œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å­˜å‚¨</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä»¥ç´¢å¼•æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ç£ç›˜ä¸Šã€‚</p><p><span class="github-emoji"><span>ğŸ“œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åŸåˆ™</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="github-emoji"><span>âœ”</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2714.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> â€‹é€‚åˆåŠ ç´¢å¼•ï¼š<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸»é”®è‡ªåŠ¨å»ºç«‹å”¯ä¸€ç´¢å¼•<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é¢‘ç¹æŸ¥è¯¢ã€éœ€è¦æ’åºçš„å­—æ®µ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æŸ¥è¯¢ä¸­ä¸å…¶ä»–è¡¨å…³è”çš„å­—æ®µï¼Œå¤–é”®å…³ç³»<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æŸ¥è¯¢ä¸­æ’åºçš„å­—æ®µ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æŸ¥è¯¢ä¸­ç»Ÿè®¡æˆ–åˆ†ç»„å­—æ®µ</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="github-emoji"><span>âŒ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/274c.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¸å®œåŠ ç´¢å¼•<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ•°æ®å˜åŠ¨é¢‘ç¹çš„è¡¨ï¼ˆä¸ä½†æ›´æ–°å€¼è¿˜æ›´æ–°æ ‘ï¼‰<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ•°æ®é‡å°‘ã€ç‰¹æ®Šæ•°æ®ç±»å‹å¦‚ text<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ•°æ®é‡å¤å€¼å¤šï¼Œåˆ†å¸ƒå¹³å‡ï¼ŒæŸ¥è¯¢ä¸­å¾ˆå°‘æ¶‰åŠçš„å­—æ®µ</p><p><span class="github-emoji"><span>ğŸ“œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¼˜ç‚¹</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æé«˜æ•°æ®æ£€ç´¢æ•ˆç‡ï¼Œé™ä½æ•°æ®åº“IOæˆæœ¬ã€‚</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é€šè¿‡ç´¢å¼•åˆ—å¯¹æ•°æ®æ’åºï¼Œé™ä½æ•°æ®æ’åºæˆæœ¬ï¼Œé™ä½CPUæ¶ˆè€—ã€‚</p><p><span class="github-emoji"><span>ğŸ“œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç¼ºç‚¹</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. å ç”¨é¢å¤–ç©ºé—´ï¼šç´¢å¼•å®é™…ä¸Šä¹Ÿæ˜¯ä¸€å¼ è¡¨ï¼Œä¿å­˜äº†ä¸»é”®å’Œç´¢å¼•å­—æ®µï¼Œå¹¶æŒ‡å‘å®ä½“è¡¨çš„è®°å½•ã€‚</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. é™ä½ç»´æŠ¤é€Ÿåº¦ï¼šç´¢å¼•æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œé™ä½æ›´æ–°è¡¨çš„é€Ÿåº¦ï¼Œå¦‚ insert update deleteï¼Œå› ä¸ºæ›´æ–°è¡¨æ—¶ï¼ŒMySQL ä¸ä»…è¦ä¿å­˜æ•°æ®ï¼Œè¿˜è¦ä¿å­˜ä¸€ä¸‹ç´¢å¼•æ–‡ä»¶æ¯æ¬¡æ›´æ–°æ·»åŠ äº†ç´¢å¼•åˆ—çš„å­—æ®µï¼Œéƒ½ä¼šè°ƒæ•´å› ä¸ºæ›´æ–°æ‰€å¸¦æ¥çš„é”®å€¼å˜åŒ–åçš„ç´¢å¼•ä¿¡æ¯ã€‚</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3. è€—æ—¶ï¼šåˆ›å»ºå’Œç»´æŠ¤ç´¢å¼•éœ€è¦è€—è´¹æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´éšç€æ•°æ®é‡çš„å¢åŠ è€Œå¢åŠ ï¼Œéœ€èŠ±æ—¶é—´ç ”ç©¶ä¼˜ç§€çš„ç´¢å¼•æˆ–ä¼˜åŒ–æŸ¥è¯¢ã€‚</p><p><span class="github-emoji"><span>ğŸ“œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¸ºä»€ä¹ˆä¸çœŸæ­£åˆ é™¤æ•°æ®ï¼Ÿ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸ºäº†æ•°æ®åˆ†æå’Œç´¢å¼•ã€‚</p><p><span class="github-emoji"><span>ğŸ“œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¸ºä»€ä¹ˆç´¢å¼•å¤±æ•ˆï¼Ÿ</p><ol><li>ä»¥â€œ%â€å¼€å¤´çš„ LIKE è¯­å¥ï¼Œæ¨¡ç³ŠåŒ¹é…ã€‚</li><li>OR è¯­å¥å‰åæ²¡æœ‰åŒæ—¶ä½¿ç”¨ç´¢å¼•ã€‚</li><li>æ•°æ®ç±»å‹å‡ºç°éšå¼è½¬åŒ–ï¼ˆå¦‚ varchar ä¸åŠ å•å¼•å·çš„è¯å¯èƒ½ä¼šè‡ªåŠ¨è½¬æ¢ä¸º int å‹ï¼‰ã€‚</li></ol><p><span class="github-emoji"><span>ğŸ“œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç´¢å¼•é€‰æ‹©</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç´¢å¼•åˆ—ä¸­ä¸åŒå€¼çš„æ•°ç›®å’Œè¡¨ä¸­è®°å½•æ•°ä¹‹æ¯”ï¼Œå¦‚è¡¨2000æ¡æ•°æ®ï¼Œè¡¨ç´¢å¼•åˆ—æœ‰1980ä¸ªä¸åŒçš„å€¼ï¼Œç´¢å¼•é€‰æ‹©æ€§1980/2000=0.99ï¼Œè¶Šæ¥è¿‘äº1ï¼Œç´¢å¼•æ•ˆç‡è¶Šé«˜ã€‚</p><p><span class="github-emoji"><span>ğŸ“œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4dc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è®¾è®¡</p><p>ä¸€ä¸ªè¡¨åªèƒ½æœ‰ä¸€ä¸ªèšé›†ç´¢å¼•æˆ–å¤šä¸ªéèšé›†ç´¢å¼•ï¼Œä¸èƒ½æœ‰å¤šä¸ªèšé›†ç´¢å¼•ã€‚</p><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span><span class="token punctuation">;</span>                                 <span class="token comment">-- æ˜¾ç¤ºè¡¨çš„æ‰€æœ‰ç´¢å¼•</span><span class="token keyword">create</span> <span class="token keyword">index</span> ç´¢å¼•å <span class="token keyword">on</span> è¡¨å<span class="token punctuation">(</span><span class="token punctuation">`</span>å­—æ®µ<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token comment">-- åˆ›å»ºç´¢å¼• (ç´¢å¼•åï¼šid_è¡¨å_å­—æ®µå)</span><span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span> <span class="token keyword">add</span> fulltext <span class="token keyword">index</span> ç´¢å¼•å <span class="token punctuation">`</span>å­—æ®µ<span class="token punctuation">`</span><span class="token punctuation">;</span>     <span class="token comment">-- ä¿®æ”¹ä¸ºå…¨æ–‡ç´¢å¼•</span><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">`</span>è¡¨å<span class="token punctuation">`</span><span class="token punctuation">;</span>                           <span class="token comment">-- åˆ†æSQLæ‰§è¡Œæƒ…å†µ</span><span class="token comment">-- ç´¢å¼•å¤±æ•ˆ</span>å•å€¼ç´¢å¼•å¤åˆç´¢å¼•eg<span class="token punctuation">.</span><span class="token comment">-- è¡¨ user ä¸­æœ‰å­—æ®µï¼šid name email</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>  <span class="token comment">-- ç»Ÿè®¡ç”¨æˆ·ä¹ æƒ¯ï¼Œå‘ç°ç”¨æˆ·ç‰¹åˆ«å–œæ¬¢ç”¨nameæ£€ç´¢</span><span class="token keyword">create</span> <span class="token keyword">index</span> idx_user_name <span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">-- å•å€¼ç´¢å¼•</span><span class="token keyword">create</span> <span class="token keyword">index</span> idx_user_nameEmail <span class="token keyword">on</span> <span class="token keyword">user</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">-- å¤šå€¼ç´¢å¼•</span><span class="token comment">-- æµ‹è¯•ï¼ˆæ’å…¥100ä¸‡æ¡æ•°æ®ï¼‰</span><span class="token keyword">delimiter</span> $$<span class="token keyword">create</span> <span class="token keyword">function</span> mock_data<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">returns</span> <span class="token keyword">int</span><span class="token keyword">begin</span><span class="token keyword">declare</span> num <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">100000</span><span class="token punctuation">;</span><span class="token keyword">declare</span> i <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">while</span> i<span class="token operator">&lt;</span>num <span class="token keyword">do</span><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>app_user<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>eamil<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>phone<span class="token punctuation">`</span><span class="token punctuation">,</span><span class="token punctuation">`</span>num<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token keyword">VALUES</span><span class="token punctuation">(</span>CONCAT<span class="token punctuation">(</span>ç”¨æˆ·<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'123123@qq.com'</span><span class="token punctuation">,</span>FLOOR<span class="token punctuation">(</span>RAND<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">set</span> i <span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">end</span> <span class="token keyword">while</span><span class="token punctuation">;</span><span class="token keyword">return</span> i<span class="token punctuation">;</span><span class="token keyword">end</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> app_user <span class="token keyword">where</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'ç”¨æˆ·9999'</span><span class="token punctuation">;</span>  <span class="token comment">-- æ…¢</span><span class="token keyword">create</span> <span class="token keyword">index</span> id_app_user_name <span class="token keyword">on</span> app_user<span class="token punctuation">(</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> app_user <span class="token keyword">where</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'ç”¨æˆ·9999'</span><span class="token punctuation">;</span>  <span class="token comment">-- å¿«</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¸¸è§„ç´¢å¼•ï¼ˆé»˜è®¤ï¼‰"><a href="#å¸¸è§„ç´¢å¼•ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="å¸¸è§„ç´¢å¼•ï¼ˆé»˜è®¤ï¼‰"></a>å¸¸è§„ç´¢å¼•ï¼ˆé»˜è®¤ï¼‰</h2><pre class="line-numbers language-none"><code class="language-none">INDEX / KEY<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="ä¸»é”®ç´¢å¼•"><a href="#ä¸»é”®ç´¢å¼•" class="headerlink" title="ä¸»é”®ç´¢å¼•"></a>ä¸»é”®ç´¢å¼•</h2><pre class="line-numbers language-none"><code class="language-none">PRIMARY KEYä½œç”¨ï¼šä¿è¯æ¯ä¸€è¡Œæ•°æ®éƒ½æ˜¯å”¯ä¸€çš„ï¼Œä¸å¯é‡å¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å”¯ä¸€ç´¢å¼•"><a href="#å”¯ä¸€ç´¢å¼•" class="headerlink" title="å”¯ä¸€ç´¢å¼•"></a>å”¯ä¸€ç´¢å¼•</h2><pre class="line-numbers language-none"><code class="language-none">UNIQUE KEYä½œç”¨ï¼šä¿è¯å€¼å”¯ä¸€ï¼Œé¿å…é‡å¤çš„åˆ—ï¼Œå¯é‡å¤<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å…¨æ–‡ç´¢å¼•"><a href="#å…¨æ–‡ç´¢å¼•" class="headerlink" title="å…¨æ–‡ç´¢å¼•"></a>å…¨æ–‡ç´¢å¼•</h2><pre class="line-numbers language-none"><code class="language-none">FullTextç‰¹å®šçš„æ•°æ®åº“æ‰æœ‰ å¿«é€Ÿå®šä½<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="å“ˆå¸Œç´¢å¼•"><a href="#å“ˆå¸Œç´¢å¼•" class="headerlink" title="å“ˆå¸Œç´¢å¼•"></a>å“ˆå¸Œç´¢å¼•</h2><h2 id="BTREEç´¢å¼•ï¼ˆB-æ ‘ï¼‰"><a href="#BTREEç´¢å¼•ï¼ˆB-æ ‘ï¼‰" class="headerlink" title="BTREEç´¢å¼•ï¼ˆB+æ ‘ï¼‰"></a>BTREEç´¢å¼•ï¼ˆB+æ ‘ï¼‰</h2><p>æ¦‚å¿µï¼šå¹³è¡¡å¤šå‰æœç´¢æ ‘</p><p>ä½œç”¨ï¼šç»„ç»‡ç£ç›˜ä¸­çš„æ•°æ®ï¼ˆç£ç›˜4Kï¼‰ï¼ŒB+æ ‘ä»¥é¡µä¸ºå•ä½ï¼Œä¸€é¡µ16Kã€‚</p><p>ç‰¹å¾ï¼š</p><ol><li>æ¯ä¸ªç´¢å¼•å¯¹åº”ä¸€ä¸ªB+æ•°ï¼Œéå¶å­èŠ‚ç‚¹å­˜å‚¨ç´¢å¼•é¡µï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®é¡µã€‚</li><li>æ¯è®¿é—®ä¸€é¡µï¼Œå°±æ˜¯ä¸€æ¬¡ç£ç›˜ IO ï¼ŒäºŒåˆ†æŸ¥æ‰¾ã€‚</li></ol><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210821165331.png"></p><h3 id="èšé›†ç´¢å¼•"><a href="#èšé›†ç´¢å¼•" class="headerlink" title="èšé›†ç´¢å¼•"></a>èšé›†ç´¢å¼•</h3><p>æ ¹æ®ä¸»é”®æ„é€ çš„ B+ æ ‘ï¼›å¶å­èŠ‚ç‚¹ä¸­å­˜æ”¾æ•°æ®é¡µï¼›æ•°æ®ä¹Ÿæ˜¯ç´¢å¼•çš„ä¸€éƒ¨åˆ†ã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- è¡¨ user ä¸­æœ‰ä¸¤ä¸ªå­—æ®µï¼šidã€name</span><span class="token keyword">SELECT</span><span class="token operator">*</span> <span class="token keyword">FROM</span><span class="token keyword">user</span><span class="token keyword">WHERE</span>id <span class="token operator">&gt;=</span> <span class="token number">18</span> <span class="token operator">AND</span> id <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210821165336.png"></p><h3 id="è¾…åŠ©ç´¢å¼•"><a href="#è¾…åŠ©ç´¢å¼•" class="headerlink" title="è¾…åŠ©ç´¢å¼•"></a>è¾…åŠ©ç´¢å¼•</h3><p>å¶å­èŠ‚ç‚¹ä¸åŒ…å«å…¨éƒ¨æ•°æ®ï¼›å¶å­èŠ‚ç‚¹ä¸­ï¼Œé™¤äº†ç”¨æ¥æ’åºçš„ Key è¿˜åŒ…å«ä¸€ä¸ª ä¹¦ç­¾ï¼ˆä¸»é”®ï¼‰ï¼Œå…¶å­˜å‚¨èšé›†ç´¢å¼•çš„ Keyã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment">-- æŸä¸ªè¡¨åŒ…å« id name lockyNum; idæ˜¯ä¸»é”®ï¼ŒlockyNumå­˜å‚¨è¾…åŠ©ç´¢å¼•;</span><span class="token keyword">SELECT</span><span class="token operator">*</span> <span class="token keyword">FROM</span><span class="token keyword">user</span><span class="token keyword">WHERE</span>lockyNum <span class="token operator">=</span> <span class="token number">33</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210821165357.png"></p><h2 id="RTREEç´¢å¼•"><a href="#RTREEç´¢å¼•" class="headerlink" title="RTREEç´¢å¼•"></a>RTREEç´¢å¼•</h2>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL çº¦æŸ</title>
      <link href="/2020/05/06/mysql-yue-shu/"/>
      <url>/2020/05/06/mysql-yue-shu/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>CONSTRAINTï¼Œå¾€è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå¯¹æ•°æ®çš„çº¦æŸã€‚</p><h2 id="éç©º"><a href="#éç©º" class="headerlink" title="éç©º"></a>éç©º</h2><p>NULLï¼šè¡¨ç¤º UNKNOWNï¼ˆæœªçŸ¥ï¼‰ï¼Œä¸è¡¨ç¤º â€œ â€œ(ç©ºå­—ç¬¦ä¸²)ã€‚å¯¹ NULL è¿™ä¸ªå€¼çš„ä»»ä½•æ¯”è¾ƒéƒ½ä¼šç”Ÿäº§ä¸€ä¸ª NULL å€¼ã€‚ä¸èƒ½æŠŠä»»ä½•å€¼ä¸ä¸€ä¸ª NULL å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶åœ¨é€»è¾‘ä¸Šå¸Œæœ›è·å¾—ä¸€ä¸ªç­”æ¡ˆã€‚ä¸€èˆ¬ä½¿ç”¨ IS NULL æ¥è¿›è¡Œ NULL åˆ¤æ–­ã€‚</p><p>NOT NULL ï¼šé˜²æ­¢å¡«ç©ºå€¼ã€‚</p><h2 id="è¶…é”®-å€™é€‰é”®-ä¸»é”®-å¤–é”®"><a href="#è¶…é”®-å€™é€‰é”®-ä¸»é”®-å¤–é”®" class="headerlink" title="è¶…é”® å€™é€‰é”® ä¸»é”® å¤–é”®"></a>è¶…é”® å€™é€‰é”® ä¸»é”® å¤–é”®</h2><table><thead><tr><th>MySQL é”®</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>è¶…é”®</td><td>å”¯ä¸€æ ‡è¯†å…ƒç»„çš„å±æ€§é›†</td></tr><tr><td>å€™é€‰é”®</td><td>ä¸å«é¢å¤–å±æ€§çš„è¶…é”®</td></tr><tr><td>ä¸»é”®</td><td>ç”¨æˆ·ä»å€™é€‰é”®ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºè¯¥å…ƒç»„çš„å”¯ä¸€æ ‡è¯†</td></tr><tr><td>å¤–é”®</td><td>å¦‚æœå…³ç³»æ¨¡å¼ R ä¸­å±æ€§ K æ˜¯å…¶å®ƒæ¨¡å¼çš„ä¸»é”®ï¼Œé‚£ä¹ˆ K åœ¨æ¨¡å¼ R ä¸­ç§°ä¸ºå¤–é”®</td></tr></tbody></table><h3 id="åŒ…å«å…³ç³»å›¾"><a href="#åŒ…å«å…³ç³»å›¾" class="headerlink" title="åŒ…å«å…³ç³»å›¾"></a>åŒ…å«å…³ç³»å›¾</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816103142.png"></p><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><table><thead><tr><th>å­¦å·</th><th>å§“å</th><th>æ€§åˆ«</th><th>å¹´é¾„</th><th>ç³»åˆ«</th><th>ä¸“ä¸š</th></tr></thead><tbody><tr><td>20210102</td><td>å°æ˜</td><td>ç”·</td><td>18</td><td>ç‰©ç”µç³»</td><td>ç‰©ç†</td></tr><tr><td>20210103</td><td>å°çº¢</td><td>å¥³</td><td>19</td><td>éŸ³ä¹ç³»</td><td>éŸ³ä¹</td></tr></tbody></table><p><strong>è¶…é”®</strong></p><p>â€‹    å®ä½“ç±»å…ƒç»„çš„å”¯ä¸€æ ‡è¯†ï¼Œå¦‚(å­¦å·)ã€æˆ–è€…æŠŠå®ƒå’Œé¢å¤–å±æ€§ç»„åˆèµ·æ¥ï¼Œå¦‚ï¼š(å­¦å·ï¼Œæ€§åˆ«)ã€‚</p><p><strong>å€™é€‰é”®</strong></p><p>â€‹     å®ä½“ç±»å…ƒç»„çš„å”¯ä¸€æ ‡è¯†ï¼Œå­¦å·æ˜¯å€™é€‰é”®ã€‚</p><p><strong>ä¸»é”®</strong></p><p>â€‹    ç”¨æˆ·ä»å€™é€‰é”®ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºè¯¥å®ä½“ç±»å…ƒç»„çš„å”¯ä¸€æ ‡è¯†ã€‚</p><p><strong>å¤–é”®</strong></p><p>â€‹    å¤–é”®ç›¸å¯¹äºä¸»é”®ï¼Œå¦‚åœ¨å­¦ç”Ÿè¡¨å’Œæˆç»©è¡¨ä¸­éƒ½æœ‰å­¦å·å­—æ®µï¼Œå› æ­¤å­¦å·æ˜¯å­¦ç”Ÿè¡¨çš„ä¸»é”®ï¼Œä¹Ÿæ˜¯æˆç»©è¡¨çš„å¤–é”®ã€‚</p><h2 id="ç‰©ç†å¤–é”®"><a href="#ç‰©ç†å¤–é”®" class="headerlink" title="ç‰©ç†å¤–é”®"></a>ç‰©ç†å¤–é”®</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span>è§„åˆ™<span class="token number">1.</span>ä¸»è¡¨æ˜¯å­˜åœ¨äºæ•°æ®åº“ï¼Œæˆ–æ˜¯å½“å‰æ­£åœ¨åˆ›å»ºçš„è¡¨ï¼ˆä¸»ã€ä»è¡¨æ˜¯åŒä¸€ä¸ªè¡¨ï¼Œç§°ä¸ºè‡ªå‚ç…§è¡¨ï¼Œç»“æ„ç§°ä¸ºè‡ªå‚ç…§å®Œæ•´æ€§ï¼‰<span class="token number">2.</span>ä¸»è¡¨å¿…é¡»å®šä¹‰ä¸»é”®ï¼Œä¸»é”®ä¸èƒ½åŒ…å«ç©ºå€¼ï¼Œä½†å…è®¸åœ¨å¤–é”®ä¸­å‡ºç°ç©ºå€¼ã€‚<span class="token number">3.</span>åœ¨ä¸»è¡¨çš„è¡¨ååæŒ‡å®šåˆ—åæˆ–åˆ—åçš„ç»„åˆã€‚è¿™ä¸ªåˆ—æˆ–åˆ—çš„ç»„åˆå¿…é¡»æ˜¯ä¸»è¡¨çš„ä¸»é”®æˆ–å”¯ä¸€æ€§é”®ã€‚<span class="token number">4.</span>å¤–é”®ä¸­åˆ—çš„æ•°ç›®ã€æ•°æ®ç±»å‹å¿…é¡»å’Œä¸»è¡¨çš„ä¸»é”®ä¸­åˆ—çš„æ•°ç›®ã€æ•°æ®ç±»å‹ç›¸åŒã€‚ä½œç”¨é˜²æ­¢å¼•å…¥åˆ«äººçš„åˆ— æ•°æ®ä¸æ­£ç¡®<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ–¹å¼ 1</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">1.</span> å®šä¹‰å¤–é”®<span class="token keyword">KEY</span><span class="token number">2.</span> ç»™å¤–é”®æ·»åŠ çº¦æŸå’Œå¼•ç”¨<span class="token keyword">KEY</span> <span class="token punctuation">`</span>FK_gradedid<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">CONSTRAINT</span> <span class="token punctuation">`</span>FK_gradedid<span class="token punctuation">`</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token punctuation">`</span>grade<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>æ–¹å¼ 2</strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>student<span class="token punctuation">`</span><span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token punctuation">`</span>FK_gradedid<span class="token punctuation">`</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token punctuation">`</span>grade<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>gradeid<span class="token punctuation">`</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816100910.png"></p><pre class="line-numbers language-none"><code class="language-none">CASCADEçº§è”åˆ é™¤ï¼Œä¸»è¡¨æ•°æ®è¢«åˆ ï¼Œå­è¡¨å¯¹åº”æ•°æ®ä¹Ÿè¢«åˆ NO ACTION / RESTRICTæ‹’ç»åˆ é™¤SET NULLç½®ç©ºï¼Œä¸»è¡¨æ•°æ®è¢«åˆ ï¼Œå­è¡¨å¯¹åº”æ•°æ®ç½®ä¸ºNull<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è‡ªå¢"><a href="#è‡ªå¢" class="headerlink" title="è‡ªå¢"></a>è‡ªå¢</h2><h3 id="æœ€å¤§å€¼"><a href="#æœ€å¤§å€¼" class="headerlink" title="æœ€å¤§å€¼"></a>æœ€å¤§å€¼</h3><p>è¡¨ä¸­çš„åˆ—è®¾ç½®ä¸º AUTO INCREMENT æ—¶ï¼Œå¦‚æœè¾¾åˆ°æœ€å¤§å€¼ï¼Œä¼šåœæ­¢é€’å¢ï¼Œä»»ä½•æ’å…¥éƒ½ä¼šæŠ¥é”™ï¼Œå› ä¸ºå¯†é’¥å·²è¢«ä½¿ç”¨ã€‚</p><h3 id="è‡ªå¢å°¾å€¼"><a href="#è‡ªå¢å°¾å€¼" class="headerlink" title="è‡ªå¢å°¾å€¼"></a>è‡ªå¢å°¾å€¼</h3><p>è¿”å›ç”±è‡ªå¢åˆ†é…çš„æœ€åä¸€ä¸ªå€¼ï¼Œä¸éœ€è¦æŒ‡æ˜è¡¨åã€‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> LAST_INSERT_ID<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816110520.png"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL æ•°æ®ç±»å‹</title>
      <link href="/2020/05/05/mysql-shu-ju-lei-xing/"/>
      <url>/2020/05/05/mysql-shu-ju-lei-xing/</url>
      
        <content type="html"><![CDATA[<h2 id="1-æ•°å€¼"><a href="#1-æ•°å€¼" class="headerlink" title="1. æ•°å€¼"></a>1. æ•°å€¼</h2><ul><li><p>tinyint                    1å­—èŠ‚</p></li><li><p>smallint                  2å­—èŠ‚</p></li><li><p>mediumint              3å­—èŠ‚</p></li><li><p><strong>int          æ ‡å‡†æ•´æ•°   4å­—èŠ‚</strong></p></li><li><p>bigint                       8å­—èŠ‚</p></li><li><p>float        æµ®ç‚¹æ•°      4å­—èŠ‚</p></li><li><p>double    æµ®ç‚¹æ•°      8å­—èŠ‚</p></li><li><p><strong>decimal  å­—ç¬¦ä¸²å½¢å¼æµ®ç‚¹æ•°ï¼ˆé‡‘èè®¡ç®—æ—¶ä½¿ç”¨ï¼‰</strong></p><p>salary DECIMAL(9,2)ï¼š9 ä»£è¡¨æ€»ä½æ•°ï¼Œè€Œ 2 ä»£è¡¨å°æ•°ç‚¹ä½æ•°ï¼ŒèŒƒå›´ - 9999999.99 åˆ° 9999999.99ã€‚</p></li></ul><h2 id="2-å­—ç¬¦ä¸²"><a href="#2-å­—ç¬¦ä¸²" class="headerlink" title="2. å­—ç¬¦ä¸²"></a>2. å­—ç¬¦ä¸²</h2><ul><li><strong>char</strong>       <strong>å›ºå®šå­—ç¬¦ä¸²   0~255</strong></li><li><strong>varchar  å¯å˜å­—ç¬¦ä¸²   0~65535</strong></li><li>tinytext                        2^8-1</li><li><strong>text         å¤§é‡å­—ç¬¦ä¸²             2^16-1</strong></li><li>blob         å¤§é‡å­—ç¬¦ä¸² + äºŒè¿›åˆ¶</li><li>enum      æšä¸¾</li><li>set          é›†åˆ</li></ul><blockquote><p>char å’Œ varchar çš„åŒºåˆ«ï¼š</p><ol><li>æ¦‚å¿µï¼šchar æ˜¯å›ºå®šå­—ç¬¦ä¸²ï¼Œvarchar æ˜¯å¯å˜å­—ç¬¦ä¸²ï¼›</li><li>å­˜å‚¨ï¼šå­˜å‚¨ char æ—¶ä¼šç”¨ç©ºæ ¼å¡«æ»¡å£°æ˜çš„é•¿åº¦ï¼›</li><li>æ£€ç´¢ï¼šæ£€ç´¢ char æ—¶ä¼šåˆ é™¤ç©ºæ ¼ï¼›</li></ol><p>text å’Œ blob çš„åŒºåˆ«ï¼š</p><ol><li>æ¦‚å¿µï¼štext æ˜¯ä¸€ä¸ªä¸åŒºåˆ†å¤§å°å†™çš„ blobï¼›</li><li>å­˜å‚¨ï¼šblog ä¸ä»…èƒ½å­˜å‚¨å¤§é‡å­—ç¬¦ä¸²ï¼Œè€Œä¸”è¿˜èƒ½å­˜å‚¨äºŒè¿›åˆ¶æ•°æ®ï¼›</li><li>æ’åºå’Œæ¯”è¾ƒï¼šblog åœ¨æ’åºå’Œæ¯”è¾ƒæ—¶åŒºåˆ†å¤§å°å†™ï¼›</li></ol></blockquote><h2 id="3-æ—¥æœŸæ—¶é—´"><a href="#3-æ—¥æœŸæ—¶é—´" class="headerlink" title="3. æ—¥æœŸæ—¶é—´"></a>3. æ—¥æœŸæ—¶é—´</h2><ul><li><p>date            YYYY-MM-DD</p></li><li><p>time            HH:mm:ss</p></li><li><p><strong>datetime    YYYY-MM-DD HH:mm:ss</strong></p></li><li><p><strong>timestamp  æ—¶é—´æˆ³</strong></p><p>ä½œç”¨ï¼šæ¯å½“è¡Œè¢«æ›´æ”¹æ—¶ï¼Œå°†ä¼šè·å–å½“å‰æ—¶é—´æˆ³ã€‚</p><blockquote><p>Unix å’Œ MySQL æ—¶é—´æˆ³ç›¸äº’è½¬æ¢</p><pre><code>MySQL æ—¶é—´æˆ³è½¬ä¸º Unix æ—¶é—´æˆ³ï¼šUNIX_TIMESTAMPUnix æ—¶é—´æˆ³è½¬ä¸º MySQL æ—¶é—´æˆ³ï¼šFROM_UNIXTIME</code></pre></blockquote></li><li><p>year</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL äº‹åŠ¡</title>
      <link href="/2020/05/04/mysql-shi-wu/"/>
      <url>/2020/05/04/mysql-shi-wu/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Transationï¼Œå°†ä¸€ç»„ SQL æ”¾åœ¨ä¸€ä¸ªæ‰¹æ¬¡å»æ‰§è¡Œï¼Œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ã€‚</p><blockquote><p>MySQL é»˜è®¤è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œä½†å¦‚æœè¡¨ç±»å‹æ˜¯ä½¿ç”¨ InnoDB æˆ– BDB çš„è¯ï¼Œå°±å¯ä»¥ä½¿ç”¨äº‹åŠ¡å¤„ç†ï¼Œå…ˆå…³é—­äº‹åŠ¡è‡ªåŠ¨æäº¤ï¼Œç„¶åæ‰‹åŠ¨æäº¤ã€å›æ»šã€å­˜æ¡£äº‹åŠ¡ã€‚</p></blockquote><h2 id="SQL-æµ‹è¯•"><a href="#SQL-æµ‹è¯•" class="headerlink" title="SQL æµ‹è¯•"></a>SQL æµ‹è¯•</h2><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">set</span> autocommit <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">-- å…³é—­äº‹åŠ¡è‡ªåŠ¨æäº¤ï¼ˆé»˜è®¤å¼€å¯ï¼‰</span><span class="token keyword">start</span> transation     <span class="token comment">-- å¼€å¯ä¸€ç»„äº‹åŠ¡</span>    <span class="token keyword">insert</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token keyword">insert</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token keyword">rollback</span>             <span class="token comment">-- å›æ»š</span><span class="token keyword">commit</span>               <span class="token comment">-- æäº¤ï¼ˆæäº¤å®Œå°±ä¸èƒ½å›æ»šäº†ï¼ŒæŒä¹…åŒ–ï¼‰</span><span class="token keyword">set</span> autocommit <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">-- å¼€å¯äº‹åŠ¡è‡ªåŠ¨æäº¤ï¼ˆé»˜è®¤å¼€å¯ï¼‰</span><span class="token keyword">savepoint</span>             <span class="token comment">-- å­˜æ¡£ç‚¹</span><span class="token keyword">rollback</span> <span class="token keyword">to</span> <span class="token keyword">savepoint</span> <span class="token comment">-- å›æ»šåˆ°å­˜æ¡£ç‚¹</span><span class="token keyword">release</span> <span class="token keyword">savepoint</span>     <span class="token comment">-- åˆ é™¤å­˜æ¡£ç‚¹</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h2><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¸€è‡´ Consistencyï¼šä¸€ä¸ªäº‹åŠ¡çš„æ“ä½œå‰åçŠ¶æ€ä¸€è‡´ ( æœ€ç»ˆä¸€è‡´æ€§ï¼šæ€»æ•°ä¸å˜ ä¸è¶…è¿‡1000) ã€‚<br><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> éš”ç¦» Isolation ï¼šå¤šä¸ªç”¨æˆ·å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œæ•°æ®åº“ä¸ºæ¯ä¸ªç”¨æˆ·å¼€å¯å„è‡ªçš„äº‹åŠ¡ï¼Œä½¿å…¶ç›¸äº’éš”ç¦»ã€äº’ä¸å½±å“ã€‚<br><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æŒä¹… Durability ï¼šä¸€ä¸ªäº‹åŠ¡æäº¤åï¼Œæ•°æ®å°±ä¼šè¢«æŒä¹…åŒ–åˆ°æ•°æ®åº“ï¼Œä¸å› å¤–ç•ŒåŸå› ï¼ˆå®•æœºæ–­ç”µï¼‰ä¸¢å¤±æ•°æ®ã€‚<br><span class="github-emoji"><span>4âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0034-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åŸå­ Atomicity ï¼šä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚</p><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç†è§£ï¼šä¸€ä¸ªæ± å­ï¼</p><p><span class="github-emoji"><span>ğŸ‹</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f40b.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ —å­ï¼š</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812212146.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812212527.png"></p><h2 id="äº‹åŠ¡å¹¶å‘é—®é¢˜"><a href="#äº‹åŠ¡å¹¶å‘é—®é¢˜" class="headerlink" title="äº‹åŠ¡å¹¶å‘é—®é¢˜"></a>äº‹åŠ¡å¹¶å‘é—®é¢˜</h2><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ›´æ–°ä¸¢å¤±</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°è¦†ç›–äº†å¦ä¸€ä¸ªäº‹åŠ¡çš„æ›´æ–°ã€‚</p><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è„è¯»</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸€ä¸ªäº‹åŠ¡è¯»å–åˆ°åˆ°äº†å¦ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ®ã€‚</p><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¸å¯é‡å¤è¯»</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­é‡å¤è¯»å–åŒä¸€æ•°æ®æ—¶ï¼Œæ•°æ®ä¸ä¸€è‡´ï¼ˆä¸ä¸€å®šæ˜¯é”™è¯¯ï¼Œå¯èƒ½æ˜¯åœºåˆä¸å¯¹ï¼‰ â€“ è¿èƒŒä¸€è‡´æ€§åŸåˆ™ã€‚</p><p><span class="github-emoji"><span>4âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0034-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å¹»è¯»</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ä¸€ä¸ªäº‹åŠ¡å†…è¯»å–åˆ°äº†åˆ«çš„äº‹åŠ¡æ’å…¥çš„æ•°æ®ï¼Œå¯¼è‡´å‰åæ•°æ®ä¸ä¸€è‡´ï¼ˆæ•°æ®å˜å¤šäº† ä¸€èˆ¬æ˜¯å½±å“è¡Œ å¤šäº†ä¸€è¡Œï¼‰</p><h2 id="äº‹åŠ¡éš”ç¦»çº§åˆ«-InnoDB"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«-InnoDB" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ« InnoDB"></a>äº‹åŠ¡éš”ç¦»çº§åˆ« InnoDB</h2><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½œç”¨ï¼šè§£å†³äº‹åŠ¡å¹¶å‘é—®é¢˜ã€‚</p><h3 id="äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><table><thead><tr><th>äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆç”±ä½åˆ°é«˜ï¼‰</th><th>è„è¯»</th><th>ä¸å¯é‡å¤åº¦</th><th>å¹»è¯»</th></tr></thead><tbody><tr><td>READ_UNCOMMITTED è¯»æœªæäº¤</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>READ_COMMITTED      è¯»å·²æäº¤</td><td>Ã—</td><td>âˆš</td><td>âˆš</td></tr><tr><td>REPEATABLE_READ     å¯é‡å¤è¯»ï¼ˆé»˜è®¤ï¼‰</td><td>Ã—</td><td>Ã—</td><td>âˆš</td></tr><tr><td>SERIALIZABLE               å¯ä¸²è¡ŒåŒ–</td><td>Ã—</td><td>Ã—</td><td>Ã—</td></tr></tbody></table><p>è¯»æœªæäº¤ï¼Œä¸èƒ½é¿å…æ‰€æœ‰é—®é¢˜ï¼›</p><p>è¯»å·²æäº¤ï¼Œé¿å…äº†è„è¯»ï¼›</p><p>å¯é‡å¤è¯»ï¼Œé¿å…äº†è„è¯»ã€ä¸å¯é‡å¤è¯»ï¼›</p><p>å¯ä¸²è¡ŒåŒ–ï¼Œé¿å…æ‰€æœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ç”¨ï¼Œå› ä¸ºè¿™æ ·ä¼šè®© SQL æ’é˜Ÿï¼Œå³ä¸èƒ½å¹¶å‘ï¼Œä¼šé™ä½æ€§èƒ½ã€‚</p><h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ SELECT @@tx_isolation  <span class="token comment"># æŸ¥çœ‹ MySQL é»˜è®¤éš”ç¦»çº§åˆ«</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="äº‹åŠ¡ä¼ æ’­æœºåˆ¶"><a href="#äº‹åŠ¡ä¼ æ’­æœºåˆ¶" class="headerlink" title="äº‹åŠ¡ä¼ æ’­æœºåˆ¶"></a>äº‹åŠ¡ä¼ æ’­æœºåˆ¶</h2><pre class="line-numbers language-none"><code class="language-none">REQUIRE   å¥½ç”·äºº æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡å°±è‡ªå·±åˆ›å»ºSUPPORTS  æ‡’ç”·äºº æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±ä¸åˆ›å»ºMANDATORY æ¸£ç”·   æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ²¡æœ‰å°±æŠ›å¼‚å¸¸REQUIRES_NEW   æœ‰è¦æ±‚çš„ç”·äºº å³ä½¿æœ‰äº‹åŠ¡ï¼Œä¹Ÿè¦è‡ªå·±åˆ›å»ºNOT_SUPPORTED  è¦å‡è‚¥çš„ç”·äºº æŒ‚èµ·å½“å‰äº‹åŠ¡ï¼Œæ–°å»ºè¿æ¥æ‰§è¡Œè‡ªå·±çš„äº‹åŠ¡è‡ªåŠ¨æäº¤NEVER          æœ‰æ€ªç™–çš„ç”·äºº ä»ä¸æ‰§è¡Œäº‹åŠ¡ï¼ŒæŠ›å¼‚å¸¸æŒ‚èµ·ï¼šåœ¨åŒä¸€çº¿ç¨‹å†…ï¼Œé‡‡ç”¨ä¸åŒçš„è¿æ¥ï¼Œç¬¬ä¸€ä¸ªè¿æ¥æœ‰äº‹åŠ¡ï¼Œç¬¬äºŒä¸ªè¿æ¥æ²¡æœ‰äº‹åŠ¡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812214040.png"></p><pre class="line-numbers language-none"><code class="language-none">ä¸€æ¬¡äº‹åŠ¡ = æ‰“å¼€è¿æ¥ + é€šè¿‡AOPåˆ‡å…¥äº‹åŠ¡ + æäº¤addAccount  REQUIREcreateUser  REQUIRE<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812214046.png"></p><pre class="line-numbers language-none"><code class="language-none">ä¸€æ¬¡äº‹åŠ¡ = æ‰“å¼€è¿æ¥ + é€šè¿‡AOPåˆ‡å…¥äº‹åŠ¡ + æäº¤addAccount  REQUIREcreateUser  NOT_SUPPORTED  AOPåˆ‡å…¥äº‹åŠ¡å¤±æ•ˆ æ²¡æœ‰é€šè¿‡ä»£ç†å¯¹è±¡æ‰§è¡Œç›®æ ‡å¯¹è±¡è€Œç›´æ¥è°ƒç”¨æ¨¡ç›®æ ‡å¯¹è±¡æ–¹æ³•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812214049.png"></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL å­˜å‚¨å¼•æ“</title>
      <link href="/2020/05/03/mysql-cun-chu-yin-qing/"/>
      <url>/2020/05/03/mysql-cun-chu-yin-qing/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>å­˜å‚¨å¼•æ“ / è¡¨æ ¼ç±»å‹</p><h2 id="ç§ç±»"><a href="#ç§ç±»" class="headerlink" title="ç§ç±»"></a>ç§ç±»</h2><p>INNODBã€MyISAMã€ISAMã€Heapã€Merge</p><p>XtraDBï¼šé«˜æ€§èƒ½å­˜å‚¨å¼•æ“ï¼Œæ›¿ä»£ InnoDBï¼Œå¯ç”¨äºéœ€è¦æ›´é«˜æ€§èƒ½çš„ç¯å¢ƒã€‚</p><h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><ul><li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-limits.html">innoDBé™åˆ¶çš„å®˜æ–¹æ–‡æ¡£: https://dev.mysql.com/doc/refman/8.0/en/innodb-limits.html</a></p></li><li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html">myisamé™åˆ¶çš„å®˜æ–¹æ–‡æ¡£: https://dev.mysql.com/doc/refman/8.0/en/myisam-storage-engine.html</a></p></li><li><p>innoDB</p><p>æœ€å¤š 1017 åˆ—, æœ€å¤š 64 ä¸ªäºŒçº§ç´¢å¼•, å•ä¸ªç´¢å¼•æœ€å¤šåŒ…å« 16 åˆ—, ç´¢å¼•æœ€å¤§é•¿åº¦ 767 å­—èŠ‚ï¼Œè¡Œå¤§å°æœ€å¤§ 65536 å­—èŠ‚</p></li><li><p>mysiam</p><p>æœ€å¤š 4096 åˆ—, æœ€å¤š 64 ä¸ªäºŒçº§ç´¢å¼•, å•ä¸ªç´¢å¼•æœ€å¤šåŒ…å« 16 åˆ—, ç´¢å¼•æœ€å¤§é•¿åº¦ 1000 å­—èŠ‚, è¡Œå¤§å°æœ€å¤§ 65536 å­—èŠ‚</p></li></ul><h2 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ show engines<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812205711.png"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ show variables like <span class="token string">'%storage_engine%'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812205731.png"></p><h2 id="InnoDB-å’Œ-MyISAM-çš„åŒºåˆ«"><a href="#InnoDB-å’Œ-MyISAM-çš„åŒºåˆ«" class="headerlink" title="InnoDB å’Œ MyISAM çš„åŒºåˆ«"></a>InnoDB å’Œ MyISAM çš„åŒºåˆ«</h2><table><thead><tr><th></th><th>InnoDBï¼ˆé»˜è®¤ï¼‰</th><th>MyISAM</th></tr></thead><tbody><tr><td>å­˜å‚¨ï¼ˆTBï¼‰</td><td>64</td><td>256</td></tr><tr><td><strong>å¤–é”®</strong></td><td>âˆš</td><td></td></tr><tr><td><strong>äº‹åŠ¡</strong></td><td>âˆš</td><td></td></tr><tr><td>ç´¢å¼•</td><td>âˆš</td><td>âˆš</td></tr><tr><td>ç¼“å­˜</td><td>ç¼“å­˜ç´¢å¼• çœŸå®æ•°æ®ï¼ˆå¯¹å†…å­˜è¦æ±‚é«˜ï¼‰</td><td>ç¼“å­˜ç´¢å¼•</td></tr><tr><td><strong>é”é¢—ç²’</strong></td><td>è¡Œé”<br>æ¯æ¬¡æ“ä½œæ˜¯å¯¹ä¸€è¡ŒåŠ é”ï¼Œé€‚åˆé«˜å¹¶å‘</td><td>è¡¨é”<br>æ¯æ¬¡æ“ä½œæ˜¯å¯¹æ•´å¼ è¡¨åŠ é”</td></tr><tr><td>è¡¨ç©ºé—´</td><td>å¤§</td><td>å°</td></tr><tr><td>ä¼˜ç‚¹</td><td>äº‹åŠ¡<br>ï¼ˆé€‚åˆé¢‘ç¹ä¿®æ”¹ã€å®‰å…¨æ€§è¦æ±‚é«˜çš„åº”ç”¨ï¼‰</td><td>æ€§èƒ½ï¼ˆèŠ‚çº¦ç©ºé—´ é€Ÿåº¦å¿«ï¼‰<br>ï¼ˆé€‚åˆä»¥æŸ¥è¯¢ã€æ’å…¥ä¸ºä¸»çš„åº”ç”¨ï¼‰</td></tr><tr><td>ç»„æˆæ–‡ä»¶</td><td>*.frm è¡¨ç»“æ„æ–‡ä»¶ ibdata1</td><td>* .frm è¡¨ç»“æ„æ–‡ä»¶ï¼ˆå›¾ä¹¦é¦†æ¶å­ï¼‰<br> * .MYD æ•°æ®æ–‡ä»¶ï¼ˆMYData å›¾ä¹¦ï¼‰<br> * .MYI ç´¢å¼•æ–‡ä»¶ï¼ˆMYIndex å›¾ä¹¦ç´¢å¼•ï¼‰</td></tr></tbody></table><p>InnoDBï¼š</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;æ”¯æŒäº‹åŠ¡ï¼›å¤–é”®ï¼›<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;é”é¢—ç²’ä¸ºè¡Œé”ï¼Œæ¯æ¬¡æ“ä½œæ˜¯å¯¹ä¸€è¡ŒåŠ é”ï¼Œé€‚åˆé«˜å¹¶å‘ï¼›<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç»„æˆæ–‡ä»¶åªæœ‰è¡¨ç»“æ„æ–‡ä»¶ï¼›</p><p>MyISAMï¼š</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ä¸æ”¯æŒäº‹åŠ¡ï¼Œä½†æ¯æ¬¡æŸ¥è¯¢éƒ½æ˜¯åŸå­çš„ï¼›<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç´¢é¢—ç²’ä¸ºè¡¨é”ï¼Œæ¯æ¬¡æ“ä½œæ˜¯å¯¹æ•´å¼ è¡¨åŠ é”ï¼›<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ç»„æˆæ–‡ä»¶æœ‰ 3 ç§ï¼Œè¡¨ç»“æ„æ–‡ä»¶ã€æ•°æ®æ–‡ä»¶ã€ç´¢å¼•æ–‡ä»¶ï¼›</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Swagger å¿«é€Ÿå…¥é—¨</title>
      <link href="/2020/05/02/swagger-kuai-su-ru-men/"/>
      <url>/2020/05/02/swagger-kuai-su-ru-men/</url>
      
        <content type="html"><![CDATA[<h2 id="åŸç”Ÿ-UI"><a href="#åŸç”Ÿ-UI" class="headerlink" title="åŸç”Ÿ UI"></a>åŸç”Ÿ UI</h2><p>æˆ‘ä»¬å°†ä½¿ç”¨ SpringBoot é›†æˆ Swagger 2 ï¼Œå¿«é€Ÿä½“éªŒã€‚</p><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>å¯¼å…¥ Swager 2 ä¾èµ–ï¼š</p><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>io.springfox<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>springfox-swagger-ui<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åˆ›å»º Swagger 2 é…ç½®æ–‡ä»¶</p><p>å¼€å¯ Swagger 2 æ³¨è§£ï¼š@EnableSwagger2 ï¼Œå› ä¸ºè®¾ç½®äº†åˆ†ç¯å¢ƒï¼Œæ‰€æœ‰ Swagger 2 åªåœ¨é¡¹ç›®çš„æµ‹è¯•ç¯å¢ƒä¸­ç”Ÿæ•ˆã€‚</p><p><code>application.yaml</code></p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span><span class="token comment"># å¤šç¯å¢ƒ è‡ªå®šä¹‰æ¿€æ´»æŒ‡å®šé…ç½®æ–‡ä»¶</span><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Swagger2Config.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>env<span class="token punctuation">.</span></span><span class="token class-name">Environment</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span>env<span class="token punctuation">.</span></span><span class="token class-name">Profiles</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">RequestHandlerSelectors</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ApiInfo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">Contact</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">DocumentationType</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>web<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span></span><span class="token class-name">Docket</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>swagger2<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">EnableSwagger2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableSwagger2</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SwaggerConfig</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">docket</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ†ç¯å¢ƒå¯ç”¨Swagger2</span>        <span class="token class-name">Profiles</span> profiles <span class="token operator">=</span> <span class="token class-name">Profiles</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">"dev"</span><span class="token punctuation">,</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">acceptsProfiles</span><span class="token punctuation">(</span>profiles<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>                <span class="token comment">// æ˜¯å¦å¯ç”¨Swagger2</span>                <span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// APIä¿¡æ¯</span>                <span class="token comment">// æ¥å£æ‰«æè·¯å¾„</span>                <span class="token comment">//  basePackage() æ‰«ææŒ‡å®šåŒ…</span>                <span class="token comment">//  any()  æ‰«ææ‰€æœ‰</span>                <span class="token comment">//  none()  éƒ½ä¸æ‰«æ</span>                <span class="token comment">//  withClassAnnotation()  æ‰«æç±»ä¸Šçš„æ³¨è§£ Controller.class</span>                <span class="token comment">//  withMethodAnnotation()  æ‰«ææ–¹æ³•ä¸Šçš„æ³¨è§£ GetMapping.class</span>                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">apis</span><span class="token punctuation">(</span><span class="token class-name">RequestHandlerSelectors</span><span class="token punctuation">.</span><span class="token function">basePackage</span><span class="token punctuation">(</span><span class="token string">"com.revelvy.controller"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token comment">// æ¥å£è¿‡æ»¤è·¯å¾„ï¼ˆæ’é™¤ï¼‰</span><span class="token comment">//                .paths(PathSelectors.ant("/revelvy/**"))</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token class-name">ApiInfo</span> <span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfo</span><span class="token punctuation">(</span>                <span class="token string">"æˆ‘çš„APIæ–‡æ¡£"</span><span class="token punctuation">,</span>                <span class="token string">"æˆ‘æ˜¯APIæ–‡æ¡£çš„æè¿°"</span><span class="token punctuation">,</span>                <span class="token string">"v1.0"</span><span class="token punctuation">,</span>                <span class="token string">"https://www.revelvy.cn"</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span>                        <span class="token string">"Revelvy"</span><span class="token punctuation">,</span>                        <span class="token string">"https://www.blog.revelvy.cn"</span><span class="token punctuation">,</span>                        <span class="token string">"xxx@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token string">"Apache 2.0"</span><span class="token punctuation">,</span>                <span class="token string">"http://www.apache.org/licenses/LICENSE-2.0"</span><span class="token punctuation">,</span>                <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> â€‹â€‹è‡ªå®šä¹‰ API æ–‡æ¡£æ³¨é‡Šï¼ˆå¯é€‰ï¼‰</p><table><thead><tr><th>API æ–‡æ¡£æ³¨é‡Š</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>@ApiModel()</td><td>å®ä½“ç±»æ¨¡å‹</td></tr><tr><td>@ApiModelProperty()</td><td>å®ä½“ç±»æ¨¡å‹å­—æ®µ</td></tr><tr><td>@ApiOperation()</td><td>æ¥å£æ–¹æ³•</td></tr><tr><td>@ApiParam()</td><td>æ¥å£æ–¹æ³•å½¢å‚</td></tr></tbody></table><p><code>User.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·å®ä½“ç±»"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·ID"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å¯åŠ¨</p><p>æ­¤æ—¶ï¼Œå¯åŠ¨ Spring Boot å·¥ç¨‹ï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:8080/swagger-ui.html%E3%80%82">http://localhost:8080/swagger-ui.htmlã€‚</a></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210807183229.png"></p><h2 id="ç¬¬ä¸‰æ–¹-UI"><a href="#ç¬¬ä¸‰æ–¹-UI" class="headerlink" title="ç¬¬ä¸‰æ–¹ UI"></a>ç¬¬ä¸‰æ–¹ UI</h2><p>Knife4j æ˜¯ä¸º Java MVC æ¡†æ¶é›†æˆ Swagger ç”ŸæˆApiæ–‡æ¡£çš„å¢å¼ºè§£å†³æ–¹æ¡ˆï¼Œå‰èº«æ˜¯swagger-bootstrap-uiï¼ŒåŠŸèƒ½æ›´åŠ å¼ºæ‚ï¼</p><p>Github åœ°å€ï¼š<a href="https://github.com/xiaoymin/swagger-bootstrap-ui">https://github.com/xiaoymin/swagger-bootstrap-ui</a></p><p>å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://doc.xiaominfo.com/knife4j/documentation/">https://doc.xiaominfo.com/knife4j/documentation/</a></p><p>æˆ‘è¿™é‡Œå¸¦å¤§å®¶å¿«é€Ÿä¸Šæ‰‹ä½“éªŒä¸€ç•ªï¼š</p><h3 id="ç¯å¢ƒ-1"><a href="#ç¯å¢ƒ-1" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p>å¯¼å…¥ knife4j-spring-boot-starter ä¾èµ–ï¼Œå·²è‡ªå¸¦ Swagger 2ï¼š</p><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.github.xiaoymin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>knife4j-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯æ ¹æ®éœ€è¦å¼€å¯å¢å¼ºé…ç½®ï¼š</p><p><code>application.yml</code></p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>  <span class="token comment"># ç«¯å£</span>  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span><span class="token key atrule">knife4j</span><span class="token punctuation">:</span>  <span class="token comment"># å¼€å¯å¢å¼ºé…ç½®</span>  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># å¼€å¯ç”Ÿäº§ç¯å¢ƒå±è”½</span>  <span class="token key atrule">production</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># å¼€å¯Swaggerçš„Basicè®¤è¯åŠŸèƒ½,é»˜è®¤æ˜¯ false</span>  <span class="token key atrule">basic</span><span class="token punctuation">:</span>    <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>    <span class="token comment"># Basicè®¤è¯ç”¨æˆ·å</span>    <span class="token key atrule">username</span><span class="token punctuation">:</span> test    <span class="token comment"># Basicè®¤è¯å¯†ç </span>    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>åˆ›å»º Swagger 2 é…ç½®æ–‡ä»¶ï¼š</p><p><code>Swagger2Config</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">PathSelectors</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">RequestHandlerSelectors</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ApiInfo</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">ApiKey</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">AuthorizationScope</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">Contact</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>service<span class="token punctuation">.</span></span><span class="token class-name">SecurityReference</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">DocumentationType</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>service<span class="token punctuation">.</span>contexts<span class="token punctuation">.</span></span><span class="token class-name">SecurityContext</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>web<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span></span><span class="token class-name">Docket</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">springfox<span class="token punctuation">.</span>documentation<span class="token punctuation">.</span>swagger2<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">EnableSwagger2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token comment">/** * Swagger2 é…ç½®ç±» * * @author revelvy * @since 1.0.0 */</span><span class="token annotation punctuation">@Configuration</span><span class="token annotation punctuation">@EnableSwagger2</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Swagger2Config</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">Docket</span> <span class="token function">createRestApi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Docket</span><span class="token punctuation">(</span><span class="token class-name">DocumentationType</span><span class="token punctuation">.</span>SWAGGER_2<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token comment">// ä¸ºæ‰€æœ‰æ¥å£ç”ŸæˆAPIæ–‡æ¡£</span><span class="token comment">//                .apis(RequestHandlerSelectors.any())</span>                <span class="token punctuation">.</span><span class="token function">apis</span><span class="token punctuation">(</span><span class="token class-name">RequestHandlerSelectors</span><span class="token punctuation">.</span><span class="token function">basePackage</span><span class="token punctuation">(</span><span class="token string">"com.xxxx.server.controller"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">paths</span><span class="token punctuation">(</span><span class="token class-name">PathSelectors</span><span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token class-name">ApiInfo</span> <span class="token function">apiInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ApiInfoBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">"xxxæ¥å£æ–‡æ¡£"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">description</span><span class="token punctuation">(</span><span class="token string">"xxxæ¥å£æ–‡æ¡£"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">termsOfServiceUrl</span><span class="token punctuation">(</span><span class="token string">"http://www.xx.com/"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">contact</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Contact</span><span class="token punctuation">(</span><span class="token string">"Revelvy"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"xxx@qq.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token string">"v1.0"</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ­¤æ—¶ï¼Œå¯åŠ¨ Spring Boot å·¥ç¨‹ï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼š<a href="http://localhost:8080/doc.html">http://localhost:8080/doc.html</a></p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210807180858.png"></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
            <tag> Swagger </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL å­˜å‚¨è¿‡ç¨‹</title>
      <link href="/2020/05/01/mysql-cun-chu-guo-cheng/"/>
      <url>/2020/05/01/mysql-cun-chu-guo-cheng/</url>
      
        <content type="html"><![CDATA[<h2 id="å­˜å‚¨è¿‡ç¨‹"><a href="#å­˜å‚¨è¿‡ç¨‹" class="headerlink" title="å­˜å‚¨è¿‡ç¨‹"></a>å­˜å‚¨è¿‡ç¨‹</h2><p>å­˜å‚¨è¿‡ç¨‹ Stored Procedureï¼ŒæŒ‡çš„æ˜¯ä¸€ç§åœ¨å­˜å‚¨æ•°æ®åº“å­—å…¸ä¸­çš„å¤æ‚ç¨‹åºï¼Œä»¥ä¾¿å¤–éƒ¨ç¨‹åºè°ƒç”¨çš„ä¸€ç§æ•°æ®åº“å¯¹è±¡ã€‚<br><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> â€‹ç†è§£ï¼šæ•°æ®åº“ SQL è¯­è¨€å±‚é¢çš„ä»£ç å°è£…ä¸é‡ç”¨ï¼Œå³èƒ½å®Œæˆä¸€å®šæ“ä½œçš„ä¸€ç»„ SQL è¯­å¥ã€‚</p><blockquote><p>ä¼˜ç‚¹<br>    å¯å°è£…å¹¶éšè—å¤æ‚çš„å•†ä¸šé€»è¾‘ã€‚<br>    å¯æ¥æ”¶å‚æ•°ï¼Œå¯å›ä¼ å€¼ã€‚<br>ç¼ºç‚¹<br>    å®šåˆ¶åŒ–äºç‰¹å®šçš„æ•°æ®åº“ä¸Šï¼Œå½“åˆ‡æ¢åˆ°å…¶ä»–å‚å•†çš„æ•°æ®åº“ç³»ç»Ÿæ—¶ï¼Œéœ€è¦é‡å†™åŸæœ‰çš„å­˜å‚¨è¿‡ç¨‹ã€‚<br>    æ€§èƒ½è°ƒæ ¡ä¸æ’°å†™ï¼Œå—é™äºå„ç§æ•°æ®åº“ç³»ç»Ÿã€‚</p></blockquote><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span>     <span class="token punctuation">[</span><span class="token keyword">DEFINER</span> <span class="token operator">=</span> { <span class="token keyword">user</span> <span class="token operator">|</span> <span class="token keyword">CURRENT_USER</span> }<span class="token punctuation">]</span> <span class="token keyword">PROCEDURE</span> sp_name <span class="token punctuation">(</span><span class="token punctuation">[</span>proc_parameter<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>     <span class="token punctuation">[</span>characteristic <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> routine_body proc_parameter:     <span class="token punctuation">[</span> <span class="token operator">IN</span> <span class="token operator">|</span> <span class="token keyword">OUT</span> <span class="token operator">|</span> <span class="token keyword">INOUT</span> <span class="token punctuation">]</span> param_name <span class="token keyword">type</span> characteristic: <span class="token keyword">COMMENT</span> <span class="token string">'string'</span>   <span class="token operator">|</span> <span class="token keyword">LANGUAGE</span> <span class="token keyword">SQL</span>   <span class="token operator">|</span> <span class="token punctuation">[</span><span class="token operator">NOT</span><span class="token punctuation">]</span> <span class="token keyword">DETERMINISTIC</span>   <span class="token operator">|</span> { <span class="token keyword">CONTAINS</span> <span class="token keyword">SQL</span> <span class="token operator">|</span> <span class="token keyword">NO</span> <span class="token keyword">SQL</span> <span class="token operator">|</span> <span class="token keyword">READS</span> <span class="token keyword">SQL</span> <span class="token keyword">DATA</span> <span class="token operator">|</span> <span class="token keyword">MODIFIES</span> <span class="token keyword">SQL</span> <span class="token keyword">DATA</span> }   <span class="token operator">|</span> <span class="token keyword">SQL</span> SECURITY { <span class="token keyword">DEFINER</span> <span class="token operator">|</span> <span class="token keyword">INVOKER</span> } routine_body:   Valid <span class="token keyword">SQL</span> <span class="token keyword">routine</span> statement <span class="token punctuation">[</span>begin_label:<span class="token punctuation">]</span> <span class="token keyword">BEGIN</span>   <span class="token punctuation">[</span>statement_list<span class="token punctuation">]</span>    â€¦â€¦ <span class="token keyword">END</span> <span class="token punctuation">[</span>end_label<span class="token punctuation">]</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>è‡ªå®šä¹‰è¯­å¥ç»“æŸç¬¦</code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">DELIMITER</span> $$æˆ–<span class="token keyword">DELIMITER</span> <span class="token comment">// </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>é‡è¦è¯­æ³•</code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">åˆ›å»ºå­˜å‚¨è¿‡ç¨‹: <span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> å­˜å‚¨è¿‡ç¨‹å<span class="token punctuation">(</span>å‚æ•°<span class="token punctuation">)</span>å­˜å‚¨è¿‡ç¨‹ä½“: <span class="token keyword">create</span> <span class="token keyword">function</span> å­˜å‚¨å‡½æ•°å<span class="token punctuation">(</span>å‚æ•°<span class="token punctuation">)</span> å­˜å‚¨è¿‡ç¨‹å¼€å§‹å’Œç»“æŸç¬¦å·: <span class="token keyword">BEGIN</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">END</span> å˜é‡å®šä¹‰: è¯­æ³•ï¼š<span class="token keyword">DECLARE</span> variable_name <span class="token punctuation">[</span><span class="token punctuation">,</span>variable_name<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> datatype <span class="token punctuation">[</span><span class="token keyword">DEFAULT</span> <span class="token keyword">value</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">DECLARE</span> variable_name <span class="token keyword">int</span> <span class="token keyword">unsigned</span> <span class="token keyword">default</span> <span class="token number">4000000</span><span class="token punctuation">;</span> å˜é‡èµ‹å€¼: <span class="token keyword">SET</span> @å˜é‡å <span class="token operator">=</span> è¡¨è¾¾å¼å€¼ <span class="token punctuation">[</span><span class="token punctuation">,</span>variable_name <span class="token operator">=</span> expression <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token keyword">SET</span> <span class="token variable">@p_in</span> <span class="token operator">=</span> <span class="token number">1</span> è°ƒç”¨ï¼š<span class="token keyword">call</span> sp_name<span class="token punctuation">[</span><span class="token punctuation">(</span>ä¼ å‚<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> GreetWorld<span class="token punctuation">(</span> <span class="token punctuation">)</span> <span class="token keyword">SELECT</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@greeting</span><span class="token punctuation">,</span><span class="token string">' World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">SET</span> <span class="token variable">@greeting</span><span class="token operator">=</span><span class="token string">'Hello'</span><span class="token punctuation">;</span>  <span class="token keyword">CALL</span> GreetWorld<span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token operator">+</span><span class="token comment">----------------------------+ </span><span class="token operator">|</span> CONCAT<span class="token punctuation">(</span><span class="token variable">@greeting</span><span class="token punctuation">,</span><span class="token string">' World'</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token operator">+</span><span class="token comment">----------------------------+ </span><span class="token operator">|</span>  Hello World               <span class="token operator">|</span> <span class="token operator">+</span><span class="token comment">----------------------------+</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="MySQL-å‡½æ•°è®¾ç½®"><a href="#MySQL-å‡½æ•°è®¾ç½®" class="headerlink" title="MySQL å‡½æ•°è®¾ç½®"></a>MySQL å‡½æ•°è®¾ç½®</h3><p>åœ¨ MySQL æ•°æ®åº“ä¸­æ–°å¢ä¸¤ä¸ªå‡½æ•°ï¼š</p><p><code>addDep </code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DEFINER</span><span class="token operator">=</span><span class="token punctuation">`</span>root<span class="token punctuation">`</span><span class="token variable">@`localhost`</span> <span class="token keyword">PROCEDURE</span> <span class="token punctuation">`</span>addDep<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token operator">in</span> depName <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">in</span> parentId <span class="token keyword">int</span><span class="token punctuation">,</span><span class="token operator">in</span> enabled <span class="token keyword">boolean</span><span class="token punctuation">,</span><span class="token keyword">out</span> result <span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">out</span> result2 <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token keyword">declare</span> did <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token keyword">declare</span> pDepPath <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">insert</span> <span class="token keyword">into</span> t_department <span class="token keyword">set</span> name<span class="token operator">=</span>depName<span class="token punctuation">,</span>parentId<span class="token operator">=</span>parentId<span class="token punctuation">,</span>enabled<span class="token operator">=</span>enabled<span class="token punctuation">;</span> <span class="token keyword">select</span> row_count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">into</span> result<span class="token punctuation">;</span> <span class="token keyword">select</span> last_insert_id<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">into</span> did<span class="token punctuation">;</span> <span class="token keyword">set</span> result2<span class="token operator">=</span>did<span class="token punctuation">;</span> <span class="token keyword">select</span> depPath <span class="token keyword">into</span> pDepPath <span class="token keyword">from</span> t_department <span class="token keyword">where</span> id<span class="token operator">=</span>parentId<span class="token punctuation">;</span> <span class="token keyword">update</span> t_department <span class="token keyword">set</span> depPath<span class="token operator">=</span>concat<span class="token punctuation">(</span>pDepPath<span class="token punctuation">,</span><span class="token string">'.'</span><span class="token punctuation">,</span>did<span class="token punctuation">)</span> <span class="token keyword">where</span> id<span class="token operator">=</span>did<span class="token punctuation">;</span> <span class="token keyword">update</span> t_department <span class="token keyword">set</span> isParent<span class="token operator">=</span><span class="token boolean">true</span> <span class="token keyword">where</span> id<span class="token operator">=</span>parentId<span class="token punctuation">;</span> <span class="token keyword">end</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>deleteDep  </code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">DEFINER</span><span class="token operator">=</span><span class="token punctuation">`</span>root<span class="token punctuation">`</span><span class="token variable">@`localhost`</span> <span class="token keyword">PROCEDURE</span> <span class="token punctuation">`</span>deleteDep<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token operator">in</span> did <span class="token keyword">int</span><span class="token punctuation">,</span><span class="token keyword">out</span> result <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token keyword">begin</span> <span class="token keyword">declare</span> ecount <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token keyword">declare</span> pid <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token keyword">declare</span> pcount <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token keyword">declare</span> a <span class="token keyword">int</span><span class="token punctuation">;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">into</span> a <span class="token keyword">from</span> t_department <span class="token keyword">where</span> id<span class="token operator">=</span>did <span class="token operator">and</span> isParent<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token keyword">if</span> a<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">then</span> <span class="token keyword">set</span> result<span class="token operator">=</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">into</span> ecount <span class="token keyword">from</span> t_employee <span class="token keyword">where</span> departmentId<span class="token operator">=</span>did<span class="token punctuation">;</span> <span class="token keyword">if</span> ecount<span class="token operator">&gt;</span><span class="token number">0</span> <span class="token keyword">then</span> <span class="token keyword">set</span> result<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">else</span> <span class="token keyword">select</span> parentId <span class="token keyword">into</span> pid <span class="token keyword">from</span> t_department <span class="token keyword">where</span> id<span class="token operator">=</span>did<span class="token punctuation">;</span> <span class="token keyword">delete</span> <span class="token keyword">from</span> t_department <span class="token keyword">where</span> id<span class="token operator">=</span>did <span class="token operator">and</span> isParent<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span> <span class="token keyword">select</span> row_count<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">into</span> result<span class="token punctuation">;</span> <span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">into</span> pcount <span class="token keyword">from</span> t_department <span class="token keyword">where</span> parentId<span class="token operator">=</span>pid<span class="token punctuation">;</span> <span class="token keyword">if</span> pcount<span class="token operator">=</span><span class="token number">0</span> <span class="token keyword">then</span> <span class="token keyword">update</span> t_department <span class="token keyword">set</span> isParent<span class="token operator">=</span><span class="token boolean">false</span> <span class="token keyword">where</span> id<span class="token operator">=</span>pid<span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span class="token keyword">if</span><span class="token punctuation">;</span> <span class="token keyword">end</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä»£ç è°ƒç”¨"><a href="#ä»£ç è°ƒç”¨" class="headerlink" title="ä»£ç è°ƒç”¨"></a>ä»£ç è°ƒç”¨</h3><p>å®ä½“ç±».java</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@EqualsAndHashCode</span><span class="token punctuation">(</span>callSuper <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Accessors</span><span class="token punctuation">(</span>chain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token annotation punctuation">@TableName</span><span class="token punctuation">(</span><span class="token string">"t_department"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ApiModel</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"Departmentå¯¹è±¡"</span><span class="token punctuation">,</span> description <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Department</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">long</span> serialVersionUID <span class="token operator">=</span> <span class="token number">1L</span><span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@TableId</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> type <span class="token operator">=</span> <span class="token class-name">IdType</span><span class="token punctuation">.</span>AUTO<span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"éƒ¨é—¨åç§°"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"çˆ¶id"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> parentId<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"è·¯å¾„"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> depPath<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ˜¯å¦å¯ç”¨"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> enabled<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"æ˜¯å¦ä¸Šçº§"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Boolean</span> isParent<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"å­éƒ¨é—¨åˆ—è¡¨"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">&gt;</span></span> children<span class="token punctuation">;</span>    <span class="token annotation punctuation">@ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"è¿”å›ç»“æœï¼Œå­˜å‚¨è¿‡ç¨‹ä½¿ç”¨"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@TableField</span><span class="token punctuation">(</span>exist <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> result<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æœåŠ¡å±‚æ¥å£.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IDepartmentService</span> <span class="token keyword">extends</span> <span class="token class-name">IService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ·»åŠ éƒ¨é—¨     *     * @param dep     * @return     */</span>    <span class="token class-name">RespBean</span> <span class="token function">addDep</span><span class="token punctuation">(</span><span class="token class-name">Department</span> dep<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * åˆ é™¤éƒ¨é—¨     *     * @param id     * @return     */</span>    <span class="token class-name">RespBean</span> <span class="token function">deleteDep</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æœåŠ¡å±‚æ¥å£å®ç°.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DepartmentServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">ServiceImpl</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DepartmentMapper</span><span class="token punctuation">,</span> <span class="token class-name">Department</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">IDepartmentService</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">DepartmentMapper</span> departmentMapper<span class="token punctuation">;</span>    <span class="token comment">/**     * æ·»åŠ éƒ¨é—¨     *     * @param dep     * @return     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">RespBean</span> <span class="token function">addDep</span><span class="token punctuation">(</span><span class="token class-name">Department</span> dep<span class="token punctuation">)</span> <span class="token punctuation">{</span>        dep<span class="token punctuation">.</span><span class="token function">setEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        departmentMapper<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> dep<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token class-name">RespBean</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"æ·»åŠ æˆåŠŸï¼"</span><span class="token punctuation">,</span> dep<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token class-name">RespBean</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"æ·»åŠ å¤±è´¥!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * åˆ é™¤éƒ¨é—¨     *     * @param id     * @return     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">RespBean</span> <span class="token function">deleteDep</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">Department</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Department</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        dep<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        departmentMapper<span class="token punctuation">.</span><span class="token function">deleteDep</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">==</span> dep<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token class-name">RespBean</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"è¯¥éƒ¨é—¨ä¸‹è¿˜æœ‰å­éƒ¨é—¨ï¼Œåˆ é™¤å¤±è´¥!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span> <span class="token operator">==</span> dep<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token class-name">RespBean</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"è¯¥éƒ¨é—¨ä¸‹è¿˜æœ‰å‘˜å·¥ï¼Œåˆ é™¤å¤±è´¥!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">==</span> dep<span class="token punctuation">.</span><span class="token function">getResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token class-name">RespBean</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤æˆåŠŸ!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token class-name">RespBean</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"åˆ é™¤å¤±è´¥!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>xxxMapper.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DepartmentMapper</span> <span class="token keyword">extends</span> <span class="token class-name">BaseMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>    <span class="token comment">/**     * æ·»åŠ éƒ¨é—¨     *     * @param dep     */</span>    <span class="token keyword">void</span> <span class="token function">addDep</span><span class="token punctuation">(</span><span class="token class-name">Department</span> dep<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/**     * åˆ é™¤éƒ¨é—¨     *     * @param dep     */</span>    <span class="token keyword">void</span> <span class="token function">deleteDep</span><span class="token punctuation">(</span><span class="token class-name">Department</span> dep<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>xxxMapper.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- åˆ é™¤éƒ¨é—¨ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deleteDep<span class="token punctuation">"</span></span> <span class="token attr-name">statementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CALLABLE<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    call deleteDep(#{id,mode=IN,jdbcType=INTEGER}, #{result,mode=OUT,jdbcType=INTEGER})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!-- æ·»åŠ éƒ¨é—¨ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>addDep<span class="token punctuation">"</span></span> <span class="token attr-name">statementType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>CALLABLE<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    call addDep(#{name,mode=IN,jdbcType=VARCHAR}, #{parentId,mode=IN,jdbcType=INTEGER},                #{enabled,mode=IN,jdbcType=BOOLEAN}, #{result,mode=OUT,jdbcType=INTEGER},                #{id,mode=OUT,jdbcType=INTEGER})<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Shiro å¿«é€Ÿå…¥é—¨</title>
      <link href="/2020/04/02/shiro-kuai-su-ru-men/"/>
      <url>/2020/04/02/shiro-kuai-su-ru-men/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Shiro æ˜¯ä¸€æ¬¾ç»å…¸çš„ Java å®‰å…¨æ¡†æ¶ï¼Œå¯ä»¥åœ¨åº”ç”¨åœ¨ JavaSE å’Œ JavaEE çš„åœºæ™¯ä¸­ï¼Œ ä¸»è¦ç”¨äºï¼šè®¤è¯ã€æˆæƒã€åŠ å¯†ã€ä¼šè¯ç®¡ç†ã€Webé›†æˆä»¥åŠç¼“å­˜ã€‚</p><h3 id="åŠŸèƒ½"><a href="#åŠŸèƒ½" class="headerlink" title="åŠŸèƒ½"></a>åŠŸèƒ½</h3><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806185438.png" alt="img"></p><ul><li><strong>Authentication</strong>ï¼šèº«ä»½è®¤è¯ / ç™»å½•ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯ä¸æ˜¯æ‹¥æœ‰ç›¸åº”çš„èº«ä»½ã€‚</li><li><strong>Authorization</strong>ï¼šæˆæƒï¼ŒéªŒè¯æŸä¸ªå·²è®¤è¯ç”¨æˆ·å¯¹æŸä¸ªèµ„æºæ˜¯å¦æ‹¥æœ‰æŸä¸ªæƒé™ï¼Œå¦‚ï¼šéªŒè¯æŸä¸ªç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æŸä¸ªè§’è‰²ã€‚</li><li><strong>Session</strong> <strong>Management</strong>ï¼šä¼šè¯ç®¡ç†ï¼Œå³ç”¨æˆ·ç™»å½•åå°±æ˜¯ä¸€æ¬¡ä¼šè¯ï¼Œåœ¨æ²¡æœ‰é€€å‡ºä¹‹å‰ï¼Œå®ƒçš„æ‰€æœ‰ä¿¡æ¯éƒ½åœ¨ä¼šè¯ä¸­ã€‚</li><li><strong>Cryptography</strong>ï¼šåŠ å¯†ï¼Œä¿æŠ¤æ•°æ®çš„å®‰å…¨æ€§ï¼Œå¦‚å¯†ç åŠ å¯†å­˜å‚¨åˆ°æ•°æ®åº“ã€‚</li><li><strong>Web Support</strong>ï¼šWeb æ”¯æŒã€‚</li><li><strong>Caching</strong>ï¼šç¼“å­˜ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•åï¼Œå…¶ç”¨æˆ·ä¿¡æ¯ã€æ‹¥æœ‰çš„è§’è‰² / æƒé™ä¸å¿…æ¯æ¬¡å»æŸ¥ï¼Œæé«˜æ•ˆç‡ã€‚</li><li><strong>Concurrency</strong>ï¼šShiro æ”¯æŒå¤šçº¿ç¨‹åº”ç”¨çš„å¹¶å‘éªŒè¯ï¼Œå¦‚åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œèƒ½æŠŠæƒé™è‡ªåŠ¨ä¼ æ’­è¿‡å»ã€‚</li><li><strong>Testing</strong>ï¼šæä¾›æµ‹è¯•æ”¯æŒã€‚</li><li><strong>Run As</strong>ï¼šå…è®¸ä¸€ä¸ªç”¨æˆ·å‡è£…ä¸ºå¦ä¸€ä¸ªç”¨æˆ·ï¼ˆå¦‚æœä»–ä»¬å…è®¸ï¼‰çš„èº«ä»½è¿›è¡Œè®¿é—®ã€‚</li><li><strong>Remember Me</strong>ï¼šè®°ä½æˆ‘ã€‚</li></ul><h3 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h3><h4 id="å¤–éƒ¨"><a href="#å¤–éƒ¨" class="headerlink" title="å¤–éƒ¨"></a>å¤–éƒ¨</h4><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806185444.png" alt="img"></p><ul><li><p><strong>Subject</strong>ï¼šå½“å‰ â€œç”¨æˆ·â€ ä¸»ä½“ï¼Œåº”ç”¨ä»£ç ç›´æ¥äº¤äº’çš„å¯¹è±¡ï¼ˆShiro çš„å¯¹å¤– API æ ¸å¿ƒå°±æ˜¯ Subject ä¸»ä½“ï¼‰ï¼Œè¿™ä¸ªç”¨æˆ·ä¸ä¸€å®šæ˜¯ä¸€ä¸ªå…·ä½“çš„äººï¼Œä¸å½“å‰åº”ç”¨äº¤äº’çš„ä»»ä½•ä¸œè¥¿éƒ½æ˜¯ Subjectï¼Œå¦‚ç½‘ç»œçˆ¬è™«ï¼Œæœºå™¨äººç­‰ï¼Œæ‰€æœ‰ Subject éƒ½ç»‘å®šåˆ° SecurityManagerï¼Œä¸ Subject çš„æ‰€æœ‰äº¤äº’éƒ½ä¼šå§”æ‰˜ç»™ SecurityManagerï¼›å¯ä»¥æŠŠ Subject è®¤ä¸ºæ˜¯ä¸€ä¸ªé—¨é¢ï¼ŒSecurityManager æ‰æ˜¯å®é™…çš„æ‰§è¡Œè€…</p></li><li><p><strong>SecurityManager</strong>ï¼šå®‰å…¨ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒï¼‰ï¼Œå³æ‰€æœ‰ä¸å®‰å…¨æœ‰å…³çš„æ“ä½œéƒ½ä¼šä¸ SecurityManager äº¤äº’ï¼Œç®¡ç†ç€æ‰€æœ‰ Subjectï¼Œè´Ÿè´£ä¸å…¶ä»–ç»„ä»¶è¿›è¡Œäº¤äº’ï¼Œç±»ä¼¼ SpringMVC çš„ DispatcherServlet</p></li><li><p><strong>Realm</strong>ï¼šé¢†åŸŸï¼ŒShiro ä» Realm è·å–å®‰å…¨æ•°æ®ï¼ˆå¦‚ç”¨æˆ·ã€è§’è‰²ã€æƒé™ï¼‰ï¼ŒSecurityManager è¦éªŒè¯ç”¨æˆ·èº«ä»½ï¼Œå°±è¦ä» Realm è·å–ç›¸åº”çš„ç”¨æˆ·è¿›è¡Œæ¯”è¾ƒä»¥ç¡®å®šç”¨æˆ·èº«ä»½æ˜¯å¦åˆæ³•ï¼›ä¹Ÿéœ€è¦ä» Realm å¾—åˆ°ç”¨æˆ·ç›¸åº”çš„è§’è‰² / æƒé™è¿›è¡ŒéªŒè¯ç”¨æˆ·æ˜¯å¦èƒ½è¿›è¡Œæ“ä½œï¼›å¯ä»¥æŠŠ Realm çœ‹æˆ DataSourceï¼Œå³å®‰å…¨æ•°æ®æºã€‚</p></li></ul><h4 id="å†…éƒ¨"><a href="#å†…éƒ¨" class="headerlink" title="å†…éƒ¨"></a>å†…éƒ¨</h4><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806185445.png" alt="img" style="zoom:200%;"><h2 id="å¿«é€Ÿä½“éªŒ"><a href="#å¿«é€Ÿä½“éªŒ" class="headerlink" title="å¿«é€Ÿä½“éªŒ"></a>å¿«é€Ÿä½“éªŒ</h2><h3 id="é…ç½®-Shiro-ç¯å¢ƒ"><a href="#é…ç½®-Shiro-ç¯å¢ƒ" class="headerlink" title="é…ç½® Shiro ç¯å¢ƒ"></a>é…ç½® Shiro ç¯å¢ƒ</h3><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806190916.png" alt="Shiro é¡¹ç›®é¡¹ç›®ç»“æ„"></p><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å¼•å…¥ Shiro æ‰€éœ€ä¾èµ–ï¼š</p><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--æ’é™¤logback-classic--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>ch.qos.logback<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>logback-classic<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jcl-over-slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.30<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> é…ç½®æ—¥å¿—æ–‡ä»¶ï¼š</p><p><code>log4j.properties</code></p><pre class="line-numbers language-properties" data-language="properties"><code class="language-properties"><span class="token attr-name">log4j.rootLogger</span><span class="token punctuation">=</span><span class="token attr-value">INFO, stdout</span><span class="token attr-name">log4j.appender.stdout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.ConsoleAppender</span><span class="token attr-name">log4j.appender.stdout.layout</span><span class="token punctuation">=</span><span class="token attr-value">org.apache.log4j.PatternLayout</span><span class="token attr-name">log4j.appender.stdout.layout.ConversionPattern</span><span class="token punctuation">=</span><span class="token attr-value">%d %p [%c] - %m %n</span><span class="token comment"># General Apache libraries</span><span class="token attr-name">log4j.logger.org.apache</span><span class="token punctuation">=</span><span class="token attr-value">WARN</span><span class="token comment"># Spring</span><span class="token attr-name">log4j.logger.org.springframework</span><span class="token punctuation">=</span><span class="token attr-value">WARN</span><span class="token comment"># Default Shiro logging</span><span class="token attr-name">log4j.logger.org.apache.shiro</span><span class="token punctuation">=</span><span class="token attr-value">INFO</span><span class="token comment"># Disable verbose logging</span><span class="token attr-name">log4j.logger.org.apache.shiro.util.ThreadContext</span><span class="token punctuation">=</span><span class="token attr-value">WARN</span><span class="token attr-name">log4j.logger.org.apache.shiro.cache.ehcache.EhCache</span><span class="token punctuation">=</span><span class="token attr-value">WARN</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åœ¨é¡¹ç›®èµ„æºç›®å½•ï¼ˆresourcesï¼‰æ”¾ç½® Shiro é…ç½®æ–‡ä»¶ï¼š</p><p><code>shiro.ini</code></p><pre class="line-numbers language-ini" data-language="ini"><code class="language-ini"><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">users</span><span class="token punctuation">]</span></span><span class="token comment"># user 'root' with password 'secret' and the 'admin' role</span><span class="token key attr-name">root</span> <span class="token punctuation">=</span> <span class="token value attr-value">secret, admin</span><span class="token comment"># user 'guest' with the password 'guest' and the 'guest' role</span><span class="token key attr-name">guest</span> <span class="token punctuation">=</span> <span class="token value attr-value">guest, guest</span><span class="token comment"># user 'presidentskroob' with password '12345' ("That's the same combination on</span><span class="token comment"># my luggage!!!" ;)), and role 'president'</span><span class="token key attr-name">presidentskroob</span> <span class="token punctuation">=</span> <span class="token value attr-value">12345, president</span><span class="token comment"># user 'darkhelmet' with password 'ludicrousspeed' and roles 'darklord' and 'schwartz'</span><span class="token key attr-name">darkhelmet</span> <span class="token punctuation">=</span> <span class="token value attr-value">ludicrousspeed, darklord, schwartz</span><span class="token comment"># user 'lonestarr' with password 'vespa' and roles 'goodguy' and 'schwartz'</span><span class="token key attr-name">lonestarr</span> <span class="token punctuation">=</span> <span class="token value attr-value">vespa, goodguy, schwartz</span><span class="token comment"># -----------------------------------------------------------------------------</span><span class="token comment"># Roles with assigned permissions</span><span class="token comment"># </span><span class="token comment"># Each line conforms to the format defined in the</span><span class="token comment"># org.apache.shiro.realm.text.TextConfigurationRealm#setRoleDefinitions JavaDoc</span><span class="token comment"># -----------------------------------------------------------------------------</span><span class="token header"><span class="token punctuation">[</span><span class="token section-name selector">roles</span><span class="token punctuation">]</span></span><span class="token comment"># 'admin' role has all permissions, indicated by the wildcard '*'</span><span class="token key attr-name">admin</span> <span class="token punctuation">=</span> <span class="token value attr-value">*</span><span class="token comment"># The 'schwartz' role can do anything (*) with any lightsaber:</span><span class="token key attr-name">schwartz</span> <span class="token punctuation">=</span> <span class="token value attr-value">lightsaber:*</span><span class="token comment"># The 'goodguy' role is allowed to 'drive' (action) the winnebago (type) with</span><span class="token comment"># license plate 'eagle5' (instance specific id)</span><span class="token key attr-name">goodguy</span> <span class="token punctuation">=</span> <span class="token value attr-value">winnebago:drive:eagle5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><p>åˆ›å»ºå¿«é€Ÿå¯åŠ¨æ–‡ä»¶ quickStart.java è¿›è¡Œæµ‹è¯•ï¼š</p><p><code>quickStart.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span></span><span class="token class-name">SecurityUtils</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>authc<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">IniSecurityManagerFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>mgt<span class="token punctuation">.</span></span><span class="token class-name">SecurityManager</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>session<span class="token punctuation">.</span></span><span class="token class-name">Session</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>subject<span class="token punctuation">.</span></span><span class="token class-name">Subject</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Factory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Logger</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">LoggerFactory</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> quickStart <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">transient</span> <span class="token class-name">Logger</span> log <span class="token operator">=</span> <span class="token class-name">LoggerFactory</span><span class="token punctuation">.</span><span class="token function">getLogger</span><span class="token punctuation">(</span>quickStart<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// Set up shiro environment</span>        <span class="token class-name">Factory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SecurityManager</span><span class="token punctuation">&gt;</span></span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IniSecurityManagerFactory</span><span class="token punctuation">(</span><span class="token string">"classpath:shiro.ini"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SecurityManager</span> securityManager <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>securityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–å½“å‰ç”¨æˆ· subject</span>        <span class="token class-name">Subject</span> currentUser <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æµ‹è¯•å½“å‰ç”¨æˆ·çš„ shiro session</span>        <span class="token class-name">Session</span> session <span class="token operator">=</span> currentUser<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"someKey"</span><span class="token punctuation">,</span> <span class="token string">"aValue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"someKey"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"aValue"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Retrieved the correct value! ["</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦è¢«è®¤è¯</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>currentUser<span class="token punctuation">.</span><span class="token function">isAuthenticated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// ç”Ÿæˆéšæœºä»¤ç‰Œ token</span>            <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span><span class="token string">"lonestarr"</span><span class="token punctuation">,</span> <span class="token string">"vespa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            token<span class="token punctuation">.</span><span class="token function">setRememberMe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è®°ä½æˆ‘</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                currentUser<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ‰§è¡Œç™»é™†</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> uae<span class="token punctuation">)</span> <span class="token punctuation">{</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"There is no user with username of "</span> <span class="token operator">+</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> ice<span class="token punctuation">)</span> <span class="token punctuation">{</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Password for account "</span> <span class="token operator">+</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" was incorrect!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">LockedAccountException</span> lae<span class="token punctuation">)</span> <span class="token punctuation">{</span>                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"The account for username "</span> <span class="token operator">+</span> token<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" is locked.  "</span> <span class="token operator">+</span>                        <span class="token string">"Please contact your administrator to unlock it."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">// ... catch more exceptions here (maybe custom ones specific to your application?</span>            <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticationException</span> ae<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">//unexpected condition?  error?</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">//say who they are:</span>        <span class="token comment">//print their identifying principal (in this case, a username):</span>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"User ["</span> <span class="token operator">+</span> currentUser<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"] logged in successfully."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰è§’è‰²</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentUser<span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"schwartz"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"May the Schwartz be with you!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Hello, mere mortal."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æƒé™ï¼ˆç²—ç²’åº¦ï¼‰</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentUser<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">"lightsaber:wield"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"You may use a lightsaber ring.  Use it wisely."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Sorry, lightsaber rings are for schwartz masters only."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦æ‹¥æœ‰æƒé™ï¼ˆç»†ç²’åº¦ï¼‰</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentUser<span class="token punctuation">.</span><span class="token function">isPermitted</span><span class="token punctuation">(</span><span class="token string">"winnebago:drive:eagle5"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"You are permitted to 'drive' the winnebago with license plate (id) 'eagle5'.  "</span> <span class="token operator">+</span>                    <span class="token string">"Here are the keys - have fun!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Sorry, you aren't allowed to drive the 'eagle5' winnebago!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        currentUser<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ³¨é”€</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æµ‹è¯•æˆåŠŸ<span class="github-emoji"><span>ğŸ‘»</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f47b.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> â€‹ï¼</p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806190817.png"></p><h2 id="SpringBoot-é›†æˆ-Shiro"><a href="#SpringBoot-é›†æˆ-Shiro" class="headerlink" title="SpringBoot é›†æˆ Shiro"></a>SpringBoot é›†æˆ Shiro</h2><h3 id="é…ç½®-Shiro-ç¯å¢ƒ-1"><a href="#é…ç½®-Shiro-ç¯å¢ƒ-1" class="headerlink" title="é…ç½® Shiro ç¯å¢ƒ"></a>é…ç½® Shiro ç¯å¢ƒ</h3><p>å¯¼å…¥ Shiro ä¾èµ–</p><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.4.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæ˜¯ä½¿ç”¨ SpringBoot ï¼Œåˆ™ä¹Ÿå¯ä»¥å¯¼å…¥ Shiro çš„å¯åŠ¨å™¨ï¼š</p><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.shiro<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shiro-spring-boot-web-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.7.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æµ‹è¯•-1"><a href="#æµ‹è¯•-1" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h3><h4 id="æµ‹è¯•è®¤è¯åŠŸèƒ½"><a href="#æµ‹è¯•è®¤è¯åŠŸèƒ½" class="headerlink" title="æµ‹è¯•è®¤è¯åŠŸèƒ½"></a>æµ‹è¯•è®¤è¯åŠŸèƒ½</h4><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åˆ›å»ºåŸŸå¯¹è±¡</p><p>åœ¨ confg åŒ…ä¸‹è‡ªå®šä¹‰åŸŸå¯¹è±¡ Realm ç±»ï¼Œé…ç½®è®¤è¯è¿‡æ»¤ç¨‹åºã€‚</p><p><code>UserRealm.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>    <span class="token comment">// æˆæƒ</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œäº†æˆæƒ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// è®¤è¯</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œäº†è®¤è¯~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è‡ªå®šä¹‰ç”¨æˆ·å å¯†ç  ï¼ˆå®é™…ä¸Šä»æ•°æ®åº“ä¸­è·å–ï¼‰</span>        <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token string">"revelvy"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> password <span class="token operator">=</span> <span class="token string">"988988"</span><span class="token punctuation">;</span>        <span class="token class-name">UsernamePasswordToken</span> usernamePasswordToken <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">)</span> token<span class="token punctuation">;</span>        <span class="token comment">// ç”¨æˆ·åè®¤è¯</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>usernamePasswordToken<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">// æŠ›å¼‚å¸¸ï¼šUnknownAccountException</span>        <span class="token punctuation">}</span>        <span class="token comment">// å¯†ç è®¤è¯ï¼ˆShrioè‡ªåŠ¨éªŒè¯ï¼‰</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span>password<span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åˆ›å»º Shiro é…ç½®æ–‡ä»¶</p><p>æ³¨å…¥åŸŸå¯¹è±¡ï¼Œé…ç½®å®‰å…¨ç®¡ç†å™¨å’Œè¿‡æ»¤å™¨å·¥å‚ã€‚åœ¨è¿‡æ»¤å™¨å·¥å‚ä¸­ï¼Œé…ç½® Shiro å†…ç½®è®¤è¯è¿‡æ»¤å™¨ï¼Œè®¾ç½®å¯¹åº”çš„è¿‡æ»¤æ¡ä»¶å’Œè·³è½¬æ¡ä»¶è¿‡æ»¤è¯·æ±‚ï¼Œå…¶ä¸­è®¤è¯è¿‡æ»¤æƒé™çš„è®¾ç½®å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>è®¤è¯æƒé™</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>anon</td><td>æ— éœ€è®¤è¯å³å¯è®¿é—®</td></tr><tr><td>authc</td><td>å¿…é¡»è®¤è¯æ‰å¯è®¿é—®</td></tr><tr><td>user</td><td>æ‹¥æœ‰â€œè®°ä½æˆ‘â€æ‰å¯è®¿é—®</td></tr><tr><td>perms</td><td>æ‹¥æœ‰å¯¹æŸä¸ªèµ„æºçš„æƒé™æ‰å¯è®¿é—®</td></tr><tr><td>role</td><td>æ‹¥æœ‰æŸä¸ªè§’è‰²æƒé™æ‰å¯è®¿é—®</td></tr></tbody></table><p><code>ShiroConfig.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>web<span class="token punctuation">.</span>mgt<span class="token punctuation">.</span></span><span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>shiro<span class="token punctuation">.</span>mgt<span class="token punctuation">.</span></span><span class="token class-name">SecurityManager</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Qualifier</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">LinkedHashMap</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>    <span class="token comment">// 1. Realm å¯¹è±¡</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">UserRealm</span> <span class="token function">userRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">UserRealm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// 2. securityManager å®‰å…¨ç®¡ç†å™¨</span>    <span class="token annotation punctuation">@Bean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"securityManager"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">SecurityManager</span> <span class="token function">securityManager</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"userRealm"</span><span class="token punctuation">)</span> <span class="token class-name">UserRealm</span> userRealm<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">DefaultWebSecurityManager</span> securityManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultWebSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        securityManager<span class="token punctuation">.</span><span class="token function">setRealm</span><span class="token punctuation">(</span>userRealm<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å…³è” Realm å¯¹è±¡</span>        <span class="token keyword">return</span> securityManager<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// 3. ShiroFilterFactoryBean Shiroè¿‡æ»¤å™¨å·¥å‚</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">ShiroFilterFactoryBean</span> <span class="token function">getShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"securityManager"</span><span class="token punctuation">)</span> <span class="token class-name">SecurityManager</span> securityManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ShiroFilterFactoryBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bean<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>securityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å…³è” securityManager å¯¹è±¡</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/user/*"</span><span class="token punctuation">,</span> <span class="token string">"authc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bean<span class="token punctuation">.</span><span class="token function">setFilterChainDefinitionMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>        bean<span class="token punctuation">.</span><span class="token function">setLoginUrl</span><span class="token punctuation">(</span><span class="token string">"/toLogin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç™»é™†é¡µé¢ï¼ˆæœªè®¤è¯è·³è½¬é¡µé¢ï¼‰</span>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åˆ›å»ºæ¥å£æµ‹è¯•</p><p>åœ¨åˆ›å»ºçš„ç™»é™†æµ‹è¯•é¡µé¢ä¸­ï¼Œè¾“å…¥ç”¨æˆ·åå’Œå¯†ç æ‰§è¡Œç™»é™†ï¼ŒShiro ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨æ ¡éªŒï¼Œå¯åœ¨æ§åˆ¶å°æŸ¥çœ‹ç™»å½•ç»“æœã€‚</p><p><code>HelloController.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/toLogin"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"login"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/doLogin"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">doLogin</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// è·å–å½“å‰ç”¨æˆ· subject</span>        <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç”Ÿæˆéšæœºä»¤ç‰Œ token</span>        <span class="token class-name">UsernamePasswordToken</span> token <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            subject<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ‰§è¡Œç™»é™†</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç™»é™†æˆåŠŸ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnknownAccountException</span> uae<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·åé”™è¯¯~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token string">"login"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IncorrectCredentialsException</span> ice<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¯†ç é”™è¯¯~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token string">"login"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>login.html</code></p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/doLogin<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>ç”¨æˆ·åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>å¯†ç ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æµ‹è¯•è®¤è¯åŠŸèƒ½ï¼ˆæ•°æ®åº“ï¼‰"><a href="#æµ‹è¯•è®¤è¯åŠŸèƒ½ï¼ˆæ•°æ®åº“ï¼‰" class="headerlink" title="æµ‹è¯•è®¤è¯åŠŸèƒ½ï¼ˆæ•°æ®åº“ï¼‰"></a>æµ‹è¯•è®¤è¯åŠŸèƒ½ï¼ˆæ•°æ®åº“ï¼‰</h4><p>å®é™…å¼€å‘ä¸­ï¼Œå½“æˆ‘ä»¬éƒ½éœ€è¦è¿æ¥æ•°æ®åº“æ—¶ï¼Œéœ€é…ç½®åŸŸå¯¹è±¡ï¼š</p><p><code>UserRealm.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>    <span class="token comment">// è®¤è¯</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œäº†è®¤è¯~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UsernamePasswordToken</span> usernamePasswordToken <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">)</span> token<span class="token punctuation">;</span>        <span class="token comment">// ä»æ•°æ®åº“è¯»å–ç”¨æˆ·å å¯†ç </span>        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">queryUserByName</span><span class="token punctuation">(</span>usernamePasswordToken<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç”¨æˆ·åéªŒè¯</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">// æŠ›å¼‚å¸¸ï¼šUnknownAccountException</span>        <span class="token punctuation">}</span>        <span class="token comment">// å¯†ç éªŒè¯ï¼ˆShrioè‡ªåŠ¨éªŒè¯ï¼‰</span>        <span class="token comment">// å¯ä»¥åŠ å¯†ï¼šMD5ï¼šdasdsd11 MD5ç›å€¼åŠ å¯†ï¼šdasdsd11username</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æµ‹è¯•æˆæƒåŠŸèƒ½ï¼ˆæ•°æ®åº“ï¼‰"><a href="#æµ‹è¯•æˆæƒåŠŸèƒ½ï¼ˆæ•°æ®åº“ï¼‰" class="headerlink" title="æµ‹è¯•æˆæƒåŠŸèƒ½ï¼ˆæ•°æ®åº“ï¼‰"></a>æµ‹è¯•æˆæƒåŠŸèƒ½ï¼ˆæ•°æ®åº“ï¼‰</h4><p>æµ‹è¯•å®Œè®¤è¯åŠŸèƒ½ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±å¯¹æˆæƒåŠŸèƒ½ä¸€æ¢ç©¶ç«Ÿã€‚</p><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åŸŸå¯¹è±¡</p><p><code>UserRealm.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserRealm</span> <span class="token keyword">extends</span> <span class="token class-name">AuthorizingRealm</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>    <span class="token comment">// è®¤è¯</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">AuthenticationInfo</span> <span class="token function">doGetAuthenticationInfo</span><span class="token punctuation">(</span><span class="token class-name">AuthenticationToken</span> token<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AuthenticationException</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œäº†è®¤è¯~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UsernamePasswordToken</span> usernamePasswordToken <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UsernamePasswordToken</span><span class="token punctuation">)</span> token<span class="token punctuation">;</span>        <span class="token comment">// ä»æ•°æ®åº“è¯»å–ç”¨æˆ·å å¯†ç </span>        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">queryUserByName</span><span class="token punctuation">(</span>usernamePasswordToken<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç”¨æˆ·åéªŒè¯</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token comment">// æŠ›å¼‚å¸¸ï¼šUnknownAccountException</span>        <span class="token punctuation">}</span>        <span class="token comment">// å¯†ç éªŒè¯ï¼ˆShrioè‡ªåŠ¨éªŒè¯ï¼‰</span>        <span class="token comment">// å¯ä»¥åŠ å¯†ï¼šMD5ï¼šdasdsd11 MD5ç›å€¼åŠ å¯†ï¼šdasdsd11username</span><span class="token comment">//        return new SimpleAuthenticationInfo("", user.getPwd(), "");</span>        <span class="token comment">// ä¼ é€’å½“å‰ç”¨æˆ·æ–¹ä¾¿æˆæƒå–ç”¨</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthenticationInfo</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// æˆæƒ</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token class-name">AuthorizationInfo</span> <span class="token function">doGetAuthorizationInfo</span><span class="token punctuation">(</span><span class="token class-name">PrincipalCollection</span> principals<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œäº†æˆæƒ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">SimpleAuthorizationInfo</span> info <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleAuthorizationInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–å½“å‰ç”¨æˆ· subject</span>        <span class="token class-name">Subject</span> subject <span class="token operator">=</span> <span class="token class-name">SecurityUtils</span><span class="token punctuation">.</span><span class="token function">getSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> subject<span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®æƒé™ï¼ˆä»æ•°æ®åº“ä¸­è¯»å–è¯¥ç”¨æˆ·çš„æƒé™ï¼‰</span>        info<span class="token punctuation">.</span><span class="token function">addStringPermission</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getPerms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> info<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>  Shiro é…ç½®æ–‡ä»¶</p><p><code>ShiroConfig.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShiroConfig</span> <span class="token punctuation">{</span>    <span class="token comment">// 3. ShiroFilterFactoryBean Shiroè¿‡æ»¤å™¨å·¥å‚ï¼Œè®¾ç½®å¯¹åº”çš„è¿‡æ»¤æ¡ä»¶å’Œè·³è½¬æ¡ä»¶è¿‡æ»¤è¯·æ±‚</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">ShiroFilterFactoryBean</span> <span class="token function">getShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span><span class="token string">"securityManager"</span><span class="token punctuation">)</span> <span class="token class-name">SecurityManager</span> securityManager<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ShiroFilterFactoryBean</span> bean <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ShiroFilterFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bean<span class="token punctuation">.</span><span class="token function">setSecurityManager</span><span class="token punctuation">(</span>securityManager<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/user/add"</span><span class="token punctuation">,</span><span class="token string">"perms[user:add]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æˆæƒå¿…é¡»åœ¨è®¤è¯ä¹‹å‰</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/user/*"</span><span class="token punctuation">,</span> <span class="token string">"authc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        bean<span class="token punctuation">.</span><span class="token function">setFilterChainDefinitionMap</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>        bean<span class="token punctuation">.</span><span class="token function">setUnauthorizedUrl</span><span class="token punctuation">(</span><span class="token string">"/noAuth"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æœªæˆæƒé¡µé¢</span>        bean<span class="token punctuation">.</span><span class="token function">setLoginUrl</span><span class="token punctuation">(</span><span class="token string">"/toLogin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¥å£</p><p><code>HelloController.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/noAuth"</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@ResponseBody</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">noAuth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"æœªç»æˆæƒ"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> SpringBoot </tag>
            
            <tag> Shiro </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootæ•´åˆRedis</title>
      <link href="/2020/04/01/springboot-zheng-he-redis/"/>
      <url>/2020/04/01/springboot-zheng-he-redis/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>åœ¨ SpringBoot 2.x çš„ç‰ˆæœ¬ä¸­ï¼ŒLettuce å·²ç»å–ä»£äº† Jedis æˆä¸ºé»˜è®¤çš„ Java å®¢æˆ·ç«¯å¼€å‘åŒ…ã€‚</p><blockquote><p> Jedis : ç›´è¿ï¼Œå¤šçº¿ç¨‹æ“ä½œä¸å®‰å…¨ï¼Œå¦‚æœæƒ³è¦é¿å…å°±éœ€ä½¿ç”¨ Jedis Pool è¿æ¥æ± ï¼Œç±»ä¼¼ BIO æ¨¡å¼<br>Lettuce : åŸºäºnettyï¼Œå®ä¾‹å¯ä»¥åœ¨å¤šçº¿ç¨‹ä¸­è¿›è¡Œå…±äº«ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œç±»ä¼¼ NIO æ¨¡å¼</p></blockquote><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦ä½¿ç”¨ SpringBoot é›†æˆ Redisã€‚</p><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p>å¯¼å…¥ Redis ä¾èµ–ï¼Œé…ç½®ç«¯å£å’Œä¸»æœºã€‚</p><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.5.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>applicaition.yaml</code></p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>  <span class="token key atrule">redis</span><span class="token punctuation">:</span>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.34.130    <span class="token comment">#å¯†ç </span><span class="token comment">#    password: root</span>    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>      <span class="token key atrule">pool</span><span class="token punctuation">:</span>        <span class="token comment">#æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤8</span>        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">1024</span>        <span class="token comment">#æœ€å¤§è¿æ¥é˜»å¡ç­‰å¾…æ—¶é—´ï¼Œé»˜è®¤-1</span>        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> 10000ms        <span class="token comment">#æœ€å¤§ç©ºé—²è¿æ¥</span>        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">200</span>        <span class="token comment">#æœ€å°ç©ºé—²è¿æ¥</span>        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµ‹è¯•ï¼ˆé»˜è®¤æ¨¡æ¿ï¼‰"><a href="#æµ‹è¯•ï¼ˆé»˜è®¤æ¨¡æ¿ï¼‰" class="headerlink" title="æµ‹è¯•ï¼ˆé»˜è®¤æ¨¡æ¿ï¼‰"></a>æµ‹è¯•ï¼ˆé»˜è®¤æ¨¡æ¿ï¼‰</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨ Redis çš„è‡ªåŠ¨è£…é…ç±» <strong>RedisAutoConfiguration</strong> çš„æºç ä¸­æŸ¥çœ‹å…¶é»˜è®¤æä¾›çš„æ¨¡æ¿ <strong>RedisTemplate</strong> ã€‚</p><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><p><code>RedisAutoConfiguration.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">RedisOperations</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">RedisProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">LettuceConnectionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">JedisConnectionConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisAutoConfiguration</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Bean</span><span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"redisTemplate"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span><span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> template<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Bean</span><span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token keyword">public</span> <span class="token class-name">StringRedisTemplate</span> <span class="token function">stringRedisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">UnknownHostException</span> <span class="token punctuation">{</span><span class="token class-name">StringRedisTemplate</span> template <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>template<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> template<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸éš¾çœ‹å‡ºï¼Œé»˜è®¤çš„æ¨¡æ¿æ¯”è¾ƒç®€å•ï¼Œæ²¡æœ‰è¿‡å¤šçš„é…ç½®ï¼Œä»…ä»…åªæ˜¯å¯¹æ¨¡æ¿è¿›è¡Œäº†åºåˆ—åŒ–ï¼Œå¹¶ä¸”ç”±æ³¨è§£ @ConditionalOnMissingBean(name = â€œredisTemplateâ€) å¾—çŸ¥é»˜è®¤æ¨¡æ¿çš„ç”Ÿæ•ˆæ¡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ RedisTemplate æ¥æ›¿ä»£æ­¤å¤„çš„é»˜è®¤æ¨¡æ¿ï¼Œä¾¿äºå¢å¼ºæ¨¡æ¿åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œå› ä¸º String  æ˜¯ Redis ä¸­æœ€å¸¸ç”¨çš„ç±»å‹ï¼Œæ‰€ä»¥å•ç‹¬æå– bean ä½œä¸ºå­—ç¬¦ä¸²æ¨¡æ¿ StringRedisTemplate ã€‚</p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>é€šè¿‡æ³¨å…¥ redisTemplate ï¼Œæˆ‘ä»¬å¯ä»¥éšå¿ƒæ‰€æ¬²åœ°æ“ä½œ Redis è¿›è¡Œå¢åˆ æ”¹æŸ¥ã€äº‹åŠ¡ç­‰ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">redisSpringBootTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">RedisConnection</span> connection <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">getConnectionFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    connection<span class="token punctuation">.</span><span class="token function">flushDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">,</span><span class="token string">"v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æµ‹è¯•ï¼ˆè‡ªå®šä¹‰æ¨¡æ¿ï¼‰"><a href="#æµ‹è¯•ï¼ˆè‡ªå®šä¹‰æ¨¡æ¿ï¼‰" class="headerlink" title="æµ‹è¯•ï¼ˆè‡ªå®šä¹‰æ¨¡æ¿ï¼‰"></a>æµ‹è¯•ï¼ˆè‡ªå®šä¹‰æ¨¡æ¿ï¼‰</h2><p>æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è‡ªå®šä¹‰æ¨¡æ¿æ¥å®ç°å¯¹ Redis çš„æ“ä½œã€‚é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªå®ä½“ç±» User ã€‚</p><p><code>User.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å†åˆ›å»ºä¸€ä¸ª RedisConfig çš„é…ç½®ç±»ï¼Œå› ä¸ºæˆ‘ä»¬å¼€å‘ç»å¸¸ä½¿ç”¨çš„æ˜¯ RedisTemplate&lt;String, Object&gt; ï¼Œè€Œä¸æ˜¯é»˜è®¤æ¨¡æ¿ç»™æˆ‘ä»¬æä¾›çš„ RedisTemplate&lt;Object, Object&gt; ï¼Œæ‰€ä»¥åœ¨æ­¤å¤„å¯ä»¥è‡ªå®šä¹‰å±äºæˆ‘ä»¬çš„ Redis è‡ªå®šä¹‰æ¨¡æ¿ã€‚</p><p><code>RedisConfig.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">RedisConnectionFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span>    <span class="token comment">// è‡ªå®šä¹‰ redisTemplate</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> factory<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// å¹³æ—¶å¼€å‘ä¸€èˆ¬ä½¿ç”¨ &lt;String, Object&gt;</span>        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// Jsonåºåˆ—åŒ–é…ç½®</span>        <span class="token class-name">Jackson2JsonRedisSerializer</span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">ObjectMapper</span> om <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        om<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>        om<span class="token punctuation">.</span><span class="token function">enableDefaultTyping</span><span class="token punctuation">(</span><span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">)</span><span class="token punctuation">;</span>        jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>om<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">StringRedisSerializer</span> stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//Stringç±»å‹ keyåºåˆ—å™¨</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//Stringç±»å‹ valueåºåˆ—å™¨</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//Hashç±»å‹ keyåºåˆ—å™¨</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//Hashç±»å‹ valueåºåˆ—å™¨</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> template<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ–</p><p><code>RedisConfig.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>connection<span class="token punctuation">.</span></span><span class="token class-name">RedisConnectionFactory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Bean</span><span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Stringç±»å‹ keyåºåˆ—å™¨</span>redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Stringç±»å‹ valueåºåˆ—å™¨</span>redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Hashç±»å‹ keyåºåˆ—å™¨</span>redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Hashç±»å‹ valueåºåˆ—å™¨</span>redisTemplate<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æœ‰äº†è‡ªå®šä¹‰æ¨¡æ¿ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†å…¶æ³¨å…¥ï¼Œè¿›è¡Œ Redis æ“ä½œäº†ï¼Œæ­¤å¤„ç”¨ä¼ é€’ä¸€ä¸ª user å¯¹è±¡ä½œä¸ºæµ‹è¯•ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">redisSpringBootTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"aa"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å®é™…å¼€å‘"><a href="#å®é™…å¼€å‘" class="headerlink" title="å®é™…å¼€å‘"></a>å®é™…å¼€å‘</h2><h3 id="ä½¿ç”¨-Json-ä¼ é€’å¯¹è±¡"><a href="#ä½¿ç”¨-Json-ä¼ é€’å¯¹è±¡" class="headerlink" title="ä½¿ç”¨ Json ä¼ é€’å¯¹è±¡"></a>ä½¿ç”¨ Json ä¼ é€’å¯¹è±¡</h3><p>åœ¨å·¥ä½œä¸­ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹å·²ç»åºåˆ—åŒ–çš„å®ä½“ç±»ä½¿ç”¨ Json å»ä¼ é€’å¯¹è±¡ã€‚</p><h4 id="ç¯å¢ƒ-1"><a href="#ç¯å¢ƒ-1" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.75<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>User.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Data</span><span class="token annotation punctuation">@AllArgsConstructor</span><span class="token annotation punctuation">@NoArgsConstructor</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> pwd<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä½¿ç”¨-1"><a href="#ä½¿ç”¨-1" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>æ³¨å…¥æ¨¡æ¿ï¼Œè¿›è¡Œæµ‹è¯•ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">redisSpringBootTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JsonProcessingException</span> <span class="token punctuation">{</span>    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"xiaoming"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> jsonUser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> jsonUser<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å°è£…-RedisUtil-å·¥å…·ç±»"><a href="#å°è£…-RedisUtil-å·¥å…·ç±»" class="headerlink" title="å°è£… RedisUtil å·¥å…·ç±»"></a>å°è£… RedisUtil å·¥å…·ç±»</h3><p>åŸç”Ÿçš„ Redis æ“ä½œ API æ¯”è¾ƒç¹çï¼Œä¸åˆ©äºæ•æ·å¼€å‘ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°è£…ä¸€ä¸ª Redis å·¥å…·ç±»ï¼Œç®€åŒ–æ“ä½œã€‚</p><h4 id="RedisUtil-java"><a href="#RedisUtil-java" class="headerlink" title="RedisUtil.java"></a>RedisUtil.java</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">CollectionUtils</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">RedisUtil</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>    <span class="token comment">// =============================common============================</span>    <span class="token comment">/**     * æŒ‡å®šç¼“å­˜å¤±æ•ˆæ—¶é—´     *     * @param key  é”®     * @param time æ—¶é—´(ç§’)     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">expire</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                redisTemplate<span class="token punctuation">.</span><span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ ¹æ®key è·å–è¿‡æœŸæ—¶é—´     *     * @param key é”® ä¸èƒ½ä¸ºnull     * @return æ—¶é—´(ç§’) è¿”å›0ä»£è¡¨ä¸ºæ°¸ä¹…æœ‰æ•ˆ     */</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">getExpire</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">getExpire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * åˆ¤æ–­keyæ˜¯å¦å­˜åœ¨     *     * @param key é”®     * @return true å­˜åœ¨ falseä¸å­˜åœ¨     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * åˆ é™¤ç¼“å­˜     *     * @param key å¯ä»¥ä¼ ä¸€ä¸ªå€¼ æˆ–å¤šä¸ª     */</span>    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">del</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> key<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>key<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">arrayToList</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// ============================String=============================</span>    <span class="token comment">/**     * æ™®é€šç¼“å­˜è·å–     *     * @param key é”®     * @return å€¼     */</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> key <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">null</span> <span class="token operator">:</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ™®é€šç¼“å­˜æ”¾å…¥     *     * @param key   é”®     * @param value å€¼     * @return trueæˆåŠŸ falseå¤±è´¥     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ™®é€šç¼“å­˜æ”¾å…¥å¹¶è®¾ç½®æ—¶é—´     *     * @param key   é”®     * @param value å€¼     * @param time  æ—¶é—´(ç§’) timeè¦å¤§äº0 å¦‚æœtimeå°äºç­‰äº0 å°†è®¾ç½®æ— é™æœŸ     * @return trueæˆåŠŸ false å¤±è´¥     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> time<span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * é€’å¢     *     * @param key   é”®     * @param delta è¦å¢åŠ å‡ (å¤§äº0)     */</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">incr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> delta<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"é€’å¢å› å­å¿…é¡»å¤§äº0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> delta<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * é€’å‡     *     * @param key   é”®     * @param delta è¦å‡å°‘å‡ (å°äº0)     */</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">decr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> delta<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>delta <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"é€’å‡å› å­å¿…é¡»å¤§äº0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token operator">-</span>delta<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// ================================Map=================================</span>    <span class="token comment">/**     * HashGet     *     * @param key  é”® ä¸èƒ½ä¸ºnull     * @param item é¡¹ ä¸èƒ½ä¸ºnull     */</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">hget</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–hashKeyå¯¹åº”çš„æ‰€æœ‰é”®å€¼     *     * @param key é”®     * @return å¯¹åº”çš„å¤šä¸ªé”®å€¼     */</span>    <span class="token keyword">public</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">hmget</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * HashSet     *     * @param key é”®     * @param map å¯¹åº”å¤šä¸ªé”®å€¼     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hmset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * HashSet å¹¶è®¾ç½®æ—¶é—´     *     * @param key  é”®     * @param map  å¯¹åº”å¤šä¸ªé”®å€¼     * @param time æ—¶é—´(ç§’)     * @return trueæˆåŠŸ falseå¤±è´¥     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hmset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">putAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º     *     * @param key   é”®     * @param item  é¡¹     * @param value å€¼     * @return true æˆåŠŸ falseå¤±è´¥     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å‘ä¸€å¼ hashè¡¨ä¸­æ”¾å…¥æ•°æ®,å¦‚æœä¸å­˜åœ¨å°†åˆ›å»º     *     * @param key   é”®     * @param item  é¡¹     * @param value å€¼     * @param time  æ—¶é—´(ç§’) æ³¨æ„:å¦‚æœå·²å­˜åœ¨çš„hashè¡¨æœ‰æ—¶é—´,è¿™é‡Œå°†ä¼šæ›¿æ¢åŸæœ‰çš„æ—¶é—´     * @return true æˆåŠŸ falseå¤±è´¥     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hset</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * åˆ é™¤hashè¡¨ä¸­çš„å€¼     *     * @param key  é”® ä¸èƒ½ä¸ºnull     * @param item é¡¹ å¯ä»¥ä½¿å¤šä¸ª ä¸èƒ½ä¸ºnull     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hdel</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>        redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * åˆ¤æ–­hashè¡¨ä¸­æ˜¯å¦æœ‰è¯¥é¡¹çš„å€¼     *     * @param key  é”® ä¸èƒ½ä¸ºnull     * @param item é¡¹ ä¸èƒ½ä¸ºnull     * @return true å­˜åœ¨ falseä¸å­˜åœ¨     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hHasKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * hashé€’å¢ å¦‚æœä¸å­˜åœ¨,å°±ä¼šåˆ›å»ºä¸€ä¸ª å¹¶æŠŠæ–°å¢åçš„å€¼è¿”å›     *     * @param key  é”®     * @param item é¡¹     * @param by   è¦å¢åŠ å‡ (å¤§äº0)     */</span>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">hincr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token keyword">double</span> by<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> by<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * hashé€’å‡     *     * @param key  é”®     * @param item é¡¹     * @param by   è¦å‡å°‘è®°(å°äº0)     */</span>    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">hdecr</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">String</span> item<span class="token punctuation">,</span> <span class="token keyword">double</span> by<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> item<span class="token punctuation">,</span> <span class="token operator">-</span>by<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// ============================set=============================</span>    <span class="token comment">/**     * æ ¹æ®keyè·å–Setä¸­çš„æ‰€æœ‰å€¼     *     * @param key é”®     */</span>    <span class="token keyword">public</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">sGet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ ¹æ®valueä»ä¸€ä¸ªsetä¸­æŸ¥è¯¢,æ˜¯å¦å­˜åœ¨     *     * @param key   é”®     * @param value å€¼     * @return true å­˜åœ¨ falseä¸å­˜åœ¨     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">sHasKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isMember</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å°†æ•°æ®æ”¾å…¥setç¼“å­˜     *     * @param key    é”®     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª     * @return æˆåŠŸä¸ªæ•°     */</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">sSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å°†setæ•°æ®æ”¾å…¥ç¼“å­˜     *     * @param key    é”®     * @param time   æ—¶é—´(ç§’)     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª     * @return æˆåŠŸä¸ªæ•°     */</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">sSetAndTime</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">Long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> count<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–setç¼“å­˜çš„é•¿åº¦     *     * @param key é”®     */</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">sGetSetSize</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç§»é™¤å€¼ä¸ºvalueçš„     *     * @param key    é”®     * @param values å€¼ å¯ä»¥æ˜¯å¤šä¸ª     * @return ç§»é™¤çš„ä¸ªæ•°     */</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">setRemove</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">Long</span> count <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> count<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">// ===============================list=================================</span>    <span class="token comment">/**     * è·å–listç¼“å­˜çš„å†…å®¹     *     * @param key   é”®     * @param start å¼€å§‹     * @param end   ç»“æŸ 0 åˆ° -1ä»£è¡¨æ‰€æœ‰å€¼     */</span>    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">lGet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> start<span class="token punctuation">,</span> <span class="token keyword">long</span> end<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–listç¼“å­˜çš„é•¿åº¦     *     * @param key é”®     */</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">lGetListSize</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * é€šè¿‡ç´¢å¼• è·å–listä¸­çš„å€¼     *     * @param key   é”®     * @param index ç´¢å¼• index&gt;=0æ—¶ï¼Œ 0 è¡¨å¤´ï¼Œ1 ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨ï¼›index&lt;0æ—¶ï¼Œ-1ï¼Œè¡¨å°¾ï¼Œ-2å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ï¼Œä¾æ¬¡ç±»æ¨     */</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">lGetIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å°†listæ”¾å…¥ç¼“å­˜     *     * @param key   é”®     * @param value å€¼     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å°†listæ”¾å…¥ç¼“å­˜     *     * @param key   é”®     * @param value å€¼     * @param time  æ—¶é—´(ç§’)     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPush</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å°†listæ”¾å…¥ç¼“å­˜     *     * @param key   é”®     * @param value å€¼     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPushAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å°†listæ”¾å…¥ç¼“å­˜     *     * @param key   é”®     * @param value å€¼     * @param time  æ—¶é—´(ç§’)     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lSet</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> value<span class="token punctuation">,</span> <span class="token keyword">long</span> time<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">rightPushAll</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>time <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>                <span class="token function">expire</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> time<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ ¹æ®ç´¢å¼•ä¿®æ”¹listä¸­çš„æŸæ¡æ•°æ®     *     * @param key   é”®     * @param index ç´¢å¼•     * @param value å€¼     * @return     */</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">lUpdateIndex</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> index<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç§»é™¤Nä¸ªå€¼ä¸ºvalue     *     * @param key   é”®     * @param count ç§»é™¤å¤šå°‘ä¸ª     * @param value å€¼     * @return ç§»é™¤çš„ä¸ªæ•°     */</span>    <span class="token keyword">public</span> <span class="token keyword">long</span> <span class="token function">lRemove</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span> <span class="token keyword">long</span> count<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token class-name">Long</span> remove <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> count<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> remove<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ä½¿ç”¨-2"><a href="#ä½¿ç”¨-2" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h4><p>æ³¨å…¥è‡ªå®šä¹‰çš„ Redis å·¥å…·ç±»ï¼Œè¿›è¡Œæµ‹è¯•ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Autowired</span><span class="token class-name">RedisUtil</span> redisUtil<span class="token punctuation">;</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">redisUtilTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    redisUtil<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"xiaohong"</span><span class="token punctuation">,</span> <span class="token string">"3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisUtil<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"xiaohong"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è‡³æ­¤ï¼ŒSpringBoot æ•´åˆ Redis çš„æ‰€æœ‰æ“ä½œå·²ç»å®Œæˆï¼</p>]]></content>
      
      
      <categories>
          
          <category> SpringBoot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Redis </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot è‡ªåŠ¨é…ç½®åŸç†</title>
      <link href="/2020/03/05/springboot-zi-dong-pei-zhi-yuan-li/"/>
      <url>/2020/03/05/springboot-zi-dong-pei-zhi-yuan-li/</url>
      
        <content type="html"><![CDATA[<h2 id="SpringBoot-ä¸»é…ç½®ç±»"><a href="#SpringBoot-ä¸»é…ç½®ç±»" class="headerlink" title="SpringBoot ä¸»é…ç½®ç±»"></a>SpringBoot ä¸»é…ç½®ç±»</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä» SpringBoot çš„ä¸»é…ç½®ç±»ï¼ˆè¢« <strong>@SpringBootApplication</strong> æ³¨è§£æ ‡æ³¨çš„ç±»ï¼‰å¼€å§‹ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootApplication</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿›å…¥ @SpringBootApplication æ³¨è§£ï¼Œå¯ä»¥çœ‹åˆ°å…¶ä¸Šæ–¹æœ‰ä¸‰ä¸ªæ³¨è§£ï¼Œåˆ†åˆ«æ˜¯ @SpringBootConfiguration ã€ @EnableAutoConfiguration å’Œ @ComponentScan ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@SpringBootConfiguration</span><span class="token annotation punctuation">@EnableAutoConfiguration</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>excludeFilters <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">TypeExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token annotation punctuation">@Filter</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">FilterType</span><span class="token punctuation">.</span>CUSTOM<span class="token punctuation">,</span> classes <span class="token operator">=</span> <span class="token class-name">AutoConfigurationExcludeFilter</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">SpringBootApplication</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥çš„æˆ‘ä»¬ç€é‡åˆ†æ @EnableAutoConfiguration ã€‚</p><h2 id="å¼€å¯è‡ªåŠ¨é…ç½®"><a href="#å¼€å¯è‡ªåŠ¨é…ç½®" class="headerlink" title="å¼€å¯è‡ªåŠ¨é…ç½®"></a>å¼€å¯è‡ªåŠ¨é…ç½®</h2><p> <strong>@EnableAutoConfiguration</strong> è¿™ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯ <strong>å¼€å¯è‡ªåŠ¨é…ç½®</strong> ï¼Œæˆ‘ä»¬ç‚¹å¼€å…¶æºç ï¼ˆæœ¬æ–‡ä»…å±•ç¤ºä¸è‡ªåŠ¨é…ç½®ç›¸å…³çš„é‡ç‚¹ä»£ç ï¼‰ï¼š</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@AutoConfigurationPackage</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationImportSelector</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">EnableAutoConfiguration</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ°é‡Œé¢æœ‰ä¸¤ä¸ªæ³¨è§£ï¼Œåˆ†åˆ«æ˜¯ï¼š@AutoConfigurationPackage å’Œ @Import(AutoConfigurationImportSelector.class)ï¼Œæˆ‘ä»¬æ¥é€ä¸€åˆ†æä¸€ä¸‹å®ƒä»¬å„è‡ªéƒ½åšäº†ä»€ä¹ˆäº‹æƒ…ã€‚</p><h3 id="è‡ªåŠ¨é…ç½®åŒ…"><a href="#è‡ªåŠ¨é…ç½®åŒ…" class="headerlink" title="è‡ªåŠ¨é…ç½®åŒ…"></a>è‡ªåŠ¨é…ç½®åŒ…</h3><p>  <strong>@AutoConfigurationPackage</strong> æ³¨è§£çš„æºç å¦‚ä¸‹ï¼š</p>  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationPackages<span class="token punctuation">.</span>Registrar</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">AutoConfigurationPackage</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>  è¿™ä¸ªç±»ä½¿ç”¨ @Import å¯¼å…¥äº† Registrar.class ï¼š</p>  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Registrar</span> <span class="token keyword">implements</span> <span class="token class-name">ImportBeanDefinitionRegistrar</span><span class="token punctuation">,</span> <span class="token class-name">DeterminableImports</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerBeanDefinitions</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token function">register</span><span class="token punctuation">(</span>registry<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PackageImport</span><span class="token punctuation">(</span>metadata<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  å®ƒåˆ°åº•åšäº†ä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬æŠŠ Debug æ–­ç‚¹æ‰“åœ¨æ­¤æ–¹æ³•ä¸Šï¼ŒæŸ¥çœ‹ metadata çš„å€¼ï¼Œå¯å¾—çŸ¥å…¶åŒ…å«äº†ä¸»é…ç½®ç±»çš„ä¿¡æ¯ã€‚</p><p>  <img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210804144254.png"></p><p>  é‚£ä¹ˆæ­¤å¤„å°±æ˜¯é€šè¿‡ getPackageName() æ–¹æ³•è·å–ä¸»é…ç½®ç±» Application æ‰€åœ¨çš„åŒ…è·¯å¾„ï¼Œè¿™ä¹Ÿä»ä¾§é¢è¯´æ˜äº†ä¸»é…ç½®ç±»è¦æ”¾åœ¨æœ€å¤–å±‚ç›®å½•çš„åŸå› ã€‚</p><p>  æ‰€ä»¥ï¼Œ@AutoConfigurationPackage è¿™ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯ <strong>è‡ªåŠ¨é…ç½®åŒ…ï¼Œå³é€šè¿‡å¯¼å…¥æ³¨å†Œç±» Registrar.class ä»å…ƒæ•°æ®ä¸­ metadata ä¸­æ‰¾åˆ°ä¸»é…ç½®ç±»çš„æ‰€åœ¨åŒ…è·¯å¾„ï¼Œå°†ä¸»é…ç½®ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…ä¸­çš„æ‰€æœ‰ç»„ä»¶æ‰«æåŠ è½½åˆ° Spring å®¹å™¨ä¸­</strong> ã€‚</p><h3 id="è‡ªåŠ¨é…ç½®é€‰æ‹©å™¨"><a href="#è‡ªåŠ¨é…ç½®é€‰æ‹©å™¨" class="headerlink" title="è‡ªåŠ¨é…ç½®é€‰æ‹©å™¨"></a>è‡ªåŠ¨é…ç½®é€‰æ‹©å™¨</h3><p>  <strong>AutoConfigurationImportSelector</strong> çš„æºç å¦‚ä¸‹ï¼š</p><p>  <code>AutoConfigurationImportSelector.java</code></p>  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">selectImports</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEnabled</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> NO_IMPORTS<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata <span class="token operator">=</span> <span class="token class-name">AutoConfigurationMetadataLoader</span><span class="token punctuation">.</span><span class="token function">loadMetadata</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>beanClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">AutoConfigurationEntry</span> autoConfigurationEntry <span class="token operator">=</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span>autoConfigurationMetadata<span class="token punctuation">,</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">toStringArray</span><span class="token punctuation">(</span>autoConfigurationEntry<span class="token punctuation">.</span><span class="token function">getConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getConfigurations</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configurations<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">protected</span> <span class="token class-name">AutoConfigurationEntry</span> <span class="token function">getAutoConfigurationEntry</span><span class="token punctuation">(</span><span class="token class-name">AutoConfigurationMetadata</span> autoConfigurationMetadata<span class="token punctuation">,</span><span class="token class-name">AnnotationMetadata</span> annotationMetadata<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isEnabled</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span> EMPTY_ENTRY<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token class-name">AnnotationAttributes</span> attributes <span class="token operator">=</span> <span class="token function">getAttributes</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span>configurations <span class="token operator">=</span> <span class="token function">removeDuplicates</span><span class="token punctuation">(</span>configurations<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> exclusions <span class="token operator">=</span> <span class="token function">getExclusions</span><span class="token punctuation">(</span>annotationMetadata<span class="token punctuation">,</span> attributes<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">checkExcludedClasses</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>configurations<span class="token punctuation">.</span><span class="token function">removeAll</span><span class="token punctuation">(</span>exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span>configurations <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> autoConfigurationMetadata<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">fireAutoConfigurationImportEvents</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AutoConfigurationEntry</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> exclusions<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getCandidateConfigurations</span><span class="token punctuation">(</span><span class="token class-name">AnnotationMetadata</span> metadata<span class="token punctuation">,</span> <span class="token class-name">AnnotationAttributes</span> attributes<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> configurations <span class="token operator">=</span> <span class="token class-name">SpringFactoriesLoader</span><span class="token punctuation">.</span><span class="token function">loadFactoryNames</span><span class="token punctuation">(</span><span class="token function">getSpringFactoriesLoaderFactoryClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">getBeanClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notEmpty</span><span class="token punctuation">(</span>configurations<span class="token punctuation">,</span> <span class="token string">"No auto configuration classes found in META-INF/spring.factories. If you "</span><span class="token operator">+</span> <span class="token string">"are using a custom packaging, make sure that file is correct."</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> configurations<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>  <code>SpringFactoriesLoader.java</code></p>  <pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadFactoryNames</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> factoryType<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token class-name">String</span> factoryTypeName <span class="token operator">=</span> factoryType<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token function">loadSpringFactories</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span>factoryTypeName<span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">emptyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token function">loadSpringFactories</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> urls <span class="token operator">=</span> <span class="token punctuation">(</span>classLoader <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span>                classLoader<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>FACTORIES_RESOURCE_LOCATION<span class="token punctuation">)</span> <span class="token operator">:</span>                <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemResources</span><span class="token punctuation">(</span>FACTORIES_RESOURCE_LOCATION<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedMultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">URL</span> url <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">UrlResource</span> resource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UrlResource</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token class-name">PropertiesLoaderUtils</span><span class="token punctuation">.</span><span class="token function">loadProperties</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> properties<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">String</span> factoryTypeName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> factoryImplementationName <span class="token operator">:</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">commaDelimitedListToStringArray</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>factoryTypeName<span class="token punctuation">,</span> factoryImplementationName<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        cache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Unable to load factories from location ["</span> <span class="token operator">+</span>                FACTORIES_RESOURCE_LOCATION <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> FACTORIES_RESOURCE_LOCATION <span class="token operator">=</span> <span class="token string">"META-INF/spring.factories"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æ¯ä¸ªæ–¹æ³•çš„ä½œç”¨ï¼š</p><p>â€‹    selectImportsï¼šå°†æ‰€éœ€å¯¼å…¥çš„è‡ªåŠ¨é…ç½®ç±»ä»¥å…¨ç±»å xxxAutoConfiguration çš„æ–¹å¼è¿”å›<br>â€‹    getAutoConfigurationEntryï¼šè·å–é…ç½®ç±»å®ä½“<br>   getCandidateConfigurationsï¼šè·å–ç³»ç»Ÿé¢„å…ˆåŠ è½½å¥½çš„å€™é€‰é…ç½®ç±»<br>   loadFactoryNames â€“&gt; loadSpringFactories â€“&gt; FACTORIES_RESOURCE_LOCATION = â€œMETA-INF/spring.factoriesâ€</p></blockquote><p>  spring.factories æ‰€åœ¨è·¯å¾„åŠå…¶éƒ¨åˆ†æºç ï¼š<br> <img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210804144255.png"></p>  <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Auto Configure</span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>admin<span class="token punctuation">.</span>SpringApplicationAdminJmxAutoConfiguration<span class="token punctuation">,</span>\org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>AopAutoConfiguration<span class="token punctuation">,</span>\<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>  é€šè¿‡ Debug ï¼Œå¯ä»¥çœ‹åˆ°è·å–çš„æ‰€æœ‰çš„å€™é€‰è‡ªåŠ¨é…ç½®ç±»<br>  <img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210804144258.png"></p><p>  æ‰€ä»¥ï¼ŒAutoConfigurationImportSelector çš„ä½œç”¨æ˜¯ï¼š <strong>è‡ªåŠ¨é…ç½®é€‰æ‹©å™¨ï¼Œå³ä»è·¯å¾„ â€œMETA-INF/spring.factoriesâ€ å…ƒä¿¡æ¯çš„Springå·¥å‚æ–‡ä»¶ä¸­è·å–ç³»ç»Ÿé¢„å…ˆåŠ è½½å¥½çš„å€™é€‰è‡ªåŠ¨é…ç½®ç±»ï¼Œå°†æ‰€éœ€çš„è‡ªåŠ¨é…ç½®ç±»å¯¼å…¥ Spring å®¹å™¨ã€‚</strong></p><h2 id="è‡ªåŠ¨é…ç½®ç±»çš„ç”Ÿæ•ˆæ¡ä»¶"><a href="#è‡ªåŠ¨é…ç½®ç±»çš„ç”Ÿæ•ˆæ¡ä»¶" class="headerlink" title="è‡ªåŠ¨é…ç½®ç±»çš„ç”Ÿæ•ˆæ¡ä»¶"></a>è‡ªåŠ¨é…ç½®ç±»çš„ç”Ÿæ•ˆæ¡ä»¶</h2><p>ä»‹ç»å®Œ SpringBoot æ˜¯å¦‚ä½•å¯¼å…¥è‡ªåŠ¨é…ç½®ç±»çš„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆ†æè¿™äº›è‡ªåŠ¨é…ç½®ç±»åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ‰ä¼šç”Ÿæ•ˆï¼Œæˆ‘ä»¬ä»¥è‡ªåŠ¨é…ç½®ç±» WebMvcAutoConfiguration ä¸ºä¾‹ï¼Œå…¶æºç å¦‚ä¸‹ï¼š</p><p><code>WebMvcAutoConfiguration.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ConditionalOnWebApplication</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token class-name">Type</span><span class="token punctuation">.</span>SERVLET<span class="token punctuation">)</span><span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">Servlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">DispatcherServlet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">WebMvcConfigurer</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span><span class="token class-name">WebMvcConfigurationSupport</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@AutoConfigureOrder</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span>HIGHEST_PRECEDENCE <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token annotation punctuation">@AutoConfigureAfter</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">DispatcherServletAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">TaskExecutionAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span><span class="token class-name">ValidationAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfiguration</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Import</span><span class="token punctuation">(</span><span class="token class-name">EnableWebMvcConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token class-name">WebMvcProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">ResourceProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcAutoConfigurationAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>WebMvcProperties.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"spring.mvc"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WebMvcProperties</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210804144257.png" alt="é€šè¿‡ application.yaml è‡ªå®šä¹‰ è‡ªåŠ¨é…ç½®ç±»å±æ€§"></p><p>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»çš„ç”Ÿæ•ˆæ¡ä»¶éƒ½å–å†³äº @ConditionalOnxxx æ³¨è§£ï¼Œè¯¦ç»†è¯´æ˜å¦‚å›¾ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210804144256.png"></p><p>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±» xxxAutoConfiguration éƒ½é€šè¿‡é™æ€å†…éƒ¨ç±» xxxAutoConfigurationAdapter ç»‘å®šå¯¹åº”çš„ xxxProperties ï¼ŒxxxProperties é‡ŒåŒ…å«äº†è‡ªåŠ¨é…ç½®ç±»çš„é»˜è®¤å±æ€§å€¼ï¼Œè‹¥æƒ³è‡ªå®šä¹‰å°±éœ€é€šè¿‡è®¾ç½® applicaition.yaml çš„æ–°å±æ€§å€¼è¿›è¡Œè¦†ç›–ã€‚</p><p>ä¾é  SpringBoot çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦å†æ‰‹åŠ¨é…ç½®æ³¨å…¥è¿™äº›ç¹ççš„åŠŸèƒ½ç»„ä»¶äº†ï¼ŒèŠ‚çœäº†å¤§é‡æ—¶é—´ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java JVM</title>
      <link href="/2020/02/03/java-jvm/"/>
      <url>/2020/02/03/java-jvm/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>JVM è°ƒä¼˜ç›®æ ‡ï¼šæ–¹æ³•åŒºå’Œå †ã€‚</p><h2 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223313.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223317.png"></p><ul><li>çº¿ç¨‹ç§æœ‰ï¼šç¨‹åºè®¡æ•°å™¨ã€æ ˆã€æœ¬åœ°â½…æ³•æ ˆã€‚</li><li>çº¿ç¨‹å…±äº«ï¼šâ½…æ³•åŒºã€å †ã€ç›´æ¥å†…å­˜ (ä¸åœ¨è¿â¾æ—¶æ•°æ®åŒºå†…)</li></ul><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223320.png"></p><h2 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h2><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> â€‹ä½œç”¨ï¼šåŠ è½½.classæ–‡ä»¶ã€‚</p><p><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç§ç±»ï¼š</p><ol><li>å¼•å¯¼ ç±»åŠ è½½å™¨ BootClassLoader ï¼šJVMè‡ªå¸¦ï¼Œè´Ÿè´£è£…è½½æ ¸å¿ƒç±»åº“ã€‚</li><li>æ‰©å±• ç±»åŠ è½½å™¨ ExtClassLoader ï¼šè£…è½½ jre/lib/ext ç›®å½•ä¸‹çš„jaråŒ…ã€‚</li><li>åº”ç”¨ ç±»åŠ è½½å™¨ AppClassLoaderã€‚</li></ol><pre class="line-numbers language-none"><code class="language-none">è¿‡ç¨‹ï¼š1. ç±»åŠ è½½ï¼šå°†.classæ–‡ä»¶çš„å­—èŠ‚ç åŠ è½½åˆ°å†…å­˜ï¼Œå¹¶ä¸ºä¹‹åˆ›å»ºä¸€ä¸ªClasså¯¹è±¡2. ç±»é“¾æ¥ï¼šå°†ç±»çš„äºŒè¿›åˆ¶ä»£ç åˆå¹¶åˆ°JREéªŒè¯å‡†å¤‡ï¼šä¸º staticå˜é‡ åˆ†é…å†…å­˜ç©ºé—´å¹¶è®¾ç½®åˆå§‹å€¼  m = 0è§£æï¼š&lt;clinit&gt;(){ m = 100 }3. ç±»åˆå§‹åŒ–æ—¶æœºï¼šç±»çš„ä¸»åŠ¨å¼•ç”¨ï¼šè™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œå…ˆåˆå§‹åŒ–mainæ–¹æ³•æ‰€åœ¨çš„ç±»newä¸€ä¸ªç±»çš„å¯¹è±¡è°ƒç”¨ç±»çš„staticæˆå‘˜ï¼ˆé™¤äº†finalï¼‰å’Œstaticæ–¹æ³•ä½¿ç”¨java.lang.reflectåŒ…çš„æ–¹æ³•å¯¹ç±»è¿›è¡Œåå°„è°ƒç”¨åˆå§‹åŒ–ç±»æ—¶ï¼Œå…¶çˆ¶ç±»æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™ä¼˜å…ˆåˆå§‹åŒ–çˆ¶ç±»ç±»çš„è¢«åŠ¨å¼•ç”¨ï¼ˆä¸ä¼šå‘ç”Ÿç±»åˆå§‹åŒ–ï¼‰ï¼šé€šè¿‡æ•°ç»„å®šä¹‰ç±»å¼•ç”¨å¼•ç”¨å¸¸é‡ï¼ˆå·²ç»åœ¨å¸¸é‡æ± ä¸­äº†ï¼‰å­ç±»å¼•ç”¨çˆ¶ç±»çš„é™æ€å¸¸é‡æœºåˆ¶ï¼ˆåŒäº²å§”æ´¾ï¼‰1.ä»æœ€å†…å±‚JVMè‡ªå¸¦ç±»åŠ è½½å™¨å¼€å§‹åŠ è½½ï¼Œä¸åŠ è½½å¤–å±‚æ¶æ„åŒåç±»2.ä¸¥æ ¼é€šè¿‡åŒ…åŒºåˆ†è®¿é—®åŸŸï¼Œå¤–å±‚æ¶æ„ç±»é€šè¿‡å†…ç½®ä»£ç ä¹Ÿæ— æ³•è·å–æƒé™è®¿é—®å†…å±‚ç±»  Â· å­˜å–æ§åˆ¶å™¨ï¼šæ§åˆ¶æ ¸å¿ƒAPIå¯¹æ“ä½œç³»ç»Ÿçš„å­˜å–æƒé™  Â· å®‰å…¨ç®¡ç†å™¨ï¼šæ ¸å¿ƒAPIå’Œæ“ä½œç³»ç»Ÿä¹‹é—´çš„æ¥å£ï¼Œå®ç°æƒé™æ§åˆ¶ï¼ˆä¼˜å…ˆçº§é«˜ï¼‰  Â· å®‰å…¨è½¯ä»¶åŒ…ï¼šjava.securityä¸‹çš„ç±»å’Œæ‰©å±•åŒ…ä¸‹çš„ç±»    Â· å®‰å…¨æä¾›è€…    Â· æ¶ˆæ¯æ‘˜è¦    Â· æ•°å­—ç­¾å keytools    Â· åŠ å¯†    Â· é‰´åˆ«<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223813.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Car</span> car1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Car</span> car2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>car1<span class="token punctuation">.</span>hashCode <span class="token operator">==</span> car2<span class="token punctuation">.</span>hashCode  <span class="token comment">// false</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Car</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> car1<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>classLoader æˆ– <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//AppClassLoader</span>classLoader<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//ExtClassLoader</span>classLoader<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">//null ä¸å­˜åœ¨æˆ–è°ƒç”¨ä¸åˆ°ï¼ˆC++å†™çš„ nativeï¼‰</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"java.class.path"</span><span class="token punctuation">)</span>  <span class="token comment">//ç³»ç»Ÿç±»åŠ è½½å™¨å¯ä»¥åŠ è½½çš„è·¯å¾„</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŒäº²å§”æ´¾"><a href="#åŒäº²å§”æ´¾" class="headerlink" title="åŒäº²å§”æ´¾"></a>åŒäº²å§”æ´¾</h3><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½œç”¨ï¼šå®‰å…¨ï¼Œé˜²æ­¢æ¶æ„ä»£ç å¹²æ¶‰æ­£å¸¸ä»£ç ã€‚</p><pre class="line-numbers language-none"><code class="language-none">è¿‡ç¨‹ï¼š    1.ç±»åŠ è½½å™¨æ”¶åˆ°ç±»åŠ è½½çš„è¯·æ±‚    2.ç±»åŠ è½½å™¨å°†è¯·æ±‚å‘ä¸Šå§”æ‰˜ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œä¸€ç›´å‘ä¸Šå§”æ‰˜ï¼Œç›´åˆ°å¼•å¯¼ç±»åŠ è½½å™¨    3.å¼•å¯¼ç±»åŠ è½½å™¨æ£€æŸ¥æ˜¯å¦èƒ½åŠ è½½å½“å‰ç±»ï¼Œèƒ½åŠ è½½å°±ç»“æŸï¼Œå¦åˆ™æŠ›å¼‚å¸¸ ClassNotFound é€šçŸ¥è‡ªåŠ è½½å™¨è¿›è¡ŒåŠ è½½ <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ²™ç®±å®‰å…¨"><a href="#æ²™ç®±å®‰å…¨" class="headerlink" title="æ²™ç®±å®‰å…¨"></a>æ²™ç®±å®‰å…¨</h3><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½œç”¨ï¼šå°†ä»£ç åŠ å…¥ä¿æŠ¤åŸŸï¼Œé™åˆ¶å…¶è¿è¡Œç¯å¢ƒï¼Œæ§åˆ¶ä»£ç èƒ½è¿›è¡Œå“ªäº›æ“ä½œï¼ˆé™å®šåœ¨ JVM ç‰¹å®šçš„è¿è¡ŒèŒƒå›´å†…ï¼Œé™åˆ¶å¯¹æœ¬åœ°ç³»ç»Ÿèµ„æºçš„è®¿é—®ï¼‰ã€‚</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223815.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java">ç»„ä»¶ï¼šå­—èŠ‚ç æ£€éªŒå™¨ç±»åŠ è½½å™¨ï¼šé˜²æ­¢æ¶æ„ä»£ç å¹²æ¶‰æ­£å¸¸ä»£ç ã€åŒäº²å§”æ´¾æœºåˆ¶ã€‘å®ˆæŠ¤è¢«ä¿¡ä»»çš„ç±»åº“è¾¹ç•Œå°†ä»£ç å½’å…¥ä¿æŠ¤åŸŸï¼Œé™åˆ¶å…¶è¿è¡Œç¯å¢ƒï¼Œæ§åˆ¶ä»£ç èƒ½è¿›è¡Œå“ªäº›æ“ä½œã€æ²™ç®±å®‰å…¨æœºåˆ¶ã€‘<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¿è¡Œæ—¶æ•°æ®åŒº"><a href="#è¿è¡Œæ—¶æ•°æ®åŒº" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒº"></a>è¿è¡Œæ—¶æ•°æ®åŒº</h2><h3 id="æ–¹æ³•åŒºï¼ˆç‰¹æ®Šçš„å †ï¼‰"><a href="#æ–¹æ³•åŒºï¼ˆç‰¹æ®Šçš„å †ï¼‰" class="headerlink" title="æ–¹æ³•åŒºï¼ˆç‰¹æ®Šçš„å †ï¼‰"></a>æ–¹æ³•åŒºï¼ˆç‰¹æ®Šçš„å †ï¼‰</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Method</span> <span class="token class-name">Area</span> æ¦‚å¿µï¼š è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«å­˜æ”¾ï¼š <span class="token keyword">static</span>å˜é‡ <span class="token keyword">final</span>å˜é‡ <span class="token keyword">class</span>å˜é‡ å¸¸é‡æ± <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å †ï¼ˆå­˜æ”¾å¯¹è±¡çš„åœ°å€ï¼‰"><a href="#å †ï¼ˆå­˜æ”¾å¯¹è±¡çš„åœ°å€ï¼‰" class="headerlink" title="å †ï¼ˆå­˜æ”¾å¯¹è±¡çš„åœ°å€ï¼‰"></a>å †ï¼ˆå­˜æ”¾å¯¹è±¡çš„åœ°å€ï¼‰</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223820.png"></p><pre class="line-numbers language-none"><code class="language-none">Heapæ¦‚å¿µï¼šä¸€ä¸ª JVM åªæœ‰ä¸€ä¸ªå †å†…å­˜ï¼Œå¯è‡ªç”±è°ƒèŠ‚å¤§å°å­˜æ”¾ï¼šç±»ã€æ–¹æ³•ã€å¸¸é‡ã€å˜é‡ã€æ‰€æœ‰newå‡ºæ¥çš„å¼•ç”¨ç±»å‹çš„çœŸå®å¯¹è±¡ï¼ˆè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ï¼‰åŒ…å«ï¼šæ–°ç”ŸåŒºï¼šç±»è¯ç”Ÿã€æˆé•¿ã€æ­»äº¡çš„åœ°æ–¹å…»è€åŒºå…ƒç©ºé—´ï¼ˆæ°¸ä¹…åŒºï¼‰ï¼šå¸¸é©»å†…å­˜ï¼Œå­˜æ”¾ JDK è‡ªèº«æºå¸¦çš„Classå¯¹è±¡ï¼Œä¸å­˜åœ¨åƒåœ¾å›æ”¶ï¼Œå…³é—­ JVM ä¼šé‡Šæ”¾æ­¤åŒºåŸŸå†…å­˜é€»è¾‘ä¸Šå­˜åœ¨ï¼Œç‰©ç†ä¸Šä¸å­˜åœ¨<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">long</span> max <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maxMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// JVMè¯•å›¾ä½¿ç”¨çš„æœ€å¤§å†…å­˜</span><span class="token keyword">long</span> total <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// JVMæ€»å†…å­˜</span>max<span class="token operator">/</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token operator">+</span> <span class="token string">"MB"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// OOM å †å†…å­˜æº¢å‡º æŠ¥é”™è§£å†³æ–¹æ¡ˆ</span><span class="token comment">// 1. VM options æ‰©å¤§å †å†…å­˜ </span><span class="token operator">-</span><span class="token class-name">Xms1024m</span> <span class="token operator">-</span><span class="token class-name">Xmx1024m</span> <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGCDetails</span>  <span class="token comment">// æ‰“å°GCåƒåœ¾å›æ”¶ä¿¡æ¯ Xms åˆå§‹åŒ–å†…å­˜å¤§å° Xmxæœ€å¤§å†…å­˜å¤§å°</span><span class="token operator">-</span><span class="token class-name">Xms1024m</span> <span class="token operator">-</span><span class="token class-name">Xmx1024m</span> <span class="token operator">-</span>XX<span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">HeapDumpOnOutPutMemoryError</span>  <span class="token comment">// OOM Dump</span><span class="token comment">// 2. å†…å­˜å¿«ç…§åˆ†æå·¥å…·ï¼šJprofilerã€MAT</span><span class="token comment">//    ä½œç”¨ï¼šåˆ†æDumpå†…å­˜æ–‡ä»¶ã€è·å–å †ä¸­æ•°æ®ã€è·å–å¤§çš„å¯¹è±¡</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="GC"><a href="#GC" class="headerlink" title="GC"></a>GC</h3><pre class="line-numbers language-none"><code class="language-none">åˆ†ç±»ï¼šè½»GCã€é‡GCä½œç”¨ åœ¨ï¼šæ–°ç”ŸåŒºã€å…»è€åŒºGC ç®—æ³•ï¼šå¼•ç”¨è®¡æ•°å™¨ã€å¤åˆ¶ã€æ ‡è®°æ¸…é™¤ã€æ ‡è®°æ¸…é™¤å‹ç¼©<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>1. å¼•ç”¨è®¡æ•°å™¨</strong></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223823.png"></p><p><strong>2. å¤åˆ¶</strong></p><pre class="line-numbers language-none"><code class="language-none">ä¼˜ç‚¹ï¼šä¸äº§ç”Ÿå†…å­˜ç¢ç‰‡ç¼ºç‚¹ï¼šéœ€è¦é¢å¤–å†…å­˜ç©ºé—´ï¼ˆToå¿…é¡»ä¸ºç©ºï¼‰ï¼Œç‰¹åˆ«æ˜¯æç«¯æƒ…å†µï¼šå¯¹è±¡100%å­˜æ´»åœºæ™¯ï¼šç”¨äºæ–°ç”ŸåŒºï¼ˆæ­¤æ—¶å¯¹è±¡å­˜æ´»åº¦ä½ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223825.png"></p><p><strong>3. æ ‡è®°æ¸…é™¤</strong></p><pre class="line-numbers language-none"><code class="language-none">ä¼˜ç‚¹ï¼šä¸éœ€è¦é¢å¤–å†…å­˜ç©ºé—´ç¼ºç‚¹ï¼šä¸¤æ¬¡æ‰«æï¼Œæµªè´¹æ—¶é—´ï¼Œä¼šäº§ç”Ÿå†…å­˜ç¢ç‰‡<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223828.png"></p><p><strong>4. æ ‡è®°æ¸…é™¤å‹ç¼©</strong></p><pre class="line-numbers language-none"><code class="language-none">ä¼˜ç‚¹ï¼šä¸éœ€è¦é¢å¤–å†…å­˜ç©ºé—´ï¼Œä¸äº§ç”Ÿå†…å­˜ç¢ç‰‡ç¼ºç‚¹ï¼šä¸‰æ¬¡æ‰«æï¼Œæµªè´¹æ—¶é—´<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223830.png"></p><pre class="line-numbers language-none"><code class="language-none">å†…å­˜æ•ˆç‡ï¼šå¤åˆ¶ &gt; æ ‡è®°æ¸…é™¤ &gt; æ ‡è®°å‹ç¼©å†…å­˜æ•´é½ï¼šå¤åˆ¶ = æ ‡è®°å‹ç¼© &gt; æ ‡è®°æ¸…é™¤å†…å­˜åˆ©ç”¨ï¼šæ ‡è®°å‹ç¼© = æ ‡è®°æ¸…é™¤ &gt; å¤åˆ¶GCåˆ†ä»£æ”¶é›†ç®—æ³•ï¼šæ²¡æœ‰æœ€å¥½ï¼Œåªæœ‰æœ€åˆé€‚çš„ç®—æ³•æ–°ç”ŸåŒºï¼šç”¨å¤åˆ¶å…»è€åŒºï¼šç”¨æ ‡è®°æ¸…é™¤ + æ ‡è®°æ¸…é™¤å‹ç¼©<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ ˆï¼ˆå­˜æ”¾å¯¹è±¡çš„å¼•ç”¨ï¼‰"><a href="#æ ˆï¼ˆå­˜æ”¾å¯¹è±¡çš„å¼•ç”¨ï¼‰" class="headerlink" title="æ ˆï¼ˆå­˜æ”¾å¯¹è±¡çš„å¼•ç”¨ï¼‰"></a>æ ˆï¼ˆå­˜æ”¾å¯¹è±¡çš„å¼•ç”¨ï¼‰</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816223929.png"></p><pre class="line-numbers language-none"><code class="language-none">Stackæ¦‚å¿µï¼šæ ˆå†…å­˜ï¼Œä¸»ç®¡ç¨‹åºçš„è¿è¡Œã€ç”Ÿå‘½å‘¨æœŸã€çº¿ç¨‹åŒæ­¥ï¼Œä¸€æ—¦çº¿ç¨‹ç»“æŸï¼Œæ ˆå†…å­˜å°±é‡Šæ”¾æ ˆOverï¼Œæ ˆä¸å­˜åœ¨åƒåœ¾å›æ”¶å­˜æ”¾ï¼šå…«å¤§åŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡å¼•ç”¨ã€å¯¹è±¡æ–¹æ³•<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="æœ¬åœ°æ–¹æ³•æ ˆ"><a href="#æœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆ"></a>æœ¬åœ°æ–¹æ³•æ ˆ</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Native</span> <span class="token class-name">Method</span> <span class="token class-name">Stack</span>  ç™»è®°æœ¬åœ°æ–¹æ³•ï¼ˆ<span class="token keyword">native</span> methodï¼‰ï¼Œåœ¨æ‰§è¡Œå¼•æ“æ‰§è¡Œæ—¶åŠ è½½æœ¬åœ°åº“ï¼ˆ<span class="token class-name">Native</span> <span class="token class-name">Libraries</span>ï¼‰ä½œç”¨ï¼šè°ƒç”¨åº•å±‚<span class="token class-name">C</span>è¯­è¨€çš„åº“ï¼Œè¿›å…¥æœ¬åœ°æ–¹æ³•æ ˆï¼Œè°ƒç”¨æœ¬åœ°æ–¹æ³•æ¥å£<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="ç¨‹åºè®¡æ•°å™¨"><a href="#ç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ç¨‹åºè®¡æ•°å™¨"></a>ç¨‹åºè®¡æ•°å™¨</h3><pre class="line-numbers language-none"><code class="language-none">Program Counter Registeræ¦‚å¿µï¼šæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ç¨‹åºè®¡æ•°å™¨ï¼ˆç§æœ‰ï¼‰ï¼Œå°±æ˜¯æŒ‡é’ˆï¼ŒæŒ‡å‘æ–¹æ³•åŒºä¸­çš„æ–¹æ³•å­—èŠ‚ç <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="æœ¬åœ°æ–¹æ³•æ¥å£"><a href="#æœ¬åœ°æ–¹æ³•æ¥å£" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ¥å£"></a>æœ¬åœ°æ–¹æ³•æ¥å£</h3><pre class="line-numbers language-none"><code class="language-none">Java Native Interfaceï¼ˆJNIï¼‰æ¦‚å¿µï¼šJavaæ‰©å±•ï¼Œèåˆä¸åŒè¯­è¨€<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java åå°„</title>
      <link href="/2020/02/02/java-fan-she/"/>
      <url>/2020/02/02/java-fan-she/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Reflectionï¼Œä»£ç åœ¨è¿è¡Œæ—¶å¯ä»¥å€ŸåŠ©åå°„ API è·å–ä»»ä½•ç±»çš„ä¿¡æ¯ï¼Œå¹¶èƒ½ç›´æ¥æ“ä½œä»»ä½•å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼ˆå¦‚privateï¼‰ã€‚</p><p>æ­£å¸¸ï¼šå¼•å…¥åŒ… â€“&gt; newå®ä¾‹åŒ–å¯¹è±¡ â€“&gt; å¾—åˆ°å¯¹è±¡<br>åå°„ï¼šå®ä¾‹åŒ–å¯¹è±¡ â€“&gt; getClass() â€“&gt; å¾—åˆ°å®Œæ•´åŒ…å  ã€é€šè¿‡é•œå­å¯ä»¥çœ‹åˆ°ç±»çš„å®Œæ•´ç»“æ„ä¿¡æ¯ã€‘</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816204758.png"></p><p>Class c = Class.forName(â€œjava.lang.Stringâ€);<br>åŠ è½½å®Œç±»ä¹‹åï¼Œåœ¨æ–¹æ³•åŒºä¸­äº§ç”Ÿä¸€ä¸ªClassç±»å¯¹è±¡ï¼ˆä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªClassç±»å¯¹è±¡ï¼‰ï¼ŒåŒ…å«ç±»å®Œæ•´çš„ç»“æ„ä¿¡æ¯ã€‚</p><p>å½“åŠ è½½ User å­—èŠ‚ç æ—¶ï¼ŒClasså°±ä¼šæ ¹æ®è¿™ä¸ªå­—èŠ‚ç çš„ç‰¹å¾åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹å­—èŠ‚ç è¿›è¡Œæè¿°</p><p>å¯ä»¥ç”¨ Class ç±»è·å–è¿è¡Œä¸­çš„å¯¹è±¡çš„ç±»çš„ä¿¡æ¯ï¼Œå°±èƒ½ç›´æ¥æ“ä½œå…¶å±æ€§å’Œæ–¹æ³•ã€‚</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816212325.png"></p><p>ä¼˜ç‚¹ï¼šåŠ¨æ€çµæ´»åœ°åˆ›å»ºå¯¹è±¡å’Œç¼–è¯‘ã€‚<br>ç¼ºç‚¹ï¼šæ¯” new å‡ºæ¥çš„å¯¹è±¡æ€§èƒ½é™ä½ã€‚</p><h2 id="ç¼–è¯‘-è§£é‡Š-åŠ¨æ€-é™æ€è¯­è¨€"><a href="#ç¼–è¯‘-è§£é‡Š-åŠ¨æ€-é™æ€è¯­è¨€" class="headerlink" title="ç¼–è¯‘ è§£é‡Š åŠ¨æ€ é™æ€è¯­è¨€"></a>ç¼–è¯‘ è§£é‡Š åŠ¨æ€ é™æ€è¯­è¨€</h2><p>åŠ¨æ€ï¼šä»£ç åœ¨è¿è¡Œæ—¶ç»“æ„å¯å˜æˆ–å˜é‡ç±»å‹å¯å˜ï¼ˆJSã€PHPã€Pythonï¼‰ã€‚<br>é™æ€ï¼šä»£ç åœ¨è¿è¡Œæ—¶ç»“æ„ä¸å¯å˜æˆ–å˜é‡ç±»å‹ä¸å¯å˜ï¼ˆC++ï¼‰ã€‚<br>å‡†åŠ¨æ€ï¼šåˆ©ç”¨åå°„è·å¾—ç±»ä¼¼åŠ¨æ€è¯­è¨€çš„ç‰¹æ€§ â€“&gt; çµæ´»ï¼ˆJavaï¼‰ã€‚</p><blockquote><p>ç¼–è¯‘å‹ï¼šå°†æºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œä»£ç å®‰å…¨åº¦é«˜ï¼Œæ‰§è¡Œæ•ˆç‡ä½ã€‚</p><p>è§£é‡Šå‹ï¼šè§£æå™¨å¯ä»¥ç›´æ¥è¿è¡Œæºä»£ç ï¼Œä»£ç å®‰å…¨æ€§ä½ï¼Œæ‰§è¡Œæ•ˆç‡é«˜ã€‚</p></blockquote><h2 id="åå°„-API"><a href="#åå°„-API" class="headerlink" title="åå°„ API"></a>åå°„ API</h2><ul><li>java.lang.Class                       ç±»</li><li>java.lang.reflect.Method         ç±»æ–¹æ³•</li><li>java.lang.reflect.Field             ç±»æˆå‘˜å˜é‡</li><li>java.lang.reflect.Constructor  ç±»æ„é€ å™¨</li></ul><h2 id="Class-ç±»"><a href="#Class-ç±»" class="headerlink" title="Class ç±»"></a>Class ç±»</h2><p>Classå¯¹è±¡åªèƒ½ç”±ç³»ç»Ÿåˆ›å»ºï¼ŒClassç±»æ˜¯åå°„æ ¹æºï¼Œé’ˆå¯¹ä»»ä½•å‘åŠ¨æ€åŠ è½½ã€è¿è¡Œçš„ç±»ã€å¿…é¡»å…ˆè·å¾—ç›¸åº”Classå¯¹è±¡<br>ä¸€ä¸ªåŠ è½½çš„ç±»åœ¨JVMä¸­åªæœ‰ä¸€ä¸ªClasså®ä¾‹<br>ä¸€ä¸ªClasså¯¹è±¡å¯¹åº”ä¸€ä¸ªåŠ è½½åˆ°JVMä¸­çš„ä¸€ä¸ª.classæ–‡ä»¶<br>æ¯ä¸ªç±»çš„å®ä¾‹å¯¹è±¡éƒ½ä¼šè®°å¾—è‡ªå·±æ˜¯ç”±å“ªä¸ªClasså®ä¾‹æ‰€ç”Ÿæˆçš„ï¼ˆå¼ ä¸‰ä¼šè®°å¾—Persionç±»ï¼‰<br>é€šè¿‡Classå¯ä»¥å®Œæ•´åœ°å¾—åˆ°ä¸€ä¸ªç±»ä¸­æ‰€æœ‰è¢«åŠ è½½çš„ç»“æ„</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816203950.png"></p><h2 id="Class-ç±»æ–¹æ³•"><a href="#Class-ç±»æ–¹æ³•" class="headerlink" title="Class ç±»æ–¹æ³•"></a>Class ç±»æ–¹æ³•</h2><table><thead><tr><th>è¿”å›å€¼</th><th>æ–¹æ³•å</th><th></th></tr></thead><tbody><tr><td>static ç±»&lt;?&gt;</td><td><code>forName(String className)</code></td><td>è¿”å›æŒ‡å®šç±»åçš„Classå¯¹è±¡</td></tr><tr><td>T</td><td><code>newInstance()</code></td><td>è¿”å›å½“å‰Classå¯¹è±¡çš„ä¸€ä¸ªå®ä¾‹</td></tr><tr><td>String</td><td><code>getName()</code></td><td>è¿”å›å½“å‰Classå¯¹è±¡è¡¨ç¤ºçš„å®ä½“å</td></tr><tr><td>Class</td><td><code>getSuperclass()</code></td><td>è¿”å›å½“å‰Classå¯¹è±¡çš„çˆ¶ç±»Classå¯¹è±¡</td></tr><tr><td>Class[]</td><td><code>getInterfaces()</code></td><td>è¿”å›å½“å‰Classå¯¹è±¡çš„æ¥å£</td></tr><tr><td>ClassLoader</td><td><code>getClassLoader()</code></td><td>è¿”å›å½“å‰Classå¯¹è±¡çš„ç±»åŠ è½½å™¨</td></tr><tr><td>Constructor[]</td><td><code>getConstructors()</code></td><td>è¿”å›åŒ…å«æ„é€ å™¨çš„æ•°ç»„</td></tr><tr><td>Method</td><td><code>getMethod(String name,Clss ...T)</code></td><td>è¿”å›Methodå¯¹è±¡</td></tr><tr><td></td><td><code>getModifiers()</code></td><td>è¿”å›å½“å‰Classå¯¹è±¡çš„ç±»ä¿®é¥°ç¬¦</td></tr><tr><td></td><td><code>getPackage()</code></td><td>è¿”å›å½“å‰Classå¯¹è±¡çš„åŒ…å</td></tr><tr><td>Field[]</td><td><code>getDeclaredFields()</code></td><td>è¿”å›åŒ…å«Fieldå¯¹è±¡çš„æ•°ç»„</td></tr></tbody></table><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ç±»ä¿®é¥°ç¬¦</span><span class="token comment">//   public,protected,private,final,static,abstract,interface</span><span class="token comment">//   2çš„æ¬¡å¹‚æ•°è¿›è¡Œç´¯åŠ å¾—åˆ°çš„ç»“æœæ˜¯å”¯ä¸€çš„ï¼Œé€šè¿‡ä¸€ä¸ªå€¼å¯ä»¥çŸ¥é“å¤šä¸ªä¿®é¥°ç¬¦</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clazz01<span class="token punctuation">.</span><span class="token function">getModifiers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//16</span><span class="token comment">// æ˜¯å¦ä¸ºåŸå§‹æ•°æ®ç±»å‹ï¼ˆ8ç§åŸºæœ¬æ•°æ®ç±»å‹+voidï¼‰</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>clazz01<span class="token punctuation">.</span><span class="token function">isPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//false</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//false</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//false</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//true</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">.</span><span class="token function">isPrimitive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·å–-Class-ç±»å¯¹è±¡"><a href="#è·å–-Class-ç±»å¯¹è±¡" class="headerlink" title="è·å– Class ç±»å¯¹è±¡"></a>è·å– Class ç±»å¯¹è±¡</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 1. Class.forName(åŒ…å.ç±»å)</span><span class="token class-name">Class</span> c1 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.kuang.pojo.User"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c1<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> c2<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// true</span><span class="token comment">// 2. ç±»å.class</span><span class="token class-name">Student</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token comment">// 3. å¯¹è±¡.getClass()</span>person<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">// 4. åŒ…è£…ç±».Type</span><span class="token class-name">Integer</span><span class="token punctuation">.</span>TYPE<span class="token comment">// 5. å­ç±».getSuperClass()</span>c1<span class="token punctuation">.</span><span class="token function">getSuperClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·å–-Class-ç±»å¯¹è±¡çš„å±æ€§"><a href="#è·å–-Class-ç±»å¯¹è±¡çš„å±æ€§" class="headerlink" title="è·å– Class ç±»å¯¹è±¡çš„å±æ€§"></a>è·å– Class ç±»å¯¹è±¡çš„å±æ€§</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210816213710.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.xxxx.Student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å…¬æœ‰</span><span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> fs <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// public int com.xxxx.Student.sid</span><span class="token comment">// public java.lang.String com.xxxx.Student.sname</span><span class="token comment">// public static int com.xxxx.Student.scount</span><span class="token comment">// public int com.xxxx.Person.pid</span><span class="token comment">// public java.lang.String com.xxxx.Person.pname</span><span class="token comment">// ç§æœ‰</span><span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dfs <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span>dfs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// public int com.xxxx.Student.sid</span><span class="token comment">// public java.lang.String com.xxxx.Student.sname</span><span class="token comment">// protected java.lang.String com.xxxx.Student.sidcard</span><span class="token comment">// private java.util.Date com.xxxx.Student.sbirthday</span><span class="token class-name">Field</span> sname <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getField</span><span class="token punctuation">(</span><span class="token string">"sname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Field</span> sbirthday <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">"sbirthday"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·å–-Class-ç±»å¯¹è±¡çš„æ–¹æ³•"><a href="#è·å–-Class-ç±»å¯¹è±¡çš„æ–¹æ³•" class="headerlink" title="è·å– Class ç±»å¯¹è±¡çš„æ–¹æ³•"></a>è·å– Class ç±»å¯¹è±¡çš„æ–¹æ³•</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello03Method</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">,</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">{</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.xxxx.Student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å…¬å…±</span>        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ms <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç§æœ‰</span>        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dms <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è°ƒç”¨æ–¹æ³•     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">methodInvoke</span><span class="token punctuation">(</span><span class="token class-name">Class</span> clazz<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span><span class="token punctuation">,</span> <span class="token class-name">InvocationTargetException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalAccessException</span> <span class="token punctuation">{</span>        <span class="token comment">// è·å–æŒ‡å®šæ–¹æ³• clazz.getMethod()</span>        <span class="token class-name">Method</span> method01 <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"shello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Method</span> method02 <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"shello"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è°ƒç”¨æˆå‘˜æ–¹æ³• method.invoke()</span>        <span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        method01<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">;</span>        method02<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>student<span class="token punctuation">,</span> <span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–ã€è°ƒç”¨é™æ€æ–¹æ³• clazz.getMethod()  method.invoke()</span>        <span class="token class-name">Method</span> method04 <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"srun"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        method04<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å¸¸è§é”™è¯¯     */</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">methodException</span><span class="token punctuation">(</span><span class="token class-name">Class</span> clazz<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NoSuchMethodException</span> <span class="token punctuation">{</span>        <span class="token comment">//å¸¸è§é”™è¯¯</span>        <span class="token comment">//NoSuchMethodException: com.xxxx.Student.shello(int)</span>        <span class="token comment">//Method method = clazz.getMethod("shello", int.class);</span>        <span class="token comment">//Method method =clazz.getMethod("hello");</span>        <span class="token comment">//Method method = clazz.getMethod("shello", String.class);</span>        <span class="token comment">//java.lang.NullPointerException</span>        <span class="token comment">//method.invoke(null);</span>        <span class="token comment">//java.lang.IllegalArgumentException: argument type mismatch</span>        <span class="token comment">//method.invoke(new Student(), 18);</span>        <span class="token comment">//java.lang.IllegalArgumentException: wrong number of arguments</span>        <span class="token comment">//method.invoke(new Student(), "abcd", 18);</span>        <span class="token comment">//java.lang.IllegalArgumentException: object is not an instance of declaring class</span>        <span class="token comment">//method.invoke(new Object(), "abcd", 18);</span>        <span class="token comment">//å…¬å…±æ–¹æ³•è°ƒç”¨ç§æœ‰æ–¹æ³•</span>        <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredMethod</span><span class="token punctuation">(</span><span class="token string">"shi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//java.lang.IllegalAccessException: class com.xxxx.Hello03Method cannot access a member of class com.xxxx.Student with modifiers "private"</span>        <span class="token comment">//method.invoke(new Student());</span>        <span class="token comment">//å¦‚æœè®¾ç½®ä¸ºtrueï¼Œåˆ™ä¸è¿›è¡Œå°è£…å‹ä¿®é¥°ç¬¦çš„æ£€æµ‹ï¼Œé‚£ä¹ˆå¯ä»¥è¿›è¡Œç§æœ‰æ–¹æ³•çš„è°ƒç”¨ï¼Œä½†æ˜¯å°½é‡ä¸è¦è¿™ä¹ˆå»ä½¿ç”¨</span>        <span class="token comment">//method.setAccessible(true);</span>        <span class="token comment">//method.invoke(new Student());</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è·å–-Class-ç±»å¯¹è±¡çš„æ„é€ å™¨"><a href="#è·å–-Class-ç±»å¯¹è±¡çš„æ„é€ å™¨" class="headerlink" title="è·å– Class ç±»å¯¹è±¡çš„æ„é€ å™¨"></a>è·å– Class ç±»å¯¹è±¡çš„æ„é€ å™¨</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.xxxx.Student"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å…¬å…±</span><span class="token class-name">Constructor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cs <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ç§æœ‰</span><span class="token class-name">Constructor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dcs <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredConstructors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åˆ›å»ºå¯¹è±¡ï¼ˆç¡®ä¿ç©ºæ„é€ å™¨å­˜åœ¨ï¼‰</span><span class="token class-name">Constructor</span> constructor0 <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Student</span> student <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token punctuation">)</span> constructor0<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Constructor</span> constructor1 <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Student</span> student1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Student</span><span class="token punctuation">)</span> constructor1<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"idcard"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="é€šè¿‡åå°„è°ƒç”¨æ³¨è§£"><a href="#é€šè¿‡åå°„è°ƒç”¨æ³¨è§£" class="headerlink" title="é€šè¿‡åå°„è°ƒç”¨æ³¨è§£"></a>é€šè¿‡åå°„è°ƒç”¨æ³¨è§£</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello04Reflection</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>        <span class="token comment">//è·å–ç±»å¯¹è±¡</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.xxxx.Dog"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–ç±»å¯¹è±¡çš„æ‰€æœ‰æ³¨è§£</span>        <span class="token class-name">Annotation</span><span class="token punctuation">[</span><span class="token punctuation">]</span> annotations <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getAnnotations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Annotation</span> anno <span class="token operator">:</span> annotations<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>anno<span class="token punctuation">.</span><span class="token function">annotationType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>anno<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>anno<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">//è·å–ç±»å¯¹è±¡çš„æŒ‡å®šæ³¨è§£</span>        <span class="token class-name">Pet</span> petanno <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Pet</span><span class="token punctuation">)</span> clazz<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Pet</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>petanno<span class="token punctuation">.</span><span class="token function">annotationType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>petanno<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>petanno<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Pet</span> <span class="token punctuation">{</span>    <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">"å®¶å…»å® ç‰©çŠ¬"</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">Shepherd</span> <span class="token punctuation">{</span>    <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Pet</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">"å‰å¨ƒå¨ƒ"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Shepherd</span><span class="token punctuation">(</span>type <span class="token operator">=</span> <span class="token string">"å¾·ç‰§"</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello05Test</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>        <span class="token comment">//åˆ›å»ºå¯¹è±¡</span>        <span class="token class-name">Teacher</span> teacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Teacher</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"å¼ ä¸‰ä¸°"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"æ­¦å½“å±±"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//å£°æ˜ä¸€ä¸ªå¯å˜å­—ç¬¦ä¸²ä¿å­˜æ‰“å°ä¿¡æ¯</span>        <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–ç±»å¯¹è±¡</span>        <span class="token class-name">Class</span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.xxxx.Teacher"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//è·å–æ‰€æœ‰çš„å±æ€§</span>        <span class="token class-name">Field</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dfs <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getDeclaredFields</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Field</span> field <span class="token operator">:</span> dfs<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">//å¼€å§‹è·å–å±æ€§å¯¹åº”çš„æ³¨è§£</span>            <span class="token class-name">FieldChineseName</span> anno <span class="token operator">=</span> field<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">FieldChineseName</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>anno <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    <span class="token comment">//è·å–å–å€¼æ–¹æ³•  "getid" -&gt; "getId"</span>                    <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"get"</span> <span class="token operator">+</span> field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> field<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">Method</span> method <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//public java.lang.Integer com.xxxx.Teacher.getId()</span>                    <span class="token comment">//è·å–ä¸­æ–‡åå­—  ,å±æ€§[æ•™å¸ˆç¼–å·]çš„å€¼ä¸º[1]</span>                    sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">",å±æ€§["</span> <span class="token operator">+</span> anno<span class="token punctuation">.</span><span class="token function">chineseName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]çš„å€¼ä¸º["</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"]"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalAccessException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InvocationTargetException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token comment">//        System.out.println(sb);  //,å±æ€§[æ•™å¸ˆç¼–å·]çš„å€¼ä¸º[1],å±æ€§[æ•™å¸ˆå§“å]çš„å€¼ä¸º[å¼ ä¸‰ä¸°]</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>sb<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//å±æ€§[æ•™å¸ˆç¼–å·]çš„å€¼ä¸º[1],å±æ€§[æ•™å¸ˆå§“å]çš„å€¼ä¸º[å¼ ä¸‰ä¸°]</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>FIELD<span class="token punctuation">)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">FieldChineseName</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">chineseName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">Teacher</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@FieldChineseName</span><span class="token punctuation">(</span>chineseName <span class="token operator">=</span> <span class="token string">"æ•™å¸ˆç¼–å·"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token annotation punctuation">@FieldChineseName</span><span class="token punctuation">(</span>chineseName <span class="token operator">=</span> <span class="token string">"æ•™å¸ˆå§“å"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> address<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Teacher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">Teacher</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Date</span> birthday<span class="token punctuation">,</span> <span class="token class-name">String</span> address<span class="token punctuation">,</span> <span class="token class-name">Date</span> createTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>birthday <span class="token operator">=</span> birthday<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>createTime <span class="token operator">=</span> createTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getBirthday</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> birthday<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBirthday</span><span class="token punctuation">(</span><span class="token class-name">Date</span> birthday<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>birthday <span class="token operator">=</span> birthday<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> address<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAddress</span><span class="token punctuation">(</span><span class="token class-name">String</span> address<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> address<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> createTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setCreateTime</span><span class="token punctuation">(</span><span class="token class-name">Date</span> createTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>createTime <span class="token operator">=</span> createTime<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">==</span> o<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>o <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> o<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token class-name">Teacher</span> teacher <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Teacher</span><span class="token punctuation">)</span> o<span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> teacher<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>                <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> teacher<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>                <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>birthday<span class="token punctuation">,</span> teacher<span class="token punctuation">.</span>birthday<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>                <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>address<span class="token punctuation">,</span> teacher<span class="token punctuation">.</span>address<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>                <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>createTime<span class="token punctuation">,</span> teacher<span class="token punctuation">.</span>createTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">hash</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> name<span class="token punctuation">,</span> birthday<span class="token punctuation">,</span> address<span class="token punctuation">,</span> createTime<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"Teacher{"</span> <span class="token operator">+</span>                <span class="token string">"id="</span> <span class="token operator">+</span> id <span class="token operator">+</span>                <span class="token string">", name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>                <span class="token string">", birthday="</span> <span class="token operator">+</span> birthday <span class="token operator">+</span>                <span class="token string">", address='"</span> <span class="token operator">+</span> address <span class="token operator">+</span> <span class="token string">'\''</span> <span class="token operator">+</span>                <span class="token string">", createTime="</span> <span class="token operator">+</span> createTime <span class="token operator">+</span>                <span class="token string">'}'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java æ³¨è§£</title>
      <link href="/2020/02/01/java-zhu-jie/"/>
      <url>/2020/02/01/java-zhu-jie/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>æ³¨è§£ï¼šAnnotationï¼Œæ³¨é‡Šï¼šCommentã€‚<br>ä½œç”¨ï¼šå¯¹ç¨‹åºä½œå‡ºè§£é‡Š å¯è¢«å…¶ä»–ç¨‹åºï¼ˆç¼–è¯‘å™¨ï¼‰è¯»å–ã€‚<br>è¯­æ³•ï¼š@æ³¨è§£å( )ã€‚<br>ç±»å‹ï¼š</p><table><thead><tr><th>æ³¨è§£å‚æ•°ä¸ªæ•°</th><th></th></tr></thead><tbody><tr><td>æ ‡è®°æ³¨è§£</td><td>ä¸€ä¸ªæ²¡æœ‰æˆå‘˜å®šä¹‰çš„ Annotation ç±»å‹</td></tr><tr><td>å•å€¼æ³¨è§£</td><td>å•å€¼</td></tr><tr><td>å®Œæ•´æ³¨è§£</td><td>å¤šå€¼</td></tr></tbody></table><h2 id="å†…ç½®æ³¨è§£"><a href="#å†…ç½®æ³¨è§£" class="headerlink" title="å†…ç½®æ³¨è§£"></a>å†…ç½®æ³¨è§£</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span>  <span class="token comment">// é‡å†™</span><span class="token annotation punctuation">@Deprecated</span><span class="token punctuation">(</span>since <span class="token operator">=</span> <span class="token string">"V1.8"</span><span class="token punctuation">)</span>  <span class="token comment">// åºŸå¼ƒ</span><span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">)</span>  <span class="token comment">// æŠ‘åˆ¶</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å…ƒæ³¨è§£"><a href="#å…ƒæ³¨è§£" class="headerlink" title="å…ƒæ³¨è§£"></a>å…ƒæ³¨è§£</h2><p>ä½œç”¨ï¼šæ³¨è§£å…¶ä»–æ³¨è§£ã€‚<br>è¯­æ³•ï¼špublic @interface æ³¨è§£å { å†…å®¹ }ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// è‡ªå®šä¹‰å…ƒæ³¨è§£ è‡ªåŠ¨ç»§æ‰¿ Annotation æ¥å£</span><span class="token comment">// 1. èŒƒå›´ï¼ˆå¯åŠ åœ¨å“ªäº›å…ƒç´ ä¸Šï¼‰ï¼Œè‹¥@Targetæ²¡å†™åˆ™é»˜è®¤å¯ä½¿ç”¨åœ¨ä»»ä½•å…ƒç´ ä¸Š</span><span class="token comment">//    TYPEï¼ˆç±»ã€æ¥å£ï¼‰, METHODï¼ˆæ–¹æ³•ï¼‰, CONSTRUCTORï¼ˆæ„é€ å™¨ï¼‰, FIELDï¼ˆå­—æ®µï¼‰</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">,</span> <span class="token class-name">ElementType</span><span class="token punctuation">.</span>METHOD<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token comment">// 2. ç”Ÿå‘½å‘¨æœŸ (SOURCE:åœ¨æºä»£ç ç§ç”Ÿæ•ˆ  CLASS:åœ¨ç±»ä¸­ç”Ÿæ•ˆ  RUNTIME:è¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæ•ˆï¼Œèƒ½è¢«åå°„å‘ç°)</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token annotation punctuation">@Document</span>  <span class="token comment">// 3. æ˜¯å¦æ–‡æ¡£åŒ–ï¼ˆè¢«ä¾‹å¦‚ javadoc æ­¤ç±»çš„å·¥å…·æ–‡æ¡£åŒ–ï¼‰</span><span class="token annotation punctuation">@Inherited</span>  <span class="token comment">// 4. æ˜¯å¦èƒ½è¢«å­ç±»è‡ªåŠ¨ç»§æ‰¿</span><span class="token annotation punctuation">@Native</span>  <span class="token comment">// 5. åº•å±‚ä»£ç ç”±å…¶ä»–è¯­è¨€æ„æˆ</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">MyAnnotation</span> <span class="token punctuation">{</span>    <span class="token class-name">String</span> <span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">schools</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token string">"aa"</span><span class="token punctuation">,</span><span class="token string">"bb"</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span><span class="token annotation punctuation">@interface</span> <span class="token class-name">Role</span> <span class="token punctuation">{</span>    <span class="token class-name">Position</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Repeatable</span><span class="token punctuation">(</span><span class="token class-name">Role</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>  <span class="token comment">// 6. é‡å¤</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span>RUNTIME<span class="token punctuation">)</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span>TYPE<span class="token punctuation">)</span><span class="token annotation punctuation">@interface</span> <span class="token class-name">Position</span> <span class="token punctuation">{</span>    <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Position</span><span class="token punctuation">(</span><span class="token string">"å†›é•¿"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@Position</span><span class="token punctuation">(</span><span class="token string">"æ”¿æ²»éƒ¨å‰¯ä¸»ä»»"</span><span class="token punctuation">)</span><span class="token keyword">class</span> <span class="token class-name">Soldier</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis ä¸»ä»å¤åˆ¶</title>
      <link href="/2020/01/20/redis-zhu-cong-fu-zhi/"/>
      <url>/2020/01/20/redis-zhu-cong-fu-zhi/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>ä¸»ä»å¤åˆ¶ï¼ŒæŒ‡çš„æ˜¯å°†ä¸€å° Redis æœåŠ¡å™¨çš„æ•°æ®ï¼Œå¤åˆ¶åˆ°å…¶ä»–çš„ Redis æœåŠ¡å™¨ä¸Šï¼Œæ•°æ®çš„å¤åˆ¶æ˜¯å•å‘çš„ï¼Œåªèƒ½ç”±ä¸»èŠ‚ç‚¹åˆ°ä»èŠ‚ç‚¹ã€‚å‰è€…ç§°ä¸ºä¸»èŠ‚ç‚¹( master / leader )ï¼Œä»¥å†™ä¸ºä¸»ï¼Œåè€…ç§°ä¸ºä»èŠ‚ç‚¹( slave / follower )ï¼Œä»¥è¯»ä¸ºä¸»ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯å°RedisæœåŠ¡å™¨éƒ½æ˜¯ä¸»èŠ‚ç‚¹ï¼Œä¸”ä¸€ä¸ªä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªä»èŠ‚ç‚¹(æˆ–æ²¡æœ‰ä»èŠ‚ç‚¹)ï¼Œä½†ä¸€ä¸ªä»èŠ‚ç‚¹åªèƒ½æœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹ã€‚</p><p>ä¸»ä»å¤åˆ¶ä¸»è¦æœ‰ä»¥ä¸‹ä½œç”¨ï¼š</p><ol><li>æ•°æ®å†—ä½™ï¼šä¸»ä»å¤åˆ¶å®ç°äº†æ•°æ®çš„çƒ­å¤‡ä»½ï¼Œæ˜¯æŒä¹…åŒ–ä¹‹å¤–çš„ä¸€ç§æ•°æ®å†—ä½™æ–¹å¼ã€‚</li><li>æ•…éšœæ¢å¤ï¼šå½“ä¸»èŠ‚ç‚¹å‡ºç°é—®é¢˜æ—¶ï¼Œå¯ä»¥ç”±ä»èŠ‚ç‚¹æä¾›æœåŠ¡ï¼Œå®ç°å¿«é€Ÿçš„æ•…éšœæ¢å¤ï¼Œä½†å®é™…ä¸Šæ˜¯ä¸€ç§æœåŠ¡çš„å†—ä½™ã€‚</li><li>è´Ÿè½½å‡è¡¡ï¼šåœ¨ä¸»ä»å¤åˆ¶çš„åŸºç¡€ä¸Šï¼Œé…åˆè¯»å†™åˆ†ç¦»ï¼Œå¯ä»¥ç”±ä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œç”±ä»èŠ‚ç‚¹æä¾›è¯»æœåŠ¡ï¼Œå³å†™ Redis æ•°æ®æ—¶åº”ç”¨è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯» Redis æ•°æ®æ—¶åº”ç”¨è¿æ¥ä»èŠ‚ç‚¹ï¼Œåˆ†æ‹…æœåŠ¡å™¨è´Ÿè½½ï¼Œå°¤å…¶æ˜¯åœ¨å†™å°‘è¯»å¤šçš„åœºæ™¯ä¸‹ï¼Œé€šè¿‡å¤šä¸ªä»èŠ‚ç‚¹åˆ†æ‹…è¯»è´Ÿè½½ï¼Œå¯ä»¥å¤§å¤§æé«˜ Redis æœåŠ¡å™¨çš„å¹¶å‘é‡ã€‚</li><li>é«˜å¯ç”¨çš„åŸºçŸ³ï¼šä¸»ä»å¤åˆ¶æ˜¯å“¨å…µå’Œé›†ç¾¤èƒ½å¤Ÿå®æ–½çš„åŸºç¡€ã€‚</li></ol><h2 id="æ¶æ„ï¼ˆä¸€ä¸»äºŒä»ï¼‰"><a href="#æ¶æ„ï¼ˆä¸€ä¸»äºŒä»ï¼‰" class="headerlink" title="æ¶æ„ï¼ˆä¸€ä¸»äºŒä»ï¼‰"></a>æ¶æ„ï¼ˆä¸€ä¸»äºŒä»ï¼‰</h2><p>åœ¨é¡¹ç›®ä¸­ï¼Œä¸å¯èƒ½åªä½¿ç”¨ä¸€å° Redis ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ol><li>ä»ç»“æ„ä¸Šï¼Œå•ä¸ª Redis æœåŠ¡å™¨å¯èƒ½ä¼šå•ç‚¹æ•…éšœï¼ˆå®•æœºï¼‰ï¼Œå¹¶ä¸”ä¸€å°æœåŠ¡å™¨éœ€è¦å¤„ç†æ‰€æœ‰çš„è¯·æ±‚è´Ÿè½½ï¼Œå‹åŠ›è¾ƒå¤§ã€‚</li><li>ä»å®¹é‡ä¸Šï¼Œå•ä¸ª Redis æœåŠ¡å™¨å†…å­˜å®¹é‡æœ‰é™ï¼Œå°±ç®—ä¸€å°RedisæœåŠ¡å™¨å†…å­˜å®¹é‡ä¸º256Gï¼Œä¹Ÿä¸èƒ½å°†æ‰€æœ‰å†…å­˜ç”¨ä½œRediså­˜å‚¨å†…å­˜ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œå•å°Redisæœ€å¤§ä½¿ç”¨å†…å­˜ä¸åº”è¯¥è¶…è¿‡20Gã€‚å¦‚ï¼šç”µå•†ç½‘ç«™ä¸Šçš„å•†å“ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸€æ¬¡ä¸Šä¼ ï¼Œæ— æ•°æ¬¡æµè§ˆçš„ï¼Œè¯´ä¸“ä¸šç‚¹ä¹Ÿå°±æ˜¯â€å¤šè¯»å°‘å†™â€ã€‚</li></ol><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806171136.png"></p><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>Slave å¯åŠ¨æˆåŠŸåï¼Œä¼šè‡ªåŠ¨è¿æ¥åˆ° master ä¼šå‘é€ä¸€ä¸ªåŒæ­¥å‘½ä»¤ sync ï¼Œmaster æ¥åˆ°åŒæ­¥å‘½ä»¤ä¼šå¯åŠ¨åå°çš„å­˜ç›˜è¿›ç¨‹ï¼ŒåŒæ—¶æ”¶é›†æ‰€æœ‰æ¥æ”¶åˆ°çš„ç”¨äºä¿®æ”¹æ•°æ®é›†å‘½ä»¤ï¼Œåœ¨åå°è¿›ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œmaster å°†ä¼ é€æ•´ä¸ªæ•°æ®æ–‡ä»¶åˆ° slaveï¼Œå¹¶å®Œæˆä¸€æ¬¡å…¨é‡å¤åˆ¶ã€‚ åªè¦é‡è¿ masterï¼Œéƒ½å°†è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡å…¨é‡å¤åˆ¶ã€‚</p><blockquote><p>å…¨é‡å¤åˆ¶ï¼šslave åœ¨æ¥æ”¶åˆ°æ•°æ®åº“æ–‡ä»¶æ•°æ®åï¼Œå°†å…¶å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­ã€‚<br>å¢é‡å¤åˆ¶ï¼šmaster å°†æ–°çš„æ‰€æœ‰æ”¶é›†åˆ°çš„ä¿®æ”¹å‘½ä»¤ä¾æ¬¡ä¼ ç»™ slaveï¼Œslave å†å­˜ç›˜å¹¶åŠ è½½åˆ°å†…å­˜ä¸­å®ŒæˆåŒæ­¥ã€‚</p></blockquote><h2 id="å•æœºå¤šé›†ç¾¤"><a href="#å•æœºå¤šé›†ç¾¤" class="headerlink" title="å•æœºå¤šé›†ç¾¤"></a>å•æœºå¤šé›†ç¾¤</h2><p>æœ¬ä¾‹å°†é…ç½®ä¸€ä¸»äºŒä»ï¼Œæœ‰ä¸¤ç§å®ç°æ¨¡å‹å¯ä¾›é€‰æ‹©ï¼Œæ­¤å¤„é‡‡ç”¨ç¬¬ä¸€ç§æ–¹å¼ï¼š</p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806171152.png"></p><p>é¦–å…ˆå¤åˆ¶ 3 ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åä¿®æ”¹å¯¹åº”çš„ä¿¡æ¯ï¼šç«¯å£ã€è¿›ç¨‹ pid åã€æ—¥å¿—æ–‡ä»¶åã€dump.rdb å¿«ç…§æ–‡ä»¶åã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">vim</span> redis-6379.conf$ <span class="token function">vim</span> redis-6380.conf$ <span class="token function">vim</span> redis-6381.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>redis.conf</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">port <span class="token number">6379</span>pidfile /var/run/redis_6379.pidlogfile <span class="token string">"6379.log"</span>dbfilename dump6379.rdb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>redis.conf</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">port <span class="token number">6380</span>pidfile /var/run/redis_6380.pidlogfile <span class="token string">"6380.log"</span>dbfilename dump6380.rdb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>redis.conf</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">port <span class="token number">6381</span>pidfile /var/run/redis_6381.pidlogfile <span class="token string">"6381.log"</span>dbfilename dump6381.rdb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ redis-server kconfig/redis-6379.conf$ redis-server kconfig/redis-6380.conf$ redis-server kconfig/redis-6381.conf$ <span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> redis<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>æœªé…ç½®ä¸»ä»æœºå‰ï¼ŒæŸ¥çœ‹å½“å‰èŠ‚ç‚¹çš„å¤åˆ¶ä¿¡æ¯ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> redis-cli -p <span class="token number">6379</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication   <span class="token comment"># æŸ¥çœ‹å½“å‰èŠ‚ç‚¹å¤åˆ¶ä¿¡æ¯</span>role:master  <span class="token comment"># è§’è‰² master ä¸»æœº</span>connected_slaves:0 <span class="token comment">#  æ²¡æœ‰ä»æœº</span>master_replid:b63c90e6c501143759cb0e7f450bd1eb0c70882a master_replid2:0000000000000000000000000000000000000000 master_repl_offset:0 second_repl_offset:-1 repl_backlog_active:0 repl_backlog_size:1048576 repl_backlog_first_byte_offset:0 repl_backlog_histlen:0 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é€šè¿‡å‘½ä»¤ï¼Œé…ç½®ä¸»ä»æœº"><a href="#é€šè¿‡å‘½ä»¤ï¼Œé…ç½®ä¸»ä»æœº" class="headerlink" title="é€šè¿‡å‘½ä»¤ï¼Œé…ç½®ä¸»ä»æœº"></a>é€šè¿‡å‘½ä»¤ï¼Œé…ç½®ä¸»ä»æœº</h3><p>è¿™ç§é…ç½®æ˜¯æš‚æ—¶çš„ï¼Œå¦‚æœä»æœºé‡å¯ï¼Œå°±ä¼šå˜å›ä¸»æœºï¼Œä¸€æ—¦é‡æ–°é…ç½®æˆä»æœºï¼Œå°±ä¼šç«‹å³ä»ä¸»æœºåŒæ­¥å€¼ã€‚</p><p>è®¾ç½®ä»æœº 6380 çš„ä¸»æœºä¸º 6379ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> SLAVEOF <span class="token number">127.0</span>.0.1 <span class="token number">6379</span><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span> info replication role:slave  <span class="token comment"># å½“å‰è§’è‰²æ˜¯ä»æœº </span>master_host:127.0.0.1   <span class="token comment"># å…¶ä¸»æœºä¿¡æ¯</span>master_port:6379 master_link_status:up master_last_io_seconds_ago:3 master_sync_in_progress:0 slave_repl_offset:14 slave_priority:100 slave_read_only:1 connected_slaves:0 master_replid:a81be8dd257636b2d3e7a9f595e69d73ff03774e master_replid2:0000000000000000000000000000000000000000 master_repl_offset:14 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:1 repl_backlog_histlen:14<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è®¾ç½®ä»æœº 6381 çš„ä¸»æœºä¸º 6379ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> SLAVEOF <span class="token number">127.0</span>.0.1 <span class="token number">6379</span><span class="token number">127.0</span>.0.1:638<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span> info replication role:slave  <span class="token comment"># å½“å‰è§’è‰²æ˜¯ä»æœº </span>master_host:127.0.0.1   <span class="token comment"># å…¶ä¸»æœºä¿¡æ¯</span>master_port:6379 master_link_status:up master_last_io_seconds_ago:3 master_sync_in_progress:0 slave_repl_offset:14 slave_priority:100 slave_read_only:1 connected_slaves:0 master_replid:a81be8dd257636b2d3e7a9f595e69d73ff03774e master_replid2:0000000000000000000000000000000000000000 master_repl_offset:14 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:1 repl_backlog_histlen:14<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸»æœº 6379 ä¸­æŸ¥çœ‹æ˜¯å¦é…ç½®æˆåŠŸï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> info replication role:master connected_slaves:2  <span class="token comment"># ä»æœºæ•°é‡</span>slave0:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6380</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">196</span>,lag<span class="token operator">=</span><span class="token number">1</span>slave1:ip<span class="token operator">=</span><span class="token number">127.0</span>.0.1,port<span class="token operator">=</span><span class="token number">6381</span>,state<span class="token operator">=</span>online,offset<span class="token operator">=</span><span class="token number">196</span>,lag<span class="token operator">=</span><span class="token number">0</span>master_replid:a81be8dd257636b2d3e7a9f595e69d73ff03774e master_replid2:0000000000000000000000000000000000000000 master_repl_offset:42 second_repl_offset:-1 repl_backlog_active:1 repl_backlog_size:1048576 repl_backlog_first_byte_offset:1 repl_backlog_histlen:42 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é…ç½®å®Œæˆåï¼Œä¸»æœºå¯ä»¥å†™ï¼Œä»æœºåªèƒ½è¯»ï¼Œä¸»æœºä¸­çš„æ‰€æœ‰ä¿¡æ¯å’Œæ•°æ®ï¼Œéƒ½ä¼šè‡ªåŠ¨è¢«ä»æœºä¿å­˜ï¼Œå¦‚æœä¸»æœºæ–­å¼€è¿æ¥ï¼Œä»æœºå†è¿æ¥åˆ°ä¸»æœºçš„ï¼Œä½†æ˜¯æ²¡æœ‰å†™æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™ï¼Œä¸»æœºå¦‚æœå›æ¥äº†ï¼Œä»æœºä¾æ—§å¯ä»¥ç›´æ¥è·å–åˆ°ä¸»æœºå†™çš„ä¿¡æ¯ï¼</p><h3 id="é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œé…ç½®ä¸»ä»æœº"><a href="#é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œé…ç½®ä¸»ä»æœº" class="headerlink" title="é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œé…ç½®ä¸»ä»æœº"></a>é€šè¿‡é…ç½®æ–‡ä»¶ï¼Œé…ç½®ä¸»ä»æœº</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">################################# å¤åˆ¶ #################################</span>replicaof <span class="token number">127.0</span>.0.1 <span class="token number">6379</span>  <span class="token comment"># ä¸»æœºç«¯å£å’ŒIP</span>masterauth <span class="token number">123456</span>  <span class="token comment"># ä¸»æœºå¯†ç </span>replica-serve-stale-data <span class="token function">yes</span>replica-read-only <span class="token function">yes</span>repl-diskless-sync norepl-diskless-sync-delay <span class="token number">5</span><span class="token comment"># repl-timeout 60</span>repl-disable-tcp-nodelay no<span class="token comment"># repl-backlog-size 1mb</span><span class="token comment"># repl-backlog-ttl 3600</span>replica-priority <span class="token number">100</span><span class="token comment"># min-replicas-to-write 3</span><span class="token comment"># min-replicas-max-lag 10</span><span class="token comment"># replica-announce-ip 5.5.5.5</span><span class="token comment"># replica-announce-port 1234</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¤šæœºå¤šé›†ç¾¤"><a href="#å¤šæœºå¤šé›†ç¾¤" class="headerlink" title="å¤šæœºå¤šé›†ç¾¤"></a>å¤šæœºå¤šé›†ç¾¤</h2><p>å¾…æ—¥åæ—¶é—´å……è£•å†è¿›è¡Œæµ‹è¯•</p><h2 id="å“¨å…µæ¨¡å¼"><a href="#å“¨å…µæ¨¡å¼" class="headerlink" title="å“¨å…µæ¨¡å¼"></a>å“¨å…µæ¨¡å¼</h2><p>æ‰‹åŠ¨é€‰å–ä¸»æœºï¼šå½“ä¸»æœºèŠ‚ç‚¹æ–­å¼€æ—¶ï¼Œä»æœºå¯ä»¥ä½¿ç”¨ <strong>slaveof no one</strong> è®©è‡ªå·±å˜æˆä¸»æœºï¼Œå¦‚æœåŸä¸»æœºå†è¿å›æ¥ï¼Œåªèƒ½å½“æ–°ä¸»æœºçš„ä»æœºã€‚</p><p>è‡ªåŠ¨é€‰å–ä¸»æœºï¼šå“¨å…µæ¨¡å¼ï¼Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå…¶åŸç†æ˜¯å“¨å…µé€šè¿‡å‘é€å‘½ä»¤ï¼Œç­‰å¾… Redis æœåŠ¡å™¨å“åº”ï¼Œä»è€Œç›‘æ§è¿è¡Œçš„å¤šä¸ª Redis å®ä¾‹ã€‚</p><h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><blockquote><p>ä¼˜ç‚¹ï¼š </p><ol><li>ç³»ç»Ÿçš„å¯ç”¨æ€§ã€å¥å£®æ€§é«˜ï¼šä¸»ä»åˆ‡æ¢ï¼Œæ•…éšœè½¬ç§»ã€‚</li></ol><p>ç¼ºç‚¹ï¼š </p><ol><li>é›†ç¾¤å®¹é‡ä¸€æ—¦åˆ°è¾¾ä¸Šé™ï¼Œä¸å¥½åœ¨çº¿æ‰©å®¹ã€‚</li><li>é…ç½®ç¹çã€‚</li></ol></blockquote><h3 id="å•å“¨å…µ"><a href="#å•å“¨å…µ" class="headerlink" title="å•å“¨å…µ"></a>å•å“¨å…µ</h3><h4 id="æ¶æ„"><a href="#æ¶æ„" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h4><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806171611.png"></p><blockquote><p>å“¨å…µä½œç”¨</p><ol><li>é€šè¿‡ç»™ä¸»æœºå’Œä»æœºå‘é€å‘½ä»¤ï¼Œè®© Redis æœåŠ¡å™¨å“åº”ï¼Œè¿›è€Œç›‘æ§å…¶è¿è¡ŒçŠ¶æ€ã€‚ </li><li>å½“å“¨å…µç›‘æµ‹åˆ°ä¸»æœºå®•æœºï¼Œä¼šé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼é€šçŸ¥å…¶ä»–çš„ä»æœºï¼Œä¿®æ”¹å…¶é…ç½®æ–‡ä»¶ï¼Œè®©å®ƒä»¬åˆ‡æ¢æ–°ä¸»æœºã€‚</li></ol></blockquote><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">vim</span> sentinel.conf  <span class="token comment"># åˆ›å»ºå“¨å…µé…ç½®æ–‡ä»¶</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><code>sentinel.conf</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">sentinel monitor myredis <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">1</span>  <span class="token comment"># é»˜è®¤çš„ä¸»æœºèŠ‚ç‚¹ï¼ˆ1ä»£è¡¨å¦‚æœä¸»æœºæŒ‚äº†ï¼Œå°±è®©ä»æœºæŠ•ç¥¨å†³å®šè°å½“æ–°ä¸»æœºï¼‰</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ redis-sentinel kconfig/sentinel.conf  <span class="token comment"># å¯åŠ¨å“¨å…µ</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="å¤šå“¨å…µ"><a href="#å¤šå“¨å…µ" class="headerlink" title="å¤šå“¨å…µ"></a>å¤šå“¨å…µ</h3><h4 id="æ¶æ„-1"><a href="#æ¶æ„-1" class="headerlink" title="æ¶æ„"></a>æ¶æ„</h4><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806171615.png"></p><blockquote><p>å“¨å…µä½œç”¨ï¼š</p><ol><li>å‡è®¾ä¸»æœºå®•æœºï¼Œå“¨å…µ1å…ˆæ£€æµ‹åˆ°è¿™ä¸ªç»“æœï¼Œç³»ç»Ÿå¹¶ä¸ä¼šé©¬ä¸Šè¿›è¡Œæ•…éšœè½¬ç§»( failover ) ï¼Œä»…ä»…æ˜¯å“¨å…µ 1 ä¸»è§‚è®¤ä¸ºä¸»æœºä¸å¯ç”¨ï¼Œå³ä¸»è§‚ä¸‹çº¿ã€‚</li><li>å½“åé¢çš„å“¨å…µä¹Ÿæ£€æµ‹åˆ°ä¸»æœºä¸å¯ç”¨ï¼Œå¹¶æ•°é‡è¾¾åˆ°ä¸€å®šå€¼æ—¶ï¼Œé‚£ä¹ˆå“¨å…µä¹‹é—´å°±ä¼šè¿›è¡Œä¸€æ¬¡æŠ•ç¥¨ï¼ŒæŠ•ç¥¨çš„ç»“æœç”±ä¸€ä¸ªå“¨å…µå‘èµ·ï¼Œè¿›è¡Œæ•…éšœè½¬ç§»ã€‚åˆ‡æ¢æˆåŠŸåï¼Œå°±ä¼šé€šè¿‡å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œè®©å„ä¸ªå“¨å…µæŠŠè‡ªå·±ç›‘æ§çš„ä»æœºåˆ‡æ¢æ–°ä¸»æœºï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå®¢è§‚ä¸‹çº¿ã€‚ </li></ol></blockquote><h3 id="å®Œæ•´é…ç½®"><a href="#å®Œæ•´é…ç½®" class="headerlink" title="å®Œæ•´é…ç½®"></a>å®Œæ•´é…ç½®</h3><p><code>sentinel.conf</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Example sentinel.conf </span><span class="token comment"># å“¨å…µsentinelå®ä¾‹è¿è¡Œçš„ç«¯å£ é»˜è®¤26379 </span>port <span class="token number">26379</span> <span class="token comment"># å“¨å…µsentinelçš„å·¥ä½œç›®å½• </span><span class="token function">dir</span> /tmp <span class="token comment"># å“¨å…µsentinelç›‘æ§çš„redisä¸»èŠ‚ç‚¹çš„ ip port </span><span class="token comment"># master-name  å¯ä»¥è‡ªå·±å‘½åçš„ä¸»èŠ‚ç‚¹åå­— åªèƒ½ç”±å­—æ¯A-zã€æ•°å­—0-9 ã€è¿™ä¸‰ä¸ªå­—ç¬¦".-_"ç»„æˆã€‚ </span><span class="token comment"># quorum é…ç½®å¤šå°‘ä¸ªsentinelå“¨å…µç»Ÿä¸€è®¤ä¸ºmasterä¸»èŠ‚ç‚¹å¤±è” é‚£ä¹ˆè¿™æ—¶å®¢è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹å¤±è”äº† </span><span class="token comment"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt; </span>sentinel monitor mymaster <span class="token number">127.0</span>.0.1 <span class="token number">6379</span> <span class="token number">2</span> <span class="token comment"># å½“åœ¨Rediså®ä¾‹ä¸­å¼€å¯äº†requirepass foobared æˆæƒå¯†ç  è¿™æ ·æ‰€æœ‰è¿æ¥Rediså®ä¾‹çš„å®¢æˆ·ç«¯éƒ½è¦æä¾› å¯†ç  </span><span class="token comment"># è®¾ç½®å“¨å…µsentinel è¿æ¥ä¸»ä»çš„å¯†ç  æ³¨æ„å¿…é¡»ä¸ºä¸»ä»è®¾ç½®ä¸€æ ·çš„éªŒè¯å¯†ç  </span><span class="token comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt; </span>sentinel auth-pass mymaster MySUPER--secret-0123passw0rd <span class="token comment"># æŒ‡å®šå¤šå°‘æ¯«ç§’ä¹‹å    ä¸»èŠ‚ç‚¹æ²¡æœ‰åº”ç­”å“¨å…µsentinel æ­¤æ—¶å“¨å…µä¸»è§‚ä¸Šè®¤ä¸ºä¸»èŠ‚ç‚¹ä¸‹çº¿ é»˜è®¤30ç§’ </span><span class="token comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt; </span>sentinel down-after-milliseconds mymaster <span class="token number">30000</span> <span class="token comment"># è¿™ä¸ªé…ç½®é¡¹æŒ‡å®šäº†åœ¨å‘ç”Ÿfailoverä¸»å¤‡åˆ‡æ¢æ—¶æœ€å¤šå¯ä»¥æœ‰å¤šå°‘ä¸ª slave åŒæ—¶å¯¹æ–°çš„masterè¿›è¡ŒåŒæ­¥ï¼Œ è¿™ä¸ªæ•°å­—è¶Šå°ï¼Œå®Œæˆ failover æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ï¼Œ </span><span class="token comment"># ä½†æ˜¯å¦‚æœè¿™ä¸ªæ•°å­—è¶Šå¤§ï¼Œå°±æ„å‘³ç€è¶Š    å¤šçš„slaveå› ä¸ºreplicationè€Œä¸å¯ç”¨ã€‚ </span><span class="token comment"># å¯ä»¥é€šè¿‡å°†è¿™ä¸ªå€¼è®¾ä¸º 1 æ¥ä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªslave å¤„äºä¸èƒ½å¤„ç†å‘½ä»¤è¯·æ±‚çš„çŠ¶æ€ã€‚ </span><span class="token comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt; </span>sentinel parallel-syncs mymaster <span class="token number">1</span> <span class="token comment"># æ•…éšœè½¬ç§»çš„è¶…æ—¶æ—¶é—´    failover-timeout å¯ä»¥ç”¨åœ¨ä»¥ä¸‹è¿™äº›æ–¹é¢ï¼š </span><span class="token comment">#1. åŒä¸€ä¸ªsentinelå¯¹åŒä¸€ä¸ªmasterä¸¤æ¬¡failoverä¹‹é—´çš„é—´éš”æ—¶é—´ã€‚ </span><span class="token comment">#2. å½“ä¸€ä¸ªslaveä»ä¸€ä¸ªé”™è¯¯çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®å¼€å§‹è®¡ç®—æ—¶é—´ã€‚ç›´åˆ°slaveè¢«çº æ­£ä¸ºå‘æ­£ç¡®çš„masteré‚£é‡ŒåŒæ­¥æ•°æ®æ—¶ã€‚ </span><span class="token comment">#3.å½“æƒ³è¦å–æ¶ˆä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„failoveræ‰€éœ€è¦çš„æ—¶é—´ã€‚ </span><span class="token comment">#4.å½“è¿›è¡Œfailoveræ—¶ï¼Œé…ç½®æ‰€æœ‰slavesæŒ‡å‘æ–°çš„masteræ‰€éœ€çš„æœ€å¤§æ—¶é—´ã€‚ä¸è¿‡ï¼Œå³ä½¿è¿‡äº†è¿™ä¸ªè¶…æ—¶ï¼Œ slaves ä¾ç„¶ä¼šè¢«æ­£ç¡®é…ç½®ä¸ºæŒ‡å‘ masterï¼Œä½†æ˜¯å°±ä¸æŒ‰parallel-syncsæ‰€é…ç½®çš„è§„åˆ™æ¥äº† </span><span class="token comment"># é»˜è®¤ä¸‰åˆ†é’Ÿ </span><span class="token comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span>sentinel failover-timeout mymaster <span class="token number">180000</span><span class="token comment"># SCRIPTS EXECUTION </span><span class="token comment">#é…ç½®å½“æŸä¸€äº‹ä»¶å‘ç”Ÿæ—¶æ‰€éœ€è¦æ‰§è¡Œçš„è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡è„šæœ¬æ¥é€šçŸ¥ç®¡ç†å‘˜ï¼Œä¾‹å¦‚å½“ç³»ç»Ÿè¿è¡Œä¸æ­£å¸¸æ—¶å‘é‚®ä»¶é€šçŸ¥ ç›¸å…³äººå‘˜ã€‚ </span><span class="token comment">#å¯¹äºè„šæœ¬çš„è¿è¡Œç»“æœæœ‰ä»¥ä¸‹è§„åˆ™ï¼š </span><span class="token comment">#è‹¥è„šæœ¬æ‰§è¡Œåè¿”å›1ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬ç¨åå°†ä¼šè¢«å†æ¬¡æ‰§è¡Œï¼Œé‡å¤æ¬¡æ•°ç›®å‰é»˜è®¤ä¸º10 </span><span class="token comment">#è‹¥è„šæœ¬æ‰§è¡Œåè¿”å›2ï¼Œæˆ–è€…æ¯”2æ›´é«˜çš„ä¸€ä¸ªè¿”å›å€¼ï¼Œè„šæœ¬å°†ä¸ä¼šé‡å¤æ‰§è¡Œã€‚ </span><span class="token comment">#å¦‚æœè„šæœ¬åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ç”±äºæ”¶åˆ°ç³»ç»Ÿä¸­æ–­ä¿¡å·è¢«ç»ˆæ­¢äº†ï¼Œåˆ™åŒè¿”å›å€¼ä¸º1æ—¶çš„è¡Œä¸ºç›¸åŒã€‚ </span><span class="token comment">#ä¸€ä¸ªè„šæœ¬çš„æœ€å¤§æ‰§è¡Œæ—¶é—´ä¸º60sï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ—¶é—´ï¼Œè„šæœ¬å°†ä¼šè¢«ä¸€ä¸ªSIGKILLä¿¡å·ç»ˆæ­¢ï¼Œä¹‹åé‡æ–°æ‰§è¡Œã€‚ </span><span class="token comment">#é€šçŸ¥å‹è„šæœ¬:å½“sentinelæœ‰ä»»ä½•è­¦å‘Šçº§åˆ«çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚è¯´rediså®ä¾‹çš„ä¸»è§‚å¤±æ•ˆå’Œå®¢è§‚å¤±æ•ˆç­‰ç­‰ï¼‰ï¼Œå°†ä¼šå»è°ƒç”¨è¿™ä¸ªè„šæœ¬ï¼Œè¿™æ—¶è¿™ä¸ªè„šæœ¬åº”è¯¥é€šè¿‡é‚®ä»¶ï¼ŒSMSç­‰æ–¹å¼å»é€šçŸ¥ç³»ç»Ÿç®¡ç†å‘˜å…³äºç³»ç»Ÿä¸æ­£å¸¸è¿è¡Œçš„ä¿¡ æ¯ã€‚è°ƒç”¨è¯¥è„šæœ¬æ—¶ï¼Œå°†ä¼ ç»™è„šæœ¬ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶çš„ç±»å‹ï¼Œä¸€ä¸ªæ˜¯äº‹ä»¶çš„æè¿°ã€‚å¦‚æœsentinel.confé… ç½®æ–‡ä»¶ä¸­é…ç½®äº†è¿™ä¸ªè„šæœ¬è·¯å¾„ï¼Œé‚£ä¹ˆå¿…é¡»ä¿è¯è¿™ä¸ªè„šæœ¬å­˜åœ¨äºè¿™ä¸ªè·¯å¾„ï¼Œå¹¶ä¸”æ˜¯å¯æ‰§è¡Œçš„ï¼Œå¦åˆ™sentinelæ—  æ³•æ­£å¸¸å¯åŠ¨æˆåŠŸã€‚ </span><span class="token comment">#é€šçŸ¥è„šæœ¬ </span><span class="token comment"># shellç¼–ç¨‹ </span><span class="token comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt; </span>sentinel notification-script mymaster /var/redis/notify.sh <span class="token comment"># å®¢æˆ·ç«¯é‡æ–°é…ç½®ä¸»èŠ‚ç‚¹å‚æ•°è„šæœ¬ </span><span class="token comment"># å½“ä¸€ä¸ªmasterç”±äºfailoverè€Œå‘ç”Ÿæ”¹å˜æ—¶ï¼Œè¿™ä¸ªè„šæœ¬å°†ä¼šè¢«è°ƒç”¨ï¼Œé€šçŸ¥ç›¸å…³çš„å®¢æˆ·ç«¯å…³äºmasteråœ°å€å·² ç»å‘ç”Ÿæ”¹å˜çš„ä¿¡æ¯ã€‚ </span><span class="token comment"># ä»¥ä¸‹å‚æ•°å°†ä¼šåœ¨è°ƒç”¨è„šæœ¬æ—¶ä¼ ç»™è„šæœ¬: </span><span class="token comment"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt; </span><span class="token comment"># ç›®å‰&lt;state&gt;æ€»æ˜¯â€œfailoverâ€, </span><span class="token comment"># &lt;role&gt;æ˜¯â€œleaderâ€æˆ–è€…â€œobserverâ€ä¸­çš„ä¸€ä¸ªã€‚ </span><span class="token comment"># å‚æ•° from-ip, from-port, to-ip, to-port æ˜¯ç”¨æ¥å’Œæ—§çš„ master å’Œæ–°çš„ master (å³æ—§çš„slave)é€šä¿¡çš„ </span><span class="token comment"># è¿™ä¸ªè„šæœ¬åº”è¯¥æ˜¯é€šç”¨çš„ï¼Œèƒ½è¢«å¤šæ¬¡è°ƒç”¨ï¼Œä¸æ˜¯é’ˆå¯¹æ€§çš„ã€‚ </span><span class="token comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt; </span>sentinel client-reconfig-script mymaster /var/redis/reconfig.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> ä¸»ä»å¤åˆ¶ </tag>
            
            <tag> å“¨å…µæ¨¡å¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Servlet</title>
      <link href="/2020/01/18/servlet/"/>
      <url>/2020/01/18/servlet/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¦‚å¿µ<br>Server + Appletï¼ŒæœåŠ¡ç«¯å°ç¨‹åºï¼Œè¿è¡Œåœ¨æœåŠ¡å™¨ç«¯çš„ Servlet å®¹å™¨ä¸­ã€‚<br>Servlet å®¹å™¨ï¼šæä¾›äº† Servlet åŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå¦‚ Tomcat, Jetty, WebLogic Server, WebSphere, JBoss ç­‰ã€‚<br><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>ä½œç”¨<br>     è§£è€¦ï¼Œä½œä¸º Web åº”ç”¨çš„æ§åˆ¶å™¨ç»„ä»¶ï¼Œç”ŸæˆåŠ¨æ€çš„ Web é¡µé¢ã€‚</p><h2 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822220012.png"></p><pre class="line-numbers language-none"><code class="language-none">ç”±äºServletè¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œæ²¡æœ‰main()æ–¹æ³•ï¼Œå› æ­¤ï¼Œæ•´ä¸ªç”Ÿå‘½å‘¨æœŸéƒ½æ˜¯ç”±å®¹å™¨æ¥æ§åˆ¶çš„ã€‚Servletçš„ç”Ÿå‘½å‘¨æœŸåªæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼šæœªåˆ›å»ºçŠ¶æ€ä¸åˆå§‹åŒ–çŠ¶æ€ã€‚è¿™ä¸¤ç§çŠ¶æ€çš„è½¬æ¢ä¸»è¦æ˜¯ç”±ä¸‰ä¸ªé‡è¦çš„æ–¹ æ³•æ¥è¿›è¡Œæ§åˆ¶ï¼šinit()&gt; service()å’Œdestroy()ã€‚å…¶ä¸­ï¼Œinit()æ–¹æ³•æ˜¯Servletç”Ÿå‘½çš„èµ·ç‚¹ï¼Œç”¨äºåˆ›å»ºæˆ–æ‰“å¼€ä»»ä½•ä¸Servletç›¸å…³çš„èµ„æºä»¥åŠæ‰§è¡Œåˆå§‹åŒ–å·¥ä½œã€‚service()æ ¹æ®HTTPè¯·æ±‚çš„methodå±æ€§çš„ä¸åŒ(GETã€POSTç­‰)å°†è¯·æ±‚åˆ†å‘åˆ°doGet()ã€doPost()ç­‰æ–¹æ³•ã€‚destory()æ–¹æ³•é‡Šæ”¾ä»»ä½•åœ¨init()æ–¹æ³•ä¸­æ‰“å¼€çš„ä¸Servletç›¸å…³çš„èµ„æºã€‚ç†è§£ï¼šäººçš„ä¸€ç”Ÿ å‡ºç”Ÿ-ç”Ÿæ´»-æ­»äº¡åˆå§‹åŒ–ï¼šinit() æ¯å½“è¯·æ±‚åˆ°è¾¾å®¹å™¨æ—¶ï¼Œå®¹å™¨æŸ¥æ‰¾ servlet å¯¹è±¡æ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºå®ä¾‹å¹¶è¿›è¡Œåˆå§‹åŒ–ã€‚æœåŠ¡:service() æ¯å½“è¯·æ±‚åˆ°è¾¾å®¹å™¨ï¼Œå®¹å™¨è°ƒç”¨ servlet å¯¹è±¡çš„ service()æ–¹æ³•å¤„ç†è¯·æ±‚ï¼Œå¯è¢«å¤šæ¬¡è°ƒç”¨é”€æ¯:destroy() å½“æœåŠ¡å™¨å…³é—­ / åº”ç”¨ç¨‹åºåœæ­¢æ—¶ï¼Œé”€æ¯ Servlet å®ä¾‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å·¥ä½œåŸç†"><a href="#å·¥ä½œåŸç†" class="headerlink" title="å·¥ä½œåŸç†"></a>å·¥ä½œåŸç†</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822210928.png"></p><pre class="line-numbers language-none"><code class="language-none">1ï¼‰æµè§ˆå™¨å‘ Servletå®¹å™¨ å‘èµ·è¯·æ±‚ã€‚2ï¼‰å®¹å™¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šåˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼šHttpServletRequest å’Œ HttpServletResponseã€‚3ï¼‰å®¹å™¨æ ¹æ®è¯·æ±‚çš„ URL æ‰¾åˆ°å¯¹åº”çš„ Servletï¼Œç„¶åé’ˆå¯¹è¯¥è¯·æ±‚åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼ˆå®¹å™¨ä¼šé’ˆå¯¹æ¯æ¬¡è¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹è¿›è¡Œå¤„ç†ï¼‰ï¼Œ åŒæ—¶æŠŠä¸¤ä¸ªå¯¹è±¡ä»¥å‚æ•°çš„å½¢å¼ä¼ é€’åˆ°æ–°åˆ›å»ºçš„çº¿ç¨‹ä¸­ã€‚4ï¼‰å®¹å™¨è°ƒç”¨ Servlet çš„ service()æ–¹æ³•æ¥å®Œæˆå¯¹ç”¨æˆ·è¯·æ±‚çš„å“åº”ï¼Œservice()æ–¹æ³•ä¼šè°ƒç”¨ doPost()æˆ– doGet() æ–¹æ³•æ¥å®Œæˆå…·ä½“çš„å“åº”ä»»åŠ¡ï¼ŒåŒæ—¶æŠŠç”Ÿæˆçš„åŠ¨æ€é¡µé¢è¿”å›ç»™å®¹å™¨ã€‚ 56ï¼‰å®¹å™¨æŠŠå“åº”ç»„è£…æˆ HTTP æ ¼å¼è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æ­¤æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹è¿è¡Œç»“æŸé€€å‡ºï¼ŒåŒæ—¶åˆ é™¤ç¬¬ 2 æ­¥åˆ›å»ºçš„ä¸¤ä¸ªå¯¹è±¡ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="MVCï¼ˆServlet-JSPï¼‰"><a href="#MVCï¼ˆServlet-JSPï¼‰" class="headerlink" title="MVCï¼ˆServlet + JSPï¼‰"></a>MVCï¼ˆServlet + JSPï¼‰</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822212412.png"></p><h2 id="åŒºåˆ«ï¼ˆServlet-JSPï¼‰"><a href="#åŒºåˆ«ï¼ˆServlet-JSPï¼‰" class="headerlink" title="åŒºåˆ«ï¼ˆServlet + JSPï¼‰"></a>åŒºåˆ«ï¼ˆServlet + JSPï¼‰</h2><h3 id="ç›¸åŒç‚¹"><a href="#ç›¸åŒç‚¹" class="headerlink" title="ç›¸åŒç‚¹"></a>ç›¸åŒç‚¹</h3><p>JSPå¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Servletï¼Œå®ƒåªä¸è¿‡æ˜¯å¯¹Servletçš„æ‰©å±•ï¼ŒJSPå¯ä»¥å®Œæˆçš„å·¥ä½œï¼ŒServletéƒ½å¯ä»¥å®Œæˆã€‚å¦‚ï¼Œç”ŸæˆåŠ¨æ€é¡µé¢ã€‚ç”±äºJSPé¡µé¢æœ€ç»ˆè¦è¢«è½¬æ¢æˆServletæ¥è¿è¡Œ, å› æ­¤ï¼Œå¤„ç†è¯·æ±‚å®é™…ä¸Šæ˜¯ç¼–è¯‘åçš„Servletã€‚ </p><h3 id="ä¸åŒç‚¹"><a href="#ä¸åŒç‚¹" class="headerlink" title="ä¸åŒç‚¹"></a>ä¸åŒç‚¹</h3><p>â‘ HTMLå®ç°æ–¹å¼</p><p>Servletï¼šåœ¨Javaè¯­è¨€ä¸­åµŒå…¥HTMLä»£ç ï¼Œç¼–å†™å’Œä¿®æ”¹HTMLä¸æ–¹ä¾¿ï¼Œ é€‚åˆåšæµç¨‹æ§åˆ¶ã€ä¸šåŠ¡å¤„ç†ã€‚</p><p>JSPï¼šåœ¨HTMLä¸­åµŒå…¥Javaä»£ç ï¼Œé€‚åˆé¡µé¢çš„æ˜¾ç¤ºã€‚å¦‚åœ¨Strutsä¸­ï¼ŒServletä½äºçš„æ§åˆ¶å±‚ï¼Œè€ŒJSPä½äºè§†å›¾å±‚ã€‚</p><p>â‘¡å†…ç½®å¯¹è±¡</p><p>Servlet ä¸­æ²¡æœ‰å†…ç½®å¯¹è±¡</p><p>JSPä¸­çš„å†…ç½®å¯¹è±¡å¿…é¡»é€šè¿‡HttpServletRequestå¯¹è±¡ã€HttpServletResponseå¯¹è±¡ä»¥åŠ HttpServletå¯¹è±¡å¾—åˆ°ã€‚</p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822204437.png"></p><p><strong>WEB-INF / web.xml</strong></p><pre class="line-numbers language-none"><code class="language-none">WEB-INFï¼šWebåº”ç”¨çš„å®‰å…¨ç›®å½•ï¼Œå³åªæœ‰æœåŠ¡ç«¯å¯ä»¥è®¿é—®ï¼Œè‹¥æƒ³è®¿é—®å®‰å…¨ç›®å½•é‡Œçš„æ–‡ä»¶ï¼Œéœ€è¦åœ¨ web.xml è®¾ç½®æ˜ å°„ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>WEB-INF / classesæ–‡ä»¶å¤¹</strong></p><pre class="line-numbers language-none"><code class="language-none">å­˜æ”¾ *.class æ–‡ä»¶ï¼šç±»åº“ï¼Œå®ç° JSP é¡µé¢å‰å°å’Œåå°çš„åˆ†ç¦»ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822204440.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822204442.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822204451.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822204454.png"></p><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å®ç°Servlet * 1.åˆ›å»ºæ™®é€šJavaç±» * 2.ç»§æ‰¿HttpServletç±»  èƒ½è¢«è®¿é—® * 3.é‡å†™serviceæ–¹æ³•  å¤„ç†è¯·æ±‚ * 4.æ·»åŠ @WebServletæ³¨è§£  æŒ‡å®šè®¿é—®è·¯å¾„ */</span><span class="token comment">//@WebServlet(value = {"/s1","/s2"})</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span>urlPatterns <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"/s1"</span><span class="token punctuation">,</span><span class="token string">"/s2"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServletTest</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// æ§åˆ¶å°è¾“å‡ºæ•°æ®</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æµè§ˆå™¨è¾“å‡ºæ•°æ®ï¼ˆé€šè¿‡å­—ç¬¦æµ Writerï¼‰</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"hello!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HttpServletRequest"><a href="#HttpServletRequest" class="headerlink" title="HttpServletRequest"></a>HttpServletRequest</h2><h3 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/s01"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet01</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// ä¸­æ–‡ä¹±ç </span>        request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 1. è¯·æ±‚å®Œæ•´è·¯å¾„url ï¼ˆä»httpå¼€å§‹ï¼Œåˆ°"?"å‰é¢ç»“æŸï¼‰</span>        <span class="token class-name">String</span> url <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token comment">// 2. è¯·æ±‚èµ„æºè·¯å¾„uri ï¼ˆä»é¡¹ç›®çš„ç«™ç‚¹åå¼€å§‹ï¼Œåˆ°"?"å‰é¢ç»“æŸï¼‰</span>        <span class="token class-name">String</span> uri <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 3. è¯·æ±‚å‚æ•°å­—ç¬¦ä¸² ï¼ˆä»"?"åé¢å¼€å§‹ï¼Œåˆ°æœ€åçš„å­—ç¬¦ä¸²ï¼‰</span>        <span class="token class-name">String</span> queryString <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 4. è¯·æ±‚æ–¹å¼ ï¼ˆGETå’ŒPOSTï¼‰</span>        <span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 5. å½“å‰åè®®ç‰ˆæœ¬ ï¼ˆHTTP/1.1ï¼‰</span>        <span class="token class-name">String</span> prototol <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getProtocol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 6. é¡¹ç›®ç«™ç‚¹å ï¼ˆé¡¹ç›®å¯¹å¤–è®¿é—®è·¯å¾„ï¼‰</span>        <span class="token class-name">String</span> webapp <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 7. è·å–æŒ‡å®šåçš„å‚æ•°å€¼ï¼Œè¿”å›å­—ç¬¦ä¸²</span>        <span class="token class-name">String</span> uname <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> upwd <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"upwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"unameï¼š"</span> <span class="token operator">+</span> uname <span class="token operator">+</span> <span class="token string">"ï¼Œupwdï¼š"</span> <span class="token operator">+</span> upwd<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 8. è·å–æŒ‡å®šåçš„æ‰€æœ‰å‚æ•°å€¼ï¼Œè¿”å›å­—ç¬¦ä¸²æ•°ç»„ ï¼ˆç”¨äºå¤é€‰æ¡†ä¼ å€¼ï¼‰</span>        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> hobbys <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameterValues</span><span class="token punctuation">(</span><span class="token string">"hobby"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//    åˆ¤æ–­æ•°ç»„æ˜¯å¦ä¸ºç©º</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>hobbys <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> hobbys<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> hobby<span class="token operator">:</span> hobbys<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"çˆ±å¥½ï¼š"</span> <span class="token operator">+</span> hobby<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¯·æ±‚è½¬å‘"><a href="#è¯·æ±‚è½¬å‘" class="headerlink" title="è¯·æ±‚è½¬å‘"></a>è¯·æ±‚è½¬å‘</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** *   è¯·æ±‚è½¬å‘ *   è¯­æ³•ï¼šrequest.getRequestDispatcher(url).forward(request,response); *   å¯ä»¥è®©è¯·æ±‚ä»æœåŠ¡ç«¯è·³è½¬åˆ°å®¢æˆ·ç«¯ï¼ˆæˆ–è·³è½¬åˆ°æŒ‡å®šä½ç½®ï¼‰ *   ç‰¹ç‚¹ï¼š *      1. æœåŠ¡ç«¯è¡Œä¸º *      2. urlä¸æ”¹å˜ *      3. åªæœ‰ä¸€ä¸ªè¯·æ±‚ï¼ŒrequeståŸŸä¸­æ•°æ®å¯å…±äº« *      4. åœ°å€ï¼šå½“å‰é¡¹ç›®ç«™ç‚¹ä¸‹çš„èµ„æºï¼Œç»å¯¹åœ°å€å®šä½åˆ°ç«™ç‚¹å */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/s03"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet03</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// è¯·æ±‚è½¬å‘è·³è½¬åˆ°Servlet04</span>        request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"s04"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¯·æ±‚è½¬å‘è·³è½¬åˆ°jspé¡µé¢</span>        request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¯·æ±‚è½¬å‘è·³è½¬åˆ°htmlé¡µé¢</span>        request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"login.html"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="request-åŸŸå¯¹è±¡"><a href="#request-åŸŸå¯¹è±¡" class="headerlink" title="request åŸŸå¯¹è±¡"></a>request åŸŸå¯¹è±¡</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** *  request åŸŸå¯¹è±¡å±æ€§ *      è®¾ç½® request.setAttribute(String name, Object value); *      è·å– request.getAttribute(String name); *      åˆ é™¤ request.removeAttribute(String name); *  åœ¨ä¸€æ¬¡è¯·æ±‚ä¸­æœ‰æ•ˆã€‚è¯·æ±‚è½¬å‘æœ‰æ•ˆï¼Œé‡å®šå‘å¤±æ•ˆã€‚ï¼ˆé€šè¿‡è¯¥å¯¹è±¡å¯ä»¥åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ä¼ é€’æ•°æ®ï¼‰ */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/s05"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet05</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>       request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"aaa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"bbb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"list"</span><span class="token punctuation">,</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>       request<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// è¯·æ±‚è½¬å‘è·³è½¬åˆ° Servlet06 æˆ– jsp å¹¶é€šè¿‡åŸŸå¯¹è±¡ä¼ é€’æ•°æ®</span>       request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"s06"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>       request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"index.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page import="java.util.List" %&gt;&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;&lt;html&gt;  &lt;head&gt;    &lt;title&gt;$Title$&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;  &lt;h2&gt;index.jsp&lt;/h2&gt;  &lt;%    String name = (String) request.getAttribute("name");    System.out.println("nameï¼š" + name);    List&lt;String&gt; list = (List&lt;String&gt;) request.getAttribute("list");  %&gt;  &lt;/body&gt;&lt;/html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HttpServletResponse"><a href="#HttpServletResponse" class="headerlink" title="HttpServletResponse"></a>HttpServletResponse</h2><h3 id="æ–¹æ³•-1"><a href="#æ–¹æ³•-1" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å“åº” * * ä¸­æ–‡ä¹±ç ï¼š *      1. è®¾ç½®æœåŠ¡ç«¯çš„ç¼–ç æ ¼å¼ *         response.setCharacterEncoding("UTF-8"); *      2. è®¾ç½®å®¢æˆ·ç«¯çš„ç¼–ç æ ¼å¼ *         response.setHeader("content-type","text/html;charset=UTF-8"); *      3. åŒæ—¶è®¾ç½®å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„ç¼–ç æ ¼å¼ï¼ˆæ¨èï¼‰ *         response.setContentType("text/html;charset=UTF-8"); */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/s01"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet01</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// ä¸­æ–‡ä¹±ç </span>        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å­—ç¬¦è¾“å‡ºæµ ï¼ˆè¾“å‡ºå­—ç¬¦ä¸²ï¼‰</span>        <span class="token class-name">PrintWriter</span> printWriter <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        printWriter<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å­—èŠ‚è¾“å‡ºæµ ï¼ˆè¾“å‡ºä»»æ„æ•°æ®ï¼‰</span>        <span class="token class-name">ServletOutputStream</span> servletOutputStream <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        servletOutputStream<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"Hi"</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é‡å®šå‘"><a href="#é‡å®šå‘" class="headerlink" title="é‡å®šå‘"></a>é‡å®šå‘</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** *   é‡å®šå‘ *   è¯­æ³•ï¼šresponse.sendRedirect(url); *   ç‰¹ç‚¹ *       1. æœåŠ¡ç«¯æŒ‡å¯¼ï¼Œå®¢æˆ·ç«¯è¡Œä¸º *       2. ä¸¤æ¬¡è¯·æ±‚ï¼Œæ•…requeståŸŸä¸­æ•°æ®ä¸å…±äº« *       3. urlæ”¹å˜ *       4. åœ°å€ï¼šä»»æ„ç«™ç‚¹èµ„æºï¼Œç»å¯¹åœ°å€å¯å†™åˆ°http:// */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/s04"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet04</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// é‡å®šå‘è·³è½¬åˆ°s05</span>        response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"s05"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åŒºåˆ«ï¼ˆè¯·æ±‚è½¬å‘å’Œé‡å®šå‘ï¼‰"><a href="#åŒºåˆ«ï¼ˆè¯·æ±‚è½¬å‘å’Œé‡å®šå‘ï¼‰" class="headerlink" title="åŒºåˆ«ï¼ˆè¯·æ±‚è½¬å‘å’Œé‡å®šå‘ï¼‰"></a>åŒºåˆ«ï¼ˆè¯·æ±‚è½¬å‘å’Œé‡å®šå‘ï¼‰</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822222049.png"></p><pre class="line-numbers language-none"><code class="language-none">å®ç°è¿™ç§ç¨‹åºçš„æ¨¡å—åŒ–ï¼Œè®©ä¸åŒçš„Servletæ¥å®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œå¦‚å¯ä»¥è®©å…¶ä¸­ä¸€ä¸ªServletæ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚ï¼Œå¦å¤–ä¸€ä¸ªServletæ¥å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ã€‚ä¸ºäº†å®ç°è¿™ç§ç¨‹åºçš„æ¨¡å—åŒ–,å°±éœ€è¦ä¿è¯åœ¨ä¸åŒçš„Servletä¹‹é—´å¯ä»¥ç›¸äº’è·³è½¬ï¼Œè€ŒServletä¸­ä¸»è¦æœ‰ä¸¤ç§å®ç°è·³è½¬çš„æ–¹å¼ï¼šforwardæ–¹å¼ä¸redirectæ–¹å¼ã€‚forwardï¼šæœåŠ¡å™¨å†…éƒ¨çš„é‡å®šå‘ï¼ŒæœåŠ¡å™¨ç›´æ¥è®¿é—®ç›®æ ‡åœ°å€çš„URL,æŠŠé‚£ä¸ªURLçš„å“åº”å†…å®¹è¯»å–è¿‡æ¥ï¼Œè€Œå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ï¼Œå› æ­¤ï¼Œåœ¨å®¢æˆ·ç«¯æµè§ˆå™¨çš„åœ°å€æ ä¸­ä¸ä¼šæ˜¾ç¤ºè½¬å‘åçš„åœ°å€ï¼Œè¿˜æ˜¯åŸæ¥çš„åœ°å€ã€‚ç”±äºåœ¨æ•´ä¸ªå®šå‘çš„è¿‡ç¨‹ä¸­ç”¨çš„æ˜¯åŒä¸€ä¸ªrequest,å› æ­¤ï¼Œforwardä¼šå°†requestçš„ä¿¡æ¯å¸¦åˆ°è¢«å®šå‘çš„JSPæˆ– Servletä¸­ä½¿ç”¨ã€‚ redirectï¼šå®¢æˆ·ç«¯é‡å®šå‘ï¼ˆæœåŠ¡å™¨å¤–éƒ¨çš„é‡å®šå‘ï¼‰ï¼Œæ˜¯å®Œå…¨çš„è·³è½¬ï¼Œå³å®¢æˆ·ç«¯æµè§ˆå™¨ä¼šè·å–åˆ°è·³è½¬åçš„åœ°å€ï¼Œç„¶åé‡æ–°å‘é€ è¯·æ±‚ï¼Œå› æ­¤ï¼Œæµè§ˆå™¨ä¸­ä¼šæ˜¾ç¤ºè·³è½¬åçš„åœ°å€ã€‚åŒæ—¶ç”±äºè¿™ç§æ–¹å¼æ¯”forwardæ–¹å¼å¤šäº†ä¸€æ¬¡ç½‘ç»œè¯·æ±‚ï¼Œæ‰€ä»¥ï¼Œforwardæ•ˆç‡æ›´é«˜ã€‚éœ€è€æ³¨æ„çš„æ˜¯ï¼Œå®¢æˆ·ç«¯é‡å®šå‘å¯ä»¥é€šè¿‡è®¾ç½®ç‰¹å®šçš„HTTPå¤´æˆ–è€…å†™JavaScriptè„šæœ¬å®ç°ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java">æ¦‚å¿µ    æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€ç§æŠ€æœ¯ï¼Œé€šè¿‡æœåŠ¡å™¨çš„ç¨‹åºèƒ½å°†ä¸€äº›åªé¡»ä¿å­˜åœ¨å®¢æˆ·ç«¯æˆ–åœ¨å®¢æˆ·ç«¯è¿›è¡Œå¤„ç†çš„æ•°æ®ï¼Œæ”¾åœ¨æœ¬åœ°çš„è®¡ç®—æœºä¸Šã€‚    ç›®çš„ï¼šæé«˜ç½‘é¡µå¤„ç†çš„æ•ˆç‡ã€å‡å°‘æœåŠ¡å™¨çš„è´Ÿè½½    å¦‚ï¼šè®°ä½å¯†ç ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ–¹æ³•-2"><a href="#æ–¹æ³•-2" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Cookie åˆ›å»º åˆ°æœŸæ—¶é—´ æŒ‡å®šè·¯å¾„ è·å–  */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/cook01"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cookie01</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ›å»º</span>        <span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ°æœŸæ—¶é—´</span>        cookie<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…³é—­æµè§ˆå™¨å¤±æ•ˆï¼ˆé»˜è®¤ï¼‰</span>        cookie<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 30ç§’åå¤±æ•ˆ</span>        cookie<span class="token punctuation">.</span><span class="token function">setMaxAge</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  ç«‹å³å¤±æ•ˆ</span>        <span class="token comment">// æŒ‡å®šè·¯å¾„</span>        <span class="token comment">// "/"  å½“å‰æœåŠ¡å™¨ä¸‹ä»»ä½•é¡¹ç›®éƒ½å¯è·å–Cookieå¯¹è±¡</span>        cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä¸è®¾ç½® æˆ– "å½“å‰ç«™ç‚¹å"ï¼ˆé»˜è®¤ï¼‰ å½“å‰é¡¹ç›®ä¸‹çš„èµ„æºå¯è·å–Cookieå¯¹è±¡</span>        cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// "æŒ‡å®šé¡¹ç›®çš„ç«™ç‚¹å"  æŒ‡å®šé¡¹ç›®ä¸‹çš„èµ„æºå¯è·å–Cookieå¯¹è±¡</span>        cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">"/sr03"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// "æŒ‡å®šç›®å½•çš„ç«™ç‚¹å"  æŒ‡å®šç›®å½•ä¸‹çš„èµ„æºå¯è·å–Cookieå¯¹è±¡</span>        cookie<span class="token punctuation">.</span><span class="token function">setPath</span><span class="token punctuation">(</span><span class="token string">"/sc04/cook02"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å“åº”Cookieå¯¹è±¡ç»™æµè§ˆå™¨</span>        response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment">/** * Cookieçš„è·å– */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/cook02"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cookie02</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>       <span class="token comment">// è·å–cookieæ•°ç»„  è¿”å›å€¼cookieæ•°ç»„</span>        <span class="token class-name">Cookie</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cookies <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ¤æ–­cookieéç©º</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cookies <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> cookies<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// éå†cookieæ•°ç»„</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cookie</span> cookie<span class="token operator">:</span> cookies <span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// è·å–cookieçš„åç§°å’Œå€¼</span>                <span class="token class-name">String</span> name <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">String</span> value <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"åç§°ï¼š"</span> <span class="token operator">+</span>name <span class="token operator">+</span> <span class="token string">"ï¼Œå€¼ï¼š"</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸­æ–‡"><a href="#ä¸­æ–‡" class="headerlink" title="ä¸­æ–‡"></a>ä¸­æ–‡</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Cookieçš„æ³¨æ„ç‚¹ *  1. Cookieåªåœ¨å½“å‰æµè§ˆå™¨ä¸­æœ‰æ•ˆ *  2. Cookieè‹¥å­˜ä¸­æ–‡ï¼Œåˆ™éœ€é€šè¿‡URLEncoder.encode()æ–¹æ³•è¿›è¡Œç¼–ç ï¼Œè·å–æ—¶é€šè¿‡URLDecoder.decode()æ–¹æ³•è¿›è¡Œè§£ç  *  3. è‹¥å‡ºç°åŒåçš„Cookieå¯¹è±¡ï¼Œåˆ™ä¼šè¦†ç›– *  4. Cookieå­˜å‚¨ç©ºé—´æœ‰é™ï¼Œä¸åŒæµè§ˆå™¨çš„ä¸Šé™ä¸åŒï¼Œä¸€èˆ¬4kbå·¦å³ */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/cook04"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cookie04</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token string">"å§“å"</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token string">"å¼ ä¸‰"</span><span class="token punctuation">;</span>        <span class="token comment">// ç¼–ç </span>        <span class="token class-name">Cookie</span> cookie <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">URLEncoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Cookie</span><span class="token punctuation">[</span><span class="token punctuation">]</span> cookies <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ¤æ–­éç©º</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cookies <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> cookies<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// éå†</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Cookie</span> cook <span class="token operator">:</span> cookies <span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// è§£ç </span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">URLDecoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>cook<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">URLDecoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>cook<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xxxx<span class="token punctuation">.</span>servlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">ServletException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">WebServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">Cookie</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServlet</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLDecoder</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLEncoder</span><span class="token punctuation">;</span><span class="token comment">/** * Cookieçš„è·¯å¾„ *      3. æŒ‡å®šé¡¹ç›®ä¸‹çš„èµ„æºå¯è·å–Cookieå¯¹è±¡ *      4. æŒ‡å®šç›®å½•ä¸‹çš„èµ„æºå¯è·å–Cookieå¯¹è±¡ * *      æ€»ç»“ï¼šåªæœ‰è®¿é—®çš„è·¯å¾„ä¸­åŒ…å«Cookieå¯¹è±¡çš„pathå€¼ï¼Œæ‰å¯ä»¥è·å–åˆ°è¯¥cookieå¯¹è±¡ * */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/cook05"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cookie05</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="HttpSession"><a href="#HttpSession" class="headerlink" title="HttpSession"></a>HttpSession</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java">æ¦‚å¿µä¼šè¯ï¼Œ<span class="token class-name">HttpSession</span>å¯¹è±¡æ˜¯ <span class="token class-name"><span class="token namespace">javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>HttpSession</span> çš„å®ä¾‹ï¼Œè¯¥æ¥å£åªæ˜¯ä¸€ä¸ªçº¯ç²¹çš„æ¥å£ã€‚å¯¹æœåŠ¡å™¨è€Œè¨€ï¼Œæ¯ä¸€ä¸ªè¿æ¥åˆ°å®ƒçš„å®¢æˆ·ç«¯éƒ½æ˜¯ä¸€ä¸ª sessionï¼Œservlet å®¹å™¨ä½¿ç”¨æ­¤æ¥å£åˆ›å»º HTTP å®¢æˆ·ç«¯å’Œ HTTP æœåŠ¡å™¨ä¹‹é—´çš„ä¼šè¯ã€‚    ä¼šè¯å°†ä¿ç•™æŒ‡å®šçš„æ—¶é—´æ®µï¼Œè·¨å¤šä¸ªè¿æ¥æˆ–æ¥è‡ªç”¨æˆ·çš„é¡µé¢è¯·æ±‚ã€‚ä¸€ä¸ªä¼šè¯å¯¹åº”äºä¸€ä¸ªç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å¯èƒ½å¤šæ¬¡è®¿é—®ä¸€ä¸ªç«™ç‚¹ã€‚å¯ä»¥é€šè¿‡æ­¤æ¥å£æŸ¥çœ‹å’Œæ“ä½œæœ‰å…³æŸä¸ªä¼šè¯çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä¼šè¯æ ‡è¯†ç¬¦ã€åˆ›å»ºæ—¶é—´å’Œæœ€åä¸€æ¬¡è®¿é—®æ—¶é—´ã€‚    æ— è®ºå®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡å™¨ç«¯éƒ½å¯ä»¥æ„ŸçŸ¥åˆ°ï¼Œè‹¥é‡æ–°æ‰“å¼€ä¸€ä¸ªæ–°çš„æµè§ˆå™¨ï¼Œåˆ™æ— æ³•å–å¾—ä¹‹å‰è®¾ç½®çš„sessionï¼Œå› æ¯ä¸€ä¸ª session åªä¿å­˜åœ¨å½“å‰çš„æµè§ˆå™¨å½“ä¸­ï¼Œå¹¶åœ¨ç›¸å…³çš„é¡µé¢å–å¾—ã€‚    ä½œç”¨ï¼šä¸ºäº†æ ‡è¯†ä¸€æ¬¡ä¼šè¯ï¼Œæˆ–è€…è¯´ç¡®è®¤ä¸€ä¸ªç”¨æˆ·ï¼›å¹¶ä¸”åœ¨ä¸€æ¬¡ä¼šè¯ï¼ˆä¸€ä¸ªç”¨æˆ·çš„å¤šæ¬¡è¯·æ±‚ï¼‰æœŸé—´å…±äº«æ•°æ®ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Session-åŸŸå¯¹è±¡-æ–¹æ³•"><a href="#Session-åŸŸå¯¹è±¡-æ–¹æ³•" class="headerlink" title="Session åŸŸå¯¹è±¡ æ–¹æ³•"></a>Session åŸŸå¯¹è±¡ æ–¹æ³•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Sessionå¯¹è±¡ * ç”Ÿå‘½å‘¨æœŸ *      1. ï¼ˆé»˜è®¤ï¼‰Tomcat é…ç½®æ–‡ä»¶ conf/web.xml å•ä½ï¼šåˆ†é’Ÿ *          Tomcat ä¸­ session é»˜è®¤çš„å­˜æ´»æ—¶é—´ä¸º 30minï¼Œä¸€æ—¦æœ‰æ“ä½œä¼šé‡æ–°è®¡æ—¶ã€‚ *          &lt;session-config&gt; *             &lt;session-timeout&gt;30&lt;/session-timeout&gt; *          &lt;/session-config&gt; *      2. æ‰‹åŠ¨é”€æ¯ *          session.setMaxInactiveInterval(int) è®¾ç½® å•ä½ä¸ºç§’ã€‚ *          session.getMaxInactiveInterval() æŸ¥çœ‹ å½“å‰ Session å¯¹è±¡çš„æœ€å¤§ä¸æ´»åŠ¨æ—¶é—´ã€‚ *      3. ç«‹å³é”€æ¯ *          session.invalidate() *      4. å…³é—­æµè§ˆå™¨ *          sessionåº•å±‚ä¾èµ–cookieï¼Œcookieå¯¹è±¡é»˜è®¤åªåœ¨æµè§ˆå™¨å†…å­˜ä¸­å­˜æ´»ï¼Œå…³é—­æµè§ˆå™¨å³å¤±æ•ˆ *      5. å…³é—­æœåŠ¡å™¨ *          å½“å…³é—­æœåŠ¡å™¨æ—¶ï¼Œsession é”€æ¯ã€‚ */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/ser01"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Session01</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// è·å– sessionå¯¹è±¡ï¼ˆå…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™è·å–ï¼›åä¹‹åˆ™åˆ›å»ºï¼‰</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä¼šè¯æ ‡è¯†ç¬¦</span>        <span class="token class-name">String</span> id <span class="token operator">=</span> session<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ›å»ºæ—¶é—´</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">getCreationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">getLastAccessedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// æ˜¯å¦æ˜¯æ–°çš„sessionå¯¹è±¡</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">isNew</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ°æœŸæ—¶é—´</span>        <span class="token comment">// æ‰‹åŠ¨é”€æ¯ 15ç§’å¤±æ•ˆ</span>        session<span class="token punctuation">.</span><span class="token function">setMaxInactiveInterval</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç«‹å³é”€æ¯</span>        session<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Session-åŸŸå¯¹è±¡-å±æ€§"><a href="#Session-åŸŸå¯¹è±¡-å±æ€§" class="headerlink" title="Session åŸŸå¯¹è±¡ å±æ€§"></a>Session åŸŸå¯¹è±¡ å±æ€§</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * Session åŸŸå¯¹è±¡å±æ€§ *      è®¾ç½® session.setAttribute() *      è·å– session.getAttribute() *      åˆ é™¤ session.removeAttribute() * åœ¨ä¸€æ¬¡ä¼šè¯ä¸­æœ‰æ•ˆã€‚è¯·æ±‚è½¬å‘ã€é‡å®šå‘éƒ½æœ‰æ•ˆï¼Œé”€æ¯åå¤±æ•ˆã€‚ */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/ser02"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Session02</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"uname"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"upwd"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        session<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"upwd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;&lt;html&gt;  &lt;head&gt;    &lt;title&gt;è·å–SessionåŸŸå¯¹è±¡&lt;/title&gt;  &lt;/head&gt;  &lt;body&gt;  &lt;%    String uname = (String) request.getSession().getAttribute("uname");  %&gt;  &lt;/body&gt;&lt;/html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ServletContext"><a href="#ServletContext" class="headerlink" title="ServletContext"></a>ServletContext</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java">æ¦‚å¿µ    æ¯ä¸€ä¸ª <span class="token class-name">Web</span> åº”ç”¨éƒ½æœ‰ä¸”ä»…æœ‰ä¸€ä¸ª <span class="token class-name">ServletContext</span> å¯¹è±¡ï¼Œåˆç§° <span class="token class-name">Application</span> å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ˜¯ä¸åº”ç”¨ç¨‹åºç›¸å…³çš„ã€‚    åœ¨ WEB å®¹å™¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šä¸ºæ¯ä¸€ä¸ª WEB åº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„<span class="token class-name">ServletContext</span> å¯¹è±¡ã€‚ä½œç”¨    ç¬¬ä¸€ã€ä½œä¸ºåŸŸå¯¹è±¡ç”¨æ¥å…±äº«æ•°æ®ï¼›     ç¬¬äºŒã€è¯¥å¯¹è±¡ä¸­ä¿å­˜äº†å½“å‰åº”ç”¨ç¨‹åºç›¸å…³ä¿¡æ¯ã€‚        <span class="token function">getServerInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> æ–¹æ³•è·å–å½“å‰æœåŠ¡å™¨ä¿¡æ¯        <span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">)</span> è·å–èµ„æºçš„çœŸå®è·¯å¾„<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è·å–-æ–¹æ³•"><a href="#è·å–-æ–¹æ³•" class="headerlink" title="è·å–  æ–¹æ³•"></a>è·å–  æ–¹æ³•</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ServletContext å¯¹è±¡ è·å– æ–¹æ³• */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/s01"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet01</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// è·å–        // 1. é€šè¿‡requestå¯¹è·å–        ServletContext servletContext = request.getServletContext();        // 2. é€šè¿‡sessionå¯¹è±¡è·å–        ServletContext servletContext = request.getSession().getServletContext();        // 3. é€šè¿‡ServletConfigå¯¹è±¡è·å–        ServletContext servletContext = getServletConfig().getServletContext();        // 4. ç›´æ¥        ServletContext servletContext = getServletContext();        // æ–¹æ³•        // 1. è·å–å½“å‰æœåŠ¡å™¨çš„ç‰ˆæœ¬ä¿¡æ¯        String serverInfo = request.getServletContext().getServerInfo();        System.out.println("è·å–å½“å‰æœåŠ¡å™¨çš„ç‰ˆæœ¬ä¿¡æ¯: " + serverInfo);        // 2. è·å–é¡¹ç›®çš„çœŸå®è·¯å¾„        String realPath = request.getServletContext().getRealPath("/");        System.out.println("è·å–é¡¹ç›®çš„çœŸå®è·¯å¾„ï¼š" + realPath);    }}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ServletContext-åŸŸå¯¹è±¡"><a href="#ServletContext-åŸŸå¯¹è±¡" class="headerlink" title="ServletContext åŸŸå¯¹è±¡"></a>ServletContext åŸŸå¯¹è±¡</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java">æ¦‚å¿µ    åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­æœ‰æ•ˆï¼ˆä½¿å¾—æ•´ä¸ªåº”ç”¨ç¨‹åºå…±äº«æŸäº›æ•°æ®ï¼‰ã€‚æœåŠ¡å™¨å…³é—­åå¤±æ•ˆã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ServletContext åŸŸå¯¹è±¡å±æ€§ *      è®¾ç½® servletContext.setAttribute() *      è·å– servletContext.getAttribute() *      åˆ é™¤ servletContext.removeAttribute() * åœ¨ä¸€æ¬¡ä¼šè¯ä¸­æœ‰æ•ˆã€‚è¯·æ±‚è½¬å‘ã€é‡å®šå‘éƒ½æœ‰æ•ˆï¼Œé”€æ¯åå¤±æ•ˆã€‚ */</span><span class="token class-name">ServletContext</span> servletContext <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>servletContext<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> servletContext<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>servletContext<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–‡ä»¶"><a href="#æ–‡ä»¶" class="headerlink" title="æ–‡ä»¶"></a>æ–‡ä»¶</h2><h3 id="ä¸Šä¼ "><a href="#ä¸Šä¼ " class="headerlink" title="ä¸Šä¼ "></a>ä¸Šä¼ </h3><h4 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h4><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>æ–‡ä»¶ä¸Šä¼ <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--        æ–‡ä»¶ä¸Šä¼             1. å‡†å¤‡è¡¨å•            2. å‡†å¤‡è¡¨å•å…ƒç´ ã€nameå±æ€§å€¼ ï¼ˆè¡¨å•æäº¤ä¸€å®šè¦è®¾ç½®è¡¨å•å…ƒç´ çš„nameå±æ€§å€¼ï¼Œå¦åˆ™åå°æ— æ³•æ¥æ”¶æ•°æ®ï¼ï¼‰                æ™®é€šé¡¹  type="text"                æ–‡ä»¶é¡¹  type="file"    --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uploadServlet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        å§“åï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uname<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        æ–‡ä»¶ï¼š<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myfile<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--buttoné»˜è®¤çš„ç±»å‹æ˜¯æäº¤ç±»å‹ type="submit" --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>æäº¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åç«¯"><a href="#åç«¯" class="headerlink" title="åç«¯"></a>åç«¯</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * æ–‡ä»¶ä¸Šä¼  *      ä½¿ç”¨æ³¨è§£ @MultipartConfigå°†ä¸€ä¸ª Servlet æ ‡è¯†ä¸ºæ”¯æŒæ–‡ä»¶ä¸Šä¼ ã€‚ *      Servlet å°† multipart/form-data çš„ POST è¯·æ±‚å°è£…æˆ Partå¯¹è±¡ï¼Œé€šè¿‡ Part å¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚ */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/uploadServlet"</span><span class="token punctuation">)</span><span class="token annotation punctuation">@MultipartConfig</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–Partå¯¹è±¡ ï¼ˆServlet å°† multipart/form-data çš„ POST è¯·æ±‚å°è£…æˆ Partå¯¹è±¡ï¼‰</span>        <span class="token class-name">Part</span> part <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getPart</span><span class="token punctuation">(</span><span class="token string">"myfile"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¡¨å•ä¸­fileæ–‡ä»¶åŸŸçš„nameå±æ€§å€¼</span>        <span class="token comment">// é€šè¿‡Partå¯¹è±¡å¾—åˆ°ä¸Šä¼ æ–‡ä»¶å</span>        <span class="token class-name">String</span> fileName <span class="token operator">=</span> part<span class="token punctuation">.</span><span class="token function">getSubmittedFileName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è‡ªå®šä¹‰æ–‡ä»¶å­˜æ”¾è·¯å¾„</span>        <span class="token class-name">String</span> basePath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä¸Šä¼ æ–‡ä»¶åˆ°æŒ‡å®šç›®å½•</span>        part<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>basePath <span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><h4 id="å‰ç«¯-1"><a href="#å‰ç«¯-1" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h4><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>æ–‡ä»¶ä¸‹è½½<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><span class="token comment">&lt;!--    1. è¶…é“¾æ¥ä¸‹è½½        å½“ä½¿ç”¨è¶…é“¾æ¥ï¼ˆaæ ‡ç­¾ï¼‰æ—¶ï¼Œè‹¥é‡åˆ°æµè§ˆå™¨ä¸èƒ½è¯†åˆ«çš„èµ„æºï¼Œåˆ™ä¼šè¿›è¡Œä¸‹è½½ã€‚        é€šè¿‡download å±æ€§å¼ºåˆ¶è§„å®šæµè§ˆå™¨è¿›è¡Œä¸‹è½½ã€‚            download å±æ€§å¯ä»¥ä¸å†™ä»»ä½•ä¿¡æ¯ï¼Œè‡ªåŠ¨ä½¿ç”¨é»˜è®¤æ–‡ä»¶åã€‚           è‹¥è®¾ç½®äº†downloadå±æ€§çš„å€¼ï¼Œåˆ™ä½¿ç”¨è®¾ç½®çš„å€¼ä½œä¸ºæ–‡ä»¶åã€‚    2. åå°Javaä»£ç ä¸‹è½½--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download/test.txt<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token punctuation">&gt;</span></span>æ–‡æœ¬æ–‡ä»¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download/bd_logo1.png<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç™¾åº¦.png<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>å›¾ç‰‡æ–‡ä»¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download/test.rar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>å‹ç¼©æ–‡ä»¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>downloadServlet<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>        æ–‡ä»¶åï¼š        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileName<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è¯·è¾“å…¥è¦ä¸‹è½½çš„æ–‡ä»¶å<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>ä¸‹è½½<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822211648.png"></p><h4 id="åç«¯-1"><a href="#åç«¯-1" class="headerlink" title="åç«¯"></a>åç«¯</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * æ–‡ä»¶ä¸‹è½½ * *  1.è®¾ç½®å“åº”ç±»å‹ ï¼ˆæµè§ˆå™¨æ— æ³•ä½¿ç”¨æŸç§æ–¹å¼æˆ–æ¿€æ´»æŸä¸ªç¨‹åºæ¥å¤„ç†çš„ MIME ç±»å‹ï¼‰ *       response.setContentType("application/x-msdownload"); *    æˆ– response.setContentType("application/octet-stream"); *    è®¾ç½®å“åº”å¤´ *    response.setHeader("Content-Disposition", "attachment;filename=" + fileName); *  2.è¯»å–æ‰€éœ€æ–‡ä»¶ï¼ˆæ–‡ä»¶è¾“å…¥æµ new FileInputStream(file)ï¼‰ *  3.å“åº”ï¼ˆå­—èŠ‚è¾“å‡ºæµ response.getOutputStream().write() ï¼‰ *  4.å…³é—­ æ–‡ä»¶è¾“å…¥æµã€å­—èŠ‚è¾“å‡ºæµ */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/downloadServlet"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DownloadServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–å‚æ•° ï¼ˆè·å–è¦ä¸‹è½½çš„æ–‡ä»¶åï¼‰</span>        <span class="token class-name">String</span> fileName <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"fileName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// éç©ºåˆ¤æ–­</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"è¯·è¾“å…¥è¦ä¸‹è½½çš„æ–‡ä»¶åï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// å¾—åˆ°èµ„æºçš„ç»å¯¹è·¯å¾„</span>        <span class="token class-name">String</span> basePath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">"/download/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–èµ„æºfileå¯¹è±¡</span>        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>basePath <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ¤æ–­æ–‡ä»¶å¯¹è±¡æ˜¯å¦å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªæ ‡å‡†æ–‡ä»¶</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> file<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// è®¾ç½®å“åº”ç±»å‹</span>            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/x-msdownload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//response.setContentType("application/octet-stream");</span>            <span class="token comment">// è®¾ç½®å“åº”å¤´</span>            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment;filename="</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å–æ–‡ä»¶è¾“å…¥æµ</span>            <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å–å­—èŠ‚è¾“å‡ºæµ</span>            <span class="token class-name">ServletOutputStream</span> out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> len<span class="token punctuation">;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">// å¾ªç¯è¾“å‡º</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>                out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ–°å¢</span>            <span class="token punctuation">}</span>            <span class="token comment">// å…³é—­è¾“å…¥è¾“å‡ºæµ</span>            out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·é‡è¯•ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java">æ¦‚å¿µ<span class="token class-name">Filter</span>ï¼Œç”¨äºå¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡Œé¢„å¤„ç†æˆ–å¯¹æœåŠ¡å™¨å“åº”è¿›è¡Œåå¤„ç†    ï¼ˆå³æ‹¦æˆªç”¨æˆ·è¯·æ±‚ <span class="token class-name">HttpServletRequest</span>ï¼Œæ”¹ <span class="token class-name">Request</span>ï¼›æ‹¦æˆªæœåŠ¡å™¨å“åº” <span class="token class-name">HttpServletResponse</span>ï¼Œæ”¹ <span class="token class-name">Response</span>ï¼‰ã€‚    å®Œæ•´æµç¨‹ï¼š     <span class="token class-name">Filter</span> å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡Œé¢„å¤„ç†ï¼Œå†å°†è¯·æ±‚äº¤ç»™ <span class="token class-name">Servlet</span> è¿›è¡Œå¤„ç†å¹¶ç”Ÿæˆå“åº”ï¼Œæœ€åå†å¯¹æœåŠ¡å™¨å“åº”è¿›è¡Œåå¤„ç†ã€‚    è¿‡æ»¤å™¨é“¾ï¼š<span class="token class-name">Filter</span> chainï¼Œ<span class="token class-name">Web</span> åº”ç”¨ä¸­å¤šä¸ª <span class="token class-name">Filter</span> çš„ç»„åˆï¼ˆè¯·æ±‚æ—¶ï¼šå…ˆé…ç½®å…ˆæ‰§è¡Œï¼Œå“åº”æ—¶<span class="token operator">:</span> ç›¸åé¡ºåºï¼‰ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210822211709.png"></p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p><strong>Filter01.java</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è¿‡æ»¤å™¨ *      1.@WebServlet("s01")  é…ç½®éœ€æ‹¦æˆªçš„èµ„æºè·¯å¾„ *      2.doFilter()  é…ç½®æ”¾è¡Œ  filterChain.doFilter(servletRequest,servletResponse); */</span><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"s01"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Filter01</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Filter01 init..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è¿‡æ»¤æ–¹æ³•     * @param servletRequest     * @param servletResponse     * @param filterChain     * @throws IOException     * @throws ServletException     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Filter01 æ­£åœ¨æ‹¦æˆª..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>servletRequest<span class="token punctuation">,</span>servletResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Filter01 destory..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Servlet01.java</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/01"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet01</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Servlet01..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><h4 id="ä¹±ç "><a href="#ä¹±ç " class="headerlink" title="ä¹±ç "></a>ä¹±ç </h4><pre class="line-numbers language-java" data-language="java"><code class="language-java">src<span class="token operator">/</span>com<span class="token operator">/</span>xxxx<span class="token operator">/</span>filter<span class="token operator">/</span><span class="token class-name">Filter02</span><span class="token punctuation">.</span>java<span class="token comment">/** * å­—ç¬¦ä¹±ç å¤„ç† *      ä¹±ç æƒ…å†µï¼š *              Tomcat8åŠä»¥ä¸Šç‰ˆæœ¬        Tomcat7åŠä»¥ä¸‹ç‰ˆæœ¬ *      POSTè¯·æ±‚  ä¹±ç ï¼Œéœ€å¤„ç†              ä¹±ç ï¼Œéœ€å¤„ç† *      GETè¯·æ±‚  ä¸ä¹±ç ï¼Œä¸éœ€å¤„ç†           ä¹±ç ï¼Œéœ€å¤„ç† *      å¦‚ä½•å¤„ç†ï¼š *          1ã€å¤„ç†POSTè¯·æ±‚ *              request.setCharacterEncoding("UTF-8"); *          2ã€å¤„ç†GETè¯·æ±‚ä¸”æœåŠ¡å™¨ç‰ˆæœ¬åœ¨Tomcat8ä»¥ä¸‹çš„ *              1&gt; å¾—åˆ°è¯·æ±‚ç±»å‹ ï¼ˆGETè¯·æ±‚ï¼‰ *              2&gt; å¾—åˆ°æœåŠ¡å™¨çš„ç‰ˆæœ¬çš„ä¿¡æ¯ *              3&gt; åˆ¤æ–­æ˜¯GETè¯·æ±‚ä¸”Tomcatç‰ˆæœ¬å°äº8 *              4&gt; å¤„ç†ä¹±ç  *                 new String(request.getParameter("å‚æ•°å").getBytes("ISO-8859-1"),"UTF-8"); */</span><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Filter02</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token class-name">Filter02</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> fConfig<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> arg0<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> arg1<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> chain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>        <span class="token comment">// åŸºäºHTTP</span>        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> arg0<span class="token punctuation">;</span>        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> arg1<span class="token punctuation">;</span>        <span class="token comment">// å¤„ç†è¯·æ±‚ä¹±ç ä¹±ç  ï¼ˆå¤„ç†POSTè¯·æ±‚ï¼‰</span>        request<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¤„ç†GETè¯·æ±‚ä¸”æœåŠ¡å™¨ç‰ˆæœ¬åœ¨Tomcat8ä»¥ä¸‹çš„</span>        <span class="token class-name">String</span> method <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¦‚æœæ˜¯GETè¯·æ±‚</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"GET"</span><span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// æœåŠ¡å™¨ç‰ˆæœ¬åœ¨Tomcat8ä»¥ä¸‹çš„ Apache Tomcat/8.0.45</span>            <span class="token class-name">String</span> serverInfo <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServerInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å¾—åˆ°å…·ä½“çš„ç‰ˆæœ¬å·</span>            <span class="token class-name">String</span> versionStr <span class="token operator">=</span> serverInfo<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>serverInfo<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>                    serverInfo<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// åˆ¤æ–­æœåŠ¡å™¨ç‰ˆæœ¬æ˜¯å¦å°äº8</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>versionStr<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// å¾—åˆ°è‡ªå®šä¹‰å†…éƒ¨ç±»</span>                <span class="token comment">// MyWapperç»§æ‰¿äº†HttpServletRequestWapperå¯¹è±¡</span>                <span class="token comment">// è€ŒHttpServletRequestWapperå¯¹è±¡å®ç°äº†HttpServletRequestæ¥å£</span>                <span class="token comment">// æ‰€ä»¥MyWapperçš„æœ¬è´¨ä¹Ÿæ˜¯requestå¯¹è±¡</span>                <span class="token class-name">HttpServletRequest</span> myRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyWapper</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// æ”¾è¡Œèµ„æº</span>                chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>myRequest<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">// æ”¾è¡Œèµ„æº</span>        chain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å®šä¹‰å†…éƒ¨ç±»ï¼Œç»§æ‰¿HttpServletRequestWrapperåŒ…è£…ç±»å¯¹è±¡ï¼Œé‡å†™getParameter()æ–¹æ³•     */</span>    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">MyWapper</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServletRequestWrapper</span> <span class="token punctuation">{</span>        <span class="token comment">// å®šä¹‰æˆå‘˜å˜é‡ï¼Œæå‡æ„é€ å™¨ ä¸­çš„requestå¯¹è±¡çš„èŒƒå›´</span>        <span class="token keyword">private</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token class-name">MyWapper</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">super</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">this</span><span class="token punctuation">.</span>request <span class="token operator">=</span> request<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">/**         * é‡å†™getParameter()æ–¹æ³•         */</span>        <span class="token annotation punctuation">@Override</span>        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">String</span> value <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">try</span> <span class="token punctuation">{</span>                    <span class="token comment">// å°†é»˜è®¤ISO-8859-1ç¼–ç çš„å­—ç¬¦è½¬æ¢æˆUTF-8</span>                    value <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"ISO-8859-1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">UnsupportedEncodingException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">return</span> value<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="éæ³•è®¿é—®æ‹¦æˆª"><a href="#éæ³•è®¿é—®æ‹¦æˆª" class="headerlink" title="éæ³•è®¿é—®æ‹¦æˆª"></a>éæ³•è®¿é—®æ‹¦æˆª</h4><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">web/login.jsp&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;    &lt;form action="s01" id="loginForm"&gt;        &lt;label&gt;            å§“åï¼š            &lt;input type="text" name="uname" id="uname"&gt;        &lt;/label&gt;        &lt;button type="button" onclick="login()"&gt;ç™»é™†&lt;/button&gt;    &lt;/form&gt;    &lt;script src="js/user.js" type="text/javascript"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;web/index.jsp&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;    &lt;h2&gt;æ¬¢è¿${sessionScope.user}ç™»é™†&lt;/h2&gt;&lt;/body&gt;&lt;/html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">web<span class="token operator">/</span>js<span class="token operator">/</span>user<span class="token punctuation">.</span>js<span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// åˆ¤æ–­éç©ºåˆ™æäº¤</span>    <span class="token keyword">var</span> uname <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"uname"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>uname <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> uname<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"loginForm"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">src<span class="token operator">/</span>com<span class="token operator">/</span>xxxx<span class="token operator">/</span>filter<span class="token operator">/</span><span class="token class-name">Filter03</span><span class="token punctuation">.</span>java<span class="token comment">/** * éæ³•è®¿é—®æ‹¦æˆªï¼ˆå½“ç”¨æˆ·æœªç™»å½•æ—¶ï¼Œæ‹¦æˆªè¯·æ±‚åˆ°ç™»å½•é¡µé¢ï¼‰ *      æ‹¦æˆªçš„èµ„æºï¼š *          æ‹¦æˆªæ‰€æœ‰èµ„æº /* *      éœ€è¢«æ”¾è¡Œçš„èµ„æºï¼š *          1ã€æ”¾è¡ŒæŒ‡å®šé¡µé¢ï¼Œæ— éœ€ç™»å½•å¯ä»¥è®¿é—®çš„é¡µé¢ ï¼ˆå¦‚ï¼šç™»å½•ã€æ³¨å†Œé¡µé¢ç­‰ï¼‰ *          2ã€æ”¾è¡Œé™æ€èµ„æºï¼ˆå¦‚ï¼šcssã€jsã€imageç­‰èµ„æºï¼‰ *          3ã€æ”¾è¡ŒæŒ‡å®šæ“ä½œï¼Œæ— éœ€ç™»å½•å³å¯æ‰§è¡Œçš„æ“ä½œï¼ˆå¦‚ï¼šç™»å½•æ“ä½œã€æ³¨å†Œæ“ä½œç­‰ï¼‰ *          4ã€æ”¾è¡Œç™»å½•çŠ¶æ€ ï¼ˆå¦‚æœå­˜åœ¨æŒ‡å®šsessuinå¯¹è±¡ï¼Œåˆ™ä¸ºç™»å½•çŠ¶æ€ï¼‰ */</span><span class="token annotation punctuation">@WebFilter</span><span class="token punctuation">(</span><span class="token string">"/*"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Filter03</span> <span class="token keyword">implements</span> <span class="token class-name">Filter</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">FilterConfig</span> filterConfig<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doFilter</span><span class="token punctuation">(</span><span class="token class-name">ServletRequest</span> servletRequest<span class="token punctuation">,</span> <span class="token class-name">ServletResponse</span> servletResponse<span class="token punctuation">,</span> <span class="token class-name">FilterChain</span> filterChain<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">ServletException</span> <span class="token punctuation">{</span>        <span class="token comment">// åŸºäºHTTP</span>        <span class="token class-name">HttpServletRequest</span> request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span><span class="token punctuation">)</span> servletRequest<span class="token punctuation">;</span>        <span class="token class-name">HttpServletResponse</span> response <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">HttpServletResponse</span><span class="token punctuation">)</span> servletResponse<span class="token punctuation">;</span>        <span class="token comment">// è·å–è¯·æ±‚çš„è·¯å¾„</span>        <span class="token class-name">String</span> path <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRequestURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç«™ç‚¹å/èµ„æºè·¯å¾„</span>        <span class="token comment">// 1ã€æ”¾è¡ŒæŒ‡å®šé¡µé¢ï¼Œæ— éœ€ç™»å½•å¯ä»¥è®¿é—®çš„é¡µé¢ ï¼ˆå¦‚ï¼šç™»å½•ã€æ³¨å†Œé¡µé¢ç­‰ï¼‰</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"/login.jsp"</span><span class="token punctuation">)</span> <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"/register.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// 2ã€æ”¾è¡Œé™æ€èµ„æºï¼ˆå¦‚ï¼šcssã€jsã€imageç­‰èµ„æºï¼‰</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"/js"</span><span class="token punctuation">)</span> <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"image"</span><span class="token punctuation">)</span> <span class="token operator">||</span> path<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"/css"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// 3ã€æ”¾è¡ŒæŒ‡å®šæ“ä½œï¼Œæ— éœ€ç™»å½•å³å¯æ‰§è¡Œçš„æ“ä½œï¼ˆå¦‚ï¼šç™»å½•æ“ä½œã€æ³¨å†Œæ“ä½œç­‰ï¼‰</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// 4ã€æ”¾è¡Œç™»å½•çŠ¶æ€ ï¼ˆå¦‚æœå­˜åœ¨æŒ‡å®šsessuinå¯¹è±¡ï¼Œåˆ™ä¸ºç™»å½•çŠ¶æ€ï¼‰</span>        <span class="token comment">// è·å–sessionåŸŸå¯¹è±¡</span>        <span class="token class-name">String</span> uname <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è‹¥sessionåŸŸå¯¹è±¡ä¸ä¸ºç©ºï¼Œåˆ™ä¸ºç™»å½•çŠ¶æ€ï¼Œæ”¾è¡Œ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>uname <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>uname<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            filterChain<span class="token punctuation">.</span><span class="token function">doFilter</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// è‹¥ä»¥ä¸Šæ¡ä»¶å‡ä¸æ»¡è¶³ï¼Œæ‹¦æˆªè·³è½¬åˆ°ç™»å½•é¡µé¢</span>        response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>src<span class="token operator">/</span>com<span class="token operator">/</span>xxxx<span class="token operator">/</span>servlet<span class="token operator">/</span><span class="token class-name">LoginServlet</span><span class="token punctuation">.</span>java<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç”¨æˆ·ç™»é™†..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">String</span> uname <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"uname"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>uname<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è‹¥æ˜¯adminè¡¨ç¤ºç™»é™†æˆåŠŸ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"admin"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>uname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span>uname<span class="token punctuation">)</span><span class="token punctuation">;</span>            resp<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span><span class="token string">"index.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            req<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span><span class="token string">"login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>resp<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç›‘å¬å™¨"><a href="#ç›‘å¬å™¨" class="headerlink" title="ç›‘å¬å™¨"></a>ç›‘å¬å™¨</h2><pre class="line-numbers language-java" data-language="java"><code class="language-java">æ¦‚å¿µæ˜¯ <span class="token class-name">Servlet</span> ä¸­ä¸€ç§çš„ç‰¹æ®Šçš„ç±»ï¼Œèƒ½ç›‘å¬ <span class="token class-name">Web</span> ä¸­çš„ç‰¹å®šäº‹ä»¶å¦‚åŸŸå¯¹è±¡<span class="token class-name">ServletContext</span>ï¼Œ<span class="token class-name">HttpSession</span>ï¼Œ<span class="token class-name">ServletRequest</span> çš„åˆ›å»ºå’Œé”€æ¯ï¼›å˜é‡çš„åˆ›å»ºã€é”€æ¯å’Œä¿®æ”¹ç­‰ã€‚ å¯ä»¥åœ¨æŸäº›åŠ¨ä½œå‰åå¢åŠ å¤„ç†ï¼Œå®ç°ç›‘æ§ã€‚ç±»å‹ï¼ˆä¸‰ç±»å…«ç§ï¼‰    â‘´ ç›‘å¬ç”Ÿå‘½å‘¨æœŸï¼š<span class="token class-name">ServletRequestListener</span><span class="token class-name">HttpSessionListener</span><span class="token class-name">ServletContextListener</span>â‘µ ç›‘å¬å€¼çš„å˜åŒ–ï¼š<span class="token class-name">ServletRequestAttributeListener</span><span class="token class-name">HttpSessionAttributeListener</span><span class="token class-name">ServletContextAttributeListener</span>â‘¶ é’ˆå¯¹ session ä¸­çš„å¯¹è±¡<span class="token operator">:</span>ç›‘å¬ session ä¸­çš„ <span class="token class-name">Java</span> å¯¹è±¡<span class="token punctuation">(</span><span class="token class-name">JavaBean</span><span class="token punctuation">)</span> ï¼Œæ˜¯ <span class="token class-name">JavaBean</span> ç›´æ¥å®ç°ç›‘å¬å™¨ çš„æ¥å£ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h3><p><strong>Listener.java</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@WebListener</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Listener</span> <span class="token keyword">implements</span> <span class="token class-name">HttpSessionListener</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * å½“sessionå¯¹è±¡è¢«åˆ›å»ºæ—¶æ‰§è¡Œ     * @param httpSessionEvent     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionCreated</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> httpSessionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Sessionå¯¹è±¡è¢«åˆ›å»ºäº†..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å½“sessionå¯¹è±¡è¢«é”€æ¯æ—¶æ‰§è¡Œ     * @param httpSessionEvent     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionDestroyed</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> httpSessionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Sessionå¯¹è±¡è¢«é”€æ¯äº†..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>src<span class="token operator">/</span>com<span class="token operator">/</span>xxxx<span class="token operator">/</span>servlet<span class="token operator">/</span><span class="token class-name">Servlet01</span><span class="token punctuation">.</span>java<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/s01"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet01</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Servlet01..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ›å»ºsessionå¯¹è±¡</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>src<span class="token operator">/</span>com<span class="token operator">/</span>xxxx<span class="token operator">/</span>servlet<span class="token operator">/</span><span class="token class-name">Servlet02</span><span class="token punctuation">.</span>java<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/s02"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Servlet02</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Servlet02..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é”€æ¯sessionå¯¹è±¡</span>       req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åº”ç”¨-1"><a href="#åº”ç”¨-1" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><h4 id="åœ¨çº¿äººæ•°ç»Ÿè®¡"><a href="#åœ¨çº¿äººæ•°ç»Ÿè®¡" class="headerlink" title="åœ¨çº¿äººæ•°ç»Ÿè®¡"></a>åœ¨çº¿äººæ•°ç»Ÿè®¡</h4><p><strong>OnlineListener.java</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * åœ¨çº¿äººæ•°ç»Ÿè®¡ *  å½“æœ‰æ–°çš„sessionå¯¹è±¡åˆ›å»ºæ—¶ï¼Œäººæ•°+1 *  å½“æœ‰sessionå¯¹è±¡é”€æ¯æ—¶ï¼Œäººæ•°-1 */</span><span class="token annotation punctuation">@WebListener</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnlineListener</span> <span class="token keyword">implements</span> <span class="token class-name">HttpSessionListener</span> <span class="token punctuation">{</span>    <span class="token comment">// å®šä¹‰åœ¨çº¿äººæ•°</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> onlineNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">/**     * å½“æœ‰æ–°çš„sessionå¯¹è±¡åˆ›å»ºæ—¶ï¼Œäººæ•°+1     * @param httpSessionEvent     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionCreated</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> httpSessionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// äººæ•°+1</span>        onlineNumber<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token comment">// å°†äººæ•°è®¾ç½®åˆ°servletContextä½œç”¨åŸŸä¸­</span>        httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineNumber"</span><span class="token punctuation">,</span>onlineNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å½“æœ‰sessionå¯¹è±¡é”€æ¯æ—¶ï¼Œäººæ•°-1     * @param httpSessionEvent     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sessionDestroyed</span><span class="token punctuation">(</span><span class="token class-name">HttpSessionEvent</span> httpSessionEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// äººæ•°-1</span>        onlineNumber<span class="token operator">--</span><span class="token punctuation">;</span>        <span class="token comment">// å°†äººæ•°è®¾ç½®åˆ°servletContextä½œç”¨åŸŸä¸­</span>        httpSessionEvent<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineNumber"</span><span class="token punctuation">,</span>onlineNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>src<span class="token operator">/</span>com<span class="token operator">/</span>xxxx<span class="token operator">/</span>servlet<span class="token operator">/</span><span class="token class-name">OnlineServlet</span><span class="token punctuation">.</span>java<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/online"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OnlineServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> req<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ServletException</span><span class="token punctuation">,</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// åˆ›å»ºsessionå¯¹è±¡</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–å‚æ•°å€¼  key</span>        <span class="token class-name">String</span> key <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ¤æ–­å‚æ•°æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºåšé€€å‡ºæ“ä½œ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>key <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"logout"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// é”€æ¯sessionå¯¹è±¡</span>            session<span class="token punctuation">.</span><span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">/* ç™»å½•æ“ä½œ */</span>        <span class="token comment">// å¾—åˆ°å½“å‰ä½œç”¨åŸŸçš„åœ¨çº¿äººæ•°</span>        <span class="token class-name">Integer</span> onlineNumber <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"onlineNumber"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®å“åº”ç±»å‹åŠç¼–ç </span>        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"text/html;charset=UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¾“å‡ºäººæ•°</span>        resp<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"&lt;h2&gt;å½“å‰åœ¨çº¿äººæ•°ï¼š"</span><span class="token operator">+</span>onlineNumber<span class="token operator">+</span><span class="token string">"&lt;/h2&gt; &lt;a href='online?key=logout'&gt;é€€å‡º&lt;/a&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Servlet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis å‘å¸ƒè®¢é˜…</title>
      <link href="/2020/01/16/redis-fa-bu-ding-yue/"/>
      <url>/2020/01/16/redis-fa-bu-ding-yue/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Redis çš„å‘å¸ƒè®¢é˜…( publish/subscribe )ï¼Œæ˜¯ä¸€ç§æ¶ˆæ¯é€šä¿¡æ¨¡å¼ï¼Œæ¶ˆæ¯å‘é€è€…å‘å¸ƒä¿¡æ¯ï¼Œæ¶ˆæ¯è®¢é˜…è€…ï¼ˆ Redis-client ï¼‰æ¥æ”¶æ¶ˆæ¯ï¼Œå¯ä»¥ç”¨æ¥æ„å»ºç½‘ç»œèŠå¤©å®¤ã€å®æ—¶å¹¿æ’­ã€å®æ—¶æé†’ç­‰å³æ—¶é€šä¿¡åº”ç”¨ï¼Œå¤æ‚ç‚¹çš„å°±ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ MQ ã€‚</p><h3 id="å‘å¸ƒè®¢é˜…çš„æµç¨‹å›¾"><a href="#å‘å¸ƒè®¢é˜…çš„æµç¨‹å›¾" class="headerlink" title="å‘å¸ƒè®¢é˜…çš„æµç¨‹å›¾"></a>å‘å¸ƒè®¢é˜…çš„æµç¨‹å›¾</h3><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806150601.png"></p><table><thead><tr><th>å‘½ä»¤</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td>subscribe channel</td><td>è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“</td></tr><tr><td>unsubscribe channel</td><td>å–æ¶ˆè®¢é˜…</td></tr><tr><td>publish channel</td><td>å‘å¸ƒæ¶ˆæ¯åˆ°é¢‘é“</td></tr></tbody></table><p>æ¶ˆæ¯è®¢é˜…è€…å¯ä»¥è®¢é˜…å¤šä¸ªé¢‘é“ï¼Œæ­¤å¤„æœ‰ 3 ä¸ªè®¢é˜…è€…åŒæ—¶è®¢é˜…äº† channel1 é¢‘é“ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806150613.png"></p><p>æ¶ˆæ¯å‘å¸ƒè€…é€šè¿‡ PUBLISH å‘½ä»¤æŠŠæ¶ˆæ¯å‘é€åˆ°é¢‘é“ channel1 ï¼Œæ‰€æœ‰çš„è®¢é˜…è€…å°±å¯ä»¥æ”¶åˆ°æ¶ˆæ¯ ã€‚</p><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806150618.png"></p><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p><code>è®¢é˜…ç«¯</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> SUBSCRIBE channel1  <span class="token comment"># è®¢é˜…é¢‘é“ channel1</span>channel1 Reading messages<span class="token punctuation">..</span>. <span class="token punctuation">(</span>press Ctrl-C to quit<span class="token punctuation">)</span>  <span class="token comment"># ç­‰å¾…è¯»å–é¢‘é“æ¨é€çš„æ¶ˆæ¯ </span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"subscribe"</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"channel1"</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"message"</span>  <span class="token comment"># æ¶ˆæ¯</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"channel1"</span>  <span class="token comment"># é¢‘é“ </span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"hello"</span>  <span class="token comment"># æ¶ˆæ¯çš„å…·ä½“å†…å®¹ </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>å‘å¸ƒç«¯</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> PUBLISH kuangshenshuo <span class="token string">"hello"</span>   <span class="token comment"># å‘å¸ƒè€…å‘å¸ƒæ¶ˆæ¯åˆ°é¢‘é“ï¼</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>é€šè¿‡ SUBSCRIBE å‘½ä»¤è®¢é˜…æŸé¢‘é“åï¼Œredis-server é‡Œç»´æŠ¤äº†ä¸€ä¸ªå­—å…¸ï¼Œå­—å…¸çš„é”®å°±æ˜¯å¾ˆå¤šé¢‘é“ï¼Œè€Œå­—å…¸çš„å€¼åˆ™æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸­ä¿å­˜äº†æ‰€æœ‰è®¢é˜…è¿™ä¸ª channel çš„å®¢æˆ·ç«¯ã€‚SUBSCRIBE å‘½ä»¤çš„å…³é”®ï¼Œ å°±æ˜¯å°†å®¢æˆ·ç«¯æ·»åŠ åˆ°ç»™å®š channel çš„è®¢é˜…é“¾è¡¨ä¸­ã€‚ é€šè¿‡ PUBLISH å‘½ä»¤å‘è®¢é˜…è€…å‘é€æ¶ˆæ¯ï¼Œredis-server ä¼šä½¿ç”¨ç»™å®šçš„é¢‘é“ä½œä¸ºé”®ï¼Œåœ¨å®ƒæ‰€ç»´æŠ¤çš„ channel å­—å…¸ä¸­æŸ¥æ‰¾è®°å½•äº†è®¢é˜…è¿™ä¸ªé¢‘é“çš„æ‰€æœ‰å®¢æˆ·ç«¯çš„é“¾è¡¨ï¼Œéå†è¿™ä¸ªé“¾è¡¨ï¼Œå°†æ¶ˆæ¯å‘å¸ƒç»™æ‰€æœ‰è®¢é˜…è€…ã€‚ </p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis æ•°æ®æŒä¹…åŒ–</title>
      <link href="/2020/01/10/redis-shu-ju-chi-jiu-hua/"/>
      <url>/2020/01/10/redis-shu-ju-chi-jiu-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Redis æ˜¯å†…å­˜æ•°æ®åº“ï¼Œæ–­ç”µå³å¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸ºäº†ä¿å­˜æ•°æ®ï¼Œéœ€è¦å°†æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ï¼Œå³å°†æ•°æ®ä¿å­˜ä¸ºæ–‡ä»¶å†™å…¥ç£ç›˜ä¸­ã€‚</p><p>Redis æŒä¹…åŒ–çš„æ–¹å¼æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ RDB å’Œ AOF ï¼Œå®ƒä»¬å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œæ¥ä¸‹æ¥è®©æˆ‘ä»¬ä»”ç»†æ¢ç©¶ã€‚</p><h2 id="RDBï¼ˆRedis-DataBaseï¼‰"><a href="#RDBï¼ˆRedis-DataBaseï¼‰" class="headerlink" title="RDBï¼ˆRedis DataBaseï¼‰"></a>RDBï¼ˆRedis DataBaseï¼‰</h2><h3 id="æŒä¹…åŒ–æµç¨‹"><a href="#æŒä¹…åŒ–æµç¨‹" class="headerlink" title="æŒä¹…åŒ–æµç¨‹"></a>æŒä¹…åŒ–æµç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806114552.png" alt="RDB æŒä¹…åŒ–æµç¨‹å›¾"></p><p>Redis ä¼šåˆ›å»ºï¼ˆ fork ï¼‰ä¸€ä¸ªå­è¿›ç¨‹æ¥è¿›è¡Œ RDB æŒä¹…åŒ–ï¼Œåœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…ï¼Œä¼šå…ˆå°†å†…å­˜ä¸­çš„æ•°æ®å†™å…¥åˆ°ä¸€ä¸ªä¸´æ—¶ rdb å¿«ç…§æ–‡ä»¶ä¸­ï¼Œå¾…æŒä¹…åŒ–è¿‡ç¨‹ç»“æŸåï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶å¿«ç…§æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡æŒä¹…åŒ–å¥½çš„ rdb å¿«ç…§æ–‡ä»¶ã€‚</p><h3 id="æŒä¹…åŒ–è§¦å‘æ—¶æœº"><a href="#æŒä¹…åŒ–è§¦å‘æ—¶æœº" class="headerlink" title="æŒä¹…åŒ–è§¦å‘æ—¶æœº"></a>æŒä¹…åŒ–è§¦å‘æ—¶æœº</h3><p>   <span class="github-emoji"><span>ğŸ’¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4a6.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>  æ»¡è¶³ save çš„è§„åˆ™æ—¶<br>   <span class="github-emoji"><span>ğŸ’¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4a6.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>  æ‰§è¡Œ ï¬‚ushall å‘½ä»¤æ—¶<br>   â€‹<span class="github-emoji"><span>ğŸ’¦</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4a6.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>  åœæ­¢ Redis æ—¶</p><h3 id="æ•°æ®æ¢å¤"><a href="#æ•°æ®æ¢å¤" class="headerlink" title="æ•°æ®æ¢å¤"></a>æ•°æ®æ¢å¤</h3><p>å°† Redis å¯åŠ¨ç›®å½• â€œ/usr/local/binâ€ çš„å¿«ç…§æ–‡ä»¶ dump.rdb ç›´æ¥è¯»åˆ°å†…å­˜é‡Œè¿›è¡Œæ•°æ®æ¢å¤ã€‚</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> config get <span class="token function">dir</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"dir"</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"/usr/local/bin"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><blockquote><p> ä¼˜ç‚¹ï¼š </p><ol><li> é«˜æ€§èƒ½ï¼šæ•´ä¸ªæ•°æ®æŒä¹…åŒ–è¿‡ç¨‹ä¸­ï¼Œä¸»è¿›ç¨‹ä¸è¿›è¡Œä»»ä½•IOæ“ä½œã€‚</li><li> é€‚åˆæ¢å¤å¤§æ•°æ®ï¼Œå¯¹æ•°æ®çš„å®Œæ•´æ€§è¦ä¸é«˜ï¼Œæ¯” AOP æ–¹å¼æ›´å¿«æ›´é«˜æ•ˆã€‚</li></ol><p>ç¼ºç‚¹ï¼š </p><ol><li> æ•°æ®æŒä¹…åŒ–åˆ›å»ºå­è¿›ç¨‹æ—¶ï¼Œä¼šå ç”¨é¢å¤–å†…å­˜ç©ºé—´ï¼ </li><li> æ•°æ®æŒä¹…åŒ–éœ€è¦è®¾ç½®ä¸€å®šçš„æ—¶é—´é—´éš”ï¼Œå¦‚æœ Redis æ„å¤–å®•æœºï¼Œæœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¸¢å¤±ï¼</li></ol></blockquote><h3 id="ä¸»ä»å¤åˆ¶"><a href="#ä¸»ä»å¤åˆ¶" class="headerlink" title="ä¸»ä»å¤åˆ¶"></a>ä¸»ä»å¤åˆ¶</h3><p>RDB åœ¨ä¸»ä»å¤åˆ¶çš„ä½œç”¨ï¼šä¸€èˆ¬æ”¾åœ¨ä»æœºä¸Šä½œä¸ºå¤‡ç”¨ï¼Œ15minå¤‡ä»½ä¸€æ¬¡å°±å¤Ÿäº†ï¼ˆè§„åˆ™ï¼šsave 900 1ï¼‰ã€‚</p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p><code>redis.conf</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">################################ å¿«ç…§  ################################</span><span class="token comment"># æŒä¹…åŒ–è§¦å‘æ—¶æœº</span>save <span class="token number">900</span> <span class="token number">1</span>  <span class="token comment"># è‹¥ 900s å†…ï¼Œæœ‰è‡³å°‘ 1 ä¸ª key å‘ç”Ÿæ”¹å˜ï¼Œå°±è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</span>save <span class="token number">300</span> <span class="token number">10</span>save <span class="token number">60</span> <span class="token number">10000</span><span class="token comment"># æŒä¹…åŒ–å‡ºé”™æ˜¯å¦ä»ç»§ç»­å·¥ä½œ</span>stop-writes-on-bgsave-error <span class="token function">yes</span><span class="token comment"># æ˜¯å¦å‹ç¼© .rdb æ–‡ä»¶ï¼ˆæ¶ˆè€—CPUèµ„æºï¼‰</span>rdbcompression <span class="token function">yes</span><span class="token comment"># ä¿å­˜ .rdb æ–‡ä»¶æ—¶æ˜¯å¦åšæ£€æŸ¥æ ¡éªŒå¹¶è‡ªåŠ¨ä¿®å¤</span>rdbchecksum <span class="token function">yes</span><span class="token comment"># å¯¼å‡º .rdb æ–‡ä»¶çš„æ–‡ä»¶å</span>dbfilename dump.rdb<span class="token comment"># .rdb æ–‡ä»¶ä¿å­˜è·¯å¾„</span><span class="token function">dir</span> ./<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="AOFï¼ˆAppend-Only-Fileï¼‰"><a href="#AOFï¼ˆAppend-Only-Fileï¼‰" class="headerlink" title="AOFï¼ˆAppend Only Fileï¼‰"></a>AOFï¼ˆAppend Only Fileï¼‰</h2><h3 id="æŒä¹…åŒ–æµç¨‹-1"><a href="#æŒä¹…åŒ–æµç¨‹-1" class="headerlink" title="æŒä¹…åŒ–æµç¨‹"></a>æŒä¹…åŒ–æµç¨‹</h3><p><img src="https://cdn.jsdelivr.net/gh/Revelvy/picbed/blog/img/20210806114553.png" alt="AOF æŒä¹…åŒ–æµç¨‹å›¾"></p><p>å°†æ‰€æœ‰çš„å†™æ“ä½œå‘½ä»¤ä»¥æ—¥å¿—å½¢å¼è®°å½•ä¸‹æ¥ã€‚</p><h3 id="æ•°æ®æ¢å¤-1"><a href="#æ•°æ®æ¢å¤-1" class="headerlink" title="æ•°æ®æ¢å¤"></a>æ•°æ®æ¢å¤</h3><p>æ¢å¤æ—¶æ ¹æ® .aof æ–‡ä»¶ï¼Œæ‰§è¡Œå…¨éƒ¨å‘½ä»¤ã€‚</p><p>è‹¥ .aof æ–‡ä»¶æŸåï¼Œåˆ™å¯ä»¥ç”¨ AOF æ–‡ä»¶ä¿®å¤å·¥å…·ä¿®å¤ï¼š</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ redis-check-aof --fix appendonly.aof<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä¼˜ç¼ºç‚¹-1"><a href="#ä¼˜ç¼ºç‚¹-1" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><blockquote><p>ä¼˜ç‚¹ï¼š </p><ol><li>æ¯ä¸€æ¬¡ä¿®æ”¹éƒ½åŒæ­¥ï¼Œæ–‡ä»¶çš„å®Œæ•´é«˜ã€‚</li><li>åŒæ­¥é—´éš”è®¾ç½®ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡æ—¶ï¼Œå¯èƒ½ä¼šä¸¢å¤±ä¸€ç§’çš„æ•°æ®ã€‚</li><li>åŒæ­¥é—´éš”è®¾ç½®ä¸ºä»ä¸åŒæ­¥æ—¶ï¼Œæ•ˆç‡æœ€é«˜ã€‚</li></ol><p>ç¼ºç‚¹ï¼š </p><ol><li>å½“æ•°æ®æ–‡ä»¶å¾ˆå¤§æ—¶ï¼Œæ•°æ®æ¢å¤é€Ÿåº¦æ…¢ã€‚ </li><li>è¿è¡Œæ•ˆç‡ä½ã€‚</li></ol></blockquote><h3 id="é…ç½®æ–‡ä»¶-1"><a href="#é…ç½®æ–‡ä»¶-1" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p><code>redis.conf</code></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment">############################## ä»…é™„åŠ æ¨¡å¼ ###############################</span><span class="token comment"># é»˜è®¤ä¸å¼€å¯ aof æ¨¡å¼ï¼Œå› ä¸ºåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹é»˜è®¤çš„ rdb æŒä¹…åŒ–å·²ç»å¤Ÿç”¨äº†</span>appendonly no<span class="token comment"># aof æŒä¹…åŒ–çš„æ–‡ä»¶çš„åå­—</span>appendfilename <span class="token string">"appendonly.aof"</span><span class="token comment"># appendfsync always  # æ¯æ¬¡ä¿®æ”¹éƒ½ä¼šåŒæ­¥ï¼Œé€Ÿåº¦æ…¢ä¼šæ¶ˆè€—æ€§èƒ½ï¼</span>appendfsync everysec  <span class="token comment"># æ¯ç§’æ‰§è¡Œä¸€æ¬¡åŒæ­¥ï¼Œå¯èƒ½ä¼šä¸¢å¤±è¿™1sçš„æ•°æ®ï¼</span><span class="token comment"># appendfsync no  # ä¸æ‰§è¡ŒåŒæ­¥ï¼Œæ“ä½œç³»ç»Ÿè‡ªå·±åŒæ­¥æ•°æ®ï¼Œé€Ÿåº¦æœ€å¿«ï¼</span><span class="token comment"># æ˜¯å¦å¼€å¯é‡å†™</span>no-appendfsync-on-rewrite no<span class="token comment"># é‡å†™è§„åˆ™</span>auto-aof-rewrite-percentage <span class="token number">100</span>auto-aof-rewrite-min-size 64mb  <span class="token comment"># å½“æ•°æ®æ–‡ä»¶å¤§äº 64mb æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹è¿›è¡Œè®°å½•</span>aof-load-truncated <span class="token function">yes</span>aof-use-rdb-preamble <span class="token function">yes</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> æŒä¹…åŒ– </tag>
            
            <tag> RDB </tag>
            
            <tag> AOF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jedis å¿«é€Ÿå…¥é—¨</title>
      <link href="/2020/01/07/jedis-kuai-su-ru-men/"/>
      <url>/2020/01/07/jedis-kuai-su-ru-men/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>Redis å®˜æ–¹ Java å®¢æˆ·ç«¯å¼€å‘åŒ…ã€‚</p><p>ä½œç”¨ï¼šä½¿ç”¨ Java æ“ä½œ Redis ã€‚</p><h2 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h2><h3 id="one-å¯¼å…¥ä¾èµ–"><a href="#one-å¯¼å…¥ä¾èµ–" class="headerlink" title=":one: å¯¼å…¥ä¾èµ–"></a><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å¯¼å…¥ä¾èµ–</h3><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.6.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="two-Linux-Redis-è¿œç¨‹æœåŠ¡ç«¯é…ç½®"><a href="#two-Linux-Redis-è¿œç¨‹æœåŠ¡ç«¯é…ç½®" class="headerlink" title=":two: Linux Redis è¿œç¨‹æœåŠ¡ç«¯é…ç½®"></a><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Linux Redis è¿œç¨‹æœåŠ¡ç«¯é…ç½®</h3><p>æœ¬ä¾‹ä½¿ç”¨éƒ¨ç½²åœ¨æœ¬åœ°çš„ CentOS è™šæ‹Ÿæœºæ­å»º Redis æœåŠ¡ï¼Œåœ¨ IDEA æµ‹è¯•è¿æ¥ä¹‹å‰ï¼Œéœ€å¼€å¯ Redis æœåŠ¡å¹¶åšç›¸å…³è®¾ç½®ã€‚</p><blockquote><p>Redis çš„åŸé…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆä¸ä¿®æ”¹ç”¨ä½œå¤‡ä»½ï¼‰ï¼š/opt/redis-5.0.12/redis.conf<br>Redis çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶è·¯å¾„ï¼š/usr/local/bin/rconfig/redis.conf</p></blockquote><h4 id="è®¾ç½®å…¬ç½‘æ¥å£ã€å…³é—­ä¿æŠ¤æ¨¡å¼"><a href="#è®¾ç½®å…¬ç½‘æ¥å£ã€å…³é—­ä¿æŠ¤æ¨¡å¼" class="headerlink" title="è®¾ç½®å…¬ç½‘æ¥å£ã€å…³é—­ä¿æŠ¤æ¨¡å¼"></a>è®¾ç½®å…¬ç½‘æ¥å£ã€å…³é—­ä¿æŠ¤æ¨¡å¼</h4><p>Redis é»˜è®¤åªèƒ½ä»æœ¬æœºè®¿é—®ï¼Œæˆ‘ä»¬æƒ³è¦ä»æœ¬åœ°è¿æ¥åˆ°æœåŠ¡å™¨ä¸Šçš„ Redis æœåŠ¡ï¼Œéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆè®¾ç½® bind ï¼Œbind ç»‘å®šçš„ IP ä¸æ˜¯è¯·æ±‚æ¥æº IP ï¼Œè€Œæ˜¯ Redis ä¸ŠæœåŠ¡å™¨æœ¬èº«æ¥æ”¶è¯·æ±‚çš„ç½‘ç»œæ¥å£çš„ IP ï¼Œæ­¤å¤„è®¾ç½®ç›‘å¬æ¥å£çš„é…ç½®æœ‰ä¸¤ç§æ–¹æ¡ˆï¼šç¬¬ä¸€ç§æ˜¯ç›´æ¥å–æ¶ˆ Redis é»˜è®¤åªèƒ½ä»æœ¬æœºè®¿é—®çš„æ³¨é‡Šï¼Œæ­¤æ—¶å°±å…è®¸äº†æ‰€æœ‰å…¬ç½‘ IP éƒ½å¯ä»¥è¿æ¥è¯¥æœåŠ¡å™¨ä¸Šçš„ Redis æœåŠ¡ã€‚ç¬¬äºŒç§æ˜¯ç»‘å®šå…¬ç½‘æ¥å£ IP ï¼Œè®© Redis åªç›‘å¬ IPv4 çš„æœ¬åœ°å›ç¯æ¥å£å’Œå…¬ç½‘æ¥å£ï¼ˆæ¨èï¼‰ï¼Œç„¶åå…³é—­ Redis çš„ä¿æŠ¤æ¨¡å¼ã€‚</p><p>é’ˆå¯¹ä¸åŒçš„ç¯å¢ƒï¼ŒæŸ¥çœ‹å…¬ç½‘æ¥å£çš„æ–¹å¼æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä½¿ç”¨ ifconfig æŸ¥çœ‹å½“å‰æœåŠ¡å™¨çš„ç½‘ç»œæ¥å£ã€‚</p><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æœ¬æœºè™šæ‹Ÿæœº</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ ifconfigdocker0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500        inet 172.17.0.1  netmask 255.255.0.0  broadcast 172.17.255.255        inet6 fe80::42:a4ff:fe2a:17fd  prefixlen 64  scopeid 0x20&lt;link&gt;        ether 02:42:a4:2a:17:fd  txqueuelen 0  (Ethernet)        RX packets 101375  bytes 17406789 (16.6 MiB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 138351  bytes 372190211 (354.9 MiB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0ens33: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500        inet 192.168.34.130  netmask 255.255.255.0  broadcast 192.168.34.255        inet6 fe80::b060:e396:f9fb:f8ee  prefixlen 64  scopeid 0x20&lt;link&gt;        ether 00:0c:29:39:24:89  txqueuelen 1000  (Ethernet)        RX packets 1031326  bytes 1493603587 (1.3 GiB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 408748  bytes 39063819 (37.2 MiB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536        inet 127.0.0.1  netmask 255.0.0.0        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;        loop  txqueuelen 1000  (Local Loopback)        RX packets 68  bytes 5916 (5.7 KiB)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 68  bytes 5916 (5.7 KiB)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0virbr0: flags=4099&lt;UP,BROADCAST,MULTICAST&gt;  mtu 1500        inet 192.168.122.1  netmask 255.255.255.0  broadcast 192.168.122.255        ether 52:54:00:30:98:90  txqueuelen 1000  (Ethernet)        RX packets 0  bytes 0 (0.0 B)        RX errors 0  dropped 0  overruns 0  frame 0        TX packets 0  bytes 0 (0.0 B)        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th align="left">ç½‘ç»œæ¥å£</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">docker0</td><td align="left">å®‰è£… docker æ—¶è‡ªåŠ¨åˆ›å»ºçš„</td></tr><tr><td align="left">ens33</td><td align="left">è™šæ‹Ÿæœºæ¥å£</td></tr><tr><td align="left">lo</td><td align="left">æœ¬åœ°å›ç¯æ¥å£</td></tr></tbody></table><p>æ­¤æ—¶ Redis é…ç½®æ–‡ä»¶åº”è®¾ç½®ä¸ºï¼š</p><p><code>redis.conf</code></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">bind 127.0.0.1 192.168.34.130protected-mode no<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> â€‹äº‘æœåŠ¡å™¨</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">$ ifconfigdocker0   Link encap:Ethernet  HWaddr 3A:F3:20:12:AE:6A          inet addr:192.168.42.1  Bcast:0.0.0.0  Mask:255.255.255.0          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:362879 errors:0 dropped:0 overruns:0 frame:0          TX packets:894703 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0          RX bytes:28218097 (26.9 MiB)  TX bytes:1326305089 (1.2 GiB)eth0      Link encap:Ethernet  HWaddr 00:16:3E:08:18:35          inet addr:10.25.102.37  Bcast:10.25.103.255  Mask:255.255.252.0          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:4958304 errors:0 dropped:0 overruns:0 frame:0          TX packets:2766733 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000          RX bytes:534516269 (509.7 MiB)  TX bytes:13382719049 (12.4 GiB)eth1      Link encap:Ethernet  HWaddr 00:16:3E:08:13:6B          inet addr:120.76.207.156  Bcast:120.76.207.255  Mask:255.255.252.0          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1          RX packets:13183600 errors:0 dropped:0 overruns:0 frame:0          TX packets:14070363 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:1000          RX bytes:6460933699 (6.0 GiB)  TX bytes:8462002985 (7.8 GiB)lo        Link encap:Local Loopback          inet addr:127.0.0.1  Mask:255.0.0.0          UP LOOPBACK RUNNING  MTU:65536  Metric:1          RX packets:156288093 errors:0 dropped:0 overruns:0 frame:0          TX packets:156288093 errors:0 dropped:0 overruns:0 carrier:0          collisions:0 txqueuelen:0          RX bytes:19039024606 (17.7 GiB)  TX bytes:19039024606 (17.7 GiB)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><table><thead><tr><th align="left">ç½‘ç»œæ¥å£</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">docker0</td><td align="left">å®‰è£… docker æ—¶è‡ªåŠ¨åˆ›å»ºçš„ç½‘æ¡¥</td></tr><tr><td align="left">eth0</td><td align="left">é˜¿é‡Œäº‘å†…ç½‘æ¥å£</td></tr><tr><td align="left">eth1</td><td align="left">é˜¿é‡Œäº‘å…¬ç½‘æ¥å£</td></tr><tr><td align="left">lo</td><td align="left">æœ¬åœ°å›ç¯æ¥å£</td></tr></tbody></table><p>æ­¤æ—¶ Redis é…ç½®æ–‡ä»¶åº”è®¾ç½®ä¸ºï¼š</p><p><code>redis.conf</code></p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell">bind 127.0.0.1 120.76.207.156protected-mode no<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="é‡å¯-Redis"><a href="#é‡å¯-Redis" class="headerlink" title="é‡å¯ Redis"></a>é‡å¯ Redis</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># å¯åŠ¨ Redis æœåŠ¡ç«¯ ï¼ˆé»˜è®¤æ— å¯†ç ï¼‰</span>$ redis-server /usr/local/bin/rconfig/redis.conf<span class="token comment"># æŸ¥çœ‹ Redis è¿›ç¨‹ï¼Œæ£€æŸ¥æ˜¯å¦å¯åŠ¨æˆåŠŸ</span>$ <span class="token function">ps</span> -ef<span class="token operator">|</span><span class="token function">grep</span> redis<span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># ps -ef|grep redis</span>root      <span class="token number">52979</span>      <span class="token number">1</span>  <span class="token number">0</span> <span class="token number">12</span>:39 ?        00:00:00 redis-server <span class="token number">127.0</span>.0.1:6379root      <span class="token number">52994</span>   <span class="token number">3457</span>  <span class="token number">0</span> <span class="token number">12</span>:39 pts/0    00:00:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto redis<span class="token comment"># åœæ­¢ Redis</span>$ redis-cli -h <span class="token number">127.0</span>.0.1 -p <span class="token number">6379</span> <span class="token function">shutdown</span>$ redis-cli -h <span class="token number">127.0</span>.0.1 -p <span class="token number">6379</span> -a password <span class="token function">shutdown</span>  <span class="token comment"># æœ‰å¯†ç æ—¶ä½¿ç”¨</span><span class="token comment"># å¼€å¯è¿æ¥</span>$ redis-cli -h <span class="token number">127.0</span>.0.1 -p <span class="token number">6379</span>$ redis-cli -h <span class="token function">host</span> -p port -a password  <span class="token comment"># æœ‰å¯†ç æ—¶ä½¿ç”¨</span><span class="token comment"># æµ‹è¯•è¿æ¥ï¼ˆè¿”å› PONG æ—¶åˆ™è¿æ¥æˆåŠŸï¼‰</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">ping</span><span class="token comment"># é€€å‡ºè¿æ¥</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token builtin class-name">exit</span><span class="token comment"># åœæ­¢ Redis å¹¶ é€€å‡ºè¿æ¥</span><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>&gt;</span> <span class="token function">shutdown</span>not connected<span class="token operator">&gt;</span> <span class="token builtin class-name">exit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å¼€æ”¾ç«¯å£"><a href="#å¼€æ”¾ç«¯å£" class="headerlink" title="å¼€æ”¾ç«¯å£"></a>å¼€æ”¾ç«¯å£</h4><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æœ¬æœºè™šæ‹Ÿæœº</p><pre class="line-numbers language-shell" data-language="shell"><code class="language-shell"><span class="token comment"># é˜²ç«å¢™å¯åœï¼ˆåœæ‰çš„è¯ï¼Œå°±ä¸éœ€åç»­çš„ç«¯å£æ“ä½œäº†ï¼‰</span>systemctl start/restart/stop firewalld<span class="token comment"># ç«¯å£</span>$ firewall-cmd --list-ports$ firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">6379</span>/tcp --permanent$ firewall-cmd --zone<span class="token operator">=</span>public --remove-port<span class="token operator">=</span><span class="token number">6379</span>/tcp --permanent<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> äº‘æœåŠ¡å™¨</p><p>é…ç½®å®‰å…¨ç»„ç­–ç•¥ï¼Œå¼€æ”¾å¯¹åº”ç«¯å£ï¼Œæ­¤å¤„ä¸åšè¿‡å¤šé˜è¿°ã€‚</p><h3 id="three-æµ‹è¯•è¿æ¥"><a href="#three-æµ‹è¯•è¿æ¥" class="headerlink" title=":three:  æµ‹è¯•è¿æ¥"></a><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>  æµ‹è¯•è¿æ¥</h3><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.75<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æµ‹è¯• Redis è¿æ¥</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">redisTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">,</span><span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">ping</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// æµ‹è¯• Redis äº‹åŠ¡</span><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">redisTransactionTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"192.168.34.130"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    jedis<span class="token punctuation">.</span><span class="token function">flushDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">JSONObject</span> jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"world"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"kuangshen"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">Transaction</span> multi <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">multi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">String</span> result <span class="token operator">=</span> jsonObject<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// jedis.watch(result)</span>    <span class="token keyword">try</span> <span class="token punctuation">{</span>        multi<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>        multi<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"k2"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>        multi<span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>        multi<span class="token punctuation">.</span><span class="token function">discard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"k1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// {"name":"kuangshen","hello":"world"}</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"k2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// {"name":"kuangshen","hello":"world"}</span>        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Redis </tag>
            
            <tag> Jedis </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis äº‹åŠ¡</title>
      <link href="/2020/01/06/redis-shi-wu/"/>
      <url>/2020/01/06/redis-shi-wu/</url>
      
        <content type="html"><![CDATA[<h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p><span class="github-emoji"><span>âš¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/26a1.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Redis äº‹åŠ¡æœ¬è´¨ï¼šä¸€ç»„å‘½ä»¤çš„é›†åˆã€‚</p><p><span class="github-emoji"><span>âš¡</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/26a1.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> Redis å•æ¡å‘½ä»¤å…·æœ‰åŸå­æ€§ï¼Œä½† Redis äº‹åŠ¡æ²¡æœ‰åŸå­æ€§ã€éš”ç¦»æ€§ï¼ˆä¸å­˜åœ¨éš”ç¦»çº§åˆ«ï¼‰ã€‚</p><h3 id="ç‰¹æ€§"><a href="#ç‰¹æ€§" class="headerlink" title="ç‰¹æ€§"></a>ç‰¹æ€§</h3><p><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä¸€æ¬¡æ€§ï¼šä¸€ä¸ªäº‹åŠ¡ä¸­çš„æ‰€æœ‰å¾…æ‰§è¡Œå‘½ä»¤éƒ½ä¼šè¢«ä¸€æ¬¡æ€§æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå³åºåˆ—åŒ–ã€‚<br><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> é¡ºåºæ€§ï¼šæŒ‰å…ˆè¿›å…ˆå‡ºçš„é¡ºåºæ‰§è¡Œã€‚<br><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ’ä»–æ€§ï¼šäº’ä¸å¹²æ‰°ã€‚</p><h3 id="æ‰§è¡Œæµç¨‹"><a href="#æ‰§è¡Œæµç¨‹" class="headerlink" title="æ‰§è¡Œæµç¨‹"></a>æ‰§è¡Œæµç¨‹</h3><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> â€‹å¼€å¯ä¸€ç»„äº‹åŠ¡ï¼šmulti<br><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> â€‹å‘½ä»¤å…¥é˜Ÿï¼šâ€¦â€¦<br><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åºŸå¼ƒè¿™ç»„äº‹åŠ¡ï¼šdiscard<br><span class="github-emoji"><span>4âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0034-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> â€‹æ‰§è¡Œäº‹åŠ¡ï¼šexec</p><p><code>æ‰§è¡Œä¸€ç»„äº‹åŠ¡</code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> multiOK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k1 v1QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k1QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">exec</span><span class="token number">1</span><span class="token punctuation">)</span> OK<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"v1"</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">keys</span> <span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"k1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>ä¸­é€”åºŸå¼ƒäº‹åŠ¡</code></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> multiOK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k1 v1QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get k1QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">discard</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">keys</span> <span class="token operator">*</span><span class="token punctuation">(</span>empty list <span class="token operator">or</span> <span class="token keyword">set</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h3><h4 id="bug-ç¼–è¯‘æ—¶å¼‚å¸¸"><a href="#bug-ç¼–è¯‘æ—¶å¼‚å¸¸" class="headerlink" title=":bug: ç¼–è¯‘æ—¶å¼‚å¸¸"></a><span class="github-emoji"><span>ğŸ›</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f41b.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç¼–è¯‘æ—¶å¼‚å¸¸</h4><p>äº‹åŠ¡ä¸­æœ‰è¯­æ³•é”™è¯¯çš„å‘½ä»¤æ—¶ï¼Œæ‰€æœ‰å‘½ä»¤éƒ½ä¸ä¼šè¢«æ‰§è¡Œ</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> multiOK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k1 v1QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> getset k1  <span class="token comment"># è¯­æ³•é”™è¯¯çš„å‘½ä»¤</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR wrong number <span class="token keyword">of</span> arguments <span class="token keyword">for</span> <span class="token string">'getset'</span> command<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k2 v2QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">exec</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> EXECABORT <span class="token keyword">Transaction</span> discarded because <span class="token keyword">of</span> previous <span class="token keyword">errors</span><span class="token punctuation">.</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">keys</span> <span class="token operator">*</span><span class="token punctuation">(</span>empty list <span class="token operator">or</span> <span class="token keyword">set</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="bug-è¿è¡Œæ—¶å¼‚å¸¸"><a href="#bug-è¿è¡Œæ—¶å¼‚å¸¸" class="headerlink" title=":bug: è¿è¡Œæ—¶å¼‚å¸¸"></a><span class="github-emoji"><span>ğŸ›</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f41b.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> è¿è¡Œæ—¶å¼‚å¸¸</h4><p>é™¤äº†é”™è¯¯å‘½ä»¤ä¸è¢«æ‰§è¡ŒæŠ›å¼‚å¸¸ä¹‹å¤–ï¼Œå…¶ä»–æ­£ç¡®å‘½ä»¤å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼ˆè¯´æ˜äº† Redis äº‹åŠ¡æ²¡æœ‰åŸå­æ€§ï¼‰</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> multiOK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k1 <span class="token string">"v1"</span>QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> incr k1  <span class="token comment"># è¯­æ³•æ­£ç¡®ä½†è¿è¡Œæ—¶é”™è¯¯ï¼ˆå­—ç¬¦ä¸²ä¸èƒ½+1ï¼‰</span>QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> k2 v2QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">exec</span><span class="token number">1</span><span class="token punctuation">)</span> OK<span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> ERR <span class="token keyword">value</span> <span class="token operator">is</span> <span class="token operator">not</span> an <span class="token keyword">integer</span> <span class="token operator">or</span> <span class="token keyword">out</span> <span class="token keyword">of</span> range<span class="token number">3</span><span class="token punctuation">)</span> OK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">keys</span> <span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"k2"</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"k1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç›‘æ§"><a href="#ç›‘æ§" class="headerlink" title="ç›‘æ§"></a>ç›‘æ§</h3><blockquote><p> æ‚²è§‚é”å’Œä¹è§‚é”</p><p> æ‚²è§‚é”ï¼šè®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¼šå‡ºé—®é¢˜ï¼Œæ— è®ºåšä»€ä¹ˆéƒ½ä¼šåŠ é”ï¼Œæ€§èƒ½ä½ã€‚</p><p> ä¹è§‚é”ï¼šè®¤ä¸ºä»€ä¹ˆæ—¶å€™éƒ½ä¸ä¼šå‡ºé—®é¢˜ï¼Œæ— è®ºåšä»€ä¹ˆéƒ½ä¸ä¼šåŠ é”ã€‚</p></blockquote><p><strong><code>ä¸åŒåœºæ™¯å®ç°ä¹è§‚é”çš„æ–¹å¼</code></strong></p><p><span class="github-emoji"><span>ğŸ’œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f49c.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ•°æ®åº“ ï¼šç”¨ version å­—æ®µï¼Œå³ä¸ºæ•°æ®å¢åŠ ä¸€ä¸ªç‰ˆæœ¬æ ‡è¯†ï¼ˆå…ˆè·å– version ï¼Œæ›´æ–°æ—¶å†æ¯”è¾ƒ versionï¼‰</p><p><span class="github-emoji"><span>ğŸ’›</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f49b.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span>  Redis ï¼šç”¨ watch å®ç°</p><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><strong><code>ä¸ä½¿ç”¨ watch æ­£å¸¸æ‰§è¡Œäº‹åŠ¡</code></strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> money <span class="token number">100</span>OK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">out</span> <span class="token number">0</span>OK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> watch money  <span class="token comment"># ç›‘æ§é’±åŒ…</span>OK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> multiOK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> decrby money <span class="token number">2</span>  <span class="token comment"># é’±åŒ…æ‰£é™¤ 2 å—é’±</span>QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> incrby <span class="token keyword">out</span> <span class="token number">2</span>  <span class="token comment"># æ€»è®¡èŠ±å‡ºå» 2 å—é’±</span>QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">exec</span>  <span class="token comment"># äº‹åŠ¡æ‰§è¡ŒæˆåŠŸåï¼Œä¼šè‡ªåŠ¨å–æ¶ˆç›‘æ§ watch </span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">98</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">integer</span><span class="token punctuation">)</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span><strong><code>ä½¿ç”¨ watch å®ç°ä¹è§‚é”</code></strong></p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># å¼€å¯ç¬¬ä¸€ä¸ªè¿æ¥ï¼ˆçº¿ç¨‹ 1ï¼‰</span>$ redis<span class="token operator">-</span>cli <span class="token operator">-</span>p <span class="token number">6379</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> money <span class="token number">100</span>OK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> <span class="token keyword">out</span> <span class="token number">0</span>OK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> watch money  <span class="token comment"># ç›‘æ§é’±åŒ…ã€åŠ ç›‘æ§/åŠ é”ã€‘</span>OK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> multiOK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> decrby money <span class="token number">2</span>  <span class="token comment"># é’±åŒ…æ‰£é™¤ 2 å—é’±</span>QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> incrby <span class="token keyword">out</span> <span class="token number">2</span>  <span class="token comment"># æ€»è®¡èŠ±å‡ºå» 2 å—é’±</span>QUEUED<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">exec</span>  <span class="token comment"># äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼ˆæ‰§è¡Œå‰ï¼Œè¢«çº¿ç¨‹ 2 æ’é˜Ÿä¿®æ”¹äº†å€¼ï¼‰ã€æ¯”å¯¹ç›‘è§†å€¼æ˜¯å¦å˜åŒ–ï¼Œä¸å˜åˆ™æ‰§è¡ŒæˆåŠŸã€‘</span><span class="token punctuation">(</span>nill<span class="token punctuation">)</span><span class="token comment"># è‹¥äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œå…ˆè§£é™¤ç›‘è§†/è§£é”ï¼Œå†é‡æ–°ç›‘è§†/åŠ é”</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> unwatchOK<span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> watchOK<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token comment"># å¼€å¯ç¬¬äºŒä¸ªè¿æ¥ï¼ˆçº¿ç¨‹ 2ï¼‰</span>$ redis<span class="token operator">-</span>cli <span class="token operator">-</span>p <span class="token number">6379</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> get money<span class="token number">98</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>:<span class="token number">6379</span><span class="token operator">&gt;</span> <span class="token keyword">set</span> money <span class="token number">999</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> äº‹åŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring MVC</title>
      <link href="/2020/01/05/spring-mvc/"/>
      <url>/2020/01/05/spring-mvc/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><h3 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h3><p><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¦‚å¿µï¼šæ¨¡å‹ - è§†å›¾ - æ§åˆ¶å™¨ï¼Œæ˜¯ä»¥è®¾è®¡ç•Œé¢åº”ç”¨ç¨‹åºä¸ºåŸºç¡€çš„è®¾è®¡æ€æƒ³ã€‚</p><ul><li>Mï¼šå°è£…æ•°æ®ã€‚</li><li>Vï¼šå±•ç¤ºæ•°æ®ã€‚</li><li>Cï¼šæ¥æ”¶è¯·æ±‚å¹¶è°ƒç”¨ä¸šåŠ¡å±‚æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œä¸šåŠ¡å±‚è¿”å›æ•°æ®ï¼Œæ§åˆ¶å™¨æ¥æ”¶æ•°æ®å’Œå‡†å¤‡æ¨¡å‹åœ¨ V å±‚å±•ç¤ºã€‚</li></ul><h3 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h3><p><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¦‚å¿µï¼šåŸºäº Java çš„å®ç°äº† MVC è®¾è®¡æ€æƒ³çš„è½»é‡çº§Webæ¡†æ¶ã€‚<br><span class="github-emoji"><span>ğŸ‰</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f389.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ€æƒ³ï¼šé€šè¿‡åˆ†ç¦» MVC åœ¨åº”ç”¨ç¨‹åºä¸­çš„è§’è‰²ï¼Œå¯¹ Web å±‚è¿›è¡Œè§£è€¦ï¼Œå°†ä¸šåŠ¡é€»è¾‘ä»ç•Œé¢ä¸­åˆ†ç¦»å‡ºæ¥ã€‚</p><h2 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811222106.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811222004.png"></p><ol><li>ç”¨æˆ·å‘é€è¯·æ±‚,è¯·æ±‚è¢«è°ƒåº¦å™¨ï¼ˆDispatherServletï¼‰æ•è·ï¼›</li><li>è°ƒåº¦å™¨å¯¹è¯·æ±‚URLè§£æè·å–URI,æ ¹æ®URI,è°ƒç”¨å¤„ç†å™¨æ˜ å°„å™¨HandlerMappingï¼›</li><li>è°ƒåº¦å™¨è·å¾—è¿”å›çš„HandlerExecutionChainï¼ˆåŒ…æ‹¬å¤„ç†å™¨å¯¹è±¡Handlerä»¥åŠå¯¹åº”çš„æ‹¦æˆªå™¨ï¼‰ï¼›</li><li>è°ƒåº¦å™¨æ ¹æ®è·å¾—çš„HandlerExecutionChainï¼Œé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„å¤„ç†å™¨é€‚é…å™¨HandlerAdapterã€‚<br> ï¼ˆé™„æ³¨ï¼šå¦‚æœæˆåŠŸè·å¾—HandlerAdapteråï¼Œæ­¤æ—¶å°†å¼€å§‹æ‰§è¡Œæ‹¦æˆªå™¨çš„preHandler(â€¦)æ–¹æ³•ï¼‰</li><li>å¤„ç†å™¨é€‚é…å™¨æ ¹æ®è¯·æ±‚çš„å¤„ç†å™¨é€‚é…å¹¶æ‰§è¡Œå¯¹åº”çš„å¤„ç†å™¨ï¼›<br>HandlerAdapter(æå–Requestä¸­çš„æ¨¡å‹æ•°æ®ï¼Œå¡«å……Handlerå…¥å‚ï¼Œå¼€å§‹æ‰§è¡ŒHandlerï¼ˆController)ã€‚<br>åœ¨å¡«å……Handlerçš„å…¥å‚è¿‡ç¨‹ä¸­ï¼Œæ ¹æ®é…ç½®ï¼ŒSpringå°†åšä¸€äº›é¢å¤–çš„å·¥ä½œï¼šHttpMessageConveterï¼š<br>å°†è¯·æ±‚æ¶ˆæ¯ï¼ˆå¦‚Jsonã€xmlç­‰æ•°æ®ï¼‰è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡ï¼Œå°†å¯¹è±¡è½¬æ¢ä¸ºæŒ‡å®šçš„å“åº”ä¿¡æ¯ã€‚<br>æ•°æ®è½¬æ¢ï¼šå¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œæ•°æ®è½¬æ¢ã€‚å¦‚Stringè½¬æ¢æˆIntegerã€Doubleç­‰æ•°æ®æ ¼å¼åŒ–ï¼š<br>æ•°æ®æ ¼å¼åŒ–ã€‚ å¦‚å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ ¼å¼åŒ–æ•°å­—æˆ–æ ¼å¼åŒ–æ—¥æœŸç­‰<br>æ•°æ®éªŒè¯ï¼š éªŒè¯æ•°æ®çš„æœ‰æ•ˆæ€§ï¼ˆé•¿åº¦ã€æ ¼å¼ç­‰ï¼‰ï¼ŒéªŒè¯ç»“æœå­˜å‚¨åˆ°BindingResultæˆ–Errorä¸­ï¼‰</li><li>å¤„ç†å™¨æ‰§è¡Œå®Œæ¯•ï¼Œè¿”å›ä¸€ä¸ªModelAndViewç»™å¤„ç†å™¨é€‚é…å™¨</li><li>å¤„ç†å™¨é€‚é…å™¨å°†æ‰§è¡Œç»“æœModelAndViewè¿”å›ç»™å‰ç«¯æ§åˆ¶å™¨ã€‚</li><li>è°ƒåº¦å™¨æ¥æ”¶åˆ°ModelAndViewåï¼Œè¯·æ±‚å¯¹åº”çš„è§†å›¾è§£æå™¨ViewResolverã€‚</li><li>è§†å›¾è§£æå™¨è§£æModelAndViewåè¿”å›å¯¹åº”è§†å›¾Viewï¼Œå°†æ•°æ®æ¸²æŸ“åˆ°è§†å›¾ï¼Œå¹¶è¿”å›æ¸²æŸ“åçš„è§†å›¾ç»™è°ƒåº¦å™¨</li><li>æœ€åå°†æ¸²æŸ“åçš„é¡µé¢å“åº”ç»™ç”¨æˆ·æˆ–å®¢æˆ·ç«¯</li></ol><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812114611.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812115400.png"></p><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.3.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.3.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginManagement</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.tomcat.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tomcat7-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- å¯åŠ¨ç«¯å£ é»˜è®¤:8080 --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span>8080<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>port</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- é¡¹ç›®çš„ç«™ç‚¹åï¼Œå³å¯¹å¤–è®¿é—®è·¯å¾„ --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><span class="token punctuation">&gt;</span></span>/test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- å­—ç¬¦é›†ç¼–ç  é»˜è®¤ï¼šISO-8859-1 --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uriEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>uriEncoding</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- æœåŠ¡å™¨åç§° --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span><span class="token punctuation">&gt;</span></span>tomcat7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>server</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginManagement</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h3><p><code>web.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd<span class="token punctuation">"</span></span>         <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- 1. æ³¨å†Œä¸­å¤®è°ƒåº¦å™¨ DispatcherServlet --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>springMvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.servlet.DispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å…³è”springMvcé…ç½®æ–‡ä»¶ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>classpath:spring-mvc.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å¯åŠ¨çº§åˆ«ï¼š1 å¯åŠ¨å®¹å™¨æ—¶åˆå§‹åŒ– å’ŒæœåŠ¡å™¨ä¸€èµ·å¯åŠ¨ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- 2. å¤„ç†å™¨æ˜ å°„å™¨--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>springMvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--            æ˜ å°„ç­–ç•¥ï¼š                /    åŒ¹é…æ‰€æœ‰è¯·æ±‚ ä¸å«.jspé¡µé¢                /*   åŒ¹é…æ‰€æœ‰è¯·æ±‚ å«  .jspé¡µé¢                *.do åŒ¹é…æ‰€æœ‰.doè¯·æ±‚        --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--        &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- ç¼–ç è¿‡æ»¤å™¨ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>encodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.filter.CharacterEncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>encoding<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>encodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>spring-mvc.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans       http://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>       <span class="token comment">&lt;!-- 2. å¤„ç†å™¨æ˜ å°„å™¨ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- 3. å¤„ç†å™¨é€‚é…å™¨ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- 4. Controller --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/hello<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.controller.HelloController<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!--        5. è§†å›¾è§£æå™¨            1. è·å–ModelAndViewçš„æ•°æ®            2. è§£æModelAndViewè§†å›¾å            3. æ‹¼æ¥è§†å›¾åï¼Œæ‰¾åˆ°å¯¹åº”è§†å›¾            4. å°†æ•°æ®æ¸²æŸ“åˆ°è§†å›¾     --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.servlet.view.InternalResourceViewResolver<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>internalResourceViewResolver<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å‰ç¼€ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prefix<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/WEB-INF/jsp/<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token comment">&lt;!-- åç¼€ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>suffix<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.jsp<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>HelloController.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token keyword">implements</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> httpServletRequest<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> httpServletResponse<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è°ƒç”¨ä¸šåŠ¡å±‚</span>        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token string">"hellomvc"</span><span class="token punctuation">;</span>        <span class="token comment">// å°è£…æ•°æ®å¯¹è±¡</span>        modelAndView<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å°è£…è§†å›¾å ä¼šç”±è§†å›¾è§£æå™¨æ‹¼æ¥æˆè¦è·³è½¬çš„è§†å›¾ /WEB-INF/jsp/hello.jsp</span>        modelAndView<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.12.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-databind<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.12.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.fasterxml.jackson.core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jackson-annotations<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.12.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.3.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-webmvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.3.2.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jstl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginManagement</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.tomcat.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>tomcat7-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- å¯åŠ¨ç«¯å£ é»˜è®¤:8080 --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>port</span><span class="token punctuation">&gt;</span></span>8080<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>port</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- é¡¹ç›®çš„ç«™ç‚¹åï¼Œå³å¯¹å¤–è®¿é—®è·¯å¾„ --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>path</span><span class="token punctuation">&gt;</span></span>/test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>path</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- å­—ç¬¦é›†ç¼–ç  é»˜è®¤ï¼šISO-8859-1 --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>uriEncoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>uriEncoding</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- æœåŠ¡å™¨åç§° --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span><span class="token punctuation">&gt;</span></span>tomcat7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>server</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginManagement</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>web.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>web-app</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd<span class="token punctuation">"</span></span>         <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- 1. æ³¨å†Œä¸­å¤®è°ƒåº¦å™¨ DispatcherServlet --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>springMvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.servlet.DispatcherServlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-class</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å…³è”springMvcé…ç½®æ–‡ä»¶ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>contextConfigLocation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>classpath:spring-mvc.xml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å¯åŠ¨çº§åˆ«ï¼š1 å¯åŠ¨å®¹å™¨æ—¶åˆå§‹åŒ– å’ŒæœåŠ¡å™¨ä¸€èµ·å¯åŠ¨ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>load-on-startup</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- 2. å¤„ç†å™¨æ˜ å°„å™¨--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servlet-name</span><span class="token punctuation">&gt;</span></span>springMvc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-name</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--            æ˜ å°„ç­–ç•¥ï¼š                /    åŒ¹é…æ‰€æœ‰è¯·æ±‚ ä¸å«.jspé¡µé¢                /*   åŒ¹é…æ‰€æœ‰è¯·æ±‚ å«  .jspé¡µé¢                *.do åŒ¹é…æ‰€æœ‰.doè¯·æ±‚        --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--        &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;--&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servlet-mapping</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- ç¼–ç è¿‡æ»¤å™¨ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>encodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-class</span><span class="token punctuation">&gt;</span></span>org.springframework.web.filter.CharacterEncodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-class</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init-param</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-name</span><span class="token punctuation">&gt;</span></span>encoding<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-name</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>param-value</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>param-value</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>init-param</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-mapping</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter-name</span><span class="token punctuation">&gt;</span></span>encodingFilter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-name</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url-pattern</span><span class="token punctuation">&gt;</span></span>/*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url-pattern</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter-mapping</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>web-app</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>spring-mvc.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>mvc</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/mvc<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans       http://www.springframework.org/schema/beans/spring-beans.xsd       http://www.springframework.org/schema/context       https://www.springframework.org/schema/context/spring-context.xsd       http://www.springframework.org/schema/mvc       https://www.springframework.org/schema/mvc/spring-mvc.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--        2+3.æ³¨è§£é©±åŠ¨ï¼ˆæ›¿æ¢å¤„ç†å™¨æ˜ å°„å™¨ã€å¤„ç†å™¨é€‚é…å™¨ï¼‰            ä½¿ @RequestMapping æ˜ å°„æ³¨è§£ç”Ÿæ•ˆï¼Œæ³¨å…¥ä»¥ä¸‹ä¸¤ä¸ªå®ä¾‹            DefaultAnnotationHandlerMappingï¼ˆç±»çº§åˆ«ï¼‰ AnnotationMethodHandlerAdapterå®ä¾‹ï¼ˆæ–¹æ³•çº§åˆ«ï¼‰    --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- Jsonä¹±ç  --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>message-converters</span> <span class="token attr-name">register-defaults</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- è¿”å›å­—ç¬¦ä¸²æ—¶ è½¬ä¸ºUTF-8 --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.http.converter.StringHttpMessageConverter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>            <span class="token comment">&lt;!-- å°†å¯¹è±¡è½¬ä¸ºJsonå¯¹è±¡ --&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.http.converter.json.MappingJackson2HttpMessageConverter<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>objectMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.http.converter.json.Jackson2ObjectMapperFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>failOnEmptyBeans<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>message-converters</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>annotation-driven</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--        4. Controller æ‰«æåŒ…è®©æ­¤åŒ…ä¸‹çš„æ‰€æœ‰æ³¨è§£ @Component ç”Ÿæ•ˆï¼Œçœç•¥æ‰‹åŠ¨æ³¨å…¥Beanå¯¹è±¡è‡ªåŠ¨æ³¨å…¥beanï¼ˆæ‰€æœ‰ä¸šåŠ¡ç±»ï¼‰    --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.revelvy.controller<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!--        é™æ€èµ„æºè¿‡æ»¤.css .js .html .mp3 .mp4    --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>default-servlet-handler</span> <span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!--        5. è§†å›¾è§£æå™¨            1. è·å–ModelAndViewçš„æ•°æ®            2. è§£æModelAndViewè§†å›¾å            3. æ‹¼æ¥è§†å›¾åï¼Œæ‰¾åˆ°å¯¹åº”è§†å›¾            4. å°†æ•°æ®æ¸²æŸ“åˆ°è§†å›¾     --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.servlet.view.InternalResourceViewResolver<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>internalResourceViewResolver<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- å‰ç¼€ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prefix<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/WEB-INF/jsp/<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token comment">&lt;!-- åç¼€ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>suffix<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.jsp<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>HelloController.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è°ƒç”¨ä¸šåŠ¡å±‚</span>        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token string">"hello MVC!"</span><span class="token punctuation">;</span>        <span class="token comment">// å°è£…æ•°æ®å¯¹è±¡</span>        modelAndView<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å°è£…è§†å›¾å ä¼šç”±è§†å›¾è§£æå™¨æ‹¼æ¥æˆè¦è·³è½¬çš„è§†å›¾ /WEB-INF/jsp/hello.jsp</span>        modelAndView<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>hello.jsp</code></p><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;%@ page contentType="text/html;charset=UTF-8" language="java" %&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;Title&lt;/title&gt;&lt;/head&gt;&lt;body&gt;    ${msg}&lt;/body&gt;&lt;/html&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="åç«¯è·¯ç”±"><a href="#åç«¯è·¯ç”±" class="headerlink" title="åç«¯è·¯ç”±"></a>åç«¯è·¯ç”±</h2><h3 id="è¯·æ±‚æ˜ å°„"><a href="#è¯·æ±‚æ˜ å°„" class="headerlink" title="è¯·æ±‚æ˜ å°„"></a>è¯·æ±‚æ˜ å°„</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * @RequestMapping() *      ä½œç”¨ï¼šç»‘å®š URI å’Œæ–¹æ³• *      ä½ç½®ï¼š *          1.ç±»ä¸Š              ip:port/ur *          2.æ–¹æ³•ä¸Š            ip:port/hello *          3.ç±» + æ–¹æ³•ä¸Š       ip:port/ur/hello *      å‚æ•°ï¼š *          value  URIè¯·æ±‚è·¯å¾„ *          method è¯·æ±‚ç±»å‹ *          params è¯·æ±‚è·¯å¾„å‚æ•°  ip:port/ur?params */</span><span class="token annotation punctuation">@Controller</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/ur"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>    <span class="token comment">// ur/hello?hh</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/hello"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">}</span><span class="token punctuation">,</span> params <span class="token operator">=</span> <span class="token string">"hh"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"Hello SpringMVC ç»‘å®šå•ä¸ªURI"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mv<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// ur/a1?hh æˆ– ur/a2?hh</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"/a1"</span><span class="token punctuation">,</span> <span class="token string">"/a2"</span><span class="token punctuation">}</span><span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">RequestMethod</span><span class="token punctuation">.</span>GET<span class="token punctuation">}</span><span class="token punctuation">,</span> params <span class="token operator">=</span> <span class="token string">"hh"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">helloArrayTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"Hello SpringMVC ç»‘å®šå¤šä¸ªURI"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mv<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¼ å‚"><a href="#ä¼ å‚" class="headerlink" title="ä¼ å‚"></a>ä¼ å‚</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ä¼ å‚ *      åŸºæœ¬ *          ç”¨åŒ…è£…ç±»ï¼ˆé¿å…500æŠ¥é”™ï¼‰ *      å¼•ç”¨ *          String | Date | æ•°ç»„ | JavaBean | é›†åˆï¼šList Set Map */</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ParamsController</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * åŸºæœ¬     *      ç”¨åŒ…è£…ç±»ï¼ˆé¿å…500æŠ¥é”™ï¼‰     *      é»˜è®¤å€¼null     *      å‰ç«¯ä¼ å‚åä¸æœ¬æ–¹æ³•å‚æ•°åä¸ä¸€è‡´æ—¶ ä½¿ç”¨ @RequestParam()     *          å‚æ•°     *               nameï¼šåˆ«å     *               defaultValueï¼šé»˜è®¤å€¼      */</span>    <span class="token comment">// p2?a=19&amp;height=170.5</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/p2"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"a"</span><span class="token punctuation">,</span> defaultValue <span class="token operator">=</span> <span class="token string">"18"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> age<span class="token punctuation">,</span> <span class="token class-name">Double</span> height<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"age:"</span> <span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">":height:"</span> <span class="token operator">+</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token comment">/**    * å¼•ç”¨ï¼šæ•°ç»„    */</span>    <span class="token comment">// p3?ids=1&amp;ids=2&amp;ids=3</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/p3"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt3</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span> id <span class="token operator">:</span> ids<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å¼•ç”¨ï¼šString     *      é»˜è®¤å€¼ä¸ºnull     */</span>    <span class="token comment">// p4?userName="zs"&amp;userPwd="ss"</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/p4"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt4</span><span class="token punctuation">(</span><span class="token class-name">String</span> userName<span class="token punctuation">,</span> <span class="token class-name">String</span> userPwd<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"userName:"</span> <span class="token operator">+</span> userName <span class="token operator">+</span> <span class="token string">":userPwd:"</span> <span class="token operator">+</span> userPwd<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * JavaBean     */</span>    <span class="token comment">// p5?id=1&amp;userName="zs"&amp;userPwd="ss"</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/p5"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt5</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å¼•ç”¨ï¼šé›†åˆ Listï¼ˆç”¨JavaBeanè¿›è¡ŒåŒ…è£…ï¼‰     */</span>    <span class="token comment">// p6?userName=df&amp;userPwd=lo&amp;id=6&amp;ids=1,2</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/p6"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt6</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>        user<span class="token punctuation">.</span><span class="token function">getIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å¼•ç”¨ï¼šé›†åˆ Mapï¼ˆç”¨JavaBeanè¿›è¡ŒåŒ…è£…ï¼‰     */</span>    <span class="token comment">// p7?map['sh']=dfmz</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/p7"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pt7</span><span class="token punctuation">(</span><span class="token class-name">User</span> user<span class="token punctuation">)</span><span class="token punctuation">{</span>        user<span class="token punctuation">.</span><span class="token function">getMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span><span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"k:"</span><span class="token operator">+</span>k<span class="token operator">+</span><span class="token string">":v:"</span><span class="token operator">+</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="è¯·æ±‚åŸŸå¯¹è±¡"><a href="#è¯·æ±‚åŸŸå¯¹è±¡" class="headerlink" title="è¯·æ±‚åŸŸå¯¹è±¡"></a>è¯·æ±‚åŸŸå¯¹è±¡</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è¯·æ±‚åŸŸå¯¹è±¡ *      ModelAndView | request | response |  Model | ModelMap | Map */</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ModelController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"m01"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">m01</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"hello SpringMvc"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mv<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"m02"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">m02</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{</span>        request<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"hello m02"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// ModelMapï¼ˆç»§æ‰¿LinkedMapï¼‰</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"m03"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">m03</span><span class="token punctuation">(</span><span class="token class-name">ModelMap</span> modelMap<span class="token punctuation">)</span> <span class="token punctuation">{</span>        modelMap<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"hello m03"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token comment">// Model  ï¼ˆModelMapç²¾ç®€ç‰ˆï¼‰</span><span class="token comment">// è‹¥è¿”å›å€¼æ˜¯String ä¸”æœ‰å¯¹åº”è§†å›¾ åˆ™ç›´æ¥ä¼ ç»™è§†å›¾è§£æå™¨</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"m04"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">m04</span><span class="token punctuation">(</span><span class="token class-name">Model</span> model<span class="token punctuation">)</span> <span class="token punctuation">{</span>        model<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"hello m04"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è¿”å›è§†å›¾å åŒä¸€ä¸ªè§†å›¾å¯å¤ç”¨ï¼ˆåªå†™ä¸€ä¸ªé¡µé¢ ä¼ é€’ä¸åŒçš„æ•°æ®ï¼‰</span>        <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"m05"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">m05</span><span class="token punctuation">(</span><span class="token class-name">Map</span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"hello m05"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="é‡å®šå‘-amp-è½¬å‘"><a href="#é‡å®šå‘-amp-è½¬å‘" class="headerlink" title="é‡å®šå‘ &amp; è½¬å‘"></a>é‡å®šå‘ &amp; è½¬å‘</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * é‡å®šå‘ è½¬å‘ * redirect: *forward: */</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ViewController</span> <span class="token punctuation">{</span>    <span class="token comment">// é‡å®šå‘ï¼ˆä¸é…ç½®è§†å›¾è§£æå™¨ï¼‰</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/cdx"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">cdx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">"redirect:/index.jsp"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token comment">// é‡å®šå‘ï¼ˆè§†å›¾è§£æå™¨ï¼‰</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/cdx"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">cdx</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">"redirect:/index.jsp"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token comment">// é‡å®šå‘ è¿”å›è§†å›¾ å¸¦å‚</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/r1"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">rt1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"redirect:/redirect?a=admin"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// é‡å®šå‘ è¿”å›è§†å›¾ ä¸­æ–‡</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/r2"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">rt2</span><span class="token punctuation">(</span><span class="token class-name">RedirectAttributes</span> redirectAttributes<span class="token punctuation">)</span><span class="token punctuation">{</span>        redirectAttributes<span class="token punctuation">.</span><span class="token function">addAttribute</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"å¥¥åˆ©ç»™"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"redirect:/redirect"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// é‡å®šå‘ è¿”å›æ¨¡å‹å’Œè§†å›¾ ä¸­æ–‡</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/r3"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">rt3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> mv<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"å¥¥åˆ©ç»™"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"redirect:/redirect"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mv<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// è½¬å‘ï¼ˆä¸é…ç½®è§†å›¾è§£æå™¨ï¼‰</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/zf"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">zf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">"forward:/index.jsp"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token comment">// è½¬å‘ï¼ˆè§†å›¾è§£æå™¨ï¼‰</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/zf"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">zf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token string">"index"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>        <span class="token comment">// è½¬å‘ åˆ°æ–¹æ³• è¿”å›æ¨¡å‹å’Œè§†å›¾ å¸¦å‚</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/z1"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">zt1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> mv<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"forward:test?a=admin&amp;b=1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mv<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// è½¬å‘ åˆ°æ–¹æ³• è¿”å›æ¨¡å‹å’Œè§†å›¾ å¸¦å‚ ä¸­æ–‡</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/z2"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">zt2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> mv<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"å¥¥åˆ©ç»™"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"forward:test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mv<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="RestFul-é£æ ¼"><a href="#RestFul-é£æ ¼" class="headerlink" title="RestFul é£æ ¼"></a>RestFul é£æ ¼</h3><p><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¦‚å¿µï¼šé€šè¿‡ä¸åŒè¯·æ±‚æ–¹å¼å®ç°ä¸åŒæ•ˆæœï¼Œå®ç°URLçš„å¤ç”¨ã€è®¿é—®å®‰å…¨ã€‚</p><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç†è§£ï¼šè¯·æ±‚åœ°å€ä¸€æ ·ï¼Œä½†åŠŸèƒ½ä¸åŒã€‚</p><table><thead><tr><th>æ•ˆæœ</th><th>URL</th></tr></thead><tbody><tr><td>å¢ POST</td><td><a href="http://127.0.0.1/item/">http://127.0.0.1/item/</a></td></tr><tr><td>åˆ  DELETE</td><td><a href="http://127.0.0.1/item/1">http://127.0.0.1/item/1</a></td></tr><tr><td>æ”¹ PUT</td><td><a href="http://127.0.0.1/item/">http://127.0.0.1/item/</a></td></tr><tr><td>æŸ¥ GET</td><td><a href="http://127.0.0.1/item/1">http://127.0.0.1/item/1</a></td></tr></tbody></table><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloController</span> <span class="token punctuation">{</span>    <span class="token comment">// éRestFulé£æ ¼ï¼šhttp://localhost:8080/hello?a=1&amp;b=haha</span>    <span class="token comment">// RestFulé£æ ¼ï¼ˆçº¦æŸè¯·æ±‚ç±»å‹ä¸ºGETï¼‰ï¼šhttp://localhost:8080/hello/1/haha</span>    <span class="token comment">// æ–¹æ³•çº§åˆ«çš„æ³¨è§£å˜ä½“ï¼š@PostMapping @DeleteMapping @PutMapping @GetMapping @PatchMapping</span><span class="token comment">//    @RequestMapping(value = "/hello/{a}/{b}", method = RequestMethod.GET)</span>    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/hello/{a}/{b}"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"b"</span><span class="token punctuation">)</span> <span class="token class-name">String</span> bb<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> modelAndView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è°ƒç”¨ä¸šåŠ¡å±‚</span>        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token string">"hello MVC!"</span> <span class="token operator">+</span> a <span class="token operator">+</span> bb<span class="token punctuation">;</span>        <span class="token comment">// å°è£…æ•°æ®å¯¹è±¡</span>        modelAndView<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å°è£…è§†å›¾å ä¼šç”±è§†å›¾è§£æå™¨æ‹¼æ¥æˆè¦è·³è½¬çš„è§†å›¾ /WEB-INF/jsp/hello.jsp</span>        modelAndView<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> modelAndView<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h2><p><span class="github-emoji"><span>ğŸŒ </span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f320.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ¦‚å¿µï¼šInterceptorï¼Œç±»ä¼¼äº Servlet çš„è¿‡æ»¤å™¨ Filter ã€‚<br><span class="github-emoji"><span>ğŸ…</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f385.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç‰¹ç‚¹ï¼š<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1. AOP æ€æƒ³çš„å…·ä½“åº”ç”¨ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2. åªæ‹¦æˆªè®¿é—®çš„æ§åˆ¶å™¨æ–¹æ³•ï¼Œè‡ªå¸¦é™æ€èµ„æºè¿‡æ»¤ï¼ˆä¸ä¼šæ‹¦æˆª .jsp .html .css .js image ç­‰ï¼‰ã€‚<br><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½œç”¨ï¼šæ‹¦æˆªç”¨æˆ·è¯·æ±‚å¹¶è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œå¦‚æƒé™éªŒè¯ã€åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»é™†ç­‰ã€‚</p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><blockquote><p>å®ç°å¤„ç†å™¨æ‹¦æˆªå™¨çš„æ¥å£ï¼šorg.springframework.web.servlet.HandlerInterceptor<br>ç»§æ‰¿å¤„ç†å™¨æ‹¦æˆªå™¨çš„é€‚é…å™¨ï¼šorg.springframework.web.servlet.handler.HandlerInterceptorAdapter</p></blockquote><h4 id="ç¯å¢ƒ-1"><a href="#ç¯å¢ƒ-1" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h4><h5 id="æ‹¦æˆªå™¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰"><a href="#æ‹¦æˆªå™¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰" class="headerlink" title="æ‹¦æˆªå™¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰"></a>æ‹¦æˆªå™¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰</h5><p><code>spring-mvc.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">    <span class="token comment">&lt;!-- æ‹¦æˆªå™¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰            æ‹¦æˆªè§„åˆ™ï¼ˆå‚æ•°ï¼š/**  æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ä¸‹çš„è¯·æ±‚ /admin/ad/addï¼‰                mvc:mapping         æ‹¦æˆªHandler æ”¯æŒé€šé…ç¬¦ å¯å¤šä¸ª                mvc:exclude-mapping æ”¾è¡ŒHandler å¯å¤šä¸ª            æ‹¦æˆªå™¨é“¾                å…ˆé…ç½®çš„æ‹¦æˆªå™¨ preHandler æ–¹æ³•å…ˆæ‰§è¡Œ                å…ˆé…ç½®çš„æ‹¦æˆªå™¨ postHandle ã€afterCompletion æ–¹æ³•åæ‰§è¡Œ(æ ˆå…ƒç´ å‡ºæ ˆæ•ˆæœ) --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>interceptors</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>interceptor</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>mapping</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/**<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--            &lt;mvc:exclude-mapping path="/user1.do"/&gt;--&gt;</span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.springmvc.interceptors.MyInterceptor1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>interceptor</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>interceptor</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>mapping</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/**<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.springmvc.interceptors.MyIntercetpor2<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>interceptor</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>interceptors</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="æ‹¦æˆªå™¨ï¼ˆä¸å¯è‡ªå®šä¹‰ï¼‰"><a href="#æ‹¦æˆªå™¨ï¼ˆä¸å¯è‡ªå®šä¹‰ï¼‰" class="headerlink" title="æ‹¦æˆªå™¨ï¼ˆä¸å¯è‡ªå®šä¹‰ï¼‰"></a>æ‹¦æˆªå™¨ï¼ˆä¸å¯è‡ªå®šä¹‰ï¼‰</h5><p><code>spring-mvc.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">   <span class="token comment">&lt;!-- æ‹¦æˆªå™¨ï¼ˆä¸å¯è‡ªå®šä¹‰ï¼‰æ‹¦æˆªæ‰€æœ‰Handler--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>interceptors</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.springmvc.interceptors.MyInterceptor1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>interceptors</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å®ç°æ¥å£"><a href="#å®ç°æ¥å£" class="headerlink" title="å®ç°æ¥å£"></a>å®ç°æ¥å£</h4><p><code>MyInterceptor1.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInterceptor1</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{</span>        <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç›®æ ‡Handleræ‰§è¡Œå‰ æ‰§è¡ŒMyInterceptor1--&gt;preHandle æ–¹æ³•..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å…è®¸æ‰§è¡Œç›®æ ‡æ–¹æ³•  trueï¼šæ”¾è¡Œ false: æ‹¦æˆª</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">// å¯ä»¥å†™æ‹¦æˆªæ—¥å¿—</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç›®æ ‡Handleræ‰§è¡Œå è§†å›¾ç”Ÿæˆå‰ æ‰§è¡ŒMyInterceptor1--&gt;postHandle æ–¹æ³•..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">// å¯ä»¥å†™æ‹¦æˆªæ—¥å¿—</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç›®æ ‡Handleræ‰§è¡Œå è§†å›¾ç”Ÿæˆå æ‰§è¡ŒMyInterceptor1--&gt;afterCompletion æ–¹æ³•..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="ç»§æ‰¿é€‚é…å™¨"><a href="#ç»§æ‰¿é€‚é…å™¨" class="headerlink" title="ç»§æ‰¿é€‚é…å™¨"></a>ç»§æ‰¿é€‚é…å™¨</h4><p><code>MyIntercetpor2.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyIntercetpor2</span> <span class="token keyword">extends</span> <span class="token class-name">HandlerInterceptorAdapter</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç›®æ ‡Handleræ‰§è¡Œå‰ æ‰§è¡ŒMyIntercetpor2--&gt;preHandle æ–¹æ³•..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">// å¯ä»¥å†™æ‹¦æˆªæ—¥å¿—</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">ModelAndView</span> modelAndView<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç›®æ ‡Handleræ‰§è¡Œå è§†å›¾ç”Ÿæˆå‰ æ‰§è¡ŒMyInterceptor2--&gt;postHandle æ–¹æ³•..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token comment">// å¯ä»¥å†™æ‹¦æˆªæ—¥å¿—</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterCompletion</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">,</span> <span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç›®æ ‡Handleræ‰§è¡Œå è§†å›¾ç”Ÿæˆå æ‰§è¡ŒMyInterceptor2--&gt;afterCompletion æ–¹æ³•..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210812121750.png"></p><h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><h4 id="ç”¨æˆ·ç™»å½•"><a href="#ç”¨æˆ·ç™»å½•" class="headerlink" title="ç”¨æˆ·ç™»å½•"></a>ç”¨æˆ·ç™»å½•</h4><p><code>spring-mvc.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">  <span class="token comment">&lt;!-- æ‹¦æˆªå™¨ï¼ˆå¯è‡ªå®šä¹‰ï¼‰ --&gt;</span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>interceptors</span><span class="token punctuation">&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>interceptor</span><span class="token punctuation">&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>mapping</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/**<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mvc:</span>exclude-mapping</span> <span class="token attr-name">path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/user/login.do<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.springmvc.interceptors.LoginInterceptor<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>interceptor</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mvc:</span>interceptors</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>UserLoginController.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserLoginController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"user/login"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> mv<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> user<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"10"</span><span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"userInfo"</span><span class="token punctuation">,</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mv<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserLoginController</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"user/login"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token class-name">HttpSession</span> session<span class="token punctuation">,</span> <span class="token class-name">String</span> uname<span class="token punctuation">,</span> <span class="token class-name">String</span> pwd<span class="token punctuation">)</span><span class="token punctuation">{</span>        session<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"userInfo"</span><span class="token punctuation">,</span>uname<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"main"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>LoginInterceptor.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginInterceptor</span> <span class="token keyword">extends</span> <span class="token class-name">HandlerInterceptorAdapter</span> <span class="token punctuation">{</span>    <span class="token comment">/**     *     * è·å–ç”¨æˆ·session ä¿¡æ¯     *      è‹¥ç”¨æˆ·session ä¿¡æ¯å­˜åœ¨  è¯·æ±‚åˆæ³• æ”¾è¡Œ     *      è‹¥ç”¨æˆ·session ä¿¡æ¯ä¸å­˜åœ¨ è¯·æ±‚éæ³• é˜»æ­¢     *     * @param request     * @param response     * @param handler     * @return     * @throws Exception     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç”¨æˆ·æœªç™»å½• æˆ– sessionå¤±æ•ˆ</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"userInfo"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getContextPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/login.jsp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="æ–‡ä»¶ä¸Šä¼ -ä¸‹è½½"><a href="#æ–‡ä»¶ä¸Šä¼ -ä¸‹è½½" class="headerlink" title="æ–‡ä»¶ä¸Šä¼  + ä¸‹è½½"></a>æ–‡ä»¶ä¸Šä¼  + ä¸‹è½½</h2><h3 id="ç¯å¢ƒ-2"><a href="#ç¯å¢ƒ-2" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-fileupload<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.servlet<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.servlet-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>spring-mvc.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- æ–‡ä»¶ä¸Šä¼  --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipartResolver<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.springframework.web.multipart.commons.CommonsMultipartResolver<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- è¯·æ±‚ç¼–ç æ ¼å¼ é¡»å’Œjspçš„pageEncodingå±æ€§ä¸€è‡´ ä¾¿äºæ­£ç¡®è¯»å–è¡¨å•å†…å®¹ é»˜è®¤ISO-8859-1 --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>defaultEncoding<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- ä¸Šä¼ æ–‡ä»¶å¤§å° 10485760 Byte = 10 M --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>maxUploadSize<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>104857600<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>maxInMemorySize<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>4096<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ä¸Šä¼ "><a href="#ä¸Šä¼ " class="headerlink" title="ä¸Šä¼ "></a>ä¸Šä¼ </h3><h4 id="å‰ç«¯è¡¨å•"><a href="#å‰ç«¯è¡¨å•" class="headerlink" title="å‰ç«¯è¡¨å•"></a>å‰ç«¯è¡¨å•</h4><blockquote><p>enctype<br>&nbsp;&nbsp;&nbsp;&nbsp;application/x-www=form-urlencodedï¼šå°†è¡¨å•åŸŸä¸­çš„valueå±æ€§å€¼å¤„ç†æˆurlç¼–ç ï¼ˆé»˜è®¤ï¼‰ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;multipart/form-dataï¼šä»¥äºŒè¿›åˆ¶æµå¤„ç†è¡¨å•æ•°æ®ï¼ŒæŠŠæ–‡ä»¶åŸŸæŒ‡å®šæ–‡ä»¶çš„å†…å®¹å°è£…åˆ°è¯·æ±‚å‚æ•°é‡Œï¼Œä¸ä¼šå¯¹å­—ç¬¦ç¼–ç ã€‚<br>&nbsp;&nbsp;&nbsp;&nbsp;text/plainï¼šé™¤äº†æŠŠç©ºæ ¼è½¬æ¢ä¸º+å·å¤–ï¼Œå…¶ä»–å­—ç¬¦ä¸åšå¤„ç†ï¼ˆé€‚åˆå‘é€é‚®ä»¶ï¼‰ã€‚</p></blockquote><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uploadFile<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> å•æ–‡ä»¶æäº¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>uploadFiles<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">multiple</span><span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> å¤šæ–‡ä»¶æäº¤<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å•æ–‡ä»¶-amp-amp-å¤šæ–‡ä»¶"><a href="#å•æ–‡ä»¶-amp-amp-å¤šæ–‡ä»¶" class="headerlink" title="å•æ–‡ä»¶ &amp;&amp; å¤šæ–‡ä»¶"></a>å•æ–‡ä»¶ &amp;&amp; å¤šæ–‡ä»¶</h4><p><code>FileController.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileController</span> <span class="token punctuation">{</span>    <span class="token comment">// å•æ–‡ä»¶</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"uploadFile"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">uploadFile</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MultipartHttpServletRequest</span> multipartHttpServletRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MultipartHttpServletRequest</span><span class="token punctuation">)</span> request<span class="token punctuation">;</span>        <span class="token comment">// MultipartFile ç±»ç”¨æ¥æ¥æ”¶å‰å°ä¼ æ¥çš„æ–‡ä»¶</span>        <span class="token class-name">MultipartFile</span> multipartFile <span class="token operator">=</span> multipartHttpServletRequest<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// åˆ¤æ–­ä¸Šä¼ çš„æ–‡ä»¶ã€æ–‡ä»¶å†…å®¹æ˜¯å¦å­˜åœ¨</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> multipartFile <span class="token operator">&amp;&amp;</span> multipartFile<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// è·å–é¡¹ç›®ç»å¯¹è·¯å¾„  D:\Java\JavaProject\SpringWebTest\src\main\webapp\</span><span class="token comment">//                String basePath1 = request.getSession().getServletContext().getRealPath("/");</span>                <span class="token class-name">String</span> basePath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// è·å–æ–‡ä»¶å¤¹å¯¹è±¡</span>                <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>basePath <span class="token operator">+</span> <span class="token string">"/upload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token comment">// æ–‡ä»¶å¤¹ä¸å­˜åœ¨ åˆ›å»ºæ–‡ä»¶å¤¹</span>                    <span class="token keyword">boolean</span> mkdirResult <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mkdirResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>                        mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"æ–‡ä»¶å¤¹åˆ›å»ºå¤±è´¥ï¼Œæ–‡ä»¶ä¸Šä¼ å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token comment">// è®¾ç½®æ–‡ä»¶å  ç³»ç»Ÿå½“å‰æ—¶é—´æ¯«ç§’æ•°+å‘½åä¸Šä¼ æ–‡ä»¶  getOriginalFilename() åŸå§‹æ–‡ä»¶å</span>                <span class="token class-name">String</span> fileName <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> multipartFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>multipartFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">// ä¿å­˜æ–‡ä»¶ æ–‡ä»¶copy</span>                multipartFile<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"æ–‡ä»¶ä¸Šä¼ æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"æ–‡ä»¶ä¸Šä¼ å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> mv<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// å¤šæ–‡ä»¶</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"uploadFiles"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">ModelAndView</span> <span class="token function">uploadFiles</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">ModelAndView</span> mv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ModelAndView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        mv<span class="token punctuation">.</span><span class="token function">setViewName</span><span class="token punctuation">(</span><span class="token string">"result"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MultipartHttpServletRequest</span> multipartHttpServletRequest <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MultipartHttpServletRequest</span><span class="token punctuation">)</span> request<span class="token punctuation">;</span>        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">MultipartFile</span><span class="token punctuation">&gt;</span></span> multipartFiles <span class="token operator">=</span> multipartHttpServletRequest<span class="token punctuation">.</span><span class="token function">getFiles</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">StringBuilder</span> stringBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MultipartFile</span> multipartFile <span class="token operator">:</span> multipartFiles<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">try</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>multipartFile<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token class-name">String</span> basePath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>basePath <span class="token operator">+</span> <span class="token string">"/upload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼šæ–‡ä»¶å¤¹åˆ›å»ºå¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span>                    <span class="token punctuation">}</span>                    <span class="token class-name">String</span> originalFileName <span class="token operator">=</span> <span class="token string">"æ–‡ä»¶ï¼š"</span> <span class="token operator">+</span> multipartFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"&amp;nbsp;&amp;nbsp;ä¸Šä¼ æˆåŠŸ&lt;br/&gt;"</span><span class="token punctuation">;</span>                    stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>originalFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token class-name">String</span> fileName <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> multipartFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>multipartFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    multipartFile<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                    <span class="token class-name">String</span> originalFileName <span class="token operator">=</span> <span class="token string">"æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼šè¯·é€‰æ‹©è‡³å°‘ä¸€ä¸ªæ–‡ä»¶&lt;br/&gt;"</span><span class="token punctuation">;</span>                    stringBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>originalFileName<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼šå¼‚å¸¸"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>        mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> stringBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> mv<span class="token punctuation">;</span>    <span class="token punctuation">}</span>            <span class="token comment">// å•æ–‡ä»¶2</span>    <span class="token comment">// @RequestParam("file") å°†name=fileæ§ä»¶å¾—åˆ°çš„æ–‡ä»¶å°è£…ä¸ºcommonsMultipartFileå¯¹è±¡</span>    <span class="token comment">// æ‰¹é‡ä¸Šä¼ commonsMultipartFileåˆ™ä¸ºæ•°ç»„å³å¯</span>    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/uploadFile2"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">uploadFile2</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestParam</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span> <span class="token class-name">CommonsMultipartFile</span> commonsMultipartFile<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{</span>        <span class="token comment">// ä¸Šä¼ è·¯å¾„</span>        <span class="token class-name">String</span> basePath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>basePath <span class="token operator">+</span> <span class="token string">"/upload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// æ–‡ä»¶å¤¹ä¸å­˜åœ¨ åˆ›å»ºæ–‡ä»¶å¤¹</span>            <span class="token keyword">boolean</span> mkdirResult <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mkdirResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>                mv<span class="token punctuation">.</span><span class="token function">addObject</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">"æ–‡ä»¶å¤¹åˆ›å»ºå¤±è´¥ï¼Œæ–‡ä»¶ä¸Šä¼ å¤±è´¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        commonsMultipartFile<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>file <span class="token operator">+</span> <span class="token string">"/"</span> <span class="token operator">+</span> commonsMultipartFile<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token string">"redirect:/index.jsp"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>result.jsp</code></p><pre class="line-numbers language-jsp" data-language="jsp"><code class="language-jsp">&lt;body&gt;  ${msg}&lt;/body&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h3><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--    1. è¶…é“¾æ¥ä¸‹è½½        å½“ä½¿ç”¨è¶…é“¾æ¥ï¼ˆaæ ‡ç­¾ï¼‰æ—¶ï¼Œè‹¥é‡åˆ°æµè§ˆå™¨ä¸èƒ½è¯†åˆ«çš„èµ„æºï¼Œåˆ™ä¼šè¿›è¡Œä¸‹è½½ã€‚        é€šè¿‡download å±æ€§å¼ºåˆ¶è§„å®šæµè§ˆå™¨è¿›è¡Œä¸‹è½½ã€‚            download å±æ€§å¯ä»¥ä¸å†™ä»»ä½•ä¿¡æ¯ï¼Œè‡ªåŠ¨ä½¿ç”¨é»˜è®¤æ–‡ä»¶åã€‚           è‹¥è®¾ç½®äº†downloadå±æ€§çš„å€¼ï¼Œåˆ™ä½¿ç”¨è®¾ç½®çš„å€¼ä½œä¸ºæ–‡ä»¶åã€‚    2. åå°Javaä»£ç ä¸‹è½½--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download/test.txt<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token punctuation">&gt;</span></span>æ–‡æœ¬æ–‡ä»¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download/bd_logo1.png<span class="token punctuation">"</span></span> <span class="token attr-name">download</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç™¾åº¦.png<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>å›¾ç‰‡æ–‡ä»¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>download/test.rar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>å‹ç¼©æ–‡ä»¶<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>${pageContext.request.contextPath}/downloadFile<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span><span class="token punctuation">&gt;</span></span>        æ–‡ä»¶åï¼š        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>fileName<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>è¯·è¾“å…¥è¦ä¸‹è½½çš„æ–‡ä»¶å<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span><span class="token punctuation">&gt;</span></span>ä¸‹è½½<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * æ–‡ä»¶ä¸‹è½½ * *  1.è®¾ç½®å“åº”ç±»å‹ ï¼ˆæµè§ˆå™¨æ— æ³•ä½¿ç”¨æŸç§æ–¹å¼æˆ–æ¿€æ´»æŸä¸ªç¨‹åºæ¥å¤„ç†çš„ MIME ç±»å‹ï¼‰ *       response.setContentType("application/x-msdownload"); *    æˆ– response.setContentType("application/octet-stream"); *    è®¾ç½®å“åº”å¤´ *    response.setHeader("Content-Disposition", "attachment;filename=" + fileName); *  2.è¯»å–æ‰€éœ€æ–‡ä»¶ï¼ˆæ–‡ä»¶è¾“å…¥æµ new FileInputStream(file)ï¼‰ *  3.å“åº”ï¼ˆå­—èŠ‚è¾“å‡ºæµ response.getOutputStream().write() ï¼‰ *  4.å…³é—­ æ–‡ä»¶è¾“å…¥æµã€å­—èŠ‚è¾“å‡ºæµ */</span><span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/downloadFile"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token class-name">String</span> downloadFile <span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>        <span class="token comment">// è·å–å‚æ•° ï¼ˆè·å–è¦ä¸‹è½½çš„æ–‡ä»¶åï¼‰</span>        <span class="token class-name">String</span> fileName <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"fileName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// éç©ºåˆ¤æ–­</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"è¯·è¾“å…¥è¦ä¸‹è½½çš„æ–‡ä»¶åï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment">// å¾—åˆ°èµ„æºçš„ç»å¯¹è·¯å¾„</span>        <span class="token class-name">String</span> basePath <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">"/download/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è·å–èµ„æºfileå¯¹è±¡</span>        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>basePath <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// åˆ¤æ–­æ–‡ä»¶å¯¹è±¡æ˜¯å¦å­˜åœ¨å¹¶ä¸”æ˜¯ä¸€ä¸ªæ ‡å‡†æ–‡ä»¶</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> file<span class="token punctuation">.</span><span class="token function">isFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment">// å“åº”ç±»å‹</span>            response<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// é¡µé¢ä¸ç¼“å­˜ æ¸…ç©ºbuffer</span>            response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// å­—ç¬¦ç¼–ç </span>            response<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"multipart/form-data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// äºŒè¿›åˆ¶ä¼ è¾“æ•°æ®</span>            <span class="token comment">//response.setContentType("application/x-msdownload");</span>            <span class="token comment">//response.setContentType("application/octet-stream");</span>            <span class="token comment">// å“åº”å¤´</span>            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment;filename="</span> <span class="token operator">+</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å–æ–‡ä»¶è¾“å…¥æµ</span>            <span class="token class-name">InputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è·å–å­—èŠ‚è¾“å‡ºæµ</span>            <span class="token class-name">ServletOutputStream</span> out <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> len<span class="token punctuation">;</span>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token comment">// å¾ªç¯è¾“å‡º</span>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>len <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>                out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// æ–°å¢</span>            <span class="token punctuation">}</span>            <span class="token comment">// å…³é—­è¾“å…¥è¾“å‡ºæµ</span>            out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">"æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·é‡è¯•ï¼"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            response<span class="token punctuation">.</span><span class="token function">getWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> Spring MVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring IOC</title>
      <link href="/2020/01/03/spring-ioc/"/>
      <url>/2020/01/03/spring-ioc/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Inversion of Controlï¼Œæ§åˆ¶åè½¬ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ã€‚</p><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç†è§£<br>æ§åˆ¶åè½¬ï¼šå°† JavaBean å¯¹è±¡å®ä¾‹åŒ–çš„è¿‡ç¨‹äº¤ç»™IOCå®¹å™¨ï¼ˆå·¥å‚ï¼‰å»è´Ÿè´£ï¼Œå³å°† JavaBean å¯¹è±¡çš„åˆ›å»ºäº¤ç»™ç¬¬ä¸‰æ–¹ã€‚<br>åè½¬ï¼šç¨‹åºè‡ªèº«ä¸åˆ›å»ºå¯¹è±¡ï¼Œå˜ä¸ºè¢«åŠ¨æ¥æ”¶å¯¹è±¡ã€‚<br>æ§åˆ¶åè½¬çš„å®ç°æ–¹æ³•ï¼šä¾èµ–æ³¨å…¥ï¼Œå³ä¸º JavaBean å¯¹è±¡çš„å±æ€§èµ‹å€¼ï¼Œå°† JavaBean å¯¹è±¡çš„å±æ€§æ³¨å…¥åˆ° IOC å®¹å™¨ï¼Œç”± Spring é€šè¿‡ XML æˆ–æ³¨è§£çš„æ–¹å¼æ¥åˆ›å»ºã€ç®¡ç†ã€è£…é…å¯¹è±¡ã€‚</p><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½œç”¨</p><pre><code>  1. **è§£è€¦**ï¼šæé«˜ä¸šåŠ¡ä»£ç çš„èšåˆåº¦ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå³é«˜å†…èšä½è€¦åˆã€‚  2. **å®ä¾‹åŒ– JavaBean å¯¹è±¡**ã€‚</code></pre><pre class="line-numbers language-none"><code class="language-none">æ ¸å¿ƒ    å·¥å‚è®¾è®¡æ¨¡å¼ ï¼ˆç®€å•å·¥å‚ å·¥å‚æ–¹æ³• æŠ½è±¡å·¥å‚ï¼‰    XMLè§£æ ï¼ˆDom4jï¼‰    åå°„æŠ€æœ¯ ï¼ˆå®ä¾‹åŒ–å¯¹è±¡ åå°„è·å–æ–¹æ³• åå°„è·å–å±æ€§ åå°„è·å–æ„é€ å™¨ åå°„è°ƒç”¨æ–¹æ³•ï¼‰    ç­–ç•¥æ¨¡å¼ ï¼ˆåŠ è½½èµ„æºï¼‰    å•ä¾‹ï¼ˆIOCåˆ›å»ºå®ä¾‹åŒ–å¯¹è±¡å¯¹è±¡ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817144534.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817144540.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817144543.png"></p><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å¯¼å…¥ä¾èµ–</p><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.2.4.RELEASE<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> é…ç½®æ–‡ä»¶</p><p><code>applicationContext.xml</code></p><ul><li>xmlns ï¼šxml å‘½åç©ºé—´ï¼ˆnamespaceï¼‰</li><li>xmlns:xsi ï¼šéµå®ˆè§„èŒƒï¼ˆschema instanceï¼‰</li><li>xsi:schemaLocationï¼šæœ¬æ–‡æ¡£ xml éµå®ˆçš„è§„èŒƒ å®˜æ–¹æŒ‡å®š</li></ul><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans        https://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--        å°†å¯¹è±¡æ”¾å…¥ Spring IoC å®¹å™¨ä¸­ï¼Œè¿›è¡Œå®ä¾‹åŒ–            ç±»å‹ å¯¹è±¡å = new ç±»å‹();        idï¼šç­‰ä»·äºå¯¹è±¡å beanæ ‡ç­¾çš„å”¯ä¸€æ ‡è¯†ï¼Œå¯¹åº”çš„ JavaBean å¯¹è±¡åé¦–å­—æ¯å°å†™        classï¼šç­‰ä»·äºå¯¹è±¡å¯¹åº”çš„å…¨é™å®šç±»å‹ JavaBean å¯¹è±¡çš„ç±»è·¯å¾„ ï¼ˆåŒ…å + ç±»åï¼‰        nameï¼šåˆ«å bean/å¯¹è±¡çš„ id åˆ«åï¼Œå¯ä»¥ç”¨åˆ«åè·å–å¯¹è±¡ï¼Œå¯å¤šä¸ª    --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mysqlImpl<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.dao.UserDaoMysqlImpl<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.UserService<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>u2,u22<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- refï¼šå¼•ç”¨Springå®¹å™¨ä¸­å·²åˆ›å»ºå¥½çš„å¯¹è±¡ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mysqlImpl<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- åˆ«å bean/å¯¹è±¡çš„idåˆ«åï¼Œå¯ä»¥ç”¨åˆ«åè·å–å¯¹è±¡ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>alias</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">alias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user01<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- å¯¼å…¥åˆå¹¶ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resources</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>spring-dao.xml<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>import</span> <span class="token attr-name">resources</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>spring-service.xml<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Test.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">{</span>    <span class="token annotation punctuation">@test</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// Springä¸Šä¸‹æ–‡å¯¹è±¡ / é…ç½®æ–‡ä»¶ ï¼ˆå•ä¸ªé…ç½®æ–‡ä»¶ ç›¸å¯¹è·¯å¾„ å¿«æ·é”®CPXï¼‰</span>        <span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä»Springçš„IoCå®¹å™¨ä¸­ï¼Œé€šè¿‡idè·å–å·²ç»å®ä¾‹åŒ–å¥½çš„å¯¹è±¡</span>        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•</span>        userService<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>å¤šä¸ªé…ç½®æ–‡ä»¶</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 1.æ€»é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰</span><span class="token class-name">ApplicationContext</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2.å¯å˜å‚æ•°</span><span class="token class-name">ApplicationContext</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"spring-dao.xml"</span><span class="token punctuation">,</span><span class="token string">"spring-service.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a>ä¾èµ–æ³¨å…¥</h2><pre class="line-numbers language-none"><code class="language-none">ä¾èµ–ï¼šbeanå¯¹è±¡çš„åˆ›å»ºï¼Œä¾èµ–äºå®¹å™¨æ³¨å…¥ï¼šbeanå¯¹è±¡çš„æ‰€æœ‰å±æ€§ï¼Œç”±å®¹å™¨æ³¨å…¥<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="ä¼ ç»Ÿæ³¨å…¥"><a href="#ä¼ ç»Ÿæ³¨å…¥" class="headerlink" title="ä¼ ç»Ÿæ³¨å…¥"></a>ä¼ ç»Ÿæ³¨å…¥</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä¼ ç»Ÿå®ä¾‹åŒ–æ–¹å¼ï¼šå®ç° UserServiceç±» å¯¹ UserDao ç±» çš„ä¾èµ–</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>    <span class="token comment">// 1.æ‰‹åŠ¨æ³¨å…¥userDao</span>    <span class="token class-name">UserDao</span> userDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 2.æ‰‹åŠ¨å¸¦å‚æ„é€ å™¨æ³¨å…¥userDao</span>    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao    <span class="token keyword">public</span> <span class="token class-name">UserService</span><span class="token punctuation">(</span><span class="token class-name">UserDao</span> userDao<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>userDao <span class="token operator">=</span> userDao<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ‰‹åŠ¨æ³¨å…¥"><a href="#æ‰‹åŠ¨æ³¨å…¥" class="headerlink" title="æ‰‹åŠ¨æ³¨å…¥"></a>æ‰‹åŠ¨æ³¨å…¥</h3><h4 id="setæ–¹æ³•ï¼ˆæ¨èï¼‰"><a href="#setæ–¹æ³•ï¼ˆæ¨èï¼‰" class="headerlink" title="setæ–¹æ³•ï¼ˆæ¨èï¼‰"></a>setæ–¹æ³•ï¼ˆæ¨èï¼‰</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/* setæ–¹æ³•æ³¨å…¥    1. æˆå‘˜å±æ€§å­—æ®µæä¾›setæ–¹æ³•    2. é…ç½®æ–‡ä»¶ä¸­é€šè¿‡propertyå±æ€§æŒ‡å®šæˆå‘˜å±æ€§å­—æ®µ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>    <span class="token comment">// JavaBean Bå¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setUserDao</span><span class="token punctuation">(</span><span class="token class-name">UserDao</span> userDao<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>userDao <span class="token operator">=</span> userDao<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// åŸºæœ¬æ•°æ®ç±»å‹</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> port<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPort</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> port<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>port <span class="token operator">=</span> port<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> host<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setHost</span><span class="token punctuation">(</span><span class="token class-name">String</span> host<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>host <span class="token operator">=</span> host<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// Listé›†åˆ</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list <span class="token operator">=</span> list<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// Seté›†åˆ</span>    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sets<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSets</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> sets<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>sets <span class="token operator">=</span> sets<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// Mapå¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>map <span class="token operator">=</span> map<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// propertieså±æ€§å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">Properties</span> properties<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProperties</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>properties <span class="token operator">=</span> properties<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"UserService Test..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>userDao<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>port<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>sets<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>v <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>map<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>properties<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">"="</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans        https://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--        setæ–¹æ³•æ³¨å…¥ï¼šé€šè¿‡propertyå±æ€§æŒ‡å®šæˆå‘˜å±æ€§å­—æ®µï¼Œå°†JavaBean Bå¯¹è±¡æ³¨å…¥åˆ°JavaBean Aå¯¹è±¡é‡Œ            nameï¼šJavaBean A ä¸­å¯¹è±¡çš„å±æ€§å­—æ®µå            refï¼šJavaBean B å¯¹è±¡çš„id            valueï¼šå…·ä½“çš„å€¼ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹ å¯¹è±¡ é›†åˆï¼‰    --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.UserService<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- JavaBeanå¯¹è±¡ï¼ˆä¸»è¦ï¼‰ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token comment">&lt;!-- åŸºæœ¬æ•°æ®ç±»å‹ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>port<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8080<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token comment">&lt;!-- å¯¹è±¡ï¼šStringã€Mapã€Properties --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>host<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>127.0.0.1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>map<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>å‘¨æ°ä¼¦<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>key</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>æ™´å¤©<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>æ—ä¿Šæ°<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>key</span><span class="token punctuation">&gt;</span></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>æ±Ÿå—<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>properties<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>bj<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>åŒ—äº¬<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sh<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>ä¸Šæµ·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- é›†åˆï¼šListã€Set --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>ä¸Šæµ·<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>åŒ—äº¬<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sets<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>ä¸Šæµ·SH<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>åŒ—äº¬BJ<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.dao.UserDao<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml">xmlns:p="http://www.springframework.org/schema/p"    <span class="token comment">&lt;!--        påç§°ç©ºé—´             ç®€åŒ–setteræ–¹æ³•å±æ€§æ³¨å…¥ã€‚    --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.UserService<span class="token punctuation">"</span></span>          <span class="token attr-name"><span class="token namespace">p:</span>userDao-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userDao<span class="token punctuation">"</span></span>          <span class="token attr-name"><span class="token namespace">p:</span>port</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>8080<span class="token punctuation">"</span></span>          <span class="token attr-name"><span class="token namespace">p:</span>host</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>127.0.0.1<span class="token punctuation">"</span></span>    <span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="æ„é€ å™¨"><a href="#æ„é€ å™¨" class="headerlink" title="æ„é€ å™¨"></a>æ„é€ å™¨</h4><h4 id="é™æ€å·¥å‚"><a href="#é™æ€å·¥å‚" class="headerlink" title="é™æ€å·¥å‚"></a>é™æ€å·¥å‚</h4><h4 id="å®ä¾‹åŒ–å·¥å‚"><a href="#å®ä¾‹åŒ–å·¥å‚" class="headerlink" title="å®ä¾‹åŒ–å·¥å‚"></a>å®ä¾‹åŒ–å·¥å‚</h4><h3 id="è‡ªåŠ¨è£…é…ï¼ˆæ¨èï¼‰"><a href="#è‡ªåŠ¨è£…é…ï¼ˆæ¨èï¼‰" class="headerlink" title="è‡ªåŠ¨è£…é…ï¼ˆæ¨èï¼‰"></a>è‡ªåŠ¨è£…é…ï¼ˆæ¨èï¼‰</h3><p>Springåœ¨ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­è‡ªåŠ¨å¯»æ‰¾ï¼Œå¹¶ç»™beanå¯¹è±¡è‡ªåŠ¨è£…é…å±æ€§ã€‚</p><h4 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h4><p><code>applicationContext.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- é…ç½®Beanå¯¹è±¡ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo.Cat<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dog<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo.Dog<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>people<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo.People<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å°æ˜<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>çŒ«å’ª<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dog<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ç‹—ç‹—<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- é…ç½®Beanå¯¹è±¡ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo.Cat<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dog<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo.Dog<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!-- autowire="byName" åœ¨å®¹å™¨ä¸Šä¸‹æ–‡è‡ªåŠ¨æŸ¥æ‰¾ï¼Œè£…é…ä¸æœ¬å¯¹è±¡peopleçš„setæ–¹æ³•å€¼å¯¹åº”çš„beanidautowire="byType" åœ¨å®¹å™¨ä¸Šä¸‹æ–‡è‡ªåŠ¨æŸ¥æ‰¾ï¼Œè£…é…ä¸æœ¬å¯¹è±¡peopleçš„å±æ€§ç±»å‹å¯¹åº”çš„beanid--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>people<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo.People<span class="token punctuation">"</span></span> <span class="token attr-name">autowire</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>byName<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>å°æ˜<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Test.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">People</span> people <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"people"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="æ³¨è§£-æ‰«æ"><a href="#æ³¨è§£-æ‰«æ" class="headerlink" title="æ³¨è§£ + æ‰«æ"></a>æ³¨è§£ + æ‰«æ</h4><p>ä¸»è¦å¤åˆ¶Beanå¯¹è±¡çš„å±æ€§æ³¨å…¥</p><h5 id="Resource"><a href="#Resource" class="headerlink" title="@Resource"></a>@Resource</h5><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-context<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>javax.annotation<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>javax.annotation-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.3.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>applicationContext.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans       https://www.springframework.org/schema/beans/spring-beans.xsd       http://www.springframework.org/schema/context       http://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- è‡ªåŠ¨è£…é…ï¼šæ³¨è§£ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span><span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- é…ç½®beanå¯¹è±¡ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo.Cat<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dog<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo.Dog<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>people<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo.People<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- è‡ªåŠ¨è£…é…ï¼šæ³¨è§£ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!--    æ‰«æå™¨        1. è®¾ç½®è‡ªåŠ¨æ‰«æèŒƒå›´        2. åœ¨éœ€è¢«å®ä¾‹åŒ–çš„JavaBeançš„ç±»ä¸Šæ·»ç»„ä»¶æ³¨è§£ï¼ˆbeanå¯¹è±¡çš„idå±æ€§é»˜è®¤æ˜¯ï¼šç±»çš„é¦–å­—æ¯å°å†™ï¼‰--&gt;</span><span class="token comment">&lt;!--   è‡ªåŠ¨æ‰«æ   æ‰«ææŒ‡å®šåŒ…ï¼Œè®©æ­¤åŒ…ä¸‹çš„æ‰€æœ‰æ³¨è§£ @Componentç­‰ ç”Ÿæ•ˆ    è‡ªåŠ¨æ³¨å…¥bean å¯çœç•¥é…ç½®Beanå¯¹è±¡ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.pojo<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>People.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * è‡ªåŠ¨è£…é…Beanå¯¹è±¡ï¼ˆåå°„ï¼‰ * 1. æ³¨è§£é»˜è®¤é€šè¿‡å±æ€§å­—æ®µåç§°æŸ¥æ‰¾å¯¹åº”çš„beanå¯¹è±¡ï¼ˆå±æ€§å­—æ®µåç§°ä¸beanæ ‡ç­¾çš„idå±æ€§å€¼ä¸€è‡´ï¼‰ * 2. è‹¥å±æ€§å­—æ®µåç§°ä¸ä¸€æ ·ï¼Œåˆ™ä¼šé€šè¿‡ç±»å‹ï¼ˆClassï¼‰ç±»å‹ * 3. å±æ€§å­—æ®µå¯æä¾›setæ–¹æ³• ä¹Ÿå¯ä¸æä¾› * 4. æ³¨è§£å¯ä»¥å£°æ˜åœ¨å±æ€§å­—æ®µä¸Š æˆ– setæ–¹æ³•çº§åˆ« * 5. å¯è®¾ç½®æ³¨è§£çš„nameå±æ€§ï¼Œnameå±æ€§å€¼è¦ä¸beanæ ‡ç­¾çš„idå±æ€§å€¼ä¸€è‡´ï¼ˆå¦‚æœè®¾ç½®äº†nameå±æ€§ï¼Œåˆ™ä¼šæŒ‰ç…§nameå±æ€§æŸ¥è¯¢beanå¯¹è±¡ï¼‰ * 6. å½“æ³¨å…¥æ¥å£æ—¶ï¼Œè‹¥æ¥å£åªæœ‰ä¸€ä¸ªå®ç°ç±»ï¼Œåˆ™ä¸ç”¨æŒ‡å®šéœ€è¢«å®ä¾‹åŒ–çš„beanå¯¹è±¡ï¼›è‹¥æ¥å£æœ‰å¤šä¸ªå®ç°ç±»ï¼Œåˆ™éœ€ä½¿ç”¨nameå±æ€§æŒ‡å®š */</span><span class="token comment">/**è¡ç”Ÿæ³¨è§£1.ç»„ä»¶æ³¨è§£å°†ç±»æ³¨å†Œåˆ°Springå®¹å™¨ä¸­ä»£ä¸ºç®¡ç†çº¦å®š                Daoå±‚ @Repository ç­‰ä»·äº &lt;bean id="people" class="com.xxxx.pojo.People" /&gt;                Serviceå±‚  @Service                Controllerå±‚  @Controller                ä»»æ„ç±»@Component2.æ¨¡å¼æ³¨è§£@Scope("singleton")  å•ä¾‹æ¨¡å¼ ç­‰ä»·äº &lt;bean scope="singleton" id="people" /&gt;@Scope("prototype")  åŸå‹æ¨¡å¼*/</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">{</span>    <span class="token comment">// è‡ªåŠ¨è£…é…Beanå¯¹è±¡ï¼ˆå¯ä¸ç”¨å†™setæ–¹æ³• é»˜è®¤å…ˆä½¿ç”¨byNameæ‰¾idï¼Œæ‰¾ä¸åˆ°å°±ä½¿ç”¨byTypeæ‰¾ç±»å‹ï¼‰</span>    <span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"cat"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Cat</span> cat<span class="token punctuation">;</span>    <span class="token comment">// @value ç­‰ä»·äº </span>    <span class="token comment">// &lt;bean id="cat" class="com.xxxx.pojo.Cat"&gt;</span>    <span class="token comment">//      &lt;property name="uname" value="åå­—" /&gt;</span>    <span class="token comment">// &lt;/bean&gt;</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"åå­—"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> uname<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        cat<span class="token punctuation">.</span><span class="token function">shout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h5><p><code>People.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">People</span> <span class="token punctuation">{</span>    <span class="token comment">// è‡ªåŠ¨è£…é…Beanå¯¹è±¡ï¼ˆå¯ä¸ç”¨å†™setæ–¹æ³• é»˜è®¤ä½¿ç”¨byTypeæ‰¾ç±»å‹ï¼‰</span>    <span class="token comment">// required = true  ä¸å…è®¸ä¸ºnull</span>    <span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token annotation punctuation">@Qualifier</span><span class="token punctuation">(</span>value<span class="token operator">=</span><span class="token string">"cat22"</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">Cat</span> cat<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        cat<span class="token punctuation">.</span><span class="token function">shout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Nullable</span> å­—æ®µå¯ä¸º<span class="token keyword">null</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">String</span> uname<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h4><p><code>User.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"çŒ«å’ª"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token string">"User{"</span> <span class="token operator">+</span> <span class="token string">"name'"</span> <span class="token operator">+</span> name <span class="token operator">+</span><span class="token string">'\''</span> <span class="token operator">+</span><span class="token string">'}'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>AppConfig.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä¹Ÿæ˜¯ç»„ä»¶ï¼Œä¹Ÿä¼šè¢«æ³¨å†Œåˆ°Springå®¹å™¨ä¸­æ‰˜ç®¡ ç›¸å½“äºxmlä¸­çš„&lt;beans&gt;...&lt;/beans&gt;</span><span class="token annotation punctuation">@Configuration</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{</span>    <span class="token comment">// ç›¸å½“äºxmlä¸­çš„&lt;bean&gt;...&lt;bean&gt;</span>    <span class="token comment">// æ–¹æ³•åï¼šç›¸å½“äºbeanid</span>    <span class="token comment">// è¿”å›å€¼ï¼šç›¸å½“äºbeanclass</span>    <span class="token annotation punctuation">@Bean</span>    <span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment">// è¿”å›è¦æ³¨å…¥åˆ°å®¹å™¨çš„beanå¯¹è±¡</span>        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Test.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> applicationContext <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">User</span> getUser <span class="token operator">=</span> applicationContext<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h2><h3 id="å®ä¾‹åŒ–"><a href="#å®ä¾‹åŒ–" class="headerlink" title="å®ä¾‹åŒ–"></a>å®ä¾‹åŒ–</h3><h4 id="æ¨¡æ‹Ÿå®ç°"><a href="#æ¨¡æ‹Ÿå®ç°" class="headerlink" title="æ¨¡æ‹Ÿå®ç°"></a>æ¨¡æ‹Ÿå®ç°</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java">æ ¸å¿ƒæŠ€æœ¯å·¥å‚æ¨¡å¼ï¼ˆç®€å•å·¥å‚ å·¥å‚æ–¹æ³• æŠ½è±¡å·¥å‚ï¼‰xmlè§£æï¼ˆ<span class="token class-name">Dom4j</span>ï¼‰åå°„æŠ€æœ¯ï¼ˆå®ä¾‹åŒ–å¯¹è±¡ åå°„è·å–æ–¹æ³• åå°„è·å–å±æ€§ åå°„è·å–æ„é€ å™¨ åå°„è°ƒç”¨æ–¹æ³•ï¼‰ç­–ç•¥æ¨¡å¼ï¼ˆåŠ è½½èµ„æºï¼‰å•ä¾‹æ¨¡å¼ï¼ˆIOCåˆ›å»ºå®ä¾‹åŒ–å¯¹è±¡ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h4><h5 id="æ„é€ å™¨å®ä¾‹åŒ–ï¼ˆé»˜è®¤ï¼‰"><a href="#æ„é€ å™¨å®ä¾‹åŒ–ï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="æ„é€ å™¨å®ä¾‹åŒ–ï¼ˆé»˜è®¤ï¼‰"></a>æ„é€ å™¨å®ä¾‹åŒ–ï¼ˆé»˜è®¤ï¼‰</h5><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ³¨æ„ï¼šå¯¹åº”Beanå¯¹è±¡éœ€è¦æä¾›ç©ºæ„é€ ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TypeDao</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> str<span class="token punctuation">;</span>    <span class="token comment">// ç©ºæ„é€ </span>    <span class="token keyword">public</span> <span class="token class-name">TypeDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">TypeDao</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>str <span class="token operator">=</span> str<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"TypeDao test..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans        https://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!--        æ„é€ å™¨å®ä¾‹åŒ–            å¯¹åº”Beanå¯¹è±¡éœ€è¦æä¾›ç©ºæ„é€      --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>typeDao<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.dao.TypeDao<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TypeDao</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> str<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">TypeDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token class-name">TypeDao</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>str <span class="token operator">=</span> str<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"TypeDao test..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="é™æ€å·¥å‚å®ä¾‹åŒ–"><a href="#é™æ€å·¥å‚å®ä¾‹åŒ–" class="headerlink" title="é™æ€å·¥å‚å®ä¾‹åŒ–"></a>é™æ€å·¥å‚å®ä¾‹åŒ–</h5><p>æ³¨æ„ï¼š</p><p>è¦æœ‰è¯¥å·¥å‚ç±»åŠå·¥å‚æ–¹æ³•<br>å·¥å‚æ–¹æ³•ä¸ºé™æ€çš„</p><h5 id="å®ä¾‹åŒ–å·¥å‚å®ä¾‹åŒ–"><a href="#å®ä¾‹åŒ–å·¥å‚å®ä¾‹åŒ–" class="headerlink" title="å®ä¾‹åŒ–å·¥å‚å®ä¾‹åŒ–"></a>å®ä¾‹åŒ–å·¥å‚å®ä¾‹åŒ–</h5><pre class="line-numbers language-none"><code class="language-none"><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h3><h4 id="å•ä¾‹ä½œç”¨åŸŸï¼ˆé»˜è®¤ï¼‰"><a href="#å•ä¾‹ä½œç”¨åŸŸï¼ˆé»˜è®¤ï¼‰" class="headerlink" title="å•ä¾‹ä½œç”¨åŸŸï¼ˆé»˜è®¤ï¼‰"></a>å•ä¾‹ä½œç”¨åŸŸï¼ˆé»˜è®¤ï¼‰</h4><p>Spring IOC å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¼šå°†æ‰€æœ‰åœ¨å•ä¾‹ä½œç”¨åŸŸä¸­çš„beanå¯¹è±¡å®ä¾‹åŒ–æ”¾åˆ°å•ä¾‹ç¼“å­˜æ± ä¸­ã€‚</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817153828.png"></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans       https://www.springframework.org/schema/beans/spring-beans.xsd       http://www.springframework.org/schema/context       http://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!--singletonå•ä¾‹ä½œç”¨åŸŸ             lazy-initå±æ€§ï¼ˆæ‡’åŠ è½½ï¼‰                 å¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºæ‡’åŠ è½½ï¼Œå®¹å™¨åœ¨å¯åŠ¨æ—¶ï¼Œä¸ä¼šå®ä¾‹åŒ–beanå¯¹è±¡ï¼Œåœ¨ç¨‹åºè°ƒç”¨æ—¶æ‰ä¼šå®ä¾‹åŒ–                 å¦‚æœè®¾ç½®falseï¼ˆé»˜è®¤ï¼‰ï¼Œè¡¨ç¤ºä¸æ‡’åŠ è½½ï¼Œå®¹å™¨å¯åŠ¨åˆ™å®ä¾‹åŒ–beanå¯¹è±¡             lazy-initå±æ€§ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸ºfalseï¼Ÿ                  1. å¯ä»¥æå‰å‘ç°æ½œåœ¨çš„é…ç½®æ–‡ä»¶                  2. Beanå¯¹è±¡åœ¨å¯åŠ¨æ—¶å°±ä¼šè®¾ç½®åœ¨å•ä¾‹ç¼“å­˜æ± ä¸­ï¼Œä½¿ç”¨æ—¶ä¸éœ€è¦å†å»å®ä¾‹åŒ–beanå¯¹è±¡ï¼Œæé«˜ç¨‹åºè¿è¡Œæ•ˆç‡             ä»€ä¹ˆå¯¹è±¡é€‚åˆä½œä¸ºå•ä¾‹å¯¹è±¡ï¼Ÿï¼ˆä»€ä¹ˆå¯¹è±¡é€‚åˆäº¤ç»™IOCå®¹å™¨å®ä¾‹åŒ–ï¼Ÿï¼‰                  æ— çŠ¶æ€çš„å¯¹è±¡ï¼ˆä¸å­˜åœ¨æ”¹å˜å½“å‰å¯¹è±¡çŠ¶æ€çš„æˆå‘˜å˜é‡ï¼‰å¦‚ï¼šcontrollerå±‚ã€serviceå±‚ã€daoå±‚        --&gt;</span>        <span class="token comment">&lt;!-- æ‡’åŠ è½½ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>roleService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.RoleService<span class="token punctuation">"</span></span> <span class="token attr-name">lazy-init</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- é»˜è®¤falseï¼Œä¸æ‡’åŠ è½½ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>roleService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.RoleService<span class="token punctuation">"</span></span> <span class="token attr-name">lazy-init</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>false<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="åŸå‹ä½œç”¨åŸŸ"><a href="#åŸå‹ä½œç”¨åŸŸ" class="headerlink" title="åŸå‹ä½œç”¨åŸŸ"></a>åŸå‹ä½œç”¨åŸŸ</h4><p>scope=â€prototypeâ€ï¼ŒSpring IOC å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸ä¼šå°†beanå¯¹è±¡å®ä¾‹åŒ–æ”¾åˆ°å•ä¾‹ç¼“å­˜æ± ä¸­ï¼Œæ¯æ¬¡å®ä¾‹åŒ–å¯¹è±¡éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210817154045.png"></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- propotype åŸå‹ä½œç”¨åŸŸ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>roleService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.RoleService<span class="token punctuation">"</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prototype<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="Webåº”ç”¨ä¸­çš„ä½œç”¨åŸŸ"><a href="#Webåº”ç”¨ä¸­çš„ä½œç”¨åŸŸ" class="headerlink" title="Webåº”ç”¨ä¸­çš„ä½œç”¨åŸŸ"></a>Webåº”ç”¨ä¸­çš„ä½œç”¨åŸŸ</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token number">1.</span> requestä½œç”¨åŸŸ    è¡¨ç¤ºæ¯ä¸ªè¯·æ±‚éœ€è¦å®¹å™¨åˆ›å»ºä¸€ä¸ªå…¨æ–°<span class="token class-name">Bean</span>ã€‚æ¯”å¦‚æäº¤è¡¨å•çš„æ•°æ®å¿…é¡»æ˜¯å¯¹æ¯æ¬¡è¯·æ±‚æ–°å»ºä¸€ä¸ª<span class="token class-name">Bean</span>    æ¥ä¿æŒè¿™äº›è¡¨å•æ•°æ®ï¼Œè¯·æ±‚ç»“æŸé‡Šæ”¾è¿™äº›æ•°æ®ã€‚<span class="token number">2.</span> sessionä½œç”¨åŸŸ    è¡¨ç¤ºæ¯ä¸ªä¼šè¯éœ€è¦å®¹å™¨åˆ›å»ºä¸€ä¸ªå…¨æ–°<span class="token class-name">Bean</span>ã€‚æ¯”å¦‚å¯¹äºæ¯ä¸ªç”¨æˆ·ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªä¼šè¯ï¼Œè¯¥ç”¨æˆ·çš„ç”¨æˆ·    ä¿¡æ¯éœ€è¦å­˜å‚¨åˆ°ä¼šè¯ä¸­ï¼Œæ­¤æ—¶å¯ä»¥å°†è¯¥<span class="token class-name">Bean</span>ä½œç”¨åŸŸé…ç½®ä¸ºsessionçº§åˆ«ã€‚<span class="token number">3.</span> globalSessionä½œç”¨åŸŸ    ç±»ä¼¼äºsessionä½œç”¨åŸŸï¼Œå…¶ç”¨äº<span class="token function">portlet</span><span class="token punctuation">(</span><span class="token class-name">Portlet</span>æ˜¯åŸºäº<span class="token class-name">Java</span>çš„<span class="token class-name">Web</span>ç»„ä»¶ï¼Œç”±<span class="token class-name">Portlet</span>å®¹å™¨ç®¡ç†ï¼Œå¹¶ç”±å®¹å™¨å¤„ç†è¯·æ±‚ï¼Œç”Ÿäº§åŠ¨æ€å†…å®¹<span class="token punctuation">)</span>ç¯å¢ƒçš„webåº”ç”¨ã€‚å¦‚æœåœ¨éportletç¯å¢ƒå°†è§†ä¸ºsessionä½œç”¨åŸŸã€‚    é…ç½®æ–¹å¼å’ŒåŸºæœ¬çš„ä½œç”¨åŸŸç›¸åŒï¼Œåªæ˜¯å¿…é¡»è¦æœ‰webç¯å¢ƒæ”¯æŒï¼Œå¹¶é…ç½®ç›¸åº”çš„å®¹å™¨ç›‘å¬å™¨æˆ–æ‹¦æˆªå™¨ä»è€Œ    èƒ½åº”ç”¨è¿™äº›ä½œç”¨åŸŸï¼Œç›®å‰å…ˆç†Ÿæ‚‰æ¦‚å¿µï¼Œåç»­é›†æˆwebæ—¶è®²è§£å…·ä½“ä½¿ç”¨ï¼Œå¤§å®¶åªéœ€è¦çŸ¥é“æœ‰è¿™äº›ä½œç”¨åŸŸå°±    å¯ä»¥äº†ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h3><ol><li>å®šä¹‰</li></ol><ul><li>åœ¨ xxxConfig é…ç½®æ–‡ä»¶ä¸­å®šä¹‰beanï¼ˆJavaæ–¹å¼è‡ªåŠ¨è£…é…ï¼‰ã€‚</li><li>åœ¨ Applicaiton.xml é…ç½®æ–‡ä»¶ä¸­é€šè¿‡beanæ ‡ç­¾å®šä¹‰å¯¹åº”beanå¯¹è±¡ã€‚</li></ul><ol start="2"><li>åˆå§‹åŒ–ï¼šIOCå®¹å™¨å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨å®ä¾‹åŒ–Beanå¯¹è±¡</li></ol><ul><li>åœ¨é…ç½®æ–‡æ¡£ä¸­é€šè¿‡æŒ‡å®š init-method å±æ€§æ¥å®Œæˆã€‚</li><li>å®ç° org.springframework.beans.factory.InitializingBean æ¥å£ã€‚</li></ul><ol start="3"><li>ä½¿ç”¨</li></ol><ul><li>ä½¿ç”¨Beanå·¥å‚å¯¹è±¡ï¼šBeanFactory</li><li>ä½¿ç”¨åº”ç”¨ä¸Šä¸‹æ–‡å¯¹è±¡ï¼š ApplicationContext</li></ul><ol start="4"><li>é”€æ¯<br>æ­¥éª¤ä¸€ï¼šé€šè¿‡ AbstractApplicationContext å¯¹è±¡ï¼Œè°ƒç”¨å…¶closeæ–¹æ³•å®ç°beançš„é”€æ¯è¿‡ç¨‹ã€‚<br>æ­¥éª¤äºŒï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå¯¹åº”é”€æ¯çš„æ–¹æ³• destroy-methodã€‚</li></ol><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans       https://www.springframework.org/schema/beans/spring-beans.xsd       http://www.springframework.org/schema/context       http://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- åˆå§‹åŒ–ï¼šåœ¨é…ç½®æ–‡æ¡£ä¸­é€šè¿‡æŒ‡å®š init-method å±æ€§æ¥å®Œæˆ--&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>roleService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.RoleService<span class="token punctuation">"</span></span> <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- åˆå§‹åŒ–ï¼šå®ç° org.springframework.beans.factory.InitializingBean æ¥å£ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>roleService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.RoleService<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- é”€æ¯ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>roleService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.RoleService<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>destroy<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>xxxx<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">InitializingBean</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RoleService</span> <span class="token keyword">implements</span> <span class="token class-name">InitializingBean</span> <span class="token punctuation">{</span>    <span class="token comment">/*public RoleService(){        System.out.println("RoleServiceè¢«åˆå§‹åŒ–äº†...");    }*/</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RoleService Test..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æŸ¥çœ‹åˆå§‹åŒ–çš„æ–¹æ³•     * @throws Exception     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RoleService init afterPropertiesSet..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„æŸ¥çœ‹åˆå§‹åŒ–çš„æ–¹æ³•     */</span>    <span class="token comment">/*public void init(){        System.out.println("RoleServiceè¢«åˆå§‹åŒ–äº†...");    }*/</span>    <span class="token comment">/**     * é”€æ¯æ–¹æ³•     */</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RoleServiceé”€æ¯..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> Spring IOC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring AOP</title>
      <link href="/2020/01/02/spring-aop/"/>
      <url>/2020/01/02/spring-aop/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>Aspect Oriented Programing</p><blockquote><p>OOP é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼šå…³æ³¨ä»£ç ä¸­çš„å•ä¸ªç±»å’Œæ–¹æ³•ã€‚<br>&nbsp;AOP é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼šå…³æ³¨ä»£ç ä¸­çš„å¤šä¸ªç±»å’Œæ–¹æ³•ã€‚</p></blockquote><p><span class="github-emoji"><span>â­</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/2b50.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½œç”¨</p><ol><li><p>è§£è€¦ï¼šæé«˜ä¸šåŠ¡ä»£ç çš„èšåˆåº¦ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ï¼Œå³é«˜å†…èšä½è€¦åˆã€‚</p></li><li><p>æé«˜ä»£ç çš„å¤ç”¨æ€§ã€‚</p></li><li><p>æé«˜ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼šé«˜ç‰ˆæœ¬å…¼å®¹ä½ç‰ˆæœ¬ã€‚</p></li><li><p><strong>ä¸æ”¹å˜åŸæœ‰ä»£ç ï¼Œç»™ç›®æ ‡å¯¹è±¡å¢åŠ æ–°çš„åŠŸèƒ½ã€‚</strong></p></li></ol><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> åº”ç”¨ï¼šæ—¥å¿—è®°å½•ï¼Œæ€§èƒ½ç»Ÿè®¡ï¼Œå®‰å…¨æ§åˆ¶ï¼Œäº‹åŠ¡å¤„ç†ç­‰ï¼Œå®ç°å…¬å…±åŠŸèƒ½æ€§çš„é‡å¤ä½¿ç”¨ã€‚</p><p><span class="github-emoji"><span>ğŸ”¥</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f525.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æœ¯è¯­</p><ul><li><p>Aspect åˆ‡é¢ï¼š æ¨ªåˆ‡å…³æ³¨ç‚¹è¢«æ¨¡å—åŒ–çš„ç‰¹æ®Šå¯¹è±¡ã€‚<strong>ç†è§£ï¼šç±»</strong></p></li><li><p>Advice é€šçŸ¥ï¼šæ‹¦æˆªä¹‹åæ–¹æ³•åè¦åšä»€ä¹ˆï¼Ÿ<strong>ç†è§£ï¼šç±»çš„æ–¹æ³•</strong></p><ol><li>å‰ç½®é€šçŸ¥ï¼šbefore() ç›®æ ‡ç±»çš„æ–¹æ³•æ‰§è¡Œå‰é€šçŸ¥ã€‚</li><li>è¿”å›é€šçŸ¥ï¼šafterReturn() ç›®æ ‡ç±»çš„æ–¹æ³•æ‰§è¡Œæ— å¼‚å¸¸åè¿”å›çš„é€šçŸ¥ã€‚</li><li>å¼‚å¸¸é€šçŸ¥ï¼šafetrThrow() ç›®æ ‡ç±»çš„æ–¹æ³•æ‰§è¡Œå¼‚å¸¸æ—¶æ‰§è¡Œã€‚</li><li>æœ€ç»ˆé€šçŸ¥ï¼šafter() æ— è®ºç›®æ ‡ç±»çš„æ–¹æ³•æ‰§è¡Œæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œã€‚</li><li>ç¯ç»•é€šçŸ¥ï¼šaround() åŒ…å›´ä¸€ä¸ªè¿æ¥ç‚¹çš„é€šçŸ¥ï¼Œå¦‚æ–¹æ³•è°ƒç”¨ã€‚ç¯ç»•é€šçŸ¥å¯åœ¨æ–¹æ³•è°ƒç”¨å‰åå®Œæˆè‡ªå®šä¹‰çš„è¡Œä¸ºã€‚å®ƒä¹Ÿä¼šé€‰æ‹©æ˜¯å¦ç»§ç»­æ‰§è¡Œè¿æ¥ç‚¹æˆ–ç›´æ¥è¿”å›å®ƒä»¬è‡ªå·±çš„è¿”å›å€¼æˆ–æŠ›å‡ºå¼‚å¸¸æ¥ç»“æŸæ‰§è¡Œã€‚</li></ol></li><li><p>Target ç›®æ ‡å¯¹è±¡ï¼šè¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼Œä¸ç”¨ç®¡ï¼ŒåŠ¨æ€ä»£ç†å¸®å¿™åšäº†ã€‚</p></li><li><p>Proxy ä»£ç†å¯¹è±¡ï¼šå‘ç›®æ ‡å¯¹è±¡åº”ç”¨é€šçŸ¥ååˆ›å»ºçš„å¯¹è±¡ï¼Œä¸ç”¨ç®¡ï¼ŒåŠ¨æ€ä»£ç†å¸®å¿™åšäº†ã€‚</p></li><li><p>Pointcut åˆ‡å…¥ç‚¹ï¼šè¦æ‹¦æˆªå“ªäº›ç±»çš„å“ªäº›ç‚¹ï¼ˆæ–¹æ³•ï¼‰ï¼ŸåŒ¹é…çš„æ–¹æ³•é›†åˆï¼ˆåŒ¹é…è§„åˆ™å®šä¹‰ è§„å®šæ‹¦æˆªå“ªäº›æ–¹æ³•ï¼Œå¯¹å“ªäº›æ–¹æ³•è¿›è¡Œå¤„ç†ï¼‰</p></li><li><p>Joinpoint è¿æ¥ç‚¹ï¼šè¢«æ‹¦æˆªçš„æ¯ä¸ªç‚¹ï¼ˆæ–¹æ³•ï¼‰ï¼Œä¸€ä¸ªè¿æ¥ç‚¹ä»£è¡¨ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œã€‚</p></li><li><p>Weave  ç»‡å…¥ï¼šå°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡å¹¶ç”Ÿæˆä»£ç†å¯¹è±¡çš„è¿‡ç¨‹ã€‚</p></li><li><p>Introduction å¼•å…¥ï¼šåœ¨ä¸ä¿®æ”¹åŸå§‹ä»£ç çš„æƒ…å†µä¸‹ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ä¸ºç±»åŠ¨æ€æ·»åŠ æ–¹æ³•æˆ–å­—æ®µçš„è¿‡ç¨‹</p></li></ul><h2 id="æ¨ªå‘å¼€å‘"><a href="#æ¨ªå‘å¼€å‘" class="headerlink" title="æ¨ªå‘å¼€å‘"></a>æ¨ªå‘å¼€å‘</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811203952.png"></p><h2 id="åº•å±‚å®ç°"><a href="#åº•å±‚å®ç°" class="headerlink" title="åº•å±‚å®ç°"></a>åº•å±‚å®ç°</h2><h3 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h3><ul><li><p>æ¦‚å¿µï¼šä»¥æŸä¸ªå¯¹è±¡ä½œä¸ºä»£ç†ï¼Œä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ç†è§£ï¼šæˆ¿å®¢ã€ä¸­ä»‹ã€æˆ¿ä¸œã€‚</p></li><li><p>ä½œç”¨ï¼šä¸ä¿®æ”¹åŸä»£ç ï¼Œå¢åŠ ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ã€‚</p></li><li><p>åˆ†ç±»ï¼šé™æ€ä»£ç†ã€åŠ¨æ€ä»£ç†ã€‚</p></li><li><p>è®¾è®¡åŸåˆ™</p><ol><li>ä»£ç† ä¸ ç›®æ ‡å¯¹è±¡ æœ‰å…±åŒè¡Œä¸ºï¼ˆå…±åŒçˆ¶ç±» / æ¥å£ï¼‰ã€‚</li><li>ä»£ç† èƒ½å¢å¼º ç›®æ ‡å¯¹è±¡ çš„è¡Œä¸ºï¼ˆä»£ç†å¯¹å‡†å¤‡å‘ç»™ç›®æ ‡å¯¹è±¡çš„è¯·æ±‚åšé¢„å¤„ç†ã€è¿‡æ»¤ï¼Œå†è¿˜ç»™ç›®æ ‡å¯¹è±¡ï¼‰ã€‚</li></ol></li></ul><h3 id="é™æ€ä»£ç†ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼‰"><a href="#é™æ€ä»£ç†ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼‰" class="headerlink" title="é™æ€ä»£ç†ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼‰"></a>é™æ€ä»£ç†ï¼ˆè£…é¥°å™¨æ¨¡å¼ï¼‰</h3><ul><li>æ¦‚å¿µï¼šæ‰‹åŠ¨ä¸ºç›®æ ‡å¯¹è±¡åˆ¶ä½œä»£ç†å¯¹è±¡ã€‚</li><li>è¦ç´ <ol><li>å…±åŒè¡Œä¸ºï¼ˆç»“å©šï¼‰        - å®šä¹‰è¡Œä¸º</li><li>ç›®æ ‡å¯¹è±¡ï¼ˆæ–°äººï¼‰        - å®ç°è¡Œä¸º</li><li>ä»£ç†å¯¹è±¡ï¼ˆå©šåº†å…¬å¸ï¼‰ - å®ç°è¡Œä¸º å¢å¼ºç›®æ ‡å¯¹è±¡è¡Œä¸º</li></ol></li><li>ç‰¹ç‚¹<ol><li>ç›®æ ‡å¯¹è±¡å›ºå®šã€‚</li><li>åœ¨ç¨‹åºæ‰§è¡Œå‰ï¼Œåˆ›å»ºç›®æ ‡å¯¹è±¡ï¼Œå³åœ¨ç¨‹åºç¼–è¯‘é˜¶æ®µå®Œæˆä»£ç†å¯¹è±¡çš„åˆ›å»ºã€‚</li><li>ä»£ç†å¯¹è±¡ä¼šå¢å¼ºç›®æ ‡å¯¹è±¡çš„è¡Œä¸ºã€‚</li><li>ç¼ºç‚¹ï¼šè‹¥å­˜åœ¨å¤šä¸ªç›®æ ‡å¯¹è±¡ï¼Œå°±éœ€ç”Ÿæˆå¤šä¸ªä»£ç†å¯¹è±¡ä¼šå¼•èµ·â€ç±»çˆ†ç‚¸â€ã€‚</li></ol></li></ul><p><code>Marry.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * å®šä¹‰æ¥å£ï¼šå®šä¹‰è¡Œä¸º */</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Marry</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Me.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç›®æ ‡å¯¹è±¡ï¼šå®ç°è¡Œä¸º */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Me</span> <span class="token keyword">implements</span> <span class="token class-name">Marry</span> <span class="token punctuation">{</span>    <span class="token comment">// å®ç°è¡Œä¸º</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¦ç»“å©šå•¦..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>MarryCompany.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ä»£ç†å¯¹è±¡ï¼šå®ç°è¡Œä¸ºå¹¶å¢å¼ºç›®æ ‡å¯¹è±¡è¡Œä¸º */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MarryCompany</span> <span class="token keyword">implements</span> <span class="token class-name">Marry</span> <span class="token punctuation">{</span>    <span class="token comment">// ç›®æ ‡å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">Me</span> me<span class="token punctuation">;</span>    <span class="token comment">// é€šè¿‡å¸¦å‚æ„é€ å™¨ä¼ é€’ç›®æ ‡å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token class-name">MarryCompany</span><span class="token punctuation">(</span><span class="token class-name">Me</span> me<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>me <span class="token operator">=</span> me<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// å®ç°è¡Œä¸º</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>me<span class="token punctuation">.</span><span class="token function">toMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">//å¢å¼ºç›®æ ‡å¯¹è±¡è¡Œä¸º</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å©šåç¥ç¦..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å©šå‰å¸ƒç½®..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>StaticProxy.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticProxy</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// ç›®æ ‡å¯¹è±¡</span>        <span class="token class-name">Me</span> me <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ä»£ç†å¯¹è±¡</span>        <span class="token class-name">MarryCompany</span> marryCompany <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MarryCompany</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡ä¸­çš„æ–¹æ³•</span>        marryCompany<span class="token punctuation">.</span><span class="token function">toMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åŠ¨æ€ä»£ç†"><a href="#åŠ¨æ€ä»£ç†" class="headerlink" title="åŠ¨æ€ä»£ç†"></a>åŠ¨æ€ä»£ç†</h3><ul><li>æ¦‚å¿µï¼šé€šè¿‡åå°„ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œä¸ºç›®æ ‡å¯¹è±¡åŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</li><li>ç‰¹ç‚¹<ol><li>ç›®æ ‡è§’è‰²ä¸å›ºå®š</li><li>åœ¨åº”ç”¨ç¨‹åºæ‰§è¡Œæ—¶ï¼ŒåŠ¨æ€åˆ›å»ºç›®æ ‡å¯¹è±¡</li><li>ä»£ç†å¯¹è±¡ä¼šå¢å¼ºç›®æ ‡å¯¹è±¡çš„è¡Œä¸º</li></ol></li></ul><h4 id="JDKï¼ˆå®ç°æ¥å£ï¼‰"><a href="#JDKï¼ˆå®ç°æ¥å£ï¼‰" class="headerlink" title="JDKï¼ˆå®ç°æ¥å£ï¼‰"></a>JDKï¼ˆå®ç°æ¥å£ï¼‰</h4><ul><li>æ¦‚å¿µ<ul><li>Proxy ç±»ï¼šJDK ä»£ç†ç±»ï¼Œé€šè¿‡ Proxy.newProxyInstance() æ–¹æ³•åŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</li><li>InvocationHandler ç±»ï¼šJDK è°ƒç”¨å¤„ç†å™¨æ¥å£ï¼Œæ­¤æ¥å£éœ€è¦è¢«å®ç°ã€‚</li></ul></li><li>æ³¨æ„<ul><li>åªèƒ½ä»£ç†å®ç°äº†æ¥å£çš„ç±»</li><li>ä¸€ä¸ªåŠ¨æ€ä»£ç† ä»£ç†çš„æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå¯¹åº”çš„ä¸€ç±»ä¸šåŠ¡ï¼ˆè¿™äº›ç±»éƒ½å®ç°è¿™ä¸ªæ¥å£ï¼‰</li></ul></li></ul><h5 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h5><p><code>JdkHandler.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * JDKåŠ¨æ€ä»£ç†ç±» *      æ¯ä¸€ä¸ªä»£ç†ç±»éƒ½éœ€å®ç°InvocationHandleræ¥å£ *      new JdkHandler(ç›®æ ‡å¯¹è±¡).getProxy() åŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡ *      Proxyç±»ï¼šæä¾›åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å’Œå®ä¾‹çš„é™æ€æ–¹æ³•Proxy.newProxyInstance() ç”ŸæˆåŠ¨æ€ä»£ç†å®ä¾‹ *      InvocationHandlerç±»ï¼šè°ƒç”¨å¤„ç†ç¨‹åºå¹¶è¿”å›ç»“æœ */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdkHandler</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{</span>    <span class="token comment">// ç›®æ ‡å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span> <span class="token comment">// ç›®æ ‡å¯¹è±¡çš„ç±»å‹ä¸å›ºå®šï¼Œåˆ›å»ºæ—¶åŠ¨æ€ç”Ÿæˆ</span>    <span class="token comment">// é€šè¿‡å¸¦å‚æ„é€ å™¨ä¼ é€’ç›®æ ‡å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token class-name">JdkHandler</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * 1. è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• ï¼ˆè¿”å›Objectï¼‰     * 2. å¢å¼ºç›®æ ‡å¯¹è±¡çš„è¡Œä¸º     * @param proxy è°ƒç”¨è¯¥æ–¹æ³•çš„ä»£ç†å®ä¾‹     * @param method ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•     * @param args ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ‰€éœ€çš„å‚æ•°     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"invokeæ–¹æ³•çš„proxyå‚æ•°ï¼š"</span> <span class="token operator">+</span> proxy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç”¨æˆ·çš„å¢å¼ºè¡Œä¸º</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===============æ–¹æ³•æ‰§è¡Œå‰"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">log</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è°ƒç”¨ç›®æ ‡å¯¹è±¡ä¸­çš„æ–¹æ³• ï¼ˆè¿”å›Objectï¼‰</span>        <span class="token class-name">Object</span> object <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç”¨æˆ·çš„å¢å¼ºè¡Œä¸º</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ–¹æ³•æ‰§è¡Œå==============="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> object<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–ä»£ç†å¯¹è±¡     *  public static Object newProxyInstance(ClassLoader loader,     *                                       Class[] interfaces,     *                                       InvocationHandler h)     *   loaderï¼šç±»åŠ è½½å™¨     *   interfacesï¼šæ¥å£æ•°ç»„      *          target.getClass().getInterfaces()ï¼šç›®æ ‡å¯¹è±¡çš„æ¥å£æ•°ç»„     *   hï¼šInvocationHandleræ¥å£ï¼ˆä¼ å…¥InvocationHandleræ¥å£çš„å®ç°ç±»ï¼‰     */</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">Object</span> object <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"getProxyè¿”å›çš„ä»£ç†å¯¹è±¡ï¼š"</span> <span class="token operator">+</span> object<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> object<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ‰§è¡Œäº†"</span> <span class="token operator">+</span> msg <span class="token operator">+</span> <span class="token string">"æ–¹æ³•"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Me1.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç›®æ ‡å¯¹è±¡ *    å®ç°è¡Œä¸º */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Me1</span> <span class="token keyword">implements</span> <span class="token class-name">Marry</span> <span class="token punctuation">{</span>    <span class="token comment">// å®ç°è¡Œä¸º</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¦ç»“å©šå•¦..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Me2.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * ç›®æ ‡å¯¹è±¡ *    å®ç°è¡Œä¸º */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Me2</span> <span class="token keyword">implements</span> <span class="token class-name">Marry</span> <span class="token punctuation">{</span>    <span class="token comment">// å®ç°è¡Œä¸º</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">toMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¦ç»“å©šå•¦..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æˆ‘è¦ç»“å©šå•¦..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>JdkHandlerTest.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdkHandlerTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// è¾“å‡ºå¹¶æŸ¥çœ‹ä»£ç†å¯¹è±¡ jdk1.8</span><span class="token comment">//        System.getProperties().put("sun.misc.ProxyGenerator.saveGeneratedFiles","true");</span>        <span class="token comment">// è¾“å‡ºå¹¶æŸ¥çœ‹ä»£ç†å¯¹è±¡ jdk11</span>        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"jdk.proxy.ProxyGenerator.saveGeneratedFiles"</span><span class="token punctuation">,</span><span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç›®æ ‡å¯¹è±¡</span>        <span class="token class-name">Me</span> me <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">JdkHandler</span> jdkHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JdkHandler</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¾—åˆ°ä»£ç†å¯¹è±¡</span>        <span class="token class-name">Marry</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Marry</span><span class="token punctuation">)</span> jdkHandler<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span>        proxy<span class="token punctuation">.</span><span class="token function">toMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="invoke"><a href="#invoke" class="headerlink" title="invoke( )"></a>invoke( )</h5><p>JDK åŠ¨æ€ä»£ç†ç±»ä¸­çš„ invoke() æ˜¯æ€ä¹ˆè¢«è°ƒç”¨çš„ï¼Ÿ</p><p>ç”± JDK ä»£ç†ç±» Proxy.class åˆ›å»ºäº†åŠ¨æ€ä»£ç†ç±» <strong>$Proxy0.class</strong>ï¼ŒåŠ¨æ€ä»£ç†ç±»é€šè¿‡æ„é€ æ–¹æ³•è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œç»™æˆå‘˜å˜é‡ JDK è°ƒç”¨å¤„ç†å™¨ invocationHandler ih èµ‹å€¼ï¼Œè°ƒç”¨ç›¸åº”æ–¹æ³•æ—¶æ–¹æ³•ä½“ä¸­è°ƒç”¨äº†çˆ¶ç±»ä¸­çš„æˆå‘˜å˜é‡ InvocationHandler çš„ invoke() æ–¹æ³•ã€‚</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811211918.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811211920.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811211922.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// ä»£ç†å¯¹è±¡</span><span class="token comment">// Source code recreated from a .class file by IntelliJ IDEA</span><span class="token comment">// (powered by Fernflower decompiler)</span><span class="token comment">//</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> $<span class="token class-name">Proxy0</span> <span class="token keyword">extends</span> <span class="token class-name">Proxy</span> <span class="token keyword">implements</span> <span class="token class-name">Marry</span> <span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> m1<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> m2<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> m3<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Method</span> m0<span class="token punctuation">;</span>    <span class="token keyword">public</span> $<span class="token class-name">Proxy0</span><span class="token punctuation">(</span><span class="token class-name">InvocationHandler</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>        <span class="token keyword">super</span><span class="token punctuation">(</span>var1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> <span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">Object</span> var1<span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Boolean</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m1<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span>var1<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> var3<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var4<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>var4<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> var2<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>var3<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">toMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">super</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m3<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> var2<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>var3<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">int</span> <span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">)</span><span class="token keyword">super</span><span class="token punctuation">.</span>h<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> m0<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> <span class="token operator">|</span> <span class="token class-name">Error</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> var2<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UndeclaredThrowableException</span><span class="token punctuation">(</span>var3<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token punctuation">{</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            m1 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Object"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"equals"</span><span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Object"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            m2 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Object"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"toString"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            m3 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.xxxx.proxy.Marry"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"toMarry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            m0 <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.Object"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"hashCode"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NoSuchMethodException</span> var2<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchMethodError</span><span class="token punctuation">(</span>var2<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> var3<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoClassDefFoundError</span><span class="token punctuation">(</span>var3<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="invoke-è¿”å›å€¼"><a href="#invoke-è¿”å›å€¼" class="headerlink" title="invoke( ) è¿”å›å€¼"></a>invoke( ) è¿”å›å€¼</h5><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811212716.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811212719.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811212722.png"></p><h4 id="CGLIBï¼ˆç»§æ‰¿ç±»ï¼‰"><a href="#CGLIBï¼ˆç»§æ‰¿ç±»ï¼‰" class="headerlink" title="CGLIBï¼ˆç»§æ‰¿ç±»ï¼‰"></a>CGLIBï¼ˆç»§æ‰¿ç±»ï¼‰</h4><ul><li>æ¦‚å¿µï¼šèƒ½ä»£ç†æ²¡æœ‰å®ç°æ¥å£çš„ç±»ï¼Œå¯¹æŒ‡å®šç›®æ ‡ç±»ç”Ÿæˆä¸€ä¸ªå­ç±»ï¼Œå¹¶è¦†ç›–å…¶ä¸­æ–¹æ³•å®ç°å¢å¼ºï¼ŒåŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡ã€‚</li><li>æ€æƒ³ï¼šç»§æ‰¿ç±» Enhancer ã€‚</li><li>ä½œç”¨ï¼šæé«˜å¼€å‘æ•ˆç‡ï¼Œæ‰¹é‡åŒ–åˆ›å»ºä»£ç†ï¼Œæé«˜ä»£ç å¤ç”¨ç‡ã€‚</li><li>æ³¨æ„ï¼šèƒ½ä»£ç†æ‰€æœ‰é™¤äº† final ç±»ä¹‹å¤–çš„ç±»ã€‚</li></ul><h5 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h5><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cglib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>cglib<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>CglibInterceptor.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CglibInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{</span>    <span class="token comment">// ç›®æ ‡å¯¹è±¡</span>    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>    <span class="token comment">// é€šè¿‡æ„é€ å™¨ä¼ å…¥ç›®æ ‡å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token class-name">CglibInterceptor</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è·å–ä»£ç†å¯¹è±¡     *     * @return     */</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// é€šè¿‡Enhancerå¯¹è±¡ä¸­çš„create()æ–¹æ³•ç”Ÿæˆä¸€ä¸ªç±»ï¼Œç”¨äºç”Ÿæˆä»£ç†å¯¹è±¡</span>        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®çˆ¶ç±» ï¼ˆå°†ç›®æ ‡ç±»ä½œä¸ºä»£ç†ç±»çš„çˆ¶ç±»ï¼‰</span>        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è®¾ç½®æ‹¦æˆªå™¨ å›è°ƒå¯¹è±¡ä¸ºæœ¬èº«å¯¹è±¡</span>        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// ç”Ÿæˆä»£ç†ç±»å¯¹è±¡ï¼Œå¹¶è¿”å›ç»™è°ƒç”¨è€…</span>        <span class="token keyword">return</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æ‹¦æˆªå™¨     * 1. ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨     * 2. è¡Œä¸ºå¢å¼º     *     * @param o           cglibåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„å®ä¾‹     * @param method      å®ä½“ç±»æ‰€è°ƒç”¨çš„éƒ½è¢«ä»£ç†çš„æ–¹æ³•çš„å¼•ç”¨     * @param objects     å‚æ•°åˆ—è¡¨     * @param methodProxy ç”Ÿæˆçš„ä»£ç†ç±»å¯¹æ–¹æ³•çš„ä»£ç†å¼•ç”¨     * @return     * @throws Throwable     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> objects<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>        <span class="token comment">// å¢å¼ºè¡Œä¸º</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"===================æ–¹æ³•å‰æ‰§è¡Œ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// è°ƒç”¨ç›®æ ‡ç±»ä¸­çš„æ–¹æ³•</span>        <span class="token class-name">Object</span> object <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> objects<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¢å¼ºè¡Œä¸º</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ–¹æ³•åæ‰§è¡Œ==================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> object<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CglibInterceptorTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// å¾—åˆ°ç›®æ ‡å¯¹è±¡</span>        <span class="token class-name">Me</span> me <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Me</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¾—åˆ°æ‹¦æˆªå™¨</span>        <span class="token class-name">CglibInterceptor</span> cglibInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CglibInterceptor</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å¾—åˆ°ä»£ç†å¯¹è±¡</span>        <span class="token class-name">Marry</span> marry  <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Marry</span><span class="token punctuation">)</span> cglibInterceptor<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡ä¸­çš„æ–¹æ³•</span>        marry<span class="token punctuation">.</span><span class="token function">toMarry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æŠ¥é”™</code></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811213037.png"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811213049.png"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">--</span>illegal<span class="token operator">-</span>access<span class="token operator">=</span>deny <span class="token operator">--</span>add<span class="token operator">-</span><span class="token keyword">opens</span> <span class="token namespace">java<span class="token punctuation">.</span>base</span><span class="token operator">/</span>java<span class="token punctuation">.</span>lang<span class="token operator">=</span>ALL<span class="token operator">-</span>UNNAMED<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811213052.png"></p><h4 id="Javaï¼ˆå­—èŠ‚ç ï¼‰"><a href="#Javaï¼ˆå­—èŠ‚ç ï¼‰" class="headerlink" title="Javaï¼ˆå­—èŠ‚ç ï¼‰"></a>Javaï¼ˆå­—èŠ‚ç ï¼‰</h4><p>å¾…æ—¥åè¡¥ä¸Šâ€¦</p><h3 id="JDK-å’Œ-CGLIB-çš„åŒºåˆ«"><a href="#JDK-å’Œ-CGLIB-çš„åŒºåˆ«" class="headerlink" title="JDK å’Œ CGLIB çš„åŒºåˆ«"></a>JDK å’Œ CGLIB çš„åŒºåˆ«</h3><ul><li>æ€æƒ³ï¼šJDKï¼šæ¥å£ï¼ŒCGLIBï¼šç»§æ‰¿</li><li>æ•ˆç‡ï¼šJDK &gt; CGLIB</li><li>é€‰æ‹©ï¼šè‹¥ç›®æ ‡å¯¹è±¡æ˜¯å®ç°äº†æ¥å£çš„ç±»ï¼šJDKï¼Œè‹¥ç›®æ ‡å¯¹è±¡æ˜¯æœªå®ç°æ¥å£çš„ç±»ï¼šCGLIB</li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ²¡æœ‰å®ç°æ¥å£çš„ç±»çš„æ–¹æ³•..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CglibInterceptorTest</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">/*é€šè¿‡CglibåŠ¨æ€ä»£ç†å®ç°ï¼šæ²¡æœ‰å®ç°æ¥å£çš„ç±»*/</span>        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">CglibInterceptor</span> cglibInterceptor02 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CglibInterceptor</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">User</span> u <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> cglibInterceptor02<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        u<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">/*é€šè¿‡JDKåŠ¨æ€ä»£ç†å®ç°ï¼šæ²¡æœ‰å®ç°æ¥å£çš„ç±»*/</span><span class="token comment">//        User user = new User();</span><span class="token comment">//        JdkHandler jdkHandler = new JdkHandler(user);</span><span class="token comment">//        User u = (User) jdkHandler.getProxy();</span><span class="token comment">//        u.test(); // æŠ¥é”™ï¼šclass com.sun.proxy.$Proxy0 cannot be cast to class com.xxxx.proxy.User</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="SpringBoot-æµ‹è¯•-æ³¨è§£"><a href="#SpringBoot-æµ‹è¯•-æ³¨è§£" class="headerlink" title="SpringBoot æµ‹è¯• æ³¨è§£"></a>SpringBoot æµ‹è¯• æ³¨è§£</h2><h3 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h3><p><code>pom.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.aspectj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aspectjweaver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.9.6<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>applicationContext.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/context<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/aop<span class="token punctuation">"</span></span>       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.springframework.org/schema/beans       https://www.springframework.org/schema/beans/spring-beans.xsd       http://www.springframework.org/schema/context       http://www.springframework.org/schema/context/spring-context.xsd       http://www.springframework.org/schema/aop       http://www.springframework.org/schema/aop/spring-aop.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.UserService<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>log<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.log.Log<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- proxy-target-class="false" é»˜è®¤falseï¼šJDK åä¹‹trueï¼šCGLIB --&gt;</span>    <span class="token comment">&lt;!-- AOPè‡ªåŠ¨ä»£ç†ï¼šæ³¨è§£ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token comment">&lt;!-- è‡ªåŠ¨æ‰«æï¼šæ‰«ææŒ‡å®šåŒ…ï¼Œè®©æ­¤åŒ…ä¸‹çš„æ³¨è§£ç”Ÿæ•ˆï¼ˆå¯çœç•¥é…ç½®Beanå¯¹è±¡ï¼‰ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!-- è‡ªåŠ¨è£…é…ï¼šæ³¨è§£ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>annotation-config</span><span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!-- AOPè‡ªåŠ¨ä»£ç†ï¼šæ³¨è§£ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h3><p><code>Log.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">/** * åˆ‡é¢ *      åˆ‡å…¥ç‚¹å’Œé€šçŸ¥çš„æŠ½è±¡ *      å®šä¹‰ åˆ‡å…¥ç‚¹  å’Œ é€šçŸ¥ *         åˆ‡å…¥ç‚¹ï¼šå®šä¹‰è¦æ‹¦æˆªå“ªäº›ç±»çš„å“ªäº›æ–¹æ³•ï¼Ÿ *         é€šçŸ¥ï¼šå®šä¹‰äº†æ‹¦æˆªåæ–¹æ³•è¦åšä»€ä¹ˆï¼Ÿ */</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Aspect</span> <span class="token comment">// æ ‡æ³¨å½“å‰ç±»ä¸ºåˆ‡é¢</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Log</span> <span class="token punctuation">{</span>    <span class="token comment">/**     * åˆ‡å…¥ç‚¹ï¼ˆæ‹¦æˆªå“ªäº›ç±»çš„å“ªäº›æ–¹æ³•ï¼Ÿï¼‰     *      @Pointcut("åŒ¹é…è§„åˆ™")     *        åŒ¹é…è§„åˆ™ï¼ˆæ‹¦æˆªå“ªäº›æ–¹æ³•ï¼Ÿï¼‰     *           1. æ‰€æœ‰å…¬å…±æ–¹æ³• xecution(public *(..))     *           2. ä»»æ„setæ–¹æ³• execution(* set*(..))     *           3. æŒ‡å®šåŒ…ä¸‹çš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³• execution(* com.xxxx.service.*.*(..))     *           4. æŒ‡å®šåŒ…åŠå­åŒ…ä¸‹çš„ä»»æ„ç±»çš„ä»»æ„æ–¹æ³• execution(* com.xxxx.service..*.*(..))     *        æ–¹æ³•ä¿®é¥°èŒƒå›´ï¼ˆpublicã€privateã€protectedã€*ï¼‰ *ï¼šè¡¨ç¤ºæ‰€æœ‰èŒƒå›´     */</span>    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* com.xxxx.service..*.*(..))"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å‰ç½®é€šçŸ¥ï¼Œå¹¶å°†é€šçŸ¥åº”ç”¨åˆ°æŒ‡å®šçš„åˆ‡å…¥ç‚¹ä¸Š     *      ç›®æ ‡ç±»çš„æ–¹æ³•æ‰§è¡Œå‰ï¼Œæ‰§è¡Œè¯¥é€šçŸ¥     */</span>    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"cut()"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å‰ç½®é€šçŸ¥..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * è¿”å›é€šçŸ¥ï¼Œå¹¶å°†é€šçŸ¥åº”ç”¨åˆ°æŒ‡å®šçš„åˆ‡å…¥ç‚¹ä¸Š     *      ç›®æ ‡ç±»çš„æ–¹æ³•æ— å¼‚å¸¸æ‰§è¡Œåï¼Œæ‰§è¡Œè¯¥é€šçŸ¥     */</span>    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"cut()"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è¿”å›é€šçŸ¥..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * æœ€ç»ˆé€šçŸ¥ï¼Œå¹¶å°†é€šçŸ¥åº”ç”¨åˆ°æŒ‡å®šçš„åˆ‡å…¥ç‚¹ä¸Š     *      ç›®æ ‡ç±»çš„æ–¹æ³•åœ¨æ‰§è¡Œåï¼Œæ‰§è¡Œè¯¥é€šçŸ¥ ï¼ˆæœ‰å¼‚å¸¸å’Œæ— å¼‚å¸¸æœ€ç»ˆéƒ½ä¼šæ‰§è¡Œï¼‰     */</span>    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"cut()"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æœ€ç»ˆé€šçŸ¥..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * å¼‚å¸¸é€šçŸ¥ï¼Œå¹¶å°†é€šçŸ¥åº”ç”¨åˆ°æŒ‡å®šçš„åˆ‡å…¥ç‚¹ä¸Š     *      ç›®æ ‡ç±»çš„æ–¹æ³•åœ¨æ‰§è¡Œå¼‚å¸¸æ—¶ï¼Œæ‰§è¡Œè¯¥é€šçŸ¥     */</span>    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"cut()"</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">"e"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrow</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"å¼‚å¸¸é€šçŸ¥...  ===== å¼‚å¸¸åŸå› ï¼š"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">/**     * ç¯ç»•é€šçŸ¥ï¼Œå¹¶å°†é€šçŸ¥åº”ç”¨åˆ°æŒ‡å®šçš„åˆ‡å…¥ç‚¹ä¸Š     *      ç›®æ ‡ç±»çš„æ–¹æ³•æ‰§è¡Œå‰åï¼Œéƒ½å¯é€šè¿‡ç¯ç»•é€šçŸ¥å®šä¹‰å“åº”çš„å¤„ç†     *          éœ€è¦é€šè¿‡æ˜¾å¼è°ƒç”¨çš„æ–¹æ³•ï¼Œå¦åˆ™æ— æ³•è®¿é—®æŒ‡å®šæ–¹æ³• pjp.proceed();     * @param pjp     * @return     */</span>    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"cut()"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span>  <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¯ç»•é€šçŸ¥-å‰ç½®é€šçŸ¥..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> object <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>        <span class="token comment">//object = pjp.proceed();</span>        <span class="token keyword">try</span><span class="token punctuation">{</span>            <span class="token comment">// æ˜¾å¼è°ƒç”¨å¯¹åº”çš„æ–¹æ³•</span>            object <span class="token operator">=</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pjp<span class="token punctuation">.</span><span class="token function">getTarget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¯ç»•é€šçŸ¥-è¿”å›é€šçŸ¥..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span><span class="token punctuation">{</span>            throwable<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¯ç»•é€šçŸ¥-å¼‚å¸¸é€šçŸ¥..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"ç¯ç»•é€šçŸ¥-åç½®é€šçŸ¥..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> object<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>UserService.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"UserService Test..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>userService<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210811213422.png"></p><h2 id="SpringBoot-æµ‹è¯•-XML"><a href="#SpringBoot-æµ‹è¯•-XML" class="headerlink" title="SpringBoot æµ‹è¯• XML"></a>SpringBoot æµ‹è¯• XML</h2><h3 id="è‡ªå®šä¹‰ç±»"><a href="#è‡ªå®šä¹‰ç±»" class="headerlink" title="è‡ªå®šä¹‰ç±»"></a>è‡ªå®šä¹‰ç±»</h3><p><code>BeforeLog.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeforeLog</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"æ–¹æ³•æ‰§è¡Œå‰..."</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>application.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.UserService<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beforeLog<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.log.BeforeLog<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!-- AOPåˆ‡å…¥ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- åˆ‡é¢ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspect</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beforeLog<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token comment">&lt;!-- åˆ‡å…¥ç‚¹ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pc<span class="token punctuation">"</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>execution(* com.xxxx.service.UserServiceImpl.*(..))<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>        <span class="token comment">&lt;!-- é€šçŸ¥ï¼ˆæŠŠBeforeLogç±»çš„beforeæ–¹æ³•åˆ‡å…¥åˆ°UserServiceImplç±»é‡Œï¼‰ --&gt;</span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>before<span class="token punctuation">"</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pc<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspect</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Test.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">CPX</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">UserService</span> userSevice <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>userService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="åŸç”Ÿ-Spring-API"><a href="#åŸç”Ÿ-Spring-API" class="headerlink" title="åŸç”Ÿ Spring API"></a>åŸç”Ÿ Spring API</h3><p><code>BeforeLog.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeforeLog</span> <span class="token keyword">implements</span> <span class="token class-name">MethodBeforeAdvice</span> <span class="token punctuation">{</span>    <span class="token comment">// methodï¼š ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•</span>    <span class="token comment">// argsï¼š ç›®æ ‡å¯¹è±¡çš„æ–¹æ³•çš„å‚æ•°</span>    <span class="token comment">// targetï¼š ç›®æ ‡å¯¹è±¡</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>target<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"çš„"</span><span class="token operator">+</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"è¢«æ‰§è¡Œäº†"</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>application.xml</code></p><pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userService<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.service.UserService<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beforeLog<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.xxxx.log.BeforeLog<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span class="token comment">&lt;!-- AOPåˆ‡å…¥ --&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>    <span class="token comment">&lt;!-- åˆ‡å…¥ç‚¹ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pointcut<span class="token punctuation">"</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>execution(* com.xxxx.service.UserServiceImpl.*(..))<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>    <span class="token comment">&lt;!-- é€šçŸ¥ï¼ˆæŠŠBeforeLogç±»åˆ‡å…¥åˆ°UserServiceImplç±»é‡Œï¼‰ --&gt;</span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>advisor</span> <span class="token attr-name">advice-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>beforeLog<span class="token punctuation">"</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pointcut<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>Test.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> ac <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">CPX</span><span class="token punctuation">(</span><span class="token string">"applicationContext.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">UserService</span> userSevice <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> ac<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userService"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>userService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
            <tag> Spring AOP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring</title>
      <link href="/2020/01/01/spring/"/>
      <url>/2020/01/01/spring/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><p>åŸºäºåˆ†å±‚çš„ JavaEE çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºã€è½»é‡çº§å¼€æºæ¡†æ¶ï¼ˆSSMä¹‹ä¸€ï¼‰</p><p><span class="github-emoji"><span>ğŸ“Œ</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/1f4cc.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ä½œç”¨ï¼šè§£è€¦ï¼Œå³é«˜å†…èšä½è€¦åˆï¼Œé™ä½ç»„ä»¶ä¹‹é—´çš„è€¦åˆåº¦ï¼Œå®ç°è½¯ä»¶å„å±‚ä¹‹é—´çš„è§£è€¦ï¼Œæé«˜é¡¹ç›®å¼€å‘æ•ˆç‡ã€‚</p><h2 id="ä¸ƒå¤§æ¨¡å—"><a href="#ä¸ƒå¤§æ¨¡å—" class="headerlink" title="ä¸ƒå¤§æ¨¡å—"></a>ä¸ƒå¤§æ¨¡å—</h2><p>Coreã€Contextã€AOPã€MVCã€Webã€ORMã€DAO</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818225110.png"></p><h2 id="ç°ä»£å¼€å‘"><a href="#ç°ä»£å¼€å‘" class="headerlink" title="ç°ä»£å¼€å‘"></a>ç°ä»£å¼€å‘</h2><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818225220.png"></p><pre class="line-numbers language-none"><code class="language-none">Spring Bootå¿«é€Ÿå¼€å‘è„šæ‰‹æ¶ï¼Œå¯ä»¥å¿«é€Ÿå¼€å‘å•ä¸ªå¾®æœåŠ¡ï¼ˆçº¦å®šå¤§äºé…ç½®ï¼‰Spring CloudåŸºäºSpring Boot<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Controller-å’Œ-RestController"><a href="#Controller-å’Œ-RestController" class="headerlink" title="@Controller å’Œ @RestController"></a>@Controller å’Œ @RestController</h2><p>@Controllerï¼šè¿”å›â¼€ä¸ªâ»šâ¾¯</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818225641.png"></p><p>@RestControllerï¼šè¿”å›JSON æˆ– XML å½¢å¼æ•°æ®</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818225643.png"></p><p>@Controller   + @ResponseBody  =  @RestController</p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818225646.png"></p><h2 id="Spring-Bean-çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#Spring-Bean-çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ"></a>Spring Bean çš„ç”Ÿå‘½å‘¨æœŸ</h2><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210819222553.png"></p><p>Springä¼šæ‰«ææŒ‡å®šåŒ…ä¸‹é¢çš„æ™®é€š Java ç±»ï¼Œå°†å…¶å˜æˆ beanDefinition å¯¹è±¡ï¼Œç„¶ååˆ›å»º Spring Bean å¯¹è±¡ã€‚</p><p>ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨å¯¹è±¡çš„classå¯¹è±¡æ¥åˆ›å»ºbeanå‘¢ï¼Ÿ</p><p>å› ä¸ºåœ¨classå¯¹è±¡ä»…ä»…èƒ½æè¿°ä¸€ä¸ªå¯¹è±¡çš„åˆ›å»ºï¼Œå®ƒä¸è¶³ä»¥ç”¨æ¥æè¿°ä¸€ä¸ªSpring beanï¼Œè€Œå¯¹äºæ˜¯å¦ä¸ºæ‡’åŠ è½½ã€æ˜¯å¦æ˜¯é¦–è¦çš„ã€åˆå§‹åŒ–æ–¹æ³•æ˜¯å“ªä¸ªã€é”€æ¯æ–¹æ³•æ˜¯å“ªä¸ªï¼Œè¿™ä¸ªSpringä¸­ç‰¹æœ‰çš„å±æ€§åœ¨classå¯¹è±¡ä¸­å¹¶æ²¡æœ‰ã€‚</p><h3 id="æ™®é€š-Java-ç±»-gt-Bean-å®šä¹‰å¯¹è±¡"><a href="#æ™®é€š-Java-ç±»-gt-Bean-å®šä¹‰å¯¹è±¡" class="headerlink" title="æ™®é€š Java ç±» -> Bean å®šä¹‰å¯¹è±¡"></a>æ™®é€š Java ç±» -&gt; Bean å®šä¹‰å¯¹è±¡</h3><h4 id="æŠ½è±¡åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„-refresh-æ–¹æ³•"><a href="#æŠ½è±¡åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„-refresh-æ–¹æ³•" class="headerlink" title="æŠ½è±¡åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ refresh( ) æ–¹æ³•"></a>æŠ½è±¡åº”ç”¨ä¸Šä¸‹æ–‡ä¸­çš„ refresh( ) æ–¹æ³•</h4><p><code>AbstractApplicationContext.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Override</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">,</span> <span class="token class-name">IllegalStateException</span> <span class="token punctuation">{</span>    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>startupShutdownMonitor<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// å‡†å¤‡ä¸Šä¸‹æ–‡</span>        <span class="token function">prepareRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å‘Šè¯‰å­ç±»åˆ·æ–°å†…éƒ¨ Bean å·¥å‚</span>        <span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory <span class="token operator">=</span> <span class="token function">obtainFreshBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// å‡†å¤‡ Bean å·¥å‚</span>        <span class="token function">prepareBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>            <span class="token comment">// å…è®¸åœ¨ä¸Šä¸‹æ–‡å­ç±»ä¸­å¯¹ Bean å·¥å‚è¿›è¡Œåç½®å¤„ç†</span>            <span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// è°ƒç”¨åœ¨ä¸Šä¸‹æ–‡ä¸­å·²è¢«æ³¨å†Œä¸º Bean çš„å·¥å‚å¤„ç†å™¨ </span>            <span class="token function">invokeBeanFactoryPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// æ³¨å†Œ Bean åç½®å¤„ç†å™¨ï¼Œç”¨æ¥æ‹¦æˆª Bean åˆ›å»º</span>            <span class="token function">registerBeanPostProcessors</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// åˆå§‹åŒ–æ¶ˆæ¯æº</span>            <span class="token function">initMessageSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// åˆå§‹åŒ–äº‹ä»¶å¤šæ’­å™¨</span>            <span class="token function">initApplicationEventMulticaster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// åˆå§‹åŒ–ç‰¹å®šä¸Šä¸‹æ–‡å­ç±»ä¸­çš„å…¶ä»–ç‰¹æ®Š beanã€‚</span>            <span class="token function">onRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// æ£€æŸ¥å¹¶æ³¨å†Œä¾¦å¬å™¨ bean </span>            <span class="token function">registerListeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å®ä¾‹åŒ–æ‰€æœ‰å‰©ä½™çš„ï¼ˆéå»¶è¿Ÿåˆå§‹åŒ–ï¼‰å•ä¾‹</span>            <span class="token function">finishBeanFactoryInitialization</span><span class="token punctuation">(</span>beanFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// æœ€åä¸€æ­¥ï¼šå‘å¸ƒç›¸åº”çš„äº‹ä»¶</span>            <span class="token function">finishRefresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BeansException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>logger<span class="token punctuation">.</span><span class="token function">isWarnEnabled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"Exception encountered during context initialization - "</span> <span class="token operator">+</span>                            <span class="token string">"cancelling refresh attempt: "</span> <span class="token operator">+</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token comment">// é”€æ¯å·²ç»åˆ›å»ºçš„å•ä¾‹ä»¥é¿å…æ‚¬ç©ºèµ„æº</span>            <span class="token function">destroyBeans</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// Reset 'active' flag.</span>            <span class="token function">cancelRefresh</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// å°†å¼‚å¸¸ä¼ æ’­ç»™è°ƒç”¨è€…</span>            <span class="token keyword">throw</span> ex<span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">finally</span> <span class="token punctuation">{</span>            <span class="token comment">// é‡ç½® Spring æ ¸å¿ƒä¸­çš„å¸¸è§å†…çœç¼“å­˜ï¼Œå› ä¸ºå¯èƒ½ä¸å†éœ€è¦å•ä¾‹ bean çš„å…ƒæ•°æ®</span>            <span class="token function">resetCommonCaches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="è°ƒç”¨-Bean-å·¥å‚çš„åç½®å¤„ç†å™¨-invokeBeanFactoryPostProcessors"><a href="#è°ƒç”¨-Bean-å·¥å‚çš„åç½®å¤„ç†å™¨-invokeBeanFactoryPostProcessors" class="headerlink" title="è°ƒç”¨ Bean å·¥å‚çš„åç½®å¤„ç†å™¨ invokeBeanFactoryPostProcessors( )"></a>è°ƒç”¨ Bean å·¥å‚çš„åç½®å¤„ç†å™¨ invokeBeanFactoryPostProcessors( )</h5><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å…ˆè°ƒç”¨ <strong>Bean å®šä¹‰å¯¹è±¡æ³¨å†Œçš„åç½®å¤„ç†å™¨</strong>ï¼ˆå­æ¥å£ï¼‰çš„ <strong>Bean å®šä¹‰å¯¹è±¡çš„æ³¨å†Œæ–¹æ³•</strong></p><p><code>BeanDefinitionRegistryPostProcessor.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanDefinitionRegistryPostProcessor</span> <span class="token keyword">extends</span> <span class="token class-name">BeanFactoryPostProcessor</span> <span class="token punctuation">{</span>    <span class="token comment">// æ‰«ææŒ‡å®šåŒ…ä¸‹çš„å¸¦æœ‰ç»„ä»¶æ³¨è§£çš„æ™®é€š Java ç±»ï¼Œå°†å…¶å˜æˆ Bean å®šä¹‰å¯¹è±¡ï¼Œæ”¾åˆ°ä¸€ä¸ª Spring çš„ Map ä¸­</span><span class="token keyword">void</span> <span class="token function">postProcessBeanDefinitionRegistry</span><span class="token punctuation">(</span><span class="token class-name">BeanDefinitionRegistry</span> registry<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å†è°ƒç”¨ <strong>Bean å·¥å‚çš„åç½®å¤„ç†å™¨</strong>ï¼ˆçˆ¶æ¥å£ï¼‰çš„ <strong>Bean å·¥å‚åç½®å¤„ç†å™¨æ–¹æ³•</strong></p><p><code>BeanFactoryPostProcessor.java</code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@FunctionalInterface</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanFactoryPostProcessor</span> <span class="token punctuation">{</span><span class="token keyword">void</span> <span class="token function">postProcessBeanFactory</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableListableBeanFactory</span> beanFactory<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h5 id="æ³¨å†Œ-Bean-å·¥å‚çš„åç½®å¤„ç†å™¨-registerBeanPostProcessors"><a href="#æ³¨å†Œ-Bean-å·¥å‚çš„åç½®å¤„ç†å™¨-registerBeanPostProcessors" class="headerlink" title="æ³¨å†Œ Bean å·¥å‚çš„åç½®å¤„ç†å™¨ registerBeanPostProcessors( )"></a>æ³¨å†Œ Bean å·¥å‚çš„åç½®å¤„ç†å™¨ registerBeanPostProcessors( )</h5><p>æ ¹æ®å®ç°äº† PriorityOrderedã€Ordered æ¥å£ï¼Œæ’åºåæ³¨å†Œæ‰€æœ‰çš„ Bean åç½®å¤„ç†å™¨ï¼Œä¸»è¦ç”¨äº Spring Bean åˆ›å»ºæ—¶ï¼Œæ‰§è¡Œè¿™äº›åç½®å¤„ç†å™¨çš„æ–¹æ³•ï¼Œè¿™ä¹Ÿæ˜¯ Spring ä¸­æä¾›çš„æ‰©å±•ç‚¹ï¼Œåœ¨æ­¤å¤„èƒ½æ’æ‰‹ Spring bean çš„åˆ›å»ºè¿‡ç¨‹ã€‚</p><h5 id="ç»“æŸ-Bean-å·¥å‚çš„åç½®å¤„ç†å™¨-finishBeanFactoryInitialization"><a href="#ç»“æŸ-Bean-å·¥å‚çš„åç½®å¤„ç†å™¨-finishBeanFactoryInitialization" class="headerlink" title="ç»“æŸ Bean å·¥å‚çš„åç½®å¤„ç†å™¨ finishBeanFactoryInitialization( )"></a>ç»“æŸ Bean å·¥å‚çš„åç½®å¤„ç†å™¨ finishBeanFactoryInitialization( )</h5><p>ç»“æŸ Bean å·¥å‚çš„åˆå§‹åŒ–ï¼Œå®Œæˆéæ‡’åŠ è½½çš„Spring beançš„åˆ›å»ºå·¥ä½œã€‚</p><h3 id="Bean-å®šä¹‰å¯¹è±¡-gt-Spring-Bean-å¯¹è±¡"><a href="#Bean-å®šä¹‰å¯¹è±¡-gt-Spring-Bean-å¯¹è±¡" class="headerlink" title="Bean å®šä¹‰å¯¹è±¡ -> Spring Bean å¯¹è±¡"></a>Bean å®šä¹‰å¯¹è±¡ -&gt; Spring Bean å¯¹è±¡</h3><h5 id="æµç¨‹-1"><a href="#æµç¨‹-1" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h5><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210820155828.png"></p><p><strong>4ä¸ªåç½®å¤„ç†å™¨æ¥å£ + 8ä¸ªåç½®å¤„ç†å™¨çš„æ–¹æ³• è´¯ç©¿åœ¨ Bean å¯¹è±¡çš„å®ä¾‹åŒ–ã€å±æ€§èµ‹å€¼ã€åˆå§‹åŒ–ã€é”€æ¯çš„è¿‡ç¨‹ä¸­ã€‚</strong></p><h5 id="4ä¸ªåç½®å¤„ç†å™¨æ¥å£"><a href="#4ä¸ªåç½®å¤„ç†å™¨æ¥å£" class="headerlink" title="4ä¸ªåç½®å¤„ç†å™¨æ¥å£"></a>4ä¸ªåç½®å¤„ç†å™¨æ¥å£</h5><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210820121149.png"></p><h6 id="BeanPostProcessor"><a href="#BeanPostProcessor" class="headerlink" title="BeanPostProcessor"></a>BeanPostProcessor</h6><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Nullable</span><span class="token keyword">default</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span><span class="token keyword">return</span> bean<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Nullable</span><span class="token keyword">default</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span><span class="token keyword">return</span> bean<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="InstantiationAwareBeanPostProcessor"><a href="#InstantiationAwareBeanPostProcessor" class="headerlink" title="InstantiationAwareBeanPostProcessor"></a>InstantiationAwareBeanPostProcessor</h6><p>å®ä¾‹åŒ–å·²çŸ¥çš„ Bean åç½®å¤„ç†å™¨ã€‚</p><p>å†…éƒ¨æä¾›äº†3ä¸ªæ–¹æ³•ï¼Œå†åŠ ä¸ŠBeanPostProcessoræ¥å£å†…éƒ¨çš„2ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥å®ç°è¿™ä¸ªæ¥å£éœ€è¦å®ç°5ä¸ªæ–¹æ³•ã€‚</p><p>ä½œç”¨ï¼šç›®æ ‡å¯¹è±¡çš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­éœ€è¦å¤„ç†çš„äº‹æƒ…ï¼ŒåŒ…æ‹¬å®ä¾‹åŒ–å¯¹è±¡çš„å‰åè¿‡ç¨‹ä»¥åŠå®ä¾‹çš„å±æ€§è®¾ç½®</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InstantiationAwareBeanPostProcessor</span> <span class="token keyword">extends</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Nullable</span><span class="token keyword">default</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInstantiation</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">postProcessAfterInstantiation</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Nullable</span><span class="token keyword">default</span> <span class="token class-name">PropertyValues</span> <span class="token function">postProcessProperties</span><span class="token punctuation">(</span><span class="token class-name">PropertyValues</span> pvs<span class="token punctuation">,</span> <span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory#createBean()æ–¹æ³•çš„Object bean = resolveBeforeInstantiation(beanName, mbdToUse);æ–¹æ³•é‡Œé¢æ‰§è¡Œäº†è¿™ä¸ªåç½®å¤„ç†å™¨</p><h6 id="SmartInstantiationAwareBeanPostProcessor"><a href="#SmartInstantiationAwareBeanPostProcessor" class="headerlink" title="SmartInstantiationAwareBeanPostProcessor"></a>SmartInstantiationAwareBeanPostProcessor</h6><p>æ™ºèƒ½å®ä¾‹åŒ–å·²çŸ¥çš„ Bean åç½®å¤„ç†å™¨ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SmartInstantiationAwareBeanPostProcessor</span> <span class="token keyword">extends</span> <span class="token class-name">InstantiationAwareBeanPostProcessor</span> <span class="token punctuation">{</span><span class="token annotation punctuation">@Nullable</span><span class="token keyword">default</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">predictBeanType</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token annotation punctuation">@Nullable</span><span class="token keyword">default</span> <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">determineCandidateConstructors</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanClass<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">default</span> <span class="token class-name">Object</span> <span class="token function">getEarlyBeanReference</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">{</span><span class="token keyword">return</span> bean<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h6 id="MergedBeanDefinitionPostProcessor"><a href="#MergedBeanDefinitionPostProcessor" class="headerlink" title="MergedBeanDefinitionPostProcessor"></a>MergedBeanDefinitionPostProcessor</h6><p>åˆå¹¶ Bean å®šä¹‰å¯¹è±¡çš„åç½®å¤„ç†å™¨ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MergedBeanDefinitionPostProcessor</span> <span class="token keyword">extends</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">{</span><span class="token keyword">void</span> <span class="token function">postProcessMergedBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">RootBeanDefinition</span> beanDefinition<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> beanType<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">resetBeanDefinition</span><span class="token punctuation">(</span><span class="token class-name">String</span> beanName<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h6 id="SmartInitializingSingleton"><a href="#SmartInitializingSingleton" class="headerlink" title="SmartInitializingSingleton"></a>SmartInitializingSingleton</h6><p>æ™ºèƒ½åˆå§‹åŒ–å•ä¾‹ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨æ‰€æœ‰çš„éæ‡’åŠ è½½å•å®ä¾‹beanéƒ½æˆåŠŸåˆ›å»ºå¹¶ä¸”æ”¾åˆ°Spring IOCå®¹å™¨ä¹‹åè¿›è¡Œæ‰§è¡Œçš„ã€‚</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SmartInitializingSingleton</span> <span class="token punctuation">{</span><span class="token keyword">void</span> <span class="token function">afterSingletonsInstantiated</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="8ä¸ªåç½®å¤„ç†å™¨çš„æ–¹æ³•"><a href="#8ä¸ªåç½®å¤„ç†å™¨çš„æ–¹æ³•" class="headerlink" title="8ä¸ªåç½®å¤„ç†å™¨çš„æ–¹æ³•"></a>8ä¸ªåç½®å¤„ç†å™¨çš„æ–¹æ³•</h5><h6 id="1-InstantiationAwareBeanPostProcessor-çš„-postProcessBeforeInstantiation"><a href="#1-InstantiationAwareBeanPostProcessor-çš„-postProcessBeforeInstantiation" class="headerlink" title="1. InstantiationAwareBeanPostProcessor çš„ postProcessBeforeInstantiation( )"></a>1. InstantiationAwareBeanPostProcessor çš„ postProcessBeforeInstantiation( )</h6><p>æ—¶æœºï¼šåœ¨ Bean å¯¹è±¡å®ä¾‹åŒ–ä¹‹å‰ã€‚</p><p>ä½œç”¨ï¼šè·å–å·²çŸ¥çš„ Bean çš„å®ä¾‹å¯¹è±¡ï¼Œè‹¥æˆåŠŸè·å–ï¼Œåˆ™è¿™ä¸ªè¿”å›å€¼å¯ä»¥ä½œä¸ºå½“å‰è¯¥ç”Ÿæˆçš„ç›®æ ‡å¯¹è±¡ï¼Œå³å½“å‰ Bean å®ä¾‹ï¼Œåç»­åªéœ€è°ƒç”¨ 5.å’Œ8. postProcessAfterInitialization æ–¹æ³•ï¼›å¦åˆ™æŒ‰ç…§æ­£å¸¸çš„è°ƒç”¨æµç¨‹èµ°ã€‚</p><h6 id="2-SmartInstantiationAwareBeanPostProcessor-çš„-determineCandidateConstructors"><a href="#2-SmartInstantiationAwareBeanPostProcessor-çš„-determineCandidateConstructors" class="headerlink" title="2. SmartInstantiationAwareBeanPostProcessor çš„ determineCandidateConstructors( )"></a>2. SmartInstantiationAwareBeanPostProcessor çš„ determineCandidateConstructors( )</h6><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210820144506.png"></p><p>æ—¶æœºï¼šåœ¨ Bean å¯¹è±¡å®ä¾‹åŒ–ä¹‹å‰ã€‚</p><p>ä½œç”¨ï¼šSpring æä¾›çš„ Bean å€™é€‰æ„é€ å™¨æ¥å£ï¼Œè¿”å› Bean å€™é€‰æ„é€ å™¨åˆ—è¡¨ï¼Œå…è®¸å¼€å‘è€…è‡ªå®šä¹‰å†³å®šä½¿ç”¨å“ªä¸ªå€™é€‰æ„é€ å™¨ã€‚</p><p>å®ç°ç±»ï¼šAutowiredAnnotationBeanPostProcessã€‚</p><p>å®ç°ï¼šè¿”å› Bean å€™é€‰çš„æ„é€ å™¨æ¥å£ï¼Œè¿”å›æ„é€ å™¨ä¸­æ ‡æ³¨äº†@Autowired æ³¨è§£çš„çš„æ–¹æ³•ï¼ŒæŸ¥æ‰¾æœ€é€‚åˆåˆ›å»º Bean çš„æ„é€ å™¨ã€‚</p><h6 id="3-MergedBeanDefinitionPostProcessor-çš„-postProcessMergedBeanDefinition"><a href="#3-MergedBeanDefinitionPostProcessor-çš„-postProcessMergedBeanDefinition" class="headerlink" title="3. MergedBeanDefinitionPostProcessor çš„ postProcessMergedBeanDefinition( )"></a>3. MergedBeanDefinitionPostProcessor çš„ postProcessMergedBeanDefinition( )</h6><p>æ—¶æœºï¼šåœ¨ Bean å¯¹è±¡å®ä¾‹åŒ–ä¹‹åã€‚</p><p>ä½œç”¨ï¼šæŸ¥æ‰¾å¹¶ç¼“å­˜ Bean æ³¨å…¥ä¿¡æ¯ï¼Œæ­¤æ—¶ä»æœªå®Œæˆæ³¨å…¥ã€‚</p><h6 id="4-SmartInstantiationAwareBeanPostProcessor-çš„-getEarlyBeanReference"><a href="#4-SmartInstantiationAwareBeanPostProcessor-çš„-getEarlyBeanReference" class="headerlink" title="4. SmartInstantiationAwareBeanPostProcessor çš„ getEarlyBeanReference( )"></a>4. SmartInstantiationAwareBeanPostProcessor çš„ getEarlyBeanReference( )</h6><p>æ—¶æœºï¼šåœ¨ Bean å¯¹è±¡å®ä¾‹åŒ–ä¹‹åã€‚</p><p>ä½œç”¨ï¼šè·å¾—æå‰æš´éœ²çš„ Bean å¼•ç”¨ï¼Œè§£å†³å±æ€§çš„å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œåªæœ‰å•ä¾‹å¯¹è±¡æ‰ä¼šè°ƒç”¨æ­¤æ–¹æ³•ã€‚</p><h6 id="5-InstantiationAwareBeanPostProcessor-çš„-postProcessAfterInstantiation"><a href="#5-InstantiationAwareBeanPostProcessor-çš„-postProcessAfterInstantiation" class="headerlink" title="5. InstantiationAwareBeanPostProcessor çš„ postProcessAfterInstantiation( )"></a>5. InstantiationAwareBeanPostProcessor çš„ postProcessAfterInstantiation( )</h6><p>æ—¶æœºï¼šåœ¨ Bean å¯¹è±¡å®ä¾‹åŒ–ä¹‹åã€‚</p><p>ä½œç”¨ï¼šåˆ¤æ–­æ˜¯å¦ç»™ Bean å¯¹è±¡æ³¨å…¥å±æ€§ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å› falseï¼Œä¼šå¿½ç•¥å±æ€§å€¼çš„è®¾ç½®ï¼›å¦‚æœè¿”å›trueï¼Œä¼šæŒ‰ç…§æ­£å¸¸æµç¨‹è®¾ç½®å±æ€§å€¼ã€‚</p><h6 id="6-InstantiationAwareBeanPostProcessor-çš„-postProcessProperties"><a href="#6-InstantiationAwareBeanPostProcessor-çš„-postProcessProperties" class="headerlink" title="6. InstantiationAwareBeanPostProcessor çš„ postProcessProperties( )"></a>6. InstantiationAwareBeanPostProcessor çš„ postProcessProperties( )</h6><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210820150427.png"></p><p>ä½œç”¨ï¼šBean å±æ€§èµ‹å€¼ã€‚</p><p>å®ç°ç±»ï¼š</p><p>AutowiredAnnotationBeanPostProcessor ï¼šå¯¹ @Autowire  @Value æ ‡æ³¨çš„å­—æ®µå’Œæ–¹æ³•æ³¨å…¥å€¼ã€‚</p><p>CommonAnnotationBeanPostProcessor ï¼š å¯¹ @Resource æ ‡æ³¨çš„å­—æ®µå’Œæ–¹æ³•æ³¨å…¥å€¼ã€‚</p><h6 id="7-BeanPostProcessor-çš„-postProcessBeforeInitialization"><a href="#7-BeanPostProcessor-çš„-postProcessBeforeInitialization" class="headerlink" title="7. BeanPostProcessor çš„  postProcessBeforeInitialization( )"></a>7. BeanPostProcessor çš„  postProcessBeforeInitialization( )</h6><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210820151429.png"></p><p>æ—¶æœºï¼šåœ¨ Bean å¯¹è±¡åˆå§‹åŒ–ä¹‹å‰ã€‚</p><p>å®ç°ç±»ï¼š</p><p>ApplicationContextAwareProcessor ï¼š</p><p>å¦‚æœ Bean å®ç°äº†EnvironmentAwareã€EmbeddedValueResolverAwareã€ResourceLoaderAwareã€ApplicationEventPublisherAwareã€MessageSourceAwareã€ApplicationContextAware æ¥å£æ—¶ï¼Œä¼šè°ƒç”¨å…¶  postProcessBeforeInitialization( ) æ–¹æ³•å°† Aware å‰ç¼€å¯¹åº”çš„å¯¹è±¡æ³¨å…¥åˆ° Bean å¯¹è±¡ä¸­ã€‚</p><p>CommonAnnotationBeanPostProcessor ï¼šè°ƒç”¨å…¶  postProcessBeforeInitialization( ) æ–¹æ³•ï¼Œè°ƒç”¨ Bean ä¸­æ ‡æ³¨ @PostConstruct æ³¨è§£çš„æ–¹æ³•ã€‚</p><h6 id="8-BeanPostProcessor-çš„-postProcessAfterInitialization"><a href="#8-BeanPostProcessor-çš„-postProcessAfterInitialization" class="headerlink" title="8. BeanPostProcessor çš„ postProcessAfterInitialization( )"></a>8. BeanPostProcessor çš„ postProcessAfterInitialization( )</h6><p>æ—¶æœºï¼šåœ¨ Bean å¯¹è±¡åˆå§‹åŒ–ä¹‹åã€‚</p><p>ä½œç”¨ï¼šåˆ¤æ–­è¯¥ Bean å¯¹è±¡æ˜¯å¦éœ€è¦ AOP ä»£ç†å¢å¼ºï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œåˆ™ä¼šåœ¨è¯¥æ­¥éª¤è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡ã€‚</p><h6 id="9-SmartInitializingSingleton-çš„-afterSingletonsInstantiated"><a href="#9-SmartInitializingSingleton-çš„-afterSingletonsInstantiated" class="headerlink" title="9.SmartInitializingSingleton çš„ afterSingletonsInstantiated( )"></a>9.SmartInitializingSingleton çš„ afterSingletonsInstantiated( )</h6><p>è¯¥æ–¹æ³•ä¼šåœ¨æ‰€æœ‰çš„éæ‡’åŠ è½½å•å®ä¾‹ Bean éƒ½æˆåŠŸåˆ›å»ºå¹¶ä¸”æ”¾åˆ° Spring IOC å®¹å™¨ä¹‹åï¼Œä¾æ¬¡éå†æ‰€æœ‰çš„ Beanï¼Œå¦‚æœå½“å‰è¿™ä¸ª Bean æ˜¯SmartInitializingSingleton çš„å­ç±»ï¼Œé‚£ä¹ˆå°±å¼ºè½¬æˆ SmartInitializingSingleton ç±»ï¼Œç„¶åè°ƒç”¨ afterSingletonsInstantiated( ) æ–¹æ³•ã€‚</p><p>è¿™ä¸ªæ‰©å±•ç‚¹å¯ä»¥è®©æˆ‘ä»¬è‡ªå®šä¹‰æ³¨è§£ï¼Œå®Œæˆæˆ‘ä»¬æƒ³è¦å®ç°çš„é€»è¾‘ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ’åºç®—æ³•</title>
      <link href="/2019/06/01/pai-xu/"/>
      <url>/2019/06/01/pai-xu/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h2><h3 id="ç®—æ³•æ¦‚è§ˆ"><a href="#ç®—æ³•æ¦‚è§ˆ" class="headerlink" title="ç®—æ³•æ¦‚è§ˆ"></a>ç®—æ³•æ¦‚è§ˆ</h3><table><thead><tr><th>æ’åºç®—æ³•</th><th>æ—¶é—´å¤æ‚åº¦</th><th>æ˜¯å¦åŸºäºæ¯”è¾ƒ</th></tr></thead><tbody><tr><td>å†’æ³¡ã€æ’å…¥ã€é€‰æ‹©</td><td>O(n^2)</td><td>âˆš</td></tr><tr><td>å¿«æ’ã€å½’å¹¶</td><td>O(nÂ·logn)</td><td>âˆš</td></tr><tr><td>æ¡¶ã€è®¡æ•°ã€åŸºæ•°</td><td>O(n)</td><td>Ã—</td></tr></tbody></table><h3 id="ç®—æ³•åˆ†æ"><a href="#ç®—æ³•åˆ†æ" class="headerlink" title="ç®—æ³•åˆ†æ"></a>ç®—æ³•åˆ†æ</h3><p><span class="github-emoji"><span>1âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0031-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> æ‰§è¡Œæ•ˆç‡</p><ol><li>æœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µæ—¶é—´å¤æ‚åº¦æˆ‘ä»¬åœ¨åˆ†ææ’åºç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ—¶ï¼Œè¦åˆ†åˆ«ç»™å‡ºæœ€å¥½æƒ…å†µã€æœ€åæƒ…å†µã€å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´å¤æ‚åº¦ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ è¿˜è¦è¯´å‡ºæœ€å¥½ã€æœ€åæ—¶é—´å¤æ‚åº¦å¯¹åº”çš„è¦æ’åºçš„åŸå§‹æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„ã€‚ä¸ºä»€ä¹ˆè¦åŒºåˆ†è¿™ä¸‰ç§æ—¶é—´å¤æ‚åº¦å‘¢ï¼Ÿç¬¬ä¸€ï¼Œæœ‰äº›æ’åºç®—æ³•ä¼šåŒºåˆ†ï¼Œä¸ºäº†å¥½å¯¹æ¯”ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ€å¥½éƒ½åšä¸€ä¸‹åŒºåˆ†ã€‚ç¬¬äºŒï¼Œå¯¹äºè¦æ’åºçš„æ•°æ®ï¼Œæœ‰çš„æ¥è¿‘æœ‰åºï¼Œæœ‰çš„å®Œå…¨æ— åºã€‚æœ‰åºåº¦ä¸åŒçš„æ•°æ®ï¼Œå¯¹äºæ’åºçš„æ‰§è¡Œæ—¶é—´è‚¯å®šæ˜¯æœ‰å½±å“çš„ï¼Œæˆ‘ä»¬è¦çŸ¥é“æ’åºç®—æ³•åœ¨ä¸åŒæ•°æ®ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚</li><li>æ—¶é—´å¤æ‚åº¦çš„ç³»æ•°ã€å¸¸æ•° ã€ä½é˜¶æˆ‘ä»¬çŸ¥é“ï¼Œæ—¶é—´å¤æ‚åº¦åæ˜ çš„æ˜¯æ•°æ®è§„æ¨¡ n å¾ˆå¤§çš„æ—¶å€™çš„ä¸€ä¸ªå¢é•¿è¶‹åŠ¿ï¼Œæ‰€ä»¥å®ƒè¡¨ç¤ºçš„æ—¶å€™ä¼šå¿½ç•¥ç³»æ•°ã€å¸¸æ•°ã€ä½é˜¶ã€‚ä½†æ˜¯å®é™…çš„è½¯ä»¶å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æ’åºçš„å¯èƒ½æ˜¯ 10 ä¸ªã€100 ä¸ªã€1000 ä¸ªè¿™æ ·è§„æ¨¡å¾ˆå°çš„æ•°æ®ï¼Œæ‰€ä»¥ï¼Œåœ¨å¯¹åŒä¸€é˜¶æ—¶é—´å¤æ‚åº¦çš„æ’åºç®—æ³•æ€§èƒ½å¯¹æ¯”çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦æŠŠç³»æ•°ã€å¸¸æ•°ã€ä½é˜¶ä¹Ÿè€ƒè™‘è¿›æ¥ã€‚</li><li>æ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°è¿™ä¸€èŠ‚å’Œä¸‹ä¸€èŠ‚è®²çš„éƒ½æ˜¯åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•ã€‚åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œä¼šæ¶‰åŠä¸¤ç§æ“ä½œï¼Œä¸€ç§æ˜¯å…ƒç´ æ¯”è¾ƒå¤§å°ï¼Œå¦ä¸€ç§æ˜¯å…ƒç´ äº¤æ¢æˆ–ç§»åŠ¨ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åœ¨åˆ†ææ’åºç®—æ³•çš„æ‰§è¡Œæ•ˆç‡çš„æ—¶å€™ï¼Œåº”è¯¥æŠŠæ¯”è¾ƒæ¬¡æ•°å’Œäº¤æ¢ï¼ˆæˆ–ç§»åŠ¨ï¼‰æ¬¡æ•°ä¹Ÿè€ƒè™‘è¿›å»ã€‚</li></ol><p><span class="github-emoji"><span>2âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0032-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> å†…å­˜æ¶ˆè€—<br>é€šè¿‡ç©ºé—´å¤æ‚åº¦æ¥è¡¡é‡ã€‚ä¸è¿‡ï¼Œé’ˆå¯¹æ’åºç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ï¼Œå¼•å…¥ä¸€ä¸ªæ–°çš„æ¦‚å¿µï¼ŒåŸåœ°æ’åºï¼ˆSorted in placeï¼‰ã€‚åŸåœ°æ’åºç®—æ³•ï¼Œç‰¹æŒ‡ç©ºé—´å¤æ‚åº¦æ˜¯ O(1) ã€‚</p><p><span class="github-emoji"><span>3âƒ£</span><img src="https://github.githubassets.com/images/icons/emoji/unicode/0033-20e3.png?v8" aria-hidden="true" onerror="this.parent.classList.add('github-emoji-fallback')"></span> ç¨³å®šæ€§<br>è¿™ä¸ªæ¦‚å¿µæ˜¯è¯´ï¼Œå¦‚æœå¾…æ’åºçš„åºåˆ—ä¸­å­˜åœ¨å€¼ç›¸ç­‰çš„å…ƒç´ ï¼Œç»è¿‡æ’åºä¹‹åï¼Œç›¸ç­‰å…ƒç´ ä¹‹é—´åŸæœ‰çš„å…ˆåé¡ºåºä¸å˜ã€‚æˆ‘é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ã€‚æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ç»„æ•°æ® 2ï¼Œ9ï¼Œ3ï¼Œ4ï¼Œ8ï¼Œ3ï¼ŒæŒ‰ç…§å¤§å°æ’åºä¹‹åå°±æ˜¯ 2ï¼Œ3ï¼Œ3ï¼Œ4ï¼Œ8ï¼Œ9ã€‚è¿™ç»„æ•°æ®é‡Œæœ‰ä¸¤ä¸ª 3ã€‚ç»è¿‡æŸç§æ’åºç®—æ³•æ’åºä¹‹åï¼Œå¦‚æœä¸¤ä¸ª 3 çš„å‰åé¡ºåºæ²¡æœ‰æ”¹å˜ï¼Œé‚£æˆ‘ä»¬å°±æŠŠè¿™ç§æ’åºç®—æ³•å«ä½œç¨³å®šçš„æ’åºç®—æ³•ï¼›å¦‚æœå‰åé¡ºåºå‘ç”Ÿå˜åŒ–ï¼Œé‚£å¯¹åº”çš„æ’åºç®—æ³•å°±å«ä½œä¸ç¨³å®šçš„æ’åºç®—æ³•ã€‚</p><h2 id="å†’æ³¡-æ’å…¥-é€‰æ‹©-n-2"><a href="#å†’æ³¡-æ’å…¥-é€‰æ‹©-n-2" class="headerlink" title="å†’æ³¡ æ’å…¥ é€‰æ‹©  n^2"></a>å†’æ³¡ æ’å…¥ é€‰æ‹©  n^2</h2><pre class="line-numbers language-none"><code class="language-none">é€‚ç”¨åœºæ™¯å°è§„æ¨¡æ•°æ®æ’åºæ—¶é—´å¤æ‚åº¦ï¼šO(n^2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><table><thead><tr><th>æ’åºç®—æ³•</th><th>æ˜¯å¦åŸåœ°æ’åº</th><th>æ˜¯å¦ç¨³å®š</th><th>æ—¶é—´å¤æ‚åº¦ï¼ˆæœ€å¥½ æœ€å å¹³å‡ï¼‰</th></tr></thead><tbody><tr><td>å†’æ³¡</td><td>âˆš</td><td>âˆš</td><td>O(n)     O(n^2) O(n^2)</td></tr><tr><td>æ’å…¥</td><td>âˆš</td><td>âˆš</td><td>O(n)     O(n^2) O(n^2)</td></tr><tr><td>é€‰æ‹©</td><td>âˆš</td><td>Ã—</td><td>O(n^2) O(n^2) O(n^2)</td></tr></tbody></table><p><code>å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰</code></p><table><thead><tr><th>å†’æ³¡æ¬¡æ•° i = [0,n) ++i</th><th>ç»“æœ</th><th>æ¯æ¬¡å†’æ³¡çš„æ¯”è¾ƒæ¬¡æ•°  j = [0,n-i-1) ++j</th></tr></thead><tbody><tr><td>0</td><td>456321</td><td>0</td></tr><tr><td>1</td><td>45321<strong>6</strong></td><td>5</td></tr><tr><td>2</td><td>4321<strong>56</strong></td><td>4</td></tr><tr><td>3</td><td>321<strong>456</strong></td><td>3</td></tr><tr><td>4</td><td>21<strong>3456</strong></td><td>2</td></tr><tr><td>5</td><td>1<strong>23456</strong></td><td>1</td></tr><tr><td>6</td><td><strong>123456</strong></td><td>0</td></tr></tbody></table><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818103836.jpg"></p><pre class="line-numbers language-none"><code class="language-none">æ¯æ¬¡å†’æ³¡æ“ä½œéƒ½ä¼šå¯¹ç›¸é‚»çš„ä¸¤ä¸ªå…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œçœ‹æ˜¯å¦æ»¡è¶³å¤§å°å…³ç³»è¦æ±‚ã€‚å¦‚æœä¸æ»¡è¶³å°±è®©å®ƒä¿©äº’æ¢ã€‚ä¸€æ¬¡å†’æ³¡ä¼šè®©è‡³å°‘ä¸€ä¸ªå…ƒç´ ç§»åŠ¨åˆ°å®ƒåº”è¯¥åœ¨çš„ä½ç½®ï¼Œé‡å¤ n æ¬¡ï¼Œå°±å®Œæˆäº† n ä¸ªæ•°æ®çš„æ’åºå·¥ä½œã€‚å½“æŸæ¬¡å†’æ³¡æ“ä½œå·²ç»æ²¡æœ‰æ•°æ®äº¤æ¢æ—¶ï¼Œè¯´æ˜å·²ç»è¾¾åˆ°å®Œå…¨æœ‰åºï¼Œä¸ç”¨å†ç»§ç»­æ‰§è¡Œåç»­çš„å†’æ³¡æ“ä½œã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818114350.jpg"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// å†’æ³¡æ’åºï¼Œaï¼šæ•°ç»„ï¼Œnï¼šæ•°ç»„å¤§å°</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bubbleSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// å†’æ³¡æ¬¡æ•°</span>        <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// æå‰é€€å‡ºå¾ªç¯æ ‡å¿—ä½</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n <span class="token operator">-</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> a<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> tmp <span class="token operator">=</span> a<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                a<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>                flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// æœ‰æ•°æ®äº¤æ¢</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flag<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>  <span class="token comment">// æ²¡æœ‰æ•°æ®äº¤æ¢ï¼Œæå‰é€€å‡º</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>åŒå‘å†’æ³¡æ’åºï¼ˆBidirectional Bubble Sortï¼‰ / é¸¡å°¾é…’æ’åºï¼ˆCocktail shakerï¼‰</code></p><pre class="line-numbers language-none"><code class="language-none">å†’æ³¡æ’åºå˜ä½“ï¼Œæ•ˆç‡æ›´é«˜ã€‚ä»ä¸¤ä¸ªæ–¹å‘ï¼ˆä½åˆ°é«˜ã€é«˜åˆ°ä½ï¼‰æ¥å›æ’åºã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>æ’å…¥æ’åºï¼ˆInsertion Sortï¼‰</code></p><table><thead><tr><th>æ’å…¥æ¬¡æ•° i = [1,n) ++i</th><th>ç»“æœ</th><th>æ¯æ¬¡æ’å…¥ j = [i-1,0] â€“j</th></tr></thead><tbody><tr><td>5</td><td></td><td></td></tr><tr><td>4</td><td></td><td></td></tr><tr><td>3</td><td></td><td></td></tr><tr><td>2</td><td></td><td></td></tr><tr><td>1</td><td></td><td></td></tr><tr><td></td><td></td><td></td></tr></tbody></table><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818114430.jpg"></p><pre class="line-numbers language-none"><code class="language-none">å°†æ•°ç»„åˆ†ä¸ºä¸¤ä¸ªåŒºé—´ï¼Œå·²æ’åºåŒºé—´å’Œæœªæ’åºåŒºé—´ã€‚åˆå§‹å·²æ’åºåŒºé—´åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼Œå°±æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚æ’å…¥ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯å–æœªæ’åºåŒºé—´ä¸­çš„å…ƒç´ ï¼Œåœ¨å·²æ’åºåŒºé—´ä¸­æ‰¾åˆ°åˆé€‚çš„æ’å…¥ä½ç½®å°†å…¶æ’å…¥ï¼Œå¹¶ä¿è¯å·²æ’åºåŒºé—´æ•°æ®ä¸€ç›´æœ‰åºã€‚é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æœªæ’åºåŒºé—´ä¸­å…ƒç´ ä¸ºç©º<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// æ’å…¥æ’åºï¼Œaï¼šæ•°ç»„ï¼Œnï¼šæ•°ç»„å¤§å°</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insertionSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> temp <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment">// æŸ¥æ‰¾æ’å…¥çš„ä½ç½®</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span> j <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> temp<span class="token punctuation">)</span> <span class="token punctuation">{</span>                a<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// æ•°æ®ç§»åŠ¨</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        a<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span> <span class="token comment">// æ’å…¥æ•°æ®</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// å¾…æ’å…¥çš„æ¬¡æ•°</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// éœ€è¦åŠ¨å°±å¾€å‰æ’ã€‚ä¸éœ€è¦å°±é€€å‡ºï¼Œæ“ä½œä¸‹ä¸€ä¸ªå¾…æ’å…¥çš„å…ƒç´ </span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> a<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> temp <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>            a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            a<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>é€‰æ‹©æ’åºï¼ˆSelection Sortï¼‰</code></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818115709.jpg"></p><pre class="line-numbers language-none"><code class="language-none">åˆ†å·²æ’åºåŒºé—´å’Œæœªæ’åºåŒºé—´ã€‚ä½†æ˜¯é€‰æ‹©æ’åºæ¯æ¬¡ä¼šä»æœªæ’åºåŒºé—´ä¸­æ‰¾åˆ°æœ€å°çš„å…ƒç´ ï¼Œå°†å…¶æ”¾åˆ°å·²æ’åºåŒºé—´çš„æœ«å°¾ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="å½’å¹¶-å¿«æ’-O-nlogn"><a href="#å½’å¹¶-å¿«æ’-O-nlogn" class="headerlink" title="å½’å¹¶ å¿«æ’ O(nlogn)"></a>å½’å¹¶ å¿«æ’ O(nlogn)</h2><pre class="line-numbers language-none"><code class="language-none">é€‚ç”¨åœºæ™¯å¤§è§„æ¨¡æ•°æ®æ’åºæ—¶é—´å¤æ‚åº¦ï¼šO(log(n))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="å½’å¹¶"><a href="#å½’å¹¶" class="headerlink" title="å½’å¹¶"></a>å½’å¹¶</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818115730.jpg"></p><pre class="line-numbers language-none"><code class="language-none">å½’å¹¶æ’åºï¼ˆåˆ†æ²» + é€’å½’ï¼‰    æ¦‚å¿µï¼šå…ˆæŠŠæ•°ç»„ä»ä¸­é—´åˆ†æˆå‰åä¸¤éƒ¨åˆ†ï¼Œç„¶åå¯¹å‰åä¸¤éƒ¨åˆ†åˆ†åˆ«æ’åºï¼Œå†å°†æ’å¥½åºçš„ä¸¤éƒ¨åˆ†åˆå¹¶åœ¨ä¸€èµ·    ç¨³å®š    æ—¶é—´å¤æ‚åº¦:         æœ€å¥½:  O(nlog(n))         æœ€å:  O(nlog(n))         å¹³å‡:  O(nlog(n)) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¿«æ’"><a href="#å¿«æ’" class="headerlink" title="å¿«æ’"></a>å¿«æ’</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818115735.jpg"></p><pre class="line-numbers language-none"><code class="language-none">å¿«é€Ÿæ’åºï¼ˆåˆ†æ²» + é€’å½’ï¼‰    æ’åºæ•°ç»„ä¸­ä¸‹æ ‡ä» p åˆ° r ä¹‹é—´çš„ä¸€ç»„æ•°æ®ï¼Œé€‰æ‹© p åˆ° r ä¹‹é—´çš„ä»»æ„ä¸€ä¸ªæ•°æ®ä½œä¸º pivotï¼ˆåˆ†åŒºç‚¹ï¼‰ã€‚    éå† p åˆ° r ä¹‹é—´çš„æ•°æ®ï¼Œå°†å°äº pivot çš„æ”¾åˆ°å·¦è¾¹ï¼Œå°†å¤§äº pivot çš„æ”¾åˆ°å³è¾¹ï¼Œå°† pivot æ”¾åˆ°ä¸­é—´ã€‚    ç»è¿‡è¿™ä¸€æ­¥éª¤ä¹‹åï¼Œæ•°ç»„ p åˆ° r ä¹‹é—´çš„æ•°æ®å°±è¢«åˆ†æˆäº†ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå‰é¢ p åˆ° q-1 ä¹‹é—´éƒ½æ˜¯å°äº pivot çš„ï¼Œä¸­é—´æ˜¯ pivotï¼Œåé¢çš„ q+1 åˆ° r ä¹‹é—´æ˜¯å¤§äº pivot çš„ã€‚    å†ç”¨é€’å½’æ’åºä¸‹æ ‡ä» p åˆ° q-1 ä¹‹é—´çš„æ•°æ®ã€ä¸‹æ ‡ä» q+1 åˆ° r ä¹‹é—´çš„æ•°æ®ï¼Œç›´åˆ°åŒºé—´ç¼©å°ä¸º 0ï¼Œæ’åºå®Œæˆã€‚    ä¸ç¨³å®š    æ—¶é—´å¤æ‚åº¦:         æœ€å¥½:  O(nlog(n))         æœ€å:  O(n^2)         å¹³å‡:  O(nlog(n)) <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">éåŸåœ°åˆ†åŒºä¼ªä»£ç     <span class="token comment">// å¿«é€Ÿæ’åºï¼ŒAæ˜¯æ•°ç»„ï¼Œnè¡¨ç¤ºæ•°ç»„çš„å¤§å°</span>    <span class="token function">quick_sort</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">quick_sort_c</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>    <span class="token comment">// å¿«é€Ÿæ’åºé€’å½’å‡½æ•°ï¼Œp,rä¸ºä¸‹æ ‡</span>    <span class="token function">quick_sort_c</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> p <span class="token operator">&gt;=</span> r then <span class="token keyword">return</span>      q <span class="token operator">=</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token comment">// è·å–åˆ†åŒºç‚¹</span>      <span class="token function">quick_sort_c</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>      <span class="token function">quick_sort_c</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">,</span> q<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span>    <span class="token punctuation">}</span>åŸåœ°åˆ†åŒºä¼ªä»£ç     <span class="token function">partition</span><span class="token punctuation">(</span><span class="token class-name">A</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>      pivot <span class="token operator">:</span><span class="token operator">=</span> <span class="token class-name">A</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span>      i <span class="token operator">:</span><span class="token operator">=</span> p      <span class="token keyword">for</span> j <span class="token operator">:</span><span class="token operator">=</span> p <span class="token keyword">to</span> <span class="token namespace">r</span><span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">do</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token class-name">A</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> pivot <span class="token punctuation">{</span>          swap <span class="token class-name">A</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">with</span> <span class="token class-name">A</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>          i <span class="token operator">:</span><span class="token operator">=</span> i<span class="token operator">+</span><span class="token number">1</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span>      swap <span class="token class-name">A</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">with</span> <span class="token class-name">A</span><span class="token punctuation">[</span>r<span class="token punctuation">]</span>      <span class="token keyword">return</span> ié€šè¿‡æ¸¸æ ‡ i æŠŠ <span class="token class-name">A</span><span class="token punctuation">[</span>p<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>r<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>åˆ†æˆä¸¤éƒ¨åˆ†ã€‚<span class="token class-name">A</span><span class="token punctuation">[</span>p<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>çš„å…ƒç´ éƒ½æ˜¯å°äº pivot çš„ï¼Œæˆ‘ä»¬æš‚ä¸”å«å®ƒâ€œå·²å¤„ç†åŒºé—´â€ï¼Œ<span class="token class-name">A</span><span class="token punctuation">[</span>i<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>r<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>æ˜¯â€œæœªå¤„ç†åŒºé—´â€ã€‚æˆ‘ä»¬æ¯æ¬¡éƒ½ä»æœªå¤„ç†çš„åŒºé—´ <span class="token class-name">A</span><span class="token punctuation">[</span>i<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>r<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>ä¸­å–ä¸€ä¸ªå…ƒç´  <span class="token class-name">A</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span>ï¼Œä¸ pivot å¯¹æ¯”ï¼Œå¦‚æœå°äº pivotï¼Œåˆ™å°†å…¶åŠ å…¥åˆ°å·²å¤„ç†åŒºé—´çš„å°¾éƒ¨ï¼Œä¹Ÿå°±æ˜¯ <span class="token class-name">A</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span>çš„ä½ç½®ã€‚å¿«æ’javaä»£ç     <span class="token comment">// 1. è·å–åˆ†åŒºç‚¹</span>    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> p<span class="token punctuation">;</span>        <span class="token keyword">int</span> pivot <span class="token operator">=</span> a<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// ä»¥æœ«å°¾å…ƒç´ å€¼ä¸ºåŸºå‡†ç‚¹</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> p<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> r<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> pivot<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">// a[i]ä¸a[j]äº¤æ¢</span>                <span class="token keyword">int</span> temp <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>                a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>                a<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>                i<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token comment">// a[i]ä¸a[r]äº¤æ¢</span>        <span class="token keyword">int</span> temp <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">;</span>        a<span class="token punctuation">[</span>r<span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">;</span>        <span class="token keyword">return</span> i<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// 2. å¿«æ’é€’å½’</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">quickSortRecur</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// åŒºé—´ç¼©å°ä¸º 0</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">&gt;=</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> q <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">partition</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> p<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">quickSortRecur</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> p<span class="token punctuation">,</span> q <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">quickSortRecur</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> q <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment">// 3. å¿«é€Ÿæ’åº aï¼šæ•°ç»„ nï¼šæ•°ç»„å¤§å°</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">quickSort</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">quickSortRecur</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818121308.jpg"></p><pre class="line-numbers language-none"><code class="language-none">O(n) æ—¶é—´å¤æ‚åº¦å†…æ±‚æ— åºæ•°ç»„ä¸­çš„ç¬¬ K å¤§å…ƒç´ ã€‚æ¯”å¦‚ï¼Œ4ï¼Œ 2ï¼Œ 5ï¼Œ 12ï¼Œ 3 è¿™æ ·ä¸€ç»„æ•°æ®ï¼Œç¬¬ 3 å¤§å…ƒç´ å°±æ˜¯ 4ã€‚æˆ‘ä»¬é€‰æ‹©æ•°ç»„åŒºé—´ A[0...n-1]çš„æœ€åä¸€ä¸ªå…ƒç´  A[n-1]ä½œä¸º pivotï¼Œå¯¹æ•°ç»„ A[0...n-1]åŸåœ°åˆ†åŒºï¼Œè¿™æ ·æ•°ç»„å°±åˆ†æˆäº†ä¸‰éƒ¨åˆ†ï¼ŒA[0...p-1]ã€A[p]ã€A[p+1...n-1]ã€‚è‹¥ p+1=Kï¼Œé‚£ A[p]å°±æ˜¯è¦æ±‚è§£çš„å…ƒç´ ï¼›è‹¥ K&gt;p+1, è¯´æ˜ç¬¬ K å¤§å…ƒç´ å‡ºç°åœ¨ A[p+1...n-1]åŒºé—´ï¼Œå†æŒ‰ç…§ä¸Šé¢æ€è·¯é€’å½’åœ°åœ¨ A[p+1...n-1]è¿™ä¸ªåŒºé—´å†…æŸ¥æ‰¾ã€‚è‹¥ K&lt;p+1, è¯´æ˜ç¬¬ K å¤§å…ƒç´ å‡ºç°åœ¨ A[0...p-1]åŒºé—´ï¼Œå†æŒ‰ç…§ä¸Šé¢æ€è·¯é€’å½’åœ°åœ¨ A[p+1...n-1]è¿™ä¸ªåŒºé—´å†…æŸ¥æ‰¾ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>åŒºåˆ«</code></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818121732.jpg"></p><pre class="line-numbers language-none"><code class="language-none">å¤„ç†è¿‡ç¨‹    å½’å¹¶ï¼šç”±ä¸‹åˆ°ä¸Šï¼Œå…ˆå¤„ç†å­é—®é¢˜ï¼Œç„¶åå†åˆå¹¶ã€‚    å¿«æ’ï¼šæ˜¯ç”±ä¸Šåˆ°ä¸‹çš„ã€‚åŸåœ°æ’åº    å½’å¹¶ï¼šéåŸåœ°æ’åºï¼ˆåˆå¹¶å‡½æ•°æ— æ³•åœ¨åŸåœ°æ‰§è¡Œï¼‰    å¿«æ’ï¼šåŸåœ°æ’åºï¼ˆé€šè¿‡è®¾è®¡å·§å¦™çš„åŸåœ°åˆ†åŒºå‡½æ•°ï¼Œå¯ä»¥å®ç°åŸåœ°æ’åºï¼Œè§£å†³äº†å½’å¹¶æ’åºå ç”¨å¤ªå¤šå†…å­˜çš„é—®é¢˜ï¼‰<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å †æ’åº-O-nlogn"><a href="#å †æ’åº-O-nlogn" class="headerlink" title="å †æ’åº O(nlogn)"></a>å †æ’åº O(nlogn)</h2><pre class="line-numbers language-none"><code class="language-none">æ¦‚å¿µï¼šHeap ä¸ç¨³å®šã€åŸåœ°ã€æ—¶é—´å¤æ‚åº¦ä¸º O(nlogn) çš„æ’åºç®—æ³•å †æ’åºä¸æ˜¯ç¨³å®šçš„æ’åºç®—æ³•ï¼Œå› ä¸ºåœ¨æ’åºçš„è¿‡ç¨‹ï¼Œå­˜åœ¨å°†å †çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹è·Ÿå †é¡¶èŠ‚ç‚¹äº’æ¢çš„æ“ä½œï¼Œæ‰€ä»¥å°±æœ‰å¯èƒ½æ”¹å˜å€¼ç›¸åŒæ•°æ®çš„åŸå§‹ç›¸å¯¹é¡ºåºã€‚å †æ˜¯ä¸€ä¸ªå®Œå…¨äºŒå‰æ ‘ï¼šå¶å­èŠ‚ç‚¹éƒ½åœ¨æœ€åº•ä¸¤å±‚ï¼Œæœ€åº•å±‚çš„å¶å­èŠ‚ç‚¹é å·¦æ’åˆ—ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹æ•°éƒ½è¦è¾¾åˆ°æœ€å¤§å †ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¿…é¡»å¤§äºç­‰äºï¼ˆæˆ–å°äºç­‰äºï¼‰å…¶å­æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼ç­‰ä»·äºå †ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºç­‰äºï¼ˆæˆ–è€…å°äºç­‰äºï¼‰å…¶å·¦å³å­èŠ‚ç‚¹çš„å€¼åˆ†ç±»ï¼š    å¤§é¡¶å †ï¼šçˆ¶èŠ‚ç‚¹çš„å€¼æ°¸è¿œå¤§äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œæœ€å¤§å€¼å­˜å‚¨äºæ ¹èŠ‚ç‚¹    å°é¡¶å †ï¼šçˆ¶èŠ‚ç‚¹çš„å€¼æ°¸è¿œå°äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œæœ€å°å€¼å­˜å‚¨äºæ ¹èŠ‚ç‚¹é¡ºåºå­˜å‚¨ï¼ˆåŸºäºæ•°ç»„ï¼‰å¦‚æœèŠ‚ç‚¹ X å­˜å‚¨åœ¨æ•°ç»„ä¸­ä¸‹æ ‡ä¸º i çš„ä½ç½®ï¼Œä¸‹æ ‡ä¸º 2 * i çš„ä½ç½®å­˜å‚¨çš„å°±æ˜¯å·¦å­èŠ‚ç‚¹ï¼Œä¸‹æ ‡ä¸º 2 * i + 1 çš„ä½ç½®å­˜å‚¨çš„å°±æ˜¯å³å­èŠ‚ç‚¹ã€‚åè¿‡æ¥ï¼Œä¸‹æ ‡ä¸º i/2 çš„ä½ç½®å­˜å‚¨å°±æ˜¯å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚å †åŒ– heapifyæŠŠæ–°æ’å…¥çš„å…ƒç´ æ”¾åˆ°å †çš„æœ€åï¼Œè¿›è¡Œè°ƒæ•´ï¼Œè®©å…¶é‡æ–°æ»¡è¶³å †çš„ç‰¹æ€§é¡ºç€èŠ‚ç‚¹æ‰€åœ¨çš„è·¯å¾„ï¼Œå‘ä¸Šæˆ–è€…å‘ä¸‹ï¼Œå¯¹æ¯”ï¼Œç„¶åäº¤æ¢<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="æ’å…¥-O-logn"><a href="#æ’å…¥-O-logn" class="headerlink" title="æ’å…¥ O(logn)"></a>æ’å…¥ O(logn)</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818121833.jpg"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818121836.jpg"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java">è¿‡ç¨‹ï¼ˆæœ¬ä¾‹ä¾§é‡ä»ä¸‹å¾€ä¸Šï¼‰è®©æ–°æ’å…¥çš„èŠ‚ç‚¹ä¸çˆ¶èŠ‚ç‚¹å¯¹æ¯”å¤§å°ã€‚å¦‚æœä¸æ»¡è¶³å­èŠ‚ç‚¹å°äºç­‰äºçˆ¶èŠ‚ç‚¹çš„å¤§å°å…³ç³»ï¼Œå°±äº’æ¢ä¸¤ä¸ªèŠ‚ç‚¹ã€‚ä¸€ç›´é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°çˆ¶å­èŠ‚ç‚¹ä¹‹é—´æ»¡è¶³å…³ç³»ã€‚<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Heap</span> <span class="token punctuation">{</span>  <span class="token keyword">private</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">;</span> <span class="token comment">// æ•°ç»„ï¼Œä»ä¸‹æ ‡1å¼€å§‹å­˜å‚¨æ•°æ®</span>  <span class="token keyword">private</span> <span class="token keyword">int</span> n<span class="token punctuation">;</span>  <span class="token comment">// å †å¯ä»¥å­˜å‚¨çš„æœ€å¤§æ•°æ®ä¸ªæ•°</span>  <span class="token keyword">private</span> <span class="token keyword">int</span> count<span class="token punctuation">;</span> <span class="token comment">// å †ä¸­å·²ç»å­˜å‚¨çš„æ•°æ®ä¸ªæ•°</span>  <span class="token keyword">public</span> <span class="token class-name">Heap</span><span class="token punctuation">(</span><span class="token keyword">int</span> capacity<span class="token punctuation">)</span> <span class="token punctuation">{</span>    a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span>capacity <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    n <span class="token operator">=</span> capacity<span class="token punctuation">;</span>    count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">int</span> data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&gt;=</span> n<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">// å †æ»¡äº†</span>    <span class="token operator">++</span>count<span class="token punctuation">;</span>    a<span class="token punctuation">[</span>count<span class="token punctuation">]</span> <span class="token operator">=</span> data<span class="token punctuation">;</span>    <span class="token keyword">int</span> i <span class="token operator">=</span> count<span class="token punctuation">;</span>    <span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">/</span><span class="token number">2</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> a<span class="token punctuation">[</span>i<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è‡ªä¸‹å¾€ä¸Šå †åŒ–</span>      <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> i<span class="token punctuation">,</span> i<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// swap()å‡½æ•°ä½œç”¨ï¼šäº¤æ¢ä¸‹æ ‡ä¸ºiå’Œi/2çš„ä¸¤ä¸ªå…ƒç´ </span>      i <span class="token operator">=</span> i<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åˆ é™¤-O-logn"><a href="#åˆ é™¤-O-logn" class="headerlink" title="åˆ é™¤ O(logn)"></a>åˆ é™¤ O(logn)</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818121853.jpg"></p><pre class="line-numbers language-java" data-language="java"><code class="language-java">è¿‡ç¨‹ï¼ˆæœ¬ä¾‹ä¾§é‡ä»ä¸Šå¾€ä¸‹ï¼‰    æŠŠæœ€åä¸€ä¸ªèŠ‚ç‚¹æ”¾åˆ°å †é¡¶ï¼Œåˆ©ç”¨åŒæ ·çš„çˆ¶å­èŠ‚ç‚¹å¯¹æ¯”æ–¹æ³•    å¯¹äºä¸æ»¡è¶³çˆ¶å­èŠ‚ç‚¹å¤§å°å…³ç³»çš„ï¼Œäº’æ¢ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå¹¶é‡å¤è¿›è¡Œè¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°çˆ¶å­èŠ‚ç‚¹ä¹‹é—´æ»¡è¶³å¤§å°å…³ç³»ä¸ºæ­¢<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">removeMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// å †ä¸­æ²¡æœ‰æ•°æ®</span>  a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token operator">--</span>count<span class="token punctuation">;</span>  <span class="token function">heapify</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> count<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">heapify</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> i<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// è‡ªä¸Šå¾€ä¸‹å †åŒ–</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> maxPos <span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">2</span> <span class="token operator">&lt;=</span> n <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> maxPos <span class="token operator">=</span> i<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span> <span class="token operator">&lt;=</span> n <span class="token operator">&amp;&amp;</span> a<span class="token punctuation">[</span>maxPos<span class="token punctuation">]</span> <span class="token operator">&lt;</span> a<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> maxPos <span class="token operator">=</span> i<span class="token operator">*</span><span class="token number">2</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>maxPos <span class="token operator">==</span> i<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token function">swap</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> i<span class="token punctuation">,</span> maxPos<span class="token punctuation">)</span><span class="token punctuation">;</span>    i <span class="token operator">=</span> maxPos<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span>ä¸€ä¸ªåŒ…å« n ä¸ªèŠ‚ç‚¹çš„å®Œå…¨äºŒå‰æ ‘ï¼Œæ ‘çš„é«˜åº¦ä¸ä¼šè¶…è¿‡ log2â€‹nã€‚å †åŒ–çš„è¿‡ç¨‹æ˜¯é¡ºç€èŠ‚ç‚¹æ‰€åœ¨è·¯å¾„æ¯”è¾ƒäº¤æ¢çš„ï¼Œæ‰€ä»¥å †åŒ–çš„æ—¶é—´å¤æ‚åº¦è·Ÿæ ‘çš„é«˜åº¦æˆæ­£æ¯”ï¼Œä¹Ÿå°±æ˜¯ <span class="token class-name">O</span><span class="token punctuation">(</span>logn<span class="token punctuation">)</span>ã€‚æ’å…¥æ•°æ®å’Œåˆ é™¤å †é¡¶å…ƒç´ çš„ä¸»è¦é€»è¾‘å°±æ˜¯å †åŒ–ï¼Œæ‰€ä»¥ï¼Œå¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ å’Œåˆ é™¤å †é¡¶å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯ <span class="token class-name">O</span><span class="token punctuation">(</span>logn<span class="token punctuation">)</span>ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p><code>å¿«é€Ÿè·å–åˆ°Top 10æœ€çƒ­é—¨çš„æœç´¢å…³é”®è¯ï¼Ÿ</code></p><pre class="line-numbers language-none"><code class="language-none">å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œæœ‰å¾ˆå¤šé«˜çº§çš„è§£å†³æ–¹æ³•ï¼Œæ¯”å¦‚ä½¿ç”¨ MapReduce ç­‰ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å°†å¤„ç†çš„åœºæ™¯é™å®šä¸ºå•æœºï¼Œå¯ä»¥ä½¿ç”¨çš„å†…å­˜ä¸º 1GBã€‚é‚£è¿™ä¸ªé—®é¢˜è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿå› ä¸ºç”¨æˆ·æœç´¢çš„å…³é”®è¯ï¼Œæœ‰å¾ˆå¤šå¯èƒ½éƒ½æ˜¯é‡å¤çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é¦–å…ˆè¦ç»Ÿè®¡æ¯ä¸ªæœç´¢å…³é”®è¯å‡ºç°çš„é¢‘ç‡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•£åˆ—è¡¨ã€å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘æˆ–è€…å…¶ä»–ä¸€äº›æ”¯æŒå¿«é€ŸæŸ¥æ‰¾ã€æ’å…¥çš„æ•°æ®ç»“æ„ï¼Œæ¥è®°å½•å…³é”®è¯åŠå…¶å‡ºç°çš„æ¬¡æ•°ã€‚å‡è®¾æˆ‘ä»¬é€‰ç”¨æ•£åˆ—è¡¨ã€‚æˆ‘ä»¬å°±é¡ºåºæ‰«æè¿™ 10 äº¿ä¸ªæœç´¢å…³é”®è¯ã€‚å½“æ‰«æåˆ°æŸä¸ªå…³é”®è¯æ—¶ï¼Œæˆ‘ä»¬å»æ•£åˆ—è¡¨ä¸­æŸ¥è¯¢ã€‚å¦‚æœå­˜åœ¨ï¼Œæˆ‘ä»¬å°±å°†å¯¹åº”çš„æ¬¡æ•°åŠ ä¸€ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å°±å°†å®ƒæ’å…¥åˆ°æ•£åˆ—è¡¨ï¼Œå¹¶è®°å½•æ¬¡æ•°ä¸º 1ã€‚ä»¥æ­¤ç±»æ¨ï¼Œç­‰éå†å®Œè¿™ 10 äº¿ä¸ªæœç´¢å…³é”®è¯ä¹‹åï¼Œæ•£åˆ—è¡¨ä¸­å°±å­˜å‚¨äº†ä¸é‡å¤çš„æœç´¢å…³é”®è¯ä»¥åŠå‡ºç°çš„æ¬¡æ•°ã€‚ç„¶åï¼Œæˆ‘ä»¬å†æ ¹æ®å‰é¢è®²çš„ç”¨å †æ±‚ Top K çš„æ–¹æ³•ï¼Œå»ºç«‹ä¸€ä¸ªå¤§å°ä¸º 10 çš„å°é¡¶å †ï¼Œéå†æ•£åˆ—è¡¨ï¼Œä¾æ¬¡å–å‡ºæ¯ä¸ªæœç´¢å…³é”®è¯åŠå¯¹åº”å‡ºç°çš„æ¬¡æ•°ï¼Œç„¶åä¸å †é¡¶çš„æœç´¢å…³é”®è¯å¯¹æ¯”ã€‚å¦‚æœå‡ºç°æ¬¡æ•°æ¯”å †é¡¶æœç´¢å…³é”®è¯çš„æ¬¡æ•°å¤šï¼Œé‚£å°±åˆ é™¤å †é¡¶çš„å…³é”®è¯ï¼Œå°†è¿™ä¸ªå‡ºç°æ¬¡æ•°æ›´å¤šçš„å…³é”®è¯åŠ å…¥åˆ°å †ä¸­ã€‚ä»¥æ­¤ç±»æ¨ï¼Œå½“éå†å®Œæ•´ä¸ªæ•£åˆ—è¡¨ä¸­çš„æœç´¢å…³é”®è¯ä¹‹åï¼Œå †ä¸­çš„æœç´¢å…³é”®è¯å°±æ˜¯å‡ºç°æ¬¡æ•°æœ€å¤šçš„ Top 10 æœç´¢å…³é”®è¯äº†ã€‚ä¸çŸ¥é“ä½ å‘ç°äº†æ²¡æœ‰ï¼Œä¸Šé¢çš„è§£å†³æ€è·¯å…¶å®å­˜åœ¨æ¼æ´ã€‚10 äº¿çš„å…³é”®è¯è¿˜æ˜¯å¾ˆå¤šçš„ã€‚æˆ‘ä»¬å‡è®¾ 10 äº¿æ¡æœç´¢å…³é”®è¯ä¸­ä¸é‡å¤çš„æœ‰ 1 äº¿æ¡ï¼Œå¦‚æœæ¯ä¸ªæœç´¢å…³é”®è¯çš„å¹³å‡é•¿åº¦æ˜¯ 50 ä¸ªå­—èŠ‚ï¼Œé‚£å­˜å‚¨ 1 äº¿ä¸ªå…³é”®è¯èµ·ç éœ€è¦ 5GB çš„å†…å­˜ç©ºé—´ï¼Œè€Œæ•£åˆ—è¡¨å› ä¸ºè¦é¿å…é¢‘ç¹å†²çªï¼Œä¸ä¼šé€‰æ‹©å¤ªå¤§çš„è£…è½½å› å­ï¼Œæ‰€ä»¥æ¶ˆè€—çš„å†…å­˜ç©ºé—´å°±æ›´å¤šäº†ã€‚è€Œæˆ‘ä»¬çš„æœºå™¨åªæœ‰ 1GB çš„å¯ç”¨å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•ä¸€æ¬¡æ€§å°†æ‰€æœ‰çš„æœç´¢å…³é”®è¯åŠ å…¥åˆ°å†…å­˜ä¸­ã€‚è¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬åœ¨å“ˆå¸Œç®—æ³•é‚£ä¸€èŠ‚è®²è¿‡ï¼Œç›¸åŒæ•°æ®ç»è¿‡å“ˆå¸Œç®—æ³•å¾—åˆ°çš„å“ˆå¸Œå€¼æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®å“ˆå¸Œç®—æ³•çš„è¿™ä¸ªç‰¹ç‚¹ï¼Œå°† 10 äº¿æ¡æœç´¢å…³é”®è¯å…ˆé€šè¿‡å“ˆå¸Œç®—æ³•åˆ†ç‰‡åˆ° 10 ä¸ªæ–‡ä»¶ä¸­ã€‚å…·ä½“å¯ä»¥è¿™æ ·åšï¼šæˆ‘ä»¬åˆ›å»º 10 ä¸ªç©ºæ–‡ä»¶ 00ï¼Œ01ï¼Œ02ï¼Œâ€¦â€¦ï¼Œ09ã€‚æˆ‘ä»¬éå†è¿™ 10 äº¿ä¸ªå…³é”®è¯ï¼Œå¹¶ä¸”é€šè¿‡æŸä¸ªå“ˆå¸Œç®—æ³•å¯¹å…¶æ±‚å“ˆå¸Œå€¼ï¼Œç„¶åå“ˆå¸Œå€¼åŒ 10 å–æ¨¡ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯è¿™ä¸ªæœç´¢å…³é”®è¯åº”è¯¥è¢«åˆ†åˆ°çš„æ–‡ä»¶ç¼–å·ã€‚å¯¹è¿™ 10 äº¿ä¸ªå…³é”®è¯åˆ†ç‰‡ä¹‹åï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½åªæœ‰ 1 äº¿çš„å…³é”®è¯ï¼Œå»é™¤æ‰é‡å¤çš„ï¼Œå¯èƒ½å°±åªæœ‰ 1000 ä¸‡ä¸ªï¼Œæ¯ä¸ªå…³é”®è¯å¹³å‡ 50 ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥æ€»çš„å¤§å°å°±æ˜¯ 500MBã€‚1GB çš„å†…å­˜å®Œå…¨å¯ä»¥æ”¾å¾—ä¸‹<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>ä¼˜å…ˆçº§é˜Ÿåˆ—ï¼Ÿ</code></p><pre class="line-numbers language-none"><code class="language-none">å †å’Œä¼˜å…ˆçº§é˜Ÿåˆ—éå¸¸ç›¸ä¼¼ã€‚ä¸€ä¸ªå †å°±å¯ä»¥çœ‹ä½œä¸€ä¸ªä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚å¾ˆå¤šæ—¶å€™ï¼Œå®ƒä»¬åªæ˜¯æ¦‚å¿µä¸Šçš„åŒºåˆ†è€Œå·²ã€‚å¾€ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œå°±ç›¸å½“äºå¾€å †ä¸­æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼›ä»ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­å–å‡ºä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ï¼Œå°±ç›¸å½“äºå–å‡ºå †é¡¶å…ƒç´ ã€‚ä¾‹å­ï¼šèµ«å¤«æ›¼ç¼–ç ã€å›¾çš„æœ€çŸ­è·¯å¾„ã€æœ€å°ç”Ÿæˆæ ‘ç®—æ³•ä¼˜å…ˆçº§é˜Ÿåˆ—çš„å®ç°ï¼šJava çš„ PriorityQueue1. åˆå¹¶æœ‰åºå°æ–‡ä»¶å‡è®¾æœ‰ 100 ä¸ªå°æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯100MBï¼Œæ¯ä¸ªæ–‡ä»¶ä¸­å­˜å‚¨çš„éƒ½æ˜¯æœ‰åºçš„å­—ç¬¦ä¸²ã€‚å¸Œæœ›å°†è¿™äº› 100 ä¸ªå°æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªæœ‰åºçš„å¤§æ–‡ä»¶ã€‚ï¼ˆç”¨æ•°ç»„çš„è¯ï¼Œæ¯æ¬¡ä»æ•°ç»„ä¸­å–æœ€å°å­—ç¬¦ä¸²ï¼Œéƒ½éœ€è¦å¾ªç¯éå†æ•´ä¸ªæ•°ç»„ï¼Œæ˜¾ç„¶ï¼Œè¿™ä¸æ˜¯å¾ˆé«˜æ•ˆã€‚ï¼‰ä»è¿™ 100 ä¸ªæ–‡ä»¶ä¸­ï¼Œå„å–ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå°†ä»å°æ–‡ä»¶ä¸­å–å‡ºæ¥çš„å­—ç¬¦ä¸²æ”¾å…¥åˆ°å°é¡¶å †ä¸­ï¼Œé‚£å †é¡¶çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯ä¼˜å…ˆçº§é˜Ÿåˆ—é˜Ÿé¦–çš„å…ƒç´ ï¼Œå°±æ˜¯æœ€å°çš„å­—ç¬¦ä¸²ã€‚æˆ‘ä»¬å°†è¿™ä¸ªå­—ç¬¦ä¸²æ”¾å…¥åˆ°å¤§æ–‡ä»¶ä¸­ï¼Œå¹¶å°†å…¶ä»å †ä¸­åˆ é™¤ã€‚ç„¶åå†ä»å°æ–‡ä»¶ä¸­å–å‡ºä¸‹ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ”¾å…¥åˆ°å †ä¸­ã€‚å¾ªç¯è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å¯ä»¥å°† 100 ä¸ªå°æ–‡ä»¶ä¸­çš„æ•°æ®ä¾æ¬¡æ”¾å…¥åˆ°å¤§æ–‡ä»¶ä¸­ã€‚2. é«˜æ€§èƒ½å®šæ—¶å™¨å‡è®¾æœ‰ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç»´æŠ¤äº†å¾ˆå¤šå®šæ—¶ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡éƒ½è®¾å®šäº†ä¸€ä¸ªè¦è§¦å‘æ‰§è¡Œçš„æ—¶é—´ç‚¹ã€‚ï¼ˆæ¯è¿‡ 1 ç§’å°±æ‰«æä¸€éä»»åŠ¡åˆ—è¡¨çš„åšæ³•æ¯”è¾ƒä½æ•ˆï¼Œä¸»è¦åŸå› æœ‰ä¸¤ç‚¹ï¼šç¬¬ä¸€ï¼Œä»»åŠ¡çš„çº¦å®šæ‰§è¡Œæ—¶é—´ç¦»å½“å‰æ—¶é—´å¯èƒ½è¿˜æœ‰å¾ˆä¹…ï¼Œè¿™æ ·å‰é¢å¾ˆå¤šæ¬¡æ‰«æå…¶å®éƒ½æ˜¯å¾’åŠ³çš„ï¼›ç¬¬äºŒï¼Œæ¯æ¬¡éƒ½è¦æ‰«ææ•´ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œå¦‚æœä»»åŠ¡åˆ—è¡¨å¾ˆå¤§çš„è¯ï¼Œä¼šå¾ˆè€—æ—¶ï¼‰æŒ‰ç…§ä»»åŠ¡è®¾å®šçš„æ‰§è¡Œæ—¶é—´ï¼Œå°†è¿™äº›ä»»åŠ¡å­˜å‚¨åœ¨ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ï¼Œé˜Ÿåˆ—é¦–éƒ¨ï¼ˆä¹Ÿå°±æ˜¯å°é¡¶å †çš„å †é¡¶ï¼‰å­˜å‚¨çš„æ˜¯æœ€å…ˆæ‰§è¡Œçš„ä»»åŠ¡ã€‚è¿™æ ·ï¼Œå®šæ—¶å™¨å°±ä¸éœ€è¦æ¯éš” 1 ç§’å°±æ‰«æä¸€éä»»åŠ¡åˆ—è¡¨äº†ã€‚å®ƒæ‹¿é˜Ÿé¦–ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ç‚¹ï¼Œä¸å½“å‰æ—¶é—´ç‚¹ç›¸å‡ï¼Œå¾—åˆ°ä¸€ä¸ªæ—¶é—´é—´éš” Tã€‚è¿™ä¸ªæ—¶é—´é—´éš” T å°±æ˜¯ï¼Œä»å½“å‰æ—¶é—´å¼€å§‹ï¼Œéœ€è¦ç­‰å¾…å¤šä¹…ï¼Œæ‰ä¼šæœ‰ç¬¬ä¸€ä¸ªä»»åŠ¡éœ€è¦è¢«æ‰§è¡Œã€‚è¿™æ ·ï¼Œå®šæ—¶å™¨å°±å¯ä»¥è®¾å®šåœ¨ T ç§’ä¹‹åï¼Œå†æ¥æ‰§è¡Œä»»åŠ¡ã€‚ä»å½“å‰æ—¶é—´ç‚¹åˆ°ï¼ˆT-1ï¼‰ç§’è¿™æ®µæ—¶é—´é‡Œï¼Œå®šæ—¶å™¨éƒ½ä¸éœ€è¦åšä»»ä½•äº‹æƒ…ã€‚å½“ T ç§’æ—¶é—´è¿‡å»ä¹‹åï¼Œå®šæ—¶å™¨å–ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­é˜Ÿé¦–çš„ä»»åŠ¡æ‰§è¡Œã€‚ç„¶åå†è®¡ç®—æ–°çš„é˜Ÿé¦–ä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ç‚¹ä¸å½“å‰æ—¶é—´ç‚¹çš„å·®å€¼ï¼ŒæŠŠè¿™ä¸ªå€¼ä½œä¸ºå®šæ—¶å™¨æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡éœ€è¦ç­‰å¾…çš„æ—¶é—´ã€‚è¿™æ ·ï¼Œå®šæ—¶å™¨æ—¢ä¸ç”¨é—´éš” 1 ç§’å°±è½®è¯¢ä¸€æ¬¡ï¼Œä¹Ÿä¸ç”¨éå†æ•´ä¸ªä»»åŠ¡åˆ—è¡¨ï¼Œæ€§èƒ½ä¹Ÿå°±æé«˜äº†ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>æ±‚ Top K ï¼Ÿ</code></p><pre class="line-numbers language-none"><code class="language-none">ä¸€ç±»æ˜¯é’ˆå¯¹é™æ€æ•°æ®é›†åˆï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®é›†åˆäº‹å…ˆç¡®å®šï¼Œä¸ä¼šå†å˜ã€‚    é’ˆå¯¹é™æ€æ•°æ®ï¼Œå¦‚ä½•åœ¨ä¸€ä¸ªåŒ…å« n ä¸ªæ•°æ®çš„æ•°ç»„ä¸­ï¼ŒæŸ¥æ‰¾å‰ K å¤§æ•°æ®å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ç»´æŠ¤ä¸€ä¸ªå¤§å°ä¸º K çš„å°é¡¶å †ï¼Œé¡ºåºéå†æ•°ç»„ï¼Œä»æ•°ç»„ä¸­å–å‡ºæ•°æ®ä¸å †é¡¶å…ƒç´ æ¯”è¾ƒã€‚å¦‚æœæ¯”å †é¡¶å…ƒç´ å¤§ï¼Œæˆ‘ä»¬å°±æŠŠå †é¡¶å…ƒç´ åˆ é™¤ï¼Œå¹¶ä¸”å°†è¿™ä¸ªå…ƒç´ æ’å…¥åˆ°å †ä¸­ï¼›å¦‚æœæ¯”å †é¡¶å…ƒç´ å°ï¼Œåˆ™ä¸åšå¤„ç†ï¼Œç»§ç»­éå†æ•°ç»„ã€‚è¿™æ ·ç­‰æ•°ç»„ä¸­çš„æ•°æ®éƒ½éå†å®Œä¹‹åï¼Œå †ä¸­çš„æ•°æ®å°±æ˜¯å‰ K å¤§æ•°æ®äº†ã€‚éå†æ•°ç»„éœ€è¦ O(n) çš„æ—¶é—´å¤æ‚åº¦ï¼Œä¸€æ¬¡å †åŒ–æ“ä½œéœ€è¦ O(logK) çš„æ—¶é—´å¤æ‚åº¦ï¼Œæ‰€ä»¥æœ€åæƒ…å†µä¸‹ï¼Œn ä¸ªå…ƒç´ éƒ½å…¥å †ä¸€æ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(nlogK)ã€‚å¦ä¸€ç±»æ˜¯é’ˆå¯¹åŠ¨æ€æ•°æ®é›†åˆï¼Œä¹Ÿå°±æ˜¯è¯´æ•°æ®é›†åˆäº‹å…ˆå¹¶ä¸ç¡®å®šï¼Œæœ‰æ•°æ®åŠ¨æ€åœ°åŠ å…¥åˆ°é›†åˆä¸­ã€‚é’ˆå¯¹åŠ¨æ€æ•°æ®æ±‚å¾— Top K å°±æ˜¯å®æ—¶ Top Kã€‚ä¸¾ä¸ªä¾‹å­ã€‚ä¸€ä¸ªæ•°æ®é›†åˆä¸­æœ‰ä¸¤ä¸ªæ“ä½œï¼Œä¸€ä¸ªæ˜¯æ·»åŠ æ•°æ®ï¼Œå¦ä¸€ä¸ªè¯¢é—®å½“å‰çš„å‰ K å¤§æ•°æ®ã€‚å¦‚æœæ¯æ¬¡è¯¢é—®å‰ K å¤§æ•°æ®ï¼Œæˆ‘ä»¬éƒ½åŸºäºå½“å‰çš„æ•°æ®é‡æ–°è®¡ç®—çš„è¯ï¼Œé‚£æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(nlogK)ï¼Œn è¡¨ç¤ºå½“å‰çš„æ•°æ®çš„å¤§å°ã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä¸€ç›´éƒ½ç»´æŠ¤ä¸€ä¸ª K å¤§å°çš„å°é¡¶å †ï¼Œå½“æœ‰æ•°æ®è¢«æ·»åŠ åˆ°é›†åˆä¸­æ—¶ï¼Œæˆ‘ä»¬å°±æ‹¿å®ƒä¸å †é¡¶çš„å…ƒç´ å¯¹æ¯”ã€‚å¦‚æœæ¯”å †é¡¶å…ƒç´ å¤§ï¼Œæˆ‘ä»¬å°±æŠŠå †é¡¶å…ƒç´ åˆ é™¤ï¼Œå¹¶ä¸”å°†è¿™ä¸ªå…ƒç´ æ’å…¥åˆ°å †ä¸­ï¼›å¦‚æœæ¯”å †é¡¶å…ƒç´ å°ï¼Œåˆ™ä¸åšå¤„ç†ã€‚è¿™æ ·ï¼Œæ— è®ºä»»ä½•æ—¶å€™éœ€è¦æŸ¥è¯¢å½“å‰çš„å‰ K å¤§æ•°æ®ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç«‹åˆ»è¿”å›ç»™ä»–ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><code>æ±‚ä¸­ä½æ•°ï¼Ÿ</code></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818121910.jpg"></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818121913.jpg"></p><pre class="line-numbers language-none"><code class="language-none">å€ŸåŠ©å †ï¼Œä¸ç”¨æ’åºï¼Œå°±å¯ä»¥éå¸¸é«˜æ•ˆåœ°å®ç°æ±‚ä¸­ä½æ•°æ“ä½œã€‚æˆ‘ä»¬éœ€è¦ç»´æŠ¤ä¸¤ä¸ªå †ï¼Œä¸€ä¸ªå¤§é¡¶å †ï¼Œä¸€ä¸ªå°é¡¶å †ã€‚å¤§é¡¶å †ä¸­å­˜å‚¨å‰åŠéƒ¨åˆ†æ•°æ®ï¼Œå°é¡¶å †ä¸­å­˜å‚¨ååŠéƒ¨åˆ†æ•°æ®ï¼Œä¸”å°é¡¶å †ä¸­çš„æ•°æ®éƒ½å¤§äºå¤§é¡¶å †ä¸­çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰ n ä¸ªæ•°æ®ï¼Œn æ˜¯å¶æ•°ï¼Œæˆ‘ä»¬ä»å°åˆ°å¤§æ’åºï¼Œé‚£å‰ n/2 ä¸ªæ•°æ®å­˜å‚¨åœ¨å¤§é¡¶å †ä¸­ï¼Œå n/2 ä¸ªæ•°æ®å­˜å‚¨åœ¨å°é¡¶å †ä¸­ã€‚è¿™æ ·ï¼Œå¤§é¡¶å †ä¸­çš„å †é¡¶å…ƒç´ å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ä¸­ä½æ•°ã€‚å¦‚æœ n æ˜¯å¥‡æ•°ï¼Œæƒ…å†µæ˜¯ç±»ä¼¼çš„ï¼Œå¤§é¡¶å †å°±å­˜å‚¨ n/2+1 ä¸ªæ•°æ®ï¼Œå°é¡¶å †ä¸­å°±å­˜å‚¨ n/2 ä¸ªæ•°æ®ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818121917.jpg"></p><pre class="line-numbers language-none"><code class="language-none">æ•°æ®æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œå½“æ–°æ·»åŠ ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¦‚ä½•è°ƒæ•´ä¸¤ä¸ªå †ï¼Œè®©å¤§é¡¶å †ä¸­çš„å †é¡¶å…ƒç´ ç»§ç»­æ˜¯ä¸­ä½æ•°å‘¢ï¼Ÿå¦‚æœæ–°åŠ å…¥çš„æ•°æ®å°äºç­‰äºå¤§é¡¶å †çš„å †é¡¶å…ƒç´ ï¼Œæˆ‘ä»¬å°±å°†è¿™ä¸ªæ–°æ•°æ®æ’å…¥åˆ°å¤§é¡¶å †ï¼›å¦åˆ™ï¼Œæˆ‘ä»¬å°±å°†è¿™ä¸ªæ–°æ•°æ®æ’å…¥åˆ°å°é¡¶å †ã€‚è¿™ä¸ªæ—¶å€™å°±æœ‰å¯èƒ½å‡ºç°ï¼Œä¸¤ä¸ªå †ä¸­çš„æ•°æ®ä¸ªæ•°ä¸ç¬¦åˆå‰é¢çº¦å®šçš„æƒ…å†µï¼šå¦‚æœ n æ˜¯å¶æ•°ï¼Œä¸¤ä¸ªå †ä¸­çš„æ•°æ®ä¸ªæ•°éƒ½æ˜¯ n/2 ï¼›å¦‚æœ n æ˜¯å¥‡æ•°ï¼Œå¤§é¡¶å †æœ‰ n/2 +1 ä¸ªæ•°æ®ï¼Œå°é¡¶å †æœ‰ n/2  ä¸ªæ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªå †ä¸­ä¸åœåœ°å°†å †é¡¶å…ƒç´ ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå †ï¼Œé€šè¿‡è¿™æ ·çš„è°ƒæ•´ï¼Œæ¥è®©ä¸¤ä¸ªå †ä¸­çš„æ•°æ®æ»¡è¶³ä¸Šé¢çš„çº¦å®šã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="äºŒåˆ†æŸ¥æ‰¾-O-logn"><a href="#äºŒåˆ†æŸ¥æ‰¾-O-logn" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾ O(logn)"></a>äºŒåˆ†æŸ¥æ‰¾ O(logn)</h2><h3 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h3><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818121924.jpg"></p><pre class="line-numbers language-none"><code class="language-none">é’ˆå¯¹ä¸€ä¸ªæœ‰åºçš„æ•°æ®é›†åˆæ¯æ¬¡éƒ½é€šè¿‡è·Ÿä¸­é—´å…ƒç´ æ¯”è¾ƒï¼Œå°†å¾…æŸ¥æ‰¾åŒºé—´ç¼©å°ä¸ºä¹‹å‰çš„ä¸€åŠï¼Œç›´åˆ°æ‰¾åˆ°è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œæˆ–åŒºé—´è¢«ç¼©å°ä¸º 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>æ—¶é—´å¤æ‚åº¦</code></p><p><img src="https://gitee.com/revelvy/picbed/raw/master/blog/img/20210818122035.jpg"></p><pre class="line-numbers language-none"><code class="language-none">ç­‰æ¯”æ•°åˆ—å…¶ä¸­ n/2k=1 æ—¶ï¼Œk çš„å€¼å°±æ˜¯æ€»å…±ç¼©å°çš„æ¬¡æ•°ã€‚è€Œæ¯ä¸€æ¬¡ç¼©å°æ“ä½œåªæ¶‰åŠä¸¤ä¸ªæ•°æ®çš„å¤§å°æ¯”è¾ƒï¼Œæ‰€ä»¥ç»è¿‡äº† k æ¬¡åŒºé—´ç¼©å°æ“ä½œï¼Œæ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(k)ã€‚é€šè¿‡ n/2k=1ï¼Œæˆ‘ä»¬å¯ä»¥æ±‚å¾— k=log2nï¼Œæ‰€ä»¥æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(log(n))ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><code>åº”ç”¨åœºæ™¯</code></p><pre class="line-numbers language-none"><code class="language-none">åªèƒ½ç”¨åœ¨æœ‰åºæ•°ç»„æ•°æ®é‡é€‚ä¸­<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="åº”ç”¨-1"><a href="#åº”ç”¨-1" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p><code>æœ‰åºæ•°ç»„ä¸­ä¸å­˜åœ¨é‡å¤å…ƒç´ </code></p><pre class="line-numbers language-none"><code class="language-none">lowã€highã€mid éƒ½æ˜¯æŒ‡æ•°ç»„ä¸‹æ ‡ï¼Œå…¶ä¸­ low å’Œ high è¡¨ç¤ºå½“å‰æŸ¥æ‰¾çš„åŒºé—´èŒƒå›´ï¼Œåˆå§‹ low=0ï¼Œ high=n-1ã€‚mid è¡¨ç¤º[low, high]çš„ä¸­é—´ä½ç½®ã€‚æˆ‘ä»¬é€šè¿‡å¯¹æ¯” a[mid]ä¸ value çš„å¤§å°ï¼Œæ¥æ›´æ–°æ¥ä¸‹æ¥è¦æŸ¥æ‰¾çš„åŒºé—´èŒƒå›´ï¼Œç›´åˆ°æ‰¾åˆ°æˆ–è€…åŒºé—´ç¼©å°ä¸º 0<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">bsearch</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> high <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>low <span class="token operator">&lt;=</span> high<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> mid <span class="token operator">=</span> <span class="token punctuation">(</span>low <span class="token operator">+</span> high<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      high <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">return</span> mid<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">ä¼˜åŒ–å¦‚æœ low å’Œ high æ¯”è¾ƒå¤§çš„è¯ï¼Œä¸¤è€…ä¹‹å’Œå°±æœ‰å¯èƒ½ä¼šæº¢å‡ºã€‚    <span class="token keyword">int</span> mid <span class="token operator">=</span>  low <span class="token operator">+</span> <span class="token punctuation">(</span>high<span class="token operator">-</span>low<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>ï¼ˆlow<span class="token operator">+</span>high<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>low<span class="token operator">+</span>high<span class="token operator">-</span>low<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>low<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">+</span><span class="token punctuation">(</span>high<span class="token operator">-</span>low<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token operator">=</span>low<span class="token operator">+</span><span class="token punctuation">(</span>high<span class="token operator">-</span>low<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span>æè‡´æ€§èƒ½<span class="token keyword">int</span> mid <span class="token operator">=</span>  low <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>1. æœ‰åºæ•°ç»„ä¸­å­˜åœ¨é‡å¤æ•°æ® æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ </code></p><pre class="line-numbers language-none"><code class="language-none">å¦‚æœæŸ¥æ‰¾çš„æ˜¯ä»»æ„ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œå½“ a[mid]ç­‰äºè¦æŸ¥æ‰¾çš„å€¼æ—¶ï¼Œa[mid]å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„å…ƒç´ ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ±‚è§£çš„æ˜¯ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ï¼Œå½“ a[mid]ç­‰äºè¦æŸ¥æ‰¾çš„å€¼æ—¶ï¼Œå°±éœ€è¦ç¡®è®¤ä¸€ä¸‹è¿™ä¸ª a[mid]æ˜¯ä¸æ˜¯ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚é‡ç‚¹çœ‹ç¬¬ 11 è¡Œä»£ç ã€‚å¦‚æœ mid ç­‰äº 0ï¼Œé‚£è¿™ä¸ªå…ƒç´ å·²ç»æ˜¯æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œé‚£å®ƒè‚¯å®šæ˜¯æˆ‘ä»¬è¦æ‰¾çš„ï¼›å¦‚æœ mid ä¸ç­‰äº 0ï¼Œä½† a[mid]çš„å‰ä¸€ä¸ªå…ƒç´  a[mid-1]ä¸ç­‰äº valueï¼Œé‚£ä¹Ÿè¯´æ˜ a[mid]å°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„ç¬¬ä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">bsearch</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> high <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>low <span class="token operator">&lt;=</span> high<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> mid <span class="token operator">=</span>  low <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      high <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> mid<span class="token punctuation">;</span>      <span class="token keyword">else</span> high <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>2. æœ‰åºæ•°ç»„ä¸­å­˜åœ¨é‡å¤æ•°æ® æŸ¥æ‰¾æœ€åä¸€ä¸ªå€¼ç­‰äºç»™å®šå€¼çš„å…ƒç´ </code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">bsearch</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> high <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>low <span class="token operator">&lt;=</span> high<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> mid <span class="token operator">=</span>  low <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>       high <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mid <span class="token operator">==</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> mid<span class="token punctuation">;</span>      <span class="token keyword">else</span> high <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>3. æœ‰åºæ•°ç»„ä¸­å­˜åœ¨é‡å¤æ•°æ® æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå¤§äºç­‰äºç»™å®šå€¼çš„å…ƒç´ </code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">bsearch</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> high <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>low <span class="token operator">&lt;=</span> high<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> mid <span class="token operator">=</span>  low <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&lt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mid <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> mid<span class="token punctuation">;</span>      <span class="token keyword">else</span> high <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>4. æœ‰åºæ•°ç»„ä¸­å­˜åœ¨é‡å¤æ•°æ® æŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºç»™å®šå€¼çš„å…ƒç´ </code></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">bsearch7</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">int</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">int</span> low <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> high <span class="token operator">=</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span>low <span class="token operator">&lt;=</span> high<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> mid <span class="token operator">=</span>  low <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>high <span class="token operator">-</span> low<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid<span class="token punctuation">]</span> <span class="token operator">&gt;</span> value<span class="token punctuation">)</span> <span class="token punctuation">{</span>      high <span class="token operator">=</span> mid <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>mid <span class="token operator">==</span> n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>a<span class="token punctuation">[</span>mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> mid<span class="token punctuation">;</span>      <span class="token keyword">else</span> low <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="å¦‚ä½•å®šä½å‡º-IP-åœ°å€çš„å½’å±åœ°ï¼Ÿ"><a href="#å¦‚ä½•å®šä½å‡º-IP-åœ°å€çš„å½’å±åœ°ï¼Ÿ" class="headerlink" title="å¦‚ä½•å®šä½å‡º IP  åœ°å€çš„å½’å±åœ°ï¼Ÿ"></a>å¦‚ä½•å®šä½å‡º IP  åœ°å€çš„å½’å±åœ°ï¼Ÿ</h3><pre class="line-numbers language-none"><code class="language-none">å…ˆå°†IPè½¬æ¢ä¸ºæ•´æ•°é€šè¿‡äºŒåˆ†æŸ¥æ‰¾ï¼Œæ‰¾åˆ°æœ€åä¸€ä¸ªèµ·å§‹ IP å°äºç­‰äºè¿™ä¸ª IP çš„ IP åŒºé—´ç„¶åï¼Œæ£€æŸ¥è¿™ä¸ª IP æ˜¯å¦åœ¨è¿™ä¸ª IP åŒºé—´å†…ï¼Œå¦‚æœåœ¨ï¼Œæˆ‘ä»¬å°±å–å‡ºå¯¹åº”çš„å½’å±åœ°æ˜¾ç¤ºï¼›å¦‚æœä¸åœ¨ï¼Œå°±è¿”å›æœªæŸ¥æ‰¾åˆ°ã€‚è½¬åŒ–ä¸ºç¬¬å››ç§å˜å½¢é—®é¢˜â€œåœ¨æœ‰åºæ•°ç»„ä¸­ï¼ŒæŸ¥æ‰¾æœ€åä¸€ä¸ªå°äºç­‰äºæŸä¸ªç»™å®šå€¼çš„å…ƒç´ â€äº†ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="å¿«é€Ÿé€‰æ‹©"><a href="#å¿«é€Ÿé€‰æ‹©" class="headerlink" title="å¿«é€Ÿé€‰æ‹©"></a>å¿«é€Ÿé€‰æ‹©</h2><pre class="line-numbers language-none"><code class="language-none">å¿«é€Ÿé€‰æ‹©æ’åºï¼ˆQuick Selectï¼‰ç”¨äºæŸ¥æ‰¾æ— åºåˆ—è¡¨ä¸­çš„ç¬¬kä¸ªæœ€å°å…ƒç´ ã€‚è¿™ç§ç®—æ³•åŠå…¶å˜ä½“ï¼Œæ˜¯å®è·µä¸­æœ€å¸¸ç”¨çš„é«˜æ•ˆé€‰æ‹©ç®—æ³•ã€‚é€‰æ‹©ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†æ¥å¯¹å…ƒç´ è¿›è¡Œåˆ†åŒºï¼Œå°†å°äºå’Œå¤§äºåŸºå‡†çš„å…ƒç´ åˆ†åœ¨åŸºå‡†å·¦è¾¹å’Œå³è¾¹çš„ä¸¤ä¸ªåŒºåŸŸã€‚ä¸åŒçš„æ˜¯ï¼Œå¿«é€Ÿé€‰æ‹©å¹¶ä¸é€’å½’è®¿é—®åŒè¾¹ï¼Œè€Œæ˜¯åªé€’å½’è¿›å…¥ä¸€è¾¹çš„å…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ä¸ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
